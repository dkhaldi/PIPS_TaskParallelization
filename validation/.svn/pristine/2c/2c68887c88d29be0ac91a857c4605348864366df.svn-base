
C
C  *********************************************************************
C  *   SUBROUTINE TO SET THE ARRAY POINTERS FOR VECTORIZING THE CODE.  *
C  *********************************************************************
C
      SUBROUTINE PSET(NX,NY,NZ,NT,NTIME,NWINDX,NWINDY,NSINKS,NFILT,
     *XSTART,YSTART,ZSTART,TSTART,DELTAX,DELTAY,DELTAZ,DELTAT,PHI,DL,
     *DX,DY,DZ,WORK,IB,IK,ITY,NCOUNT,NPRINT,NGRAPH,NPSTEP,NGSTEP)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
      DIMENSION  WORK(1200000)
C     CHARACTER DUMMY
      COMMON/LAKE/SX,SIGX,SY,SIGY,ZNOT,SFX,SFY,FLX,FLY,BASE,TSL,H0,ZW,ZL
      COMMON/SOURCE/INIT(2,2),NSOUR(2),IX(2,2),JY(2,2),KZ(2,2),
     * IVAL(2,2),NSX(2,2),NSY(2,2),NSZ(2,2),ISR(2,2)
      COMMON/LEVEL/KK1,KK2,KK3,KK4,IYHOM,IGEO,IUGX,IVGY,LT0,LT1,ICPU
      COMMON/STRCH/ALP,BET,DH,ZH,UG,VG,T1,T2,DT,TOL,ALPHA,HAMP,BUMP
      COMMON/CPU/CINIT,CINHC,CINVC,CINHT,CINVT,CINPI,CINHU,CINVU,
     *CINHV,CINVV,CINHW,CINVW,CINPR,CINBL,CINFL,CINMN
C (0,1)
C     BEGIN BLOCK
C (0,2)

      L3 = NX*NY*NZ
C (0,3)
      L2 = NX*NY
C (0,4)
      L1 = NZ
C (0,5)

      LC = 1
C (0,6)
      LAST = L3
C (0,7)
C **   PREVIOUS STEPS OF C(X,Y,Z,T-1) FOR THE TIME SCHEME             **
      LCSTEP = LAST+1
C (0,8)
      LAST = LAST+L3
C (0,9)
C **   MESO-PERTURBATION POTENTIAL TEMPERATURE POTT(X,Y,Z,T)          **
      LPOT = LAST+1
C (0,10)
      LAST = LAST+L3
C (0,11)
C **   PREVIOUS STEPS OF POTT(X,Y,Z,T-1) FOR THE TIME SCHEME          **
      LTSTEP = LAST+1
C (0,12)
      LAST = LAST+L3
C (0,13)
C **   MESO-PERTURBATION U - WIND COMPONENT UX(X,Y,Z,T)               **
      LUX = LAST+1
C (0,14)
      LAST = LAST+L3
C (0,15)
C **   PREVIOUS STEPS OF UX(X,Y,Z,T-1) FOR THE TIME SCHEME            **
      LUSTEP = LAST+1
C (0,16)
      LAST = LAST+L3
C (0,17)
C **   MESO-PERTURBATION V - WIND COMPONENT VY(X,Y,Z,T)               **
      LVY = LAST+1
C (0,18)
      LAST = LAST+L3
C (0,19)
C **   PREVIOUS STEPS OF VY(X,Y,Z,T-1) FOR THE TIME SCHEME            **
      LVSTEP = LAST+1
C (0,20)
      LAST = LAST+L3
C (0,21)
C **   MESO-PERTURBATION W - WIND COMPONENT WZ(X,Y,Z,T)               **
      LWZ = LAST+1
C (0,22)
      LAST = LAST+L3
C (0,23)
C **   MESO-PERTURBATION PRESSURE PI PRESS(X,Y,Z,T)                   **
      LPI = LAST+1
C (0,24)
      LAST = LAST+L3
C (0,25)
C **   PREVIOUS STEP OF PRESSURE PI PRESS(X,Y,Z,T)                    **
      LPSTEP = LAST+1
C (0,26)
      LAST = LAST+L3
C (0,27)
C **   SOURCES OR SINKS FOR THE POLLUTANTS  C,  Q(X,Y,Z)              **
      LQ = LAST+1
C (0,28)
      LAST = LAST+L3
C (0,29)
C **   DIFFUSSIVITY COEFFICIENT FOR MOMENTUM DKZ(X,Y,Z)=DKZM(X,Y,Z)   **
      LDKZM = LAST+1
C (0,30)
      LAST = LAST+L3
C (0,31)
C **   DIFFUSSIVITY COEFFICIENT FOR HEAT DKZ(X,Y,Z)=DKZH(X,Y,Z)       **
      LDKZH = LAST+1
C (0,32)
      LAST = LAST+L3
C (0,33)
C **   TERRAIN ELEVATION IN METERS ELEV(X,Y)                          **
      LELEV = LAST+1
C (0,34)
      LAST = LAST+L2
C (0,35)
C **   TERRAIN X-GRADIENT IN METERS ELEVX(X,Y)                        **
      LELEVX = LAST+1
C (0,36)
      LAST = LAST+L2
C (0,37)
C **   TERRAIN Y-GRADIENT IN METERS ELEVY(X,Y)                        **
      LELEVY = LAST+1
C (0,38)
      LAST = LAST+L2
C (0,39)
C **   ROUGHNESS LENGTH OF TERRAIN IN METERS Z0(X,Y)                  **
      LZ0 = LAST+1
C (0,40)
      LAST = LAST+L2
C (0,41)
C **   MIXING HEIGHT OR BOUNDARY LAYER HEIGHT HMIX(X,Y)               **
      LHMIX = LAST+1
C (0,42)
      LAST = LAST+L2
C (0,43)
C **   MIXING HEIGHT AT THE PREVIOUS TIME STEP STEPH(X,Y)             **
      LSTEPH = LAST+1
C (0,44)
      LAST = LAST+L2
C (0,45)
C **   MEAN TEMPERATURE IN THE SURFACE LAYER TAVR(X,Y)                **
      LTAVR = LAST+1
C (0,46)
      LAST = LAST+L2
C (0,47)
C **   MONIN-OBUKHOV LENGTH OBUK(X,Y)                                 **
      LOBUK = LAST+1
C (0,48)
      LAST = LAST+L2
C (0,49)
C **   FRICTION VELOCITY USTAR USTR(X,Y)                              **
      LUSTR = LAST+1
C (0,50)
      LAST = LAST+L2
C (0,51)
C **   TURBULENT  TEMPERATURE THETASTAR TSTR(X,Y)                     **
      LTSTR = LAST+1
C (0,52)
      LAST = LAST+L2
C (0,53)
C **   DRY DEPOSITION VELOCITY VDEP(X,Y)                              **
      LVDEP = LAST+1
C (0,54)
      LAST = LAST+L2
C (0,55)
C **   SURFACE DEPOSITION OF  POLLUTANTS  DEP(X,Y)                    **
      LDEP = LAST+1
C (0,56)
      LAST = LAST+L2
C (0,57)
C **   VERTICAL HEIGHT Z  ZET(Z)                                      **
      LZET = LAST+1
C (0,58)
      LAST = LAST+L1
C (0,59)
C **   UNEQUAL POINT STRECHED PARAMETER  DH/DZ = HVAR(Z)              **
      LHVAR = LAST+1
C (0,60)
      LAST = LAST+L1
C (0,61)
C **   MEAN OR SYNOPTIC U-WIND COMPONENT  UM(Z)                       **
      LUM = LAST+1
C (0,62)
      LAST = LAST+L1
C (0,63)
C **   MEAN OR SYNOPTIC V-WIND COMPONENT  VM(Z)                       **
      LVM = LAST+1
C (0,64)
      LAST = LAST+L1
C (0,65)
C **   GEOSTROPHIC U-WIND COMPONENT  UG(Z)                            **
      LUG = LAST+1
C (0,66)
      LAST = LAST+L1
C (0,67)
C **   GEOSTROPHIC V-WIND COMPONENT  VG(Z)                            **
      LVG = LAST+1
C (0,68)
      LAST = LAST+L1
C (0,69)
C **   MEAN OR SYNOPTIC POTENTIAL TEMPERATURE TM(Z)                   **
      LTM = LAST+1
C (0,70)
      LAST = LAST+L1
C (0,71)
C **   MEAN OR SYNOPTIC EDDY DIFFUSSIVITY DKM(Z)                      **
      LKM = LAST+1
C (0,72)
      LAST = LAST+L1
C (0,73)
      LDCDX = LAST+1
C (0,74)
      LAST = LAST+L3
C (0,75)
C **   DERIVATIVES WITH RESPECT TO Y  DCDY(X,Y,Z)                     **
      LDCDY = LAST+1
C (0,76)
      LAST = LAST+L3
C (0,77)
C **   HELP VECTOR FOR PADE SCHEME -CENTER ELEMENTS-                  **
      LAN = LAST+1
C (0,78)
      LAST = LAST+L1
C (0,79)
C **   HELP VECTOR FOR PADE SCHEME -LEFT   ELEMENTS-                  **
      LBN = LAST+1
C (0,80)
      LAST = LAST+L1
C (0,81)
C **   HELP VECTOR FOR PADE SCHEME -RIGHT  ELEMENTS-                  **
      LCN = LAST+1
C (0,82)
      LAST = LAST+L1
C (0,83)
C **   UTILITY VECTOR FOR NUMERICAL WORK                              **
      LHELP = LAST+1
C (0,84)
      LAST = LAST+MAX(NX, NY, NZ)
C (0,85)
C **   ANOTHER UTILITY VECTOR FOR DIRTY WORK                          **
      LHELPA = LAST+1
C (0,86)
      LAST = LAST+MAX(NX, NY, NZ)
C (0,87)
C **    WORK VECTOR FOR THE X-FFT                                     **
      LSAVEX = LAST+1
C (0,88)
      LAST = LAST+2*NX+15
C (0,89)
C **    WORK VECTOR FOR THE Y-FFT                                     **
      LSAVEY = LAST+1
C (0,90)
      LAST = LAST+2*NY+15
C (0,91)
C **    X-WAVENUMBERS  FOR FIRST DERIVATIVES                          **
      LFX = LAST+1
C (0,92)
      LAST = LAST+NX*0.5
C (0,93)
C **    X- WEIGHTS FOR HEAT AND POLLUTANTS X,Y SPECTRAL DIFFUSION     **
      LFXC = LAST+1
C (0,94)
      LAST = LAST+NX
C (0,95)
C **    X - WEIGHTS FOR MOMENTUM HORIZONTAL SPECTRAL DIFFUSION        **
      LFXX = LAST+1
C (0,96)
      LAST = LAST+NX*0.5
C (0,97)
C **    Y-WAVENUMBERS FOR FIRST DERIVATIVES                           **
      LFY = LAST+1
C (0,98)
      LAST = LAST+NY*0.5
C (0,99)
C **    Y- WEIGHTS FOR HEAT AND POLLUTANTS X,Y SPECTRAL DIFFUSION     **
      LFYC = LAST+1
C (0,100)
      LAST = LAST+NY
C (0,101)
C **    Y - WEIGHTS FOR MOMENTUM HORIZONTAL SPECTRAL DIFFUSION        **
      LFYY = LAST+1
C (0,102)
      LAST = LAST+NY*0.5
C (0,103)
C **    X - FILTER FOR DERIVATIVE  DIFFUSION                          **
      LFILX = LAST+1
C (0,104)
      LAST = LAST+NX
C (0,105)
C **    Y - FILTER FOR DERIVATIVE  DIFFUSION                          **
      LFILY = LAST+1
C (0,106)
      LAST = LAST+NY
C (0,107)
C **    Z - FILTER FOR THE SPONGE LAYER IN Z                          **
      LFILZ = LAST+1
C (0,108)
      LAST = LAST+NZ
C (0,109)

C
      CALL RUN(NX, NY, NZ, NT, NTIME, NWINDX, NWINDY, NSINKS, NFILT, 
     &XSTART, YSTART, ZSTART, TSTART, DELTAX, DELTAY, DELTAZ, DELTAT
     &, PHI, DL, DX, DY, DZ, IB, IK, ITY, NCOUNT, NPRINT, NGRAPH, 
     &NPSTEP, NGSTEP, LAST, WORK(LC), WORK(LCSTEP), WORK(LPOT), WORK(
     &LTSTEP), WORK(LUX), WORK(LUSTEP), WORK(LVY), WORK(LVSTEP), WORK
     &(LWZ), WORK(LPI), WORK(LPSTEP), WORK(LQ), WORK(LDKZM), WORK(
     &LDKZH), WORK(LELEV), WORK(LELEVX), WORK(LELEVY), WORK(LZ0), 
     &WORK(LHMIX), WORK(LSTEPH), WORK(LTAVR), WORK(LOBUK), WORK(LUSTR
     &), WORK(LTSTR), WORK(LVDEP), WORK(LDEP), WORK(LZET), WORK(LHVAR
     &), WORK(LUM), WORK(LVM), WORK(LUG), WORK(LVG), WORK(LTM), WORK(
     &LKM), WORK(LDCDX), WORK(LDCDY), WORK(LAN), WORK(LBN), WORK(LCN)
     &, WORK(LHELP), WORK(LHELPA), WORK(LSAVEX), WORK(LSAVEY), WORK(
     &LFX), WORK(LFXC), WORK(LFXX), WORK(LFY), WORK(LFYC), WORK(LFYY)
     &, WORK(LFILX), WORK(LFILY), WORK(LFILZ), L1, L2, L3)
C (0,110)
C
      RETURN
C     END BLOCK
      END
C
      SUBROUTINE RUN(NX,NY,NZ,NT,NTIME,NWINDX,ISH,NSMT,NFILT,
     * XSTART,YSTART,ZSTART,TSTART,DELTAX,DELTAY,DELTAZ,DELTAT,PHI,DL,
     * DX,DY,DZ,IB,IK,ITY,NCOUNT,NPRINT,NGRAPH,NPSTEP,NGSTEP,LFINAL,
     * C,STEPC,POTT,STEPT,UX,STEPU,VY,STEPV,WZ,PRES,STEPP,Q,DKZM,DKZH,
     * ELEV,ELEVX,ELEVY,Z0,HMIX,STEPH,TAVR,OBUK,USTR,TSTR,VDEP,DEP,
     * ZET,HVAR,UM,VM,UG,VG,TM,DKM,DCDX,DCDY,AN,BN,CN,HELP,HELPA,
     * SAVEX,SAVEY,FX,FXC,FXX,FY,FYC,FYY,FILX,FILY,FILZ,L1,L2,L3)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
C
C       VARIABLE DECLARATIONS
C
      DIMENSION  C(*),STEPC(*),POTT(*),STEPT(*),UX(*),STEPU(*),
     * VY(*),STEPV(*),WZ(*),PRES(*),STEPP(*),Q(*),DKZM(*),DKZH(*),
     * ELEV(*),ELEVX(*),ELEVY(*),Z0(*),HMIX(*),STEPH(*),TAVR(*),
     * OBUK(*),USTR(*),TSTR(*),VDEP(*), DEP(*),ZET(*),HVAR(*),
     * UM(*),VM(*),UG(*),VG(*),TM(*),DKM(*), DCDX(*),DCDY(*),
     * AN(*),BN(*),CN(*),HELP(*),HELPA(*), SAVEX(*),SAVEY(*),
     * FX(*),FXC(*),FXX(*),FY(*),FYC(*),FYY(*),FILX(*),FILY(*),FILZ(*)
C (0,1)
      RETURN
      END
!!
!! file for simple_apsi.f
!!

C
C  *********************************************************************
C  *   SUBROUTINE TO SET THE ARRAY POINTERS FOR VECTORIZING THE CODE.  *
C  *********************************************************************
C
      SUBROUTINE PSET(NX,NY,NZ,NT,NTIME,NWINDX,NWINDY,NSINKS,NFILT,
     *XSTART,YSTART,ZSTART,TSTART,DELTAX,DELTAY,DELTAZ,DELTAT,PHI,DL,
     *DX,DY,DZ,WORK,IB,IK,ITY,NCOUNT,NPRINT,NGRAPH,NPSTEP,NGSTEP)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
      DIMENSION  WORK(1200000)
C     CHARACTER DUMMY
      COMMON/LAKE/SX,SIGX,SY,SIGY,ZNOT,SFX,SFY,FLX,FLY,BASE,TSL,H0,ZW,ZL
     x 
      COMMON/SOURCE/INIT(2,2),NSOUR(2),IX(2,2),JY(2,2),KZ(2,2),
     * IVAL(2,2),NSX(2,2),NSY(2,2),NSZ(2,2),ISR(2,2)
      COMMON/LEVEL/KK1,KK2,KK3,KK4,IYHOM,IGEO,IUGX,IVGY,LT0,LT1,ICPU
      COMMON/STRCH/ALP,BET,DH,ZH,UG,VG,T1,T2,DT,TOL,ALPHA,HAMP,BUMP
      COMMON/CPU/CINIT,CINHC,CINVC,CINHT,CINVT,CINPI,CINHU,CINVU,
     *CINHV,CINVV,CINHW,CINVW,CINPR,CINBL,CINFL,CINMN
C (0,1)
      INTEGER*8 I_PIPS_RUN_HELPA
      COMMON /PIPS_RUN_HELPA/ I_PIPS_RUN_HELPA
      INTEGER*8 I_PIPS_RUN_SAVEX
      COMMON /PIPS_RUN_SAVEX/ I_PIPS_RUN_SAVEX
      INTEGER*8 I_PIPS_RUN_SAVEY
      COMMON /PIPS_RUN_SAVEY/ I_PIPS_RUN_SAVEY
      INTEGER*8 I_PIPS_RUN_FX
      COMMON /PIPS_RUN_FX/ I_PIPS_RUN_FX
      INTEGER*8 I_PIPS_RUN_FXC
      COMMON /PIPS_RUN_FXC/ I_PIPS_RUN_FXC
      INTEGER*8 I_PIPS_RUN_FXX
      COMMON /PIPS_RUN_FXX/ I_PIPS_RUN_FXX
      INTEGER*8 I_PIPS_RUN_FY
      COMMON /PIPS_RUN_FY/ I_PIPS_RUN_FY
      INTEGER*8 I_PIPS_RUN_FYC
      COMMON /PIPS_RUN_FYC/ I_PIPS_RUN_FYC
      INTEGER*8 I_PIPS_RUN_FYY
      COMMON /PIPS_RUN_FYY/ I_PIPS_RUN_FYY
C     BEGIN BLOCK
C (0,2)

      L3 = NX*NY*NZ
C (0,3)
      L2 = NX*NY
C (0,4)
      L1 = NZ
C (0,5)

      LC = 1
C (0,6)
      LAST = L3
C (0,7)
C **   PREVIOUS STEPS OF C(X,Y,Z,T-1) FOR THE TIME SCHEME             **
      LCSTEP = LAST+1
C (0,8)
      LAST = LAST+L3
C (0,9)
C **   MESO-PERTURBATION POTENTIAL TEMPERATURE POTT(X,Y,Z,T)          **
      LPOT = LAST+1
C (0,10)
      LAST = LAST+L3
C (0,11)
C **   PREVIOUS STEPS OF POTT(X,Y,Z,T-1) FOR THE TIME SCHEME          **
      LTSTEP = LAST+1
C (0,12)
      LAST = LAST+L3
C (0,13)
C **   MESO-PERTURBATION U - WIND COMPONENT UX(X,Y,Z,T)               **
      LUX = LAST+1
C (0,14)
      LAST = LAST+L3
C (0,15)
C **   PREVIOUS STEPS OF UX(X,Y,Z,T-1) FOR THE TIME SCHEME            **
      LUSTEP = LAST+1
C (0,16)
      LAST = LAST+L3
C (0,17)
C **   MESO-PERTURBATION V - WIND COMPONENT VY(X,Y,Z,T)               **
      LVY = LAST+1
C (0,18)
      LAST = LAST+L3
C (0,19)
C **   PREVIOUS STEPS OF VY(X,Y,Z,T-1) FOR THE TIME SCHEME            **
      LVSTEP = LAST+1
C (0,20)
      LAST = LAST+L3
C (0,21)
C **   MESO-PERTURBATION W - WIND COMPONENT WZ(X,Y,Z,T)               **
      LWZ = LAST+1
C (0,22)
      LAST = LAST+L3
C (0,23)
C **   MESO-PERTURBATION PRESSURE PI PRESS(X,Y,Z,T)                   **
      LPI = LAST+1
C (0,24)
      LAST = LAST+L3
C (0,25)
C **   PREVIOUS STEP OF PRESSURE PI PRESS(X,Y,Z,T)                    **
      LPSTEP = LAST+1
C (0,26)
      LAST = LAST+L3
C (0,27)
C **   SOURCES OR SINKS FOR THE POLLUTANTS  C,  Q(X,Y,Z)              **
      LQ = LAST+1
C (0,28)
      LAST = LAST+L3
C (0,29)
C **   DIFFUSSIVITY COEFFICIENT FOR MOMENTUM DKZ(X,Y,Z)=DKZM(X,Y,Z)   **
      LDKZM = LAST+1
C (0,30)
      LAST = LAST+L3
C (0,31)
C **   DIFFUSSIVITY COEFFICIENT FOR HEAT DKZ(X,Y,Z)=DKZH(X,Y,Z)       **
      LDKZH = LAST+1
C (0,32)
      LAST = LAST+L3
C (0,33)
C **   TERRAIN ELEVATION IN METERS ELEV(X,Y)                          **
      LELEV = LAST+1
C (0,34)
      LAST = LAST+L2
C (0,35)
C **   TERRAIN X-GRADIENT IN METERS ELEVX(X,Y)                        **
      LELEVX = LAST+1
C (0,36)
      LAST = LAST+L2
C (0,37)
C **   TERRAIN Y-GRADIENT IN METERS ELEVY(X,Y)                        **
      LELEVY = LAST+1
C (0,38)
      LAST = LAST+L2
C (0,39)
C **   ROUGHNESS LENGTH OF TERRAIN IN METERS Z0(X,Y)                  **
      LZ0 = LAST+1
C (0,40)
      LAST = LAST+L2
C (0,41)
C **   MIXING HEIGHT OR BOUNDARY LAYER HEIGHT HMIX(X,Y)               **
      LHMIX = LAST+1
C (0,42)
      LAST = LAST+L2
C (0,43)
C **   MIXING HEIGHT AT THE PREVIOUS TIME STEP STEPH(X,Y)             **
      LSTEPH = LAST+1
C (0,44)
      LAST = LAST+L2
C (0,45)
C **   MEAN TEMPERATURE IN THE SURFACE LAYER TAVR(X,Y)                **
      LTAVR = LAST+1
C (0,46)
      LAST = LAST+L2
C (0,47)
C **   MONIN-OBUKHOV LENGTH OBUK(X,Y)                                 **
      LOBUK = LAST+1
C (0,48)
      LAST = LAST+L2
C (0,49)
C **   FRICTION VELOCITY USTAR USTR(X,Y)                              **
      LUSTR = LAST+1
C (0,50)
      LAST = LAST+L2
C (0,51)
C **   TURBULENT  TEMPERATURE THETASTAR TSTR(X,Y)                     **
      LTSTR = LAST+1
C (0,52)
      LAST = LAST+L2
C (0,53)
C **   DRY DEPOSITION VELOCITY VDEP(X,Y)                              **
      LVDEP = LAST+1
C (0,54)
      LAST = LAST+L2
C (0,55)
C **   SURFACE DEPOSITION OF  POLLUTANTS  DEP(X,Y)                    **
      LDEP = LAST+1
C (0,56)
      LAST = LAST+L2
C (0,57)
C **   VERTICAL HEIGHT Z  ZET(Z)                                      **
      LZET = LAST+1
C (0,58)
      LAST = LAST+L1
C (0,59)
C **   UNEQUAL POINT STRECHED PARAMETER  DH/DZ = HVAR(Z)              **
      LHVAR = LAST+1
C (0,60)
      LAST = LAST+L1
C (0,61)
C **   MEAN OR SYNOPTIC U-WIND COMPONENT  UM(Z)                       **
      LUM = LAST+1
C (0,62)
      LAST = LAST+L1
C (0,63)
C **   MEAN OR SYNOPTIC V-WIND COMPONENT  VM(Z)                       **
      LVM = LAST+1
C (0,64)
      LAST = LAST+L1
C (0,65)
C **   GEOSTROPHIC U-WIND COMPONENT  UG(Z)                            **
      LUG = LAST+1
C (0,66)
      LAST = LAST+L1
C (0,67)
C **   GEOSTROPHIC V-WIND COMPONENT  VG(Z)                            **
      LVG = LAST+1
C (0,68)
      LAST = LAST+L1
C (0,69)
C **   MEAN OR SYNOPTIC POTENTIAL TEMPERATURE TM(Z)                   **
      LTM = LAST+1
C (0,70)
      LAST = LAST+L1
C (0,71)
C **   MEAN OR SYNOPTIC EDDY DIFFUSSIVITY DKM(Z)                      **
      LKM = LAST+1
C (0,72)
      LAST = LAST+L1
C (0,73)
      LDCDX = LAST+1
C (0,74)
      LAST = LAST+L3
C (0,75)
C **   DERIVATIVES WITH RESPECT TO Y  DCDY(X,Y,Z)                     **
      LDCDY = LAST+1
C (0,76)
      LAST = LAST+L3
C (0,77)
C **   HELP VECTOR FOR PADE SCHEME -CENTER ELEMENTS-                  **
      LAN = LAST+1
C (0,78)
      LAST = LAST+L1
C (0,79)
C **   HELP VECTOR FOR PADE SCHEME -LEFT   ELEMENTS-                  **
      LBN = LAST+1
C (0,80)
      LAST = LAST+L1
C (0,81)
C **   HELP VECTOR FOR PADE SCHEME -RIGHT  ELEMENTS-                  **
      LCN = LAST+1
C (0,82)
      LAST = LAST+L1
C (0,83)
C **   UTILITY VECTOR FOR NUMERICAL WORK                              **
      LHELP = LAST+1
C (0,84)
      LAST = LAST+MAX(NX, NY, NZ)
C (0,85)
C **   ANOTHER UTILITY VECTOR FOR DIRTY WORK                          **
      LHELPA = LAST+1
C (0,86)
      LAST = LAST+MAX(NX, NY, NZ)
C (0,87)
C **    WORK VECTOR FOR THE X-FFT                                     **
      LSAVEX = LAST+1
C (0,88)
      LAST = LAST+2*NX+15
C (0,89)
C **    WORK VECTOR FOR THE Y-FFT                                     **
      LSAVEY = LAST+1
C (0,90)
      LAST = LAST+2*NY+15
C (0,91)
C **    X-WAVENUMBERS  FOR FIRST DERIVATIVES                          **
      LFX = LAST+1
C (0,92)
      LAST = LAST+NX*0.5
C (0,93)
C **    X- WEIGHTS FOR HEAT AND POLLUTANTS X,Y SPECTRAL DIFFUSION     **
      LFXC = LAST+1
C (0,94)
      LAST = LAST+NX
C (0,95)
C **    X - WEIGHTS FOR MOMENTUM HORIZONTAL SPECTRAL DIFFUSION        **
      LFXX = LAST+1
C (0,96)
      LAST = LAST+NX*0.5
C (0,97)
C **    Y-WAVENUMBERS FOR FIRST DERIVATIVES                           **
      LFY = LAST+1
C (0,98)
      LAST = LAST+NY*0.5
C (0,99)
C **    Y- WEIGHTS FOR HEAT AND POLLUTANTS X,Y SPECTRAL DIFFUSION     **
      LFYC = LAST+1
C (0,100)
      LAST = LAST+NY
C (0,101)
C **    Y - WEIGHTS FOR MOMENTUM HORIZONTAL SPECTRAL DIFFUSION        **
      LFYY = LAST+1
C (0,102)
      LAST = LAST+NY*0.5
C (0,103)
C **    X - FILTER FOR DERIVATIVE  DIFFUSION                          **
      LFILX = LAST+1
C (0,104)
      LAST = LAST+NX
C (0,105)
C **    Y - FILTER FOR DERIVATIVE  DIFFUSION                          **
      LFILY = LAST+1
C (0,106)
      LAST = LAST+NY
C (0,107)
C **    Z - FILTER FOR THE SPONGE LAYER IN Z                          **
      LFILZ = LAST+1
C (0,108)
      LAST = LAST+NZ
C (0,109)
      I_PIPS_RUN_HELPA = 1200000-(LHELPA-1)
      I_PIPS_RUN_SAVEX = 1200000-(LSAVEX-1)
      I_PIPS_RUN_SAVEY = 1200000-(LSAVEY-1)
      I_PIPS_RUN_FX = 1200000-(LFX-1)
      I_PIPS_RUN_FXC = 1200000-(LFXC-1)
      I_PIPS_RUN_FXX = 1200000-(LFXX-1)
      I_PIPS_RUN_FY = 1200000-(LFY-1)
      I_PIPS_RUN_FYC = 1200000-(LFYC-1)
      I_PIPS_RUN_FYY = 1200000-(LFYY-1)

C
      CALL RUN(NX, NY, NZ, NT, NTIME, NWINDX, NWINDY, NSINKS, NFILT, 
     &XSTART, YSTART, ZSTART, TSTART, DELTAX, DELTAY, DELTAZ, DELTAT
     &, PHI, DL, DX, DY, DZ, IB, IK, ITY, NCOUNT, NPRINT, NGRAPH, 
     &NPSTEP, NGSTEP, LAST, WORK(LC), WORK(LCSTEP), WORK(LPOT), WORK(
     &LTSTEP), WORK(LUX), WORK(LUSTEP), WORK(LVY), WORK(LVSTEP), WORK
     &(LWZ), WORK(LPI), WORK(LPSTEP), WORK(LQ), WORK(LDKZM), WORK(
     &LDKZH), WORK(LELEV), WORK(LELEVX), WORK(LELEVY), WORK(LZ0), 
     &WORK(LHMIX), WORK(LSTEPH), WORK(LTAVR), WORK(LOBUK), WORK(LUSTR
     &), WORK(LTSTR), WORK(LVDEP), WORK(LDEP), WORK(LZET), WORK(LHVAR
     &), WORK(LUM), WORK(LVM), WORK(LUG), WORK(LVG), WORK(LTM), WORK(
     &LKM), WORK(LDCDX), WORK(LDCDY), WORK(LAN), WORK(LBN), WORK(LCN)
     &, WORK(LHELP), WORK(LHELPA), WORK(LSAVEX), WORK(LSAVEY), WORK(
     &LFX), WORK(LFXC), WORK(LFXX), WORK(LFY), WORK(LFYC), WORK(LFYY)
     &, WORK(LFILX), WORK(LFILY), WORK(LFILZ), L1, L2, L3)
C (0,110)
C
      RETURN
C     END BLOCK
      END
C
      SUBROUTINE RUN(NX,NY,NZ,NT,NTIME,NWINDX,ISH,NSMT,NFILT,
     * XSTART,YSTART,ZSTART,TSTART,DELTAX,DELTAY,DELTAZ,DELTAT,PHI,DL,
     * DX,DY,DZ,IB,IK,ITY,NCOUNT,NPRINT,NGRAPH,NPSTEP,NGSTEP,LFINAL,
     * C,STEPC,POTT,STEPT,UX,STEPU,VY,STEPV,WZ,PRES,STEPP,Q,DKZM,DKZH,
     * ELEV,ELEVX,ELEVY,Z0,HMIX,STEPH,TAVR,OBUK,USTR,TSTR,VDEP,DEP,
     * ZET,HVAR,UM,VM,UG,VG,TM,DKM,DCDX,DCDY,AN,BN,CN,HELP,HELPA,
     * SAVEX,SAVEY,FX,FXC,FXX,FY,FYC,FYY,FILX,FILY,FILZ,L1,L2,L3)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
C
C       VARIABLE DECLARATIONS
C
      DIMENSION  C(1200000),STEPC(-L3+1200000),POTT(-2*L3+1200000),STEPT
     x (-3*L3+1200000),UX(-4*L3+1200000),STEPU(-5*L3+1200000),
     * VY(-6*L3+1200000),STEPV(-7*L3+1200000),WZ(-8*L3+1200000),PRES(-9*
     x L3+1200000),STEPP(-10*L3+1200000),Q(-11*L3+1200000),DKZM(-12*L3+1
     x 200000),DKZH(-13*L3+1200000),
     * ELEV(-14*L3+1200000),ELEVX(-L2-14*L3+1200000),ELEVY(-2*L2-14*L3+1
     x 200000),Z0(-3*L2-14*L3+1200000),HMIX(-4*L2-14*L3+1200000),STEPH(-
     x 5*L2-14*L3+1200000),TAVR(-6*L2-14*L3+1200000),
     * OBUK(-7*L2-14*L3+1200000),USTR(-8*L2-14*L3+1200000),TSTR(-9*L2-14
     x *L3+1200000),VDEP(-10*L2-14*L3+1200000), DEP(-11*L2-14*L3+1200000
     x ),ZET(-12*L2-14*L3+1200000),HVAR(-14*L3-12*L2-L1+1200000),
     * UM(-2*L1-12*L2-14*L3+1200000),VM(-3*L1-12*L2-14*L3+1200000),UG(-4
     x *L1-12*L2-14*L3+1200000),VG(-5*L1-12*L2-14*L3+1200000),TM(-6*L1-1
     x 2*L2-14*L3+1200000),DKM(-7*L1-12*L2-14*L3+1200000), DCDX(-8*L1-12
     x *L2-14*L3+1200000),DCDY(-8*L1-12*L2-15*L3+1200000),
     * AN(-8*L1-12*L2-16*L3+1200000),BN(-9*L1-12*L2-16*L3+1200000),CN(-1
     x 0*L1-12*L2-16*L3+1200000),HELP(-11*L1-12*L2-16*L3+1200000),HELPA(
     x I_PIPS_RUN_HELPA), SAVEX(I_PIPS_RUN_SAVEX),SAVEY(I_PIPS_RUN_SAVEY
     x ),
     * FX(I_PIPS_RUN_FX),FXC(I_PIPS_RUN_FXC),FXX(I_PIPS_RUN_FXX),FY(I_PI
     x PS_RUN_FY),FYC(I_PIPS_RUN_FYC),FYY(I_PIPS_RUN_FYY),FILX(L1+NY-LFI
     x NAL+NX+1200000),FILY(L1-LFINAL+NY+1200000),FILZ(L1-LFINAL+1200000
     x )
C (0,1)
      INTEGER*8 I_PIPS_RUN_HELPA
      COMMON /PIPS_RUN_HELPA/ I_PIPS_RUN_HELPA
      INTEGER*8 I_PIPS_RUN_SAVEX
      COMMON /PIPS_RUN_SAVEX/ I_PIPS_RUN_SAVEX
      INTEGER*8 I_PIPS_RUN_SAVEY
      COMMON /PIPS_RUN_SAVEY/ I_PIPS_RUN_SAVEY
      INTEGER*8 I_PIPS_RUN_FX
      COMMON /PIPS_RUN_FX/ I_PIPS_RUN_FX
      INTEGER*8 I_PIPS_RUN_FXC
      COMMON /PIPS_RUN_FXC/ I_PIPS_RUN_FXC
      INTEGER*8 I_PIPS_RUN_FXX
      COMMON /PIPS_RUN_FXX/ I_PIPS_RUN_FXX
      INTEGER*8 I_PIPS_RUN_FY
      COMMON /PIPS_RUN_FY/ I_PIPS_RUN_FY
      INTEGER*8 I_PIPS_RUN_FYC
      COMMON /PIPS_RUN_FYC/ I_PIPS_RUN_FYC
      INTEGER*8 I_PIPS_RUN_FYY
      COMMON /PIPS_RUN_FYY/ I_PIPS_RUN_FYY
      RETURN
      END
