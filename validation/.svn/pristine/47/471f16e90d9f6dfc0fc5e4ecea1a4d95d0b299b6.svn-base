# Lots of overflows and a wrong result for the loop regions. They are
# declared empty although they are not empty. So overflow handling
# must be wrong.

# The issue here is whether the information generated by x0 = ii*jj is
# captured or not by semantics and if this information has an impact
# on the region computation. Currently, there is no impact and wrong
# results are obtained in the three cases, after many overflows.

# So the preconditions are computed three times. The first two times
# the transformers are computed without using the context, but the
# second time a transformer refinement is applied. The third time, the
# transformer is computed within its context.

setenv WS linked_regions03
delete $WS

setproperty ABORT_ON_USER_ERROR TRUE

create $WS $WS.c

setproperty CONSTANT_PATH_EFFECTS  FALSE

# Not yet: see third case
#setproperty SEMANTICS_COMPUTE_TRANSFORMERS_IN_CONTEXT TRUE

echo
echo Transformers for "main"
echo

activate PRINT_CODE_TRANSFORMERS 
display PRINTED_FILE[main]

echo
echo Preconditions for "main": first case
echo

activate PRINT_CODE_PRECONDITIONS
display PRINTED_FILE[main]

echo
echo Regions for "main"
echo

activate PRINT_CODE_REGIONS 
display PRINTED_FILE[main]

echo
echo Preconditions for "main": second case (after transformer refinement)
echo

apply REFINE_TRANSFORMERS

activate PRINT_CODE_PRECONDITIONS
display PRINTED_FILE[main]

echo
echo Regions for "main" after transformer refinement
echo

activate PRINT_CODE_REGIONS 
display PRINTED_FILE[main]

close

echo
echo Let us try again from scratch for the third case, when context are used to compute transformers
echo

delete $WS

create $WS $WS.c

setproperty CONSTANT_PATH_EFFECTS  FALSE

# Third time, use context for transformers
setproperty SEMANTICS_COMPUTE_TRANSFORMERS_IN_CONTEXT TRUE

echo
echo Transformers for "main"
echo

activate PRINT_CODE_TRANSFORMERS 
display PRINTED_FILE[main]

echo
echo Preconditions for "main": third case
echo

activate PRINT_CODE_PRECONDITIONS
display PRINTED_FILE[main]

echo
echo Regions for "main"
echo

activate PRINT_CODE_REGIONS 
display PRINTED_FILE[main]

close
#delete $WS
quit
