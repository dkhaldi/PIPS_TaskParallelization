
C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

C
      SUBROUTINE ACAC(AC,EX,WORK)
C
C COMPLEX ANTISYMMETRIC TO COMPLEX ANTISYMMETRIC
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMPLEX AC(1),WORK(1),TEMP1,TEMP2,X,Y,BJ,BJSYM
      DIMENSION EX(1)
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0001

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0003

C  T() {}

      IF (LXSTEP) THEN                                                  0005

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0006
      ENDIF

C  T(NPTSINIT) {NPTS==NPTSINIT}

C
      NPTSINIT = NPTS                                                   0008

C  T(M) {NPTS<=2M+1, 2M<=NPTS}

      M = NPTS/2                                                        0009

C  T(NPTS) {M==NPTS}

      NPTS = M                                                          0010

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0011

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0012

C  T(ISTOP) {}

      ISTOP = 1+(MTRN-1)*MSKIP                                          0013

C  T(MNSKIP) {}

      MNSKIP = M*NSKIP                                                  0014

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0015

C  T(NSKIP2) {2NSKIP==NSKIP2}

      NSKIP2 = NSKIP*2                                                  0016

C  T(MP2) {M==MP2-2}

      MP2 = M+2                                                         0017

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = IEXSHF*2                                                 0018

C  T() {}

      FACT = REAL(ISIGN)/2.                                             0019

C  T(MNSH) {MNSKIP<=2MNSH+1, 2MNSH<=MNSKIP}

      MNSH = MNSKIP/2                                                   0020

C  T(IPROD) {IPROD==MNSH}

      IPROD = MNSH                                                      0021

C  T(I,IAC,ISUM,LOOP) {}

      DO 10 LOOP = 1, ISTOP, MSKIP                                      0022

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0023

C  T(IAC) {LOOP+NSKIP==IAC}

         IAC = LOOP+NSKIP                                               0024

C  T() {}

         WORK(1) = CMPLX(0., 2.)*AC(IAC)                                0025

C  T(I,IAC) {2<=I}

         DO 20 I = 2, MH                                                0026

C  T(IAC) {IAC#init+NSKIP2==IAC}

            IAC = IAC+NSKIP2                                            0027

C  T() {}

            TEMP1 = CMPLX(0., 1.)*(AC(IAC)-AC(IAC-NSKIP2))              0028

C  T() {}

            TEMP2 = AC(IAC-NSKIP)                                       0029

C  T() {}

            WORK(I) = TEMP2+TEMP1                                       0030

C  T() {}

            WORK(MP2-I) = TEMP1-TEMP2                                   0031

C  T() {}

20          CONTINUE                                                    0032

C  T() {}

         WORK(MHP) = CMPLX(0., -2.)*AC(IAC)                             0033

C  T(IAC) {IAC==LOOP}

         IAC = LOOP                                                     0034

C  T(I,IAC) {1<=I}

         DO 30 I = 1, M                                                 0035

C  T() {}

            AC(IAC) = WORK(I)                                           0036

C  T(IAC) {IAC#init+NSKIP==IAC}

            IAC = IAC+NSKIP                                             0037

C  T() {}

30          CONTINUE                                                    0038

C  T() {}

10       CONTINUE                                                       0039

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(AC, EX)                                               0040

C  T(I,IFIN,ISTART,ISUM,J,JSUM,JSYM,LOOP) {}

      DO 40 LOOP = 1, ISTOP, MSKIP                                      0041

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0042

C  T(JSUM) {ISUM+LOOP==JSUM}

         JSUM = ISUM+LOOP                                               0043

C  T() {}

         AC(LOOP) = 0.                                                  0044

C  T(ISTART) {LOOP+NSKIP==ISTART}

         ISTART = LOOP+NSKIP                                            0045

C  T(IFIN) {IPROD+LOOP==IFIN}

         IFIN = LOOP+IPROD                                              0046

C  T(I) {I==2}

         I = 2                                                          0047

C  T(I,J,JSYM) {}

         DO 50 J = ISTART, IFIN, NSKIP                                  0048

C  T(I) {I#init+IEXSHF==I}

            I = I+IEXSHF                                                0049

C  T(JSYM) {J+JSYM==JSUM}

            JSYM = JSUM-J                                               0050

C  T() {}

            BJ = AC(J)                                                  0051

C  T() {}

            BJSYM = AC(JSYM)                                            0052

C  T() {}

            TEMP1 = BJ-BJSYM                                            0053

C  T() {}

            TEMP2 = CMPLX(FACT/EX(I), 0.)*(BJ+BJSYM)                    0054

C  T() {}

            AC(J) = TEMP1+TEMP2                                         0055

C  T() {}

            AC(JSYM) = TEMP2-TEMP1                                      0056

C  T() {}

50          CONTINUE                                                    0057

C  T() {}

40       CONTINUE                                                       0058

C  T(NPTS) {NPTS==NPTSINIT}

c      NPTS = M*2
      NPTS = NPTSINIT                                                   0059

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0060

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0061

C  T() {}

C
      IF (LFIRST) THEN                                                  0062

C  T() {}

         LFIRST = .FALSE.                                               0063

C  T() {}

         CALL CPUTIM(T2)                                                0064

C  T() {}

         TXACAC = T2-T1                                                 0065
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0066

C  T() {}

         IF (LXTIME) THEN                                               0067

C  T() {}

            LXTIME = .FALSE.                                            0068

C  T() {}

            CALL CPUTIM(T2)                                             0069

C  T() {}

            EXACAC = T2-T1                                              0070
         ENDIF

      ENDIF

C  T(NXACAC) {NXACAC==NXACAC#init+1}

C
      NXACAC = NXACAC+1                                                 0071
C
      END

C  T(NUM1) {NUM1==NUM1#init+1}

C***********************************************************************
C***********************************************************************
      SUBROUTINE BUG(POINT)
      CHARACTER*10 POINT
      COMMON /DEBUG/NUM1,TLAST

C  T() {}


      CALL CPUTIM(TNOW)                                                 0001

C  T() {}

      TSINCE = TNOW-TLAST                                               0002

C  T() {}

      WRITE (6, 9000) NUM1, TNOW, TSINCE, POINT                         0003

C  T(NUM1) {NUM1==NUM1#init+1}

      NUM1 = NUM1+1                                                     0004

C  T() {}

      TLAST = TNOW                                                      0005

C  T() {}


9000  FORMAT(' NUM1 =',I3,'; TNOW =',F9.3,' S; TSINCE =',F9.3,' S; LOCAT
     &ION IS: ',A10)                                                    0006

      END

C  T() {}

C***********************************************************************
C
C     FGPS 29-MAR-88 MODIFIED RPRINT =====> CPRINT SO AS TO PRINT OUT
C                    COMPLEX ARRAYS
C
C     N O T E :  THE INDEXING OF COMPLEX ARRAYS REPRESENTING PRINCIPAL V
C     IABLES IS OF THE FORM
C
C     COMPLEX  ======>  CA (1<=JY<=N2P,1<=IX<=N1H)
C
C     WHERE "JY" IS THE COUNT ALONG THE Y-AXIS AND "IX" RUNS ALONG THE X
C     AXIS, AND WHERE
C
C                          N2P = (N2+1)                    FOR THE Y-AXI
C     AND
C                           N1H = N1/2                     FOR THE X-AXI
C
C     AND WHERE THE GRID IS NOMINALLY DIMENSIONED (N2+1) BY N1.  MOREOVE
C     THE INDEX PAIR  JY = (N2+1)/2, IX= N1H/2  IS ASSUMED TO IDENTIFY T
C     CENTER OF THE VORTEX CELL.  HOWEVER, IN ACTUAL USE HERE, THE PROGR
C     MING INVOLVES THE REAL EQUIVALENT TO CA; I.E.,
C
C     REAL     ======>  RA (1<=JY<=N2P,1<=IX<=N1)
C
C
      SUBROUTINE CPRINT(RA,NAME,N1H,N2P,IMODE)
C
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      REAL RA(N2P,1)
      CHARACTER*8 NAME

C  T() {}

C
      WRITE (6, 9000) NSTEPS                                            0001

C  T(IX,IX1,IX2,JY,JY1) {}

C
C     SELECT THE PRINT-OUT MODE
C
c      IF (IMODE) 10,20,30
C
      IF (IMODE.LT.0) THEN                                              0002

C  T() {}

10       CONTINUE                                                       0003

C  T(IX1) {N1H+1<=4IX1, 4IX1<=N1H+4}

C
         IX1 = 1+N1H/4                                                  0004

C  T(IX2) {N1H+1<=2IX2, 2IX2<=N1H+2}

         IX2 = 1+N1H/2                                                  0005

C  T(JY1) {N2P+1<=2JY1, 2JY1<=N2P+2}

         JY1 = 1+N2P/2                                                  0006

C  T() {}

         WRITE (6, 9010) NAME, JY1, IX1, RA(JY1,IX1)                    0007

C  T() {}

         WRITE (6, 9020) NAME, JY1, IX2, RA(JY1,IX2)                    0008

C  T() {}

         IF (NAME.EQ.'PSI PHYS'.AND.NSTEPS.EQ.NUMBER) CDAT(11) = RA(    0009
     &   JY1,IX2)                                                       0009
C
c      RETURN
      ELSEIF (IMODE.EQ.0) THEN                                          0002

C  T() {}

C
20       CONTINUE                                                       0012

C  T(IX1) {N1H<=2IX1+1, 2IX1<=N1H}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF Y (I.E., 1<=JY<=N2P WITH STRIDE = 4) AT CONS
C     X (E.G., IX = N1H/2)
C
         IX1 = N1H/2                                                    0013

C  T(JY) {}

         WRITE (6, 9030) (JY,NAME,IX1,RA(JY,IX1), JY = 1, N2P, 4)       0014
C
c      RETURN
      ELSE

C  T() {}

C
30       CONTINUE                                                       0015

C  T(JY1) {N2P+1<=2JY1, 2JY1<=N2P+2}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF X (I.E., 1<=IX<=N1 WITH STRIDE = 4) AT CONST
C     Y (E.G., JY = N2P/2 + 1)
C
c      N1 = N1H + N1H
         JY1 = N2P/2+1                                                  0016

C  T(IX) {}

         WRITE (6, 9040) (IX,NAME,JY1,RA(JY1,IX), IX = 1, N1H+N1H, 4)   0017

C  T() {}

         IF (NAME.EQ.'PSI PHYS') THEN                                   0018

C  T() {}

            IF (NSTEPS.EQ.1) THEN                                       0019

C  T() {}

               CDAT(1) = RA(JY1,33)                                     0020

            ELSEIF (NSTEPS.EQ.2) THEN                                   0019

C  T() {}

               CDAT(6) = RA(JY1,33)                                     0022
            ENDIF

         ENDIF
      ENDIF

C  T() {}

C
C
C
9000  FORMAT(/,2X,'NSTEPS =',I7)                                        0023

C  T() {}

9010  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6)                  0024

C  T() {}

9020  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6,/)                0025

C  T() {}

C
9030  FORMAT(/,34(2X,'JY =',I5,2X,A8,'(JY,IX=',I3,') =',1P,E13.6,6X,'JY 
     &=',I5,2X,A8,'(JY,IX=',I3,') =',1P,E13.6,/))                       0026

C  T() {}

C
9040  FORMAT(/,34(2X,'IX =',I5,2X,A8,'(JY=',I3,',IX) =',1P,E13.6,/))    0027

      END

C  T() {}

C***********************************************************************
C
C     "CPUTIM" RETURNS ELAPSED USER (CPU) TIME, T, IN SECONDS, WHERE "T"
C     A REAL VARIABLE
C
C     ON THE CYBER205/ETA-10, THE INTRINSIC FUNCTION "SECOND()" IS REFER
C
      SUBROUTINE CPUTIM(T)
      REAL T

C  T() {}


      T = 1.0                                                           0001

      END

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

C
      SUBROUTINE CSR(A,EX)
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMPLEX A(1),EX(1),BJ,BJSTAR
C
C   PERFORM A CONJUGATE SYMMETRIC TO REAL TRANSFORM ON A PACKED
C   CONJUGATE SYMMETRIC ARRAY.  ONLY HALF THE ARRAY IS STORED, AND A(0)
C   AND A(N/2) ARE BOTH PACKED TOGETHER IN A(0) SINCE THEY ARE BOTH REAL
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0001

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0003

C  T() {}

      IF (LXSTEP) THEN                                                  0005

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0006
      ENDIF

C  T(N) {N==NPTS}

C
      N = NPTS                                                          0008

C  T(NPTS) {NPTS#init<=2NPTS+1, 2NPTS<=NPTS#init}

      NPTS = NPTS/2                                                     0009

C  T(M) {M==NPTS}

      M = NPTS                                                          0010

C  T(ISHIFT) {ISHIFT==0}

      ISHIFT = 0                                                        0011

C  T(ISHIFT) {}

      IF (ISIGN.LT.0) ISHIFT = M*IEXSHF                                 0012

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0014

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0015

C  T(I,IEXH,IEXL,IST,ISTP,J,JSTAR,LOOP) {1<=LOOP}

      DO 10 LOOP = 1, MTRN                                              0016

C  T(IST) {}

         IST = (LOOP-1)*MSKIP                                           0017

C  T(ISTP) {IST==ISTP-1}

         ISTP = IST+1                                                   0018

C  T() {}

         A(ISTP) = CMPLX(REAL(A(ISTP))+AIMAG(A(ISTP)), REAL(A(ISTP))-   0019
     &   AIMAG(A(ISTP)))                                                0019

C  T(I,IEXH,IEXL,J,JSTAR) {2<=I}

         DO 20 I = 2, MH                                                0020

C  T(J) {}

            J = (I-1)*NSKIP+ISTP                                        0021

C  T(JSTAR) {}

            JSTAR = (M-I+1)*NSKIP+ISTP                                  0022

C  T() {}

            BJ = A(J)                                                   0023

C  T() {}

            BJSTAR = A(JSTAR)                                           0024

C  T(IEXL) {}

            IEXL = IEXSHF*(I-1)+1+ISHIFT                                0025

C  T(IEXH) {}

            IEXH = IEXSHF*(M-I+1)+1+ISHIFT                              0026

C  T() {}

            A(J) = BJ+CONJG(BJSTAR)+CMPLX(0., 1.)*EX(IEXL)*(BJ-CONJG(   0027
     &      BJSTAR))                                                    0027

C  T() {}

            A(JSTAR) = BJSTAR+CONJG(BJ)+CMPLX(0., 1.)*EX(IEXH)*(        0028
     &      BJSTAR-CONJG(BJ))                                           0028

C  T() {}

20          CONTINUE                                                    0029

C  T(J) {}

         J = MH*NSKIP+ISTP                                              0030

C  T() {}

         A(J) = 2.*A(J)                                                 0031

C  T() {}

         IF (ISIGN.GT.0) A(J) = CONJG(A(J))                             0032

C  T() {}

10       CONTINUE                                                       0034

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0035

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = 2*IEXSHF                                                 0036

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(A(1), EX(1))                                          0037

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0038

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0039

C  T(NPTS) {N==NPTS}

      NPTS = N                                                          0040

C  T() {}

C
      IF (LFIRST) THEN                                                  0041

C  T() {}

         LFIRST = .FALSE.                                               0042

C  T() {}

         CALL CPUTIM(T2)                                                0043

C  T() {}

         TXXCSR = T2-T1                                                 0044
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0045

C  T() {}

         IF (LXTIME) THEN                                               0046

C  T() {}

            LXTIME = .FALSE.                                            0047

C  T() {}

            CALL CPUTIM(T2)                                             0048

C  T() {}

            EXXCSR = T2-T1                                              0049
         ENDIF

      ENDIF

C  T(NXXCSR) {NXXCSR==NXXCSR#init+1}

C
      NXXCSR = NXXCSR+1                                                 0050
C
      END

C  T(NXXOUT) {NXXOUT==NXXOUT#init+2, 1<=LPN, LPN<=OUT:MEMSIZ, 1<=LTN,
C    LTN<=OUT:MEMSIZ}

C***********************************************************************
C     FGPS 12-MAY-88 RESET "RLAMDA = 1.00"
C     FGPS 18-APR-88 RESET "DT" TO DT = 0.0001, OTHERWISE THE INCREASED
C                    FUNCTION RESULTS IN NUMERICAL INSTABILITY
C     FGPS 15-APR-88 INCREASED THE INITIAL AMPLITUDE PRESCRIBED FOR THE
C                    FUNCTION BY *50
C     FGPS 16-FEB-88 RESET "DT" TO DT = 0.001
C
      SUBROUTINE DATAST(A,N2P,N1,GMAPP)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /PI/PI
      COMMON /LADDR/LZN,LTN,LPN,LZO,LTO,LPY,LZX,LZY,LEIG,LDUMY1(3)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION A(N2P,1),GMAPP(1)
C
C PROGRAM TO INITIALIZE THE RUN (EITHER IN PHYSICAL OR FOURIER SPACE)
C PHYSICAL SPACE: KDATA=1    --> A (I,J) ... POINT (I-1, J-1)
C FOURIER SPACE : KDATA=2    --> CA(I,J) ... MODE  (I-1, J-1)
C
C ALSO, IF YOU WANT TO SPECIFY THE MEAN FLOW (KSM=2), DO IT HERE.
C
      COMMON /MFLOW/U(129)

C  T() {}

C
      ALPHA = 10.0                                                      0001

C  T() {}

C
C UNSTABLE CASE:
      BETA = 1.0                                                        0002

C  T() {}

C      RLAMDA = 1.35
C     WHEN CODE IS USED AS A BENCHMARK, SET RLAMDA = 1.00
      RLAMDA = 1.00                                                     0003

C  T() {}

      BOXX = 2.0*PI*RLAMDA                                              0004

C  T() {}

      FX = 2.0*PI/BOXX                                                  0005

C  T() {}

C
C ASSUMING THAT GSET IS CALLED. IF LMAPP = 1, H SHOULD BE SET TO
C A DEFINED POSITIVE NUMBER.
C
      H = GMAPP(N2P)                                                    0006

C  T() {}

C
C COMPUTE VISCOSITY AND HEAT CONDUCTIVITY FROM PRANDTL NUMBER
C AND THE RATIO OF RAYLEIGH NUMBER TO ITS CRITICAL VALUE:
C
      PRANDT = 10.0                                                     0007

C  T() {}

      RRATIO = 20.0                                                     0008

C  T() {}

      W = ALPHA*BETA*PRANDT*4.0/(27.0*RRATIO)                           0009

C  T() {}

      RNU = SQRT(ABS(W))                                                0010

C  T() {}

      RKAPA = RNU/PRANDT                                                0011

C  T() {}

C
C DETERMINE DIFFUSION LIMIT FOR THE TIME STEP AND COMPARE IT TO
C THE CHOSEN VALUE:
C
      DT = 0.0001                                                       0012

C  T() {}

      X = FX*REAL(N1/2-1)                                               0013

C  T() {}

      Y = REAL(N2P-1)                                                   0014

C  T() {}

      DTMAX = 1.0/((X*X+Y*Y)*MAX(RNU, RKAPA))                           0015

C  T() {}

      WRITE (6, 9000) DTMAX, DT                                         0016

C  T(NW) {}

      NW = N2P*N1                                                       0017

C  T() {}

C
C
      EPS = 100.                                                        0018

C  T(I,J) {1<=J}

      DO 10 J = 1, N1                                                   0019

C  T() {}

         X = REAL(J-1)*2.0*PI/REAL(N1)                                  0020

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0021

C  T() {}

            Y = REAL(I-1)*PI/REAL(N2P-1)                                0022

C  T() {}

            A(I,J) = EPS*SIN(X)*SIN(Y)                                  0023

C  T() {}

20          CONTINUE                                                    0024

C  T() {}

10       CONTINUE                                                       0025

C  T() {}

C
      WRITE (6, 9010)                                                   0026

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL OUT(A, LPN, NW)                                              0027

C  T(I,J) {1<=J}

      DO 30 J = 1, N1                                                   0028

C  T(I) {1<=I}

         DO 40 I = 1, N2P                                               0029

C  T() {}

            A(I,J) = 0.0                                                0030

C  T() {}

40          CONTINUE                                                    0031

C  T() {}

30       CONTINUE                                                       0032

C  T() {}

      WRITE (6, 9020)                                                   0033

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL OUT(A, LTN, NW)                                              0034

C  T() {}


9000  FORMAT(' DIFFUSION CONSTRAINT ON DT: DTMAX = ',F10.6,/,' ACTUAL DT
     & CHOSEN FOR THIS RUN: DT = ',F10.6)                               0035

C  T() {}

9010  FORMAT(/,/,/,' INITIAL STREAMFUNCTION IS   A SIN(X) SIN(Y),',/,' W
     &HERE  0 <= X <= 2*PI  AND  0 <= Y <= PI.',/,' THIS IMPLIES TWO CON
     &VECTION CELLS INITIALLY.',/,' NOTE THAT THE PRESCRIBED INITIAL STR
     &EAM-',/,' FUNCTION VS X, FOR Y=YMAX/2, IS PRINTED OUT',/,' BELOW F
     &OR NSTEPS=1 (TIME ZERO) AND ALSO FOR',/,' THE NEXT STEP, NSTEPS=2'
     &,/,/)                                                             0036

C  T() {}

9020  FORMAT(' INITIAL TEMPERATURE PERTURBATION IS ZERO.',/,' NOTE THAT 
     &THE INITIAL TEMPERATURE DROP VS',/,' Y IS PRINTED OUT BELOW, WHERE
     & INITIALLY',/,' THIS IS INDEPENDENT OF X,  I.E., 1 <= IX',/,' <= 6
     &4, AND WHERE THE Y REPRESENTATION IN',/,' PHYSICAL SPACE SPANS 1 <
     &= JY <= 129.   A',/,' KEY VARIABLE, THE EVOLUTION OF WHICH CAN',/,
     &' MONITOR CODE PERFORMANCE, IS  "TEMP PHY(',/,' JY=65,IX=33)"; I.E
     &., A MEASURE OF TEMPER-',/,' ATURE IN PHYSICAL SPACE AT THE CENTER
     &POINT',/,' OF THE BOUNDARY SEPARATING THE TWO CONVEC-',/,' TION CE
     &LLS.')                                                            0037

      END

C  T(NXXOUT,NXXXIN) {NXXOUT==NXXOUT#init+1, NXXXIN==NXXXIN#init+1,
C    1<=LOC, LOC<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE DEALSE(CA,N2P,N1H,LOC)
      COMPLEX CA(N2P,1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2

C  T(NW) {}

C
C THIS FUNCTION GIVES THE INDEX OF THE HIGHEST MODE TO BE RETAINED
C IN TERMS OF THE NUMBER OF MODES WHICH CAN BE RESOLVED:
C
C#      LSTMOD (MODEHI) = INT(0.666666666666666*REAL(MODEHI-1)+0.999)
C
      NW = 2*N2P*N1H                                                    0001

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LOC, LOC+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LOC, NW)                                              0002

C  T(N1CUT) {}

      N1CUT = INT(0.666666666666666*REAL(N1H-1)+0.999)+1                0003

C  T(N2CUT) {}

      N2CUT = INT(0.666666666666666*REAL(N2P-1)+0.999)+1                0004

C  T(I,J) {N1CUT<=J}

C
C THIS DEALIASING PROCEDURE HAS TO BE IMPROVED IF NONLINEAR MAPPING
C IN Y-DIRECTION IS USED:
C
      DO 10 J = N1CUT, N1H                                              0005

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0006

C  T() {}

            CA(I,J) = 0.0                                               0007

C  T() {}

20          CONTINUE                                                    0008

C  T() {}

10       CONTINUE                                                       0009

C  T(I,J) {1<=J}

      DO 30 J = 1, N1H                                                  0010

C  T(I) {N2CUT<=I}

         DO 40 I = N2CUT, N2P                                           0011

C  T() {}

            CA(I,J) = 0.0                                               0012

C  T() {}

40          CONTINUE                                                    0013

C  T() {}

30       CONTINUE                                                       0014

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LOC, LOC+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL OUT(CA, LOC, NW)                                             0015
C
      END

C  T() {}

C***********************************************************************
C
C     "ELAPSE" RETURNS ELAPSED WALL-CLOCK TIME, T, IN SECONDS
C
C     ON THE CYBER205 SYSTEM USE IS MADE OF THE SIL SUBROUTINE "Q5DCDMSC
C
C     FGPS 19-APR-88
C
      SUBROUTINE ELAPSE(T)

      REAL T

C  T() {}


      T = 1.0                                                           0001

      END

C  T() {}

C***********************************************************************
C
C     FGPS 12-FEB-1988 SUBR. PLOTME TEMPORARILY COMMENTED "C" OUT
C
C      SUBROUTINE PLOTME (Z,WORK,NCALL)
C      COMMON /DATA/ ALPHA,BETA,BOXX,H, RDUMY1(5), IDUMY1
C      COMMON /OPTONS/ NX,NY
C      DIMENSION Z(1), WORK(1)
C      COMMON /PLTDEF/ IDPAT, DXA, DXB, DYA, DYB
CC
CC THIS SUBROUTINE CAN BE USED FOR PLOTTING OF FIELDS IN PHYSICAL
CC SPACE. CONTOUR PLOTS ARE USUALLY BEST.
CC
C      ASPECT = BOXX/H
C      A = (DXB-DXA) / (DYB-DYA)
C      XMIN = DXA
C      XMAX = DXB
C      YMIN = DYA
C      YMAX = DYB
C      IF (A.LT.ASPECT) GO TO 10
C      SPANH = 0.5*(DYB-DYA) * ASPECT
C      RMEAN = 0.5*(DXA+DXB)
C      XMIN = RMEAN-SPANH
C      XMAX = RMEAN+SPANH
C      GO TO 30
C   10 SPANH = 0.5*(DXB-DXA) / ASPECT
C      RMEAN = 0.5*(DYA+DYB)
C      YMIN = RMEAN-SPANH
C      YMAX = RMEAN+SPANH
C   30 CALL SET (XMIN,XMAX,YMIN,YMAX,1.0,REAL(NX+1),1.0,REAL(NY+1),1)
C      CALL EDGES (-1)
C      CALL DRAWBOX (1.0,1.0,REAL(NX),REAL(NY+1))
C      CALL CONREC (Z,NY+1,NY+1,NX,0.0,0.0,0.0,1,0,0)
C      CALL FRAME
C      RETURN
C      END
C***********************************************************************
C      SUBROUTINE DATE (TODAY)
C      TODAY = DATEF(1.0)
C      RETURN
C      END
C***********************************************************************
C      SUBROUTINE TIME (NOW)
C      NOW = 8HNOW
C      RETURN
C      END
C***********************************************************************
C                           E - O - D
C***********************************************************************
C
C FFTFORTRANPACK3
C FFTFTN.5
C 10/16/80
C
      SUBROUTINE EXSET(EX,NPTS)
      COMPLEX EX(1)
      COMPLEX A1,A2

C  T() {}


      W = 6.283185307179586477/REAL(NPTS)                               0001

C  T(NH) {NPTS<=2NH+1, 2NH<=NPTS}

      NH = NPTS/2                                                       0002

C  T(J) {1<=J}

CVD$ NOVECTOR
CVD$ NOCONCUR
      DO 10 J = 1, NH                                                   0003

C  T() {}

C           EX( J ) = EXP( CMPLX( 0., REAL(J - 1)*W ) )
C10         EX( J + NH ) = EXP( CMPLX( 0., REAL(1 - J)*W ) )
         A1 = CMPLX(0., REAL(J-1)*W)                                    0004

C  T() {}

         EX(J) = EXP(A1)                                                0005

C  T() {}

         EX(J+NH) = EXP(-1.*A1)                                         0006

C  T() {}

10       CONTINUE                                                       0007
      END

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

C
      SUBROUTINE FTRVMT(DATA,EX)
C
C THIS IS A FORTRAN VERSION OF THE ASSEMBLY LANGUAGE SUBROUTINE
C FFT2, TO BE USED WITH THE NSSL SUBROUTINE PACKAGE FFTPOW2.
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
C
C DATA IS A COMPLEX ARRAY OF LENGTH NPTS WHICH SERVES FOR BOTH
C INPUT AND OUTPUT.
C
      COMMON /DATA/ALPHA,BETA,BOXX,H1,RNU,RKAPA,DT,DTT,T,NSTEP
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
C
      COMPLEX DATA(99),EXP1,EXK,EXJ,H,EX(1)
      REAL HH(2)
      EQUIVALENCE (HH,H)
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0001

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0003

C  T() {}

      IF (LXSTEP) THEN                                                  0005

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0006
      ENDIF

C  T(I2K) {I2K==NPTS}

C
      I2K = NPTS                                                        0008

C  T() {}

      IF (I2K.NE.1) THEN                                                0009
      ELSE
         GOTO 140
      ENDIF

C  T() {}

      SGN1 = ISIGN                                                      0010

C  T() {}

      EXK = EX(1+IEXSHF)                                                0011

C  T() {}

      IF (SGN1.LT.0.) EXK = CONJG(EXK)                                  0012

C  T() {}

10    CONTINUE                                                          0014

C  T(I2KP) {I2K==I2KP}

      I2KP = I2K                                                        0015

C  T(I2K) {I2K#init<=2I2K+1, 2I2K<=I2K#init}

      I2K = I2K/2                                                       0016

C  T(I2KS) {}

      I2KS = I2K*NSKIP                                                  0017

C  T() {}

      IF (2*I2K.NE.I2KP) GOTO 20                                        0018

C  T(JLI) {2JLI<=I2K+2, I2K+1<=2JLI}

      JLI = I2K/2+1                                                     0019

C  T(JJ,JL,JS,MM) {1<=JL}

      DO 30 JL = 1, I2K                                                 0020

C  T(JJ,JS,MM) {}

         IF (JL-1.LE.0) THEN                                            0021

C  T() {}

            EXJ = CMPLX(1., 0.)                                         0022

C  T(JJ,JS,MM) {}

            DO 40 JJ = JL, NPTS, I2KP                                   0023

C  T(JS,MM) {1<=MM}

               DO 50 MM = 1, MTRN                                       0024

C  T(JS) {}

                  JS = (JJ-1)*NSKIP+(MM-1)*MSKIP+1                      0025

C  T() {}

                  H = DATA(JS)-DATA(JS+I2KS)                            0026

C  T() {}

                  DATA(JS) = DATA(JS)+DATA(JS+I2KS)                     0027

C  T() {}

                  DATA(JS+I2KS) = H                                     0028

C  T() {}

50                CONTINUE                                              0029

C  T() {}

40             CONTINUE                                                 0030

         ELSEIF (JL-JLI.EQ.0) THEN                                      0021

C  T() {}

            EXJ = CMPLX(0., SGN1)                                       0032

C  T(JJ,JS,MM) {}

            DO 60 JJ = JL, NPTS, I2KP                                   0033

C  T(JS,MM) {1<=MM}

               DO 70 MM = 1, MTRN                                       0034

C  T(JS) {}

                  JS = (JJ-1)*NSKIP+(MM-1)*MSKIP+1                      0035

C  T() {}

                  H = DATA(JS)-DATA(JS+I2KS)                            0036

C  T() {}

                  DATA(JS) = DATA(JS)+DATA(JS+I2KS)                     0037

C  T() {}

                  DATA(JS+I2KS) = CMPLX(-SGN1*HH(2), SGN1*HH(1))        0038

C  T() {}

70                CONTINUE                                              0039

C  T() {}

60             CONTINUE                                                 0040

         ELSE

C  T() {}

C
C INCREMENT JL-DEPENDENT EXPONENTIAL FACTOR
C
            EXJ = EXJ*EXK                                               0041

C  T(JJ,JS,MM) {}

            DO 80 JJ = JL, NPTS, I2KP                                   0042

C  T(JS,MM) {1<=MM}

               DO 90 MM = 1, MTRN                                       0043

C  T(JS) {}

                  JS = (JJ-1)*NSKIP+(MM-1)*MSKIP+1                      0044

C  T() {}

                  H = DATA(JS)-DATA(JS+I2KS)                            0045

C  T() {}

                  DATA(JS) = DATA(JS)+DATA(JS+I2KS)                     0046

C  T() {}

                  DATA(JS+I2KS) = H*EXJ                                 0047

C  T() {}

90                CONTINUE                                              0048

C  T() {}

80             CONTINUE                                                 0049
         ENDIF

C  T() {}


30       CONTINUE                                                       0050

C  T() {}

C
C INCREMENT K-DEPENDENT EXPONENTIAL FACTOR
C
      EXK = EXK*EXK                                                     0051

C  T() {}

      IF (I2K-1.GT.0) GOTO 10                                           0052

C  T(I2K,J,JMAX,JMIN,JREV,JREV2,JREV2S,JREVS,JS,MM,NPTSD2) {}


      IF (NPTS.GT.2) THEN                                               0054

C  T(NPTSD2) {2NPTSD2<=NPTS, NPTS<=2NPTSD2+1}

         NPTSD2 = NPTS/2                                                0055

C  T(JMIN) {JMIN==0}

         JMIN = 0                                                       0056

C  T(JMAX) {JMAX==NPTS-4}

         JMAX = NPTS-4                                                  0057

C  T(JREV) {JREV==0}

         JREV = 0                                                       0058

C  T(I2K,J,JREV,JREV2,JREV2S,JREVS,JS,MM) {JMIN<=J}

         DO 100 J = JMIN, JMAX, 2                                       0059

C  T(I2K) {I2K==NPTSD2}

            I2K = NPTSD2                                                0060

C  T(JREV2) {I2K+JREV==JREV2}

            JREV2 = JREV+I2K                                            0061

C  T(JREV2S,JREVS,JS,MM) {}

            IF (JREV2-(J+1).GT.0) THEN                                  0062

C  T(JREV2S,JS,MM) {1<=MM}

               DO 110 MM = 1, MTRN                                      0063

C  T(JREV2S) {}

                  JREV2S = (MM-1)*MSKIP+JREV2*NSKIP                     0064

C  T(JS) {}

                  JS = (MM-1)*MSKIP+(J+1)*NSKIP                         0065

C  T() {}

                  H = DATA(JREV2S+1)                                    0066

C  T() {}

                  DATA(JREV2S+1) = DATA(JS+1)                           0067

C  T() {}

                  DATA(JS+1) = H                                        0068

C  T() {}

110               CONTINUE                                              0069

C  T(JREVS,JS,MM) {}

               IF (JREV-J.GT.0) THEN                                    0070

C  T(JREVS,JS,MM) {1<=MM}

                  DO 120 MM = 1, MTRN                                   0071

C  T(JREVS) {}

                     JREVS = JREV*NSKIP+(MM-1)*MSKIP                    0072

C  T(JS) {}

                     JS = J*NSKIP+(MM-1)*MSKIP                          0073

C  T() {}

                     H = DATA(JREVS+1)                                  0074

C  T() {}

                     DATA(JREVS+1) = DATA(JS+1)                         0075

C  T() {}

                     DATA(JS+1) = H                                     0076

C  T() {}

120                  CONTINUE                                           0077
               ENDIF

            ENDIF

C  T() {}


130         CONTINUE                                                    0078

C  T(I2K) {I2K#init<=2I2K+1, 2I2K<=I2K#init}

            I2K = I2K/2                                                 0079

C  T(JREV) {I2K+JREV==JREV#init}

            JREV = JREV-I2K                                             0080

C  T() {}

            IF (JREV.GE.0) GOTO 130                                     0081

C  T(JREV) {2I2K+JREV#init==JREV}

            JREV = JREV+2*I2K                                           0083

C  T() {}

100         CONTINUE                                                    0084
      ENDIF

      GOTO 140

C  T(IERR) {IERR==101}


20    IERR = 101                                                        0085

C  T() {}

C
140   CONTINUE                                                          0086

C  T() {}

C
      IF (LFIRST) THEN                                                  0087

C  T() {}

         LFIRST = .FALSE.                                               0088

C  T() {}

         CALL CPUTIM(T2)                                                0089

C  T() {}

         TFTVMT = T2-T1                                                 0090
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0091

C  T() {}

         IF (LXTIME) THEN                                               0092

C  T() {}

            LXTIME = .FALSE.                                            0093

C  T() {}

            CALL CPUTIM(T2)                                             0094

C  T() {}

            EFTVMT = T2-T1                                              0095
         ENDIF

      ENDIF

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

C
      NFTVMT = NFTVMT+1                                                 0096
C
      END

C  T() {}

C***********************************************************************
      SUBROUTINE GSET(GMAPP)
      DIMENSION GMAPP(1)
      COMMON /PI/PI
      COMMON /NMBRS/NSKIP(4),N2P,NDUMY1(3)

C  T() {}


      F = PI/REAL(N2P-1)                                                0001

C  T(I) {1<=I}

C
C GSET DEFINES THE MAPPING FUNCTION.
C
      DO 10 I = 1, N2P                                                  0002

C  T() {}

         GMAPP(I) = F*REAL(I-1)                                         0003

C  T() {}

10       CONTINUE                                                       0004
      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C***********************************************************************
C
      SUBROUTINE IN(ARRAY,LOC,NW)
      COMMON /MEMORY/MEMSIZ,RM(165117)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION ARRAY(1)
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0001

C  T(I,LOCM,NXXXIN) {LOC==LOCM+1, NXXXIN==NXXXIN#init+1, 1<=I,
C    NW+1<=I, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C
      IF (LOC.LT.1.OR.LOC+NW-1.GT.MEMSIZ.OR.NW.LT.1) THEN               0003

C  T() {}

C
         WRITE (6, 9000) LOC, NW                                        0004

C  T() {0==-1}

         STOP                                                           0005

      ELSE

C  T(LOCM) {LOC==LOCM+1}

         LOCM = LOC-1                                                   0006

C  T(I) {1<=I}

         DO 10 I = 1, NW                                                0007

C  T() {}

            ARRAY(I) = RM(LOCM+I)                                       0008

C  T() {}

10          CONTINUE                                                    0009

C  T() {}

C
         IF (LFIRST) THEN                                               0010

C  T() {}

            LFIRST = .FALSE.                                            0011

C  T() {}

            CALL CPUTIM(T2)                                             0012

C  T() {}

            TXXXIN = T2-T1                                              0013
         ENDIF

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1}

C
         NXXXIN = NXXXIN+1                                              0014
C
      ENDIF

C  T() {}


9000  FORMAT(/,/,/,' IN: ILLEGAL REQUEST. LOCATION:',I22,' ;   NUMBER OF
     & WORDS:',I22,' ;  MEMSIZ:',I7)                                    0015

      END

C  T(LCMREQ,MEMSIZ) {LARGE==MEMSIZ, LCMREQ==1, LARGE<=165117}

C***********************************************************************
      FUNCTION LCMREQ(LARGE)
      PARAMETER (LCMSIZ=165117)
      COMMON /MEMORY/MEMSIZ,RM(LCMSIZ)

C  T(LCMREQ,MEMSIZ) {LARGE==MEMSIZ, LCMREQ==1, LARGE<=165117}


      IF (LARGE.GT.LCMSIZ) THEN                                         0001

C  T() {}

C
         WRITE (6, 9010) MEMSIZ, LARGE                                  0002

C  T() {0==-1}

         STOP                                                           0003

      ELSE

C  T(MEMSIZ) {LARGE==MEMSIZ}

         MEMSIZ = LARGE                                                 0004

C  T(LCMREQ) {LCMREQ==1}

         LCMREQ = 1                                                     0005

C  T() {}

         WRITE (6, 9000) LARGE                                          0006
      ENDIF

C  T() {}


9000  FORMAT(/,/,' LCM REQUESTED:',I7,' WORDS',/,/)                     0007

C  T() {}

9010  FORMAT(/,/,/,' LCMREQ: REQUEST EXCEEDS MEMORY SIZE.',/,' MEMORY SI
     &ZE:',I7,' ;   WORDS REQUESTED:',I22)                              0008

      END

C  T() {}

C***********************************************************************
      SUBROUTINE MEAN(CA,U,G)
      DIMENSION U(1),G(1)
      COMPLEX CA(1)
      COMMON /NMBRS/NSKIP(4),N2P,NDUMY1(3)

C  T(I) {1<=I}


      DO 10 I = 1, N2P                                                  0001

C  T() {}

         U(I) = -G(I)*REAL(CA(I))                                       0002

C  T() {}

10       CONTINUE                                                       0003
      END

C  T(IEXSHF,ISIGN,KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,
C    KVF,KVP,KZF,KZP,LE,LEIG,LEV,LH,LMAPP,LOG,LPN,LPY,LSKIP,LTN,LTO,
C    LVECT,LZN,LZO,LZX,LZY,MEMSIZ,MSKIP,MTRN,N1,N1E,N1H,N1Q,N2,N2DM,
C    N2DP,N2M,N2P,N2PD,NFTVMT,NMAX2,NOALS,NOTEMP,NPTS,NSKIP,NSTEPS,
C    NUM1,NUMBER,NUSHUF,NVECT,NVSKIP,NXACAC,NXLOG2,NXPRNT,NXSCSC,
C    NXSHUF,NXXCSR,NXXOUT,NXXRCS,NXXXIN,TEMPHY:NCALL,ZETAPH:NCALL)
C    {ISIGN==-1, KDATA==1, KPF==1, KPP==249, KPRESS==1, KSM==1,
C    KTA==50, KTAPE==0, KTF==1, KTP==50, KUF==1, KUP==249, KVF==1,
C    KVP==249, KZF==1, KZP==249, LE==LZN, LMAPP==1, LPN+LTO==LPY+LTN,
C    LPN+LPY==LTN+LZX, LTN+LZO==2LPN, LPN+LZX==LTN+LZY, LSKIP==2,
C    LVECT==N2M, LZN==1, MSKIP==N2P, MTRN==N1H, N1==128, N2==128,
C    2N2==N2DM+1, 2N2==N2DP-1, N2==N2M+1, N2==N2P-1, 2N2==NPTS,
C    2N2P==N2PD,
C    NFTVMT+NXACAC#init+NXSCSC#init+NXXCSR#init+NXXRCS#init==
C    NFTVMT#init+NXACAC+NXSCSC+NXXCSR+NXXRCS, NOALS==1, NOTEMP==0,
C    NSKIP==1, NUM1==NUM1#init+2, NUMBER==250, NVECT==2, NVSKIP==1,
C    1<=LEIG, LEIG<=MEMSIZ, 1<=LPN, LTN+4<=LPN,
C    LPN+2LZO<=LTN+2MEMSIZ+3, LPN+LZY<=LTN+MEMSIZ+1, 1<=LPY,
C    MEMSIZ<=165117, 8N1E<=N1, N1<=8N1E+7, 2N1H<=N1, N1<=2N1H+1,
C    4N1Q<=N1, N1<=4N1Q+3,
C    N1H+3NUSHUF+4NXPRNT#init+9NXSHUF+3NXXCSR#init+NXXOUT#init+8
C    NXXRCS#init+NXXXIN+3TEMPHY:NCALL+4ZETAPH:NCALL<=3NUSHUF#init+4
C    NXPRNT+9NXSHUF#init+3NXXCSR+NXXOUT+8NXXRCS+NXXXIN#init+3
C    TEMPHY:NCALL#init+4ZETAPH:NCALL#init+1, 2N2<=NMAX2,
C    NUMBER+1<=NSTEPS, NUSHUF#init+NXPRNT<=NUSHUF+NXPRNT#init,
C    NUSHUF+NXPRNT#init+NXSCSC+NXSHUF#init+NXXCSR#init+NXXRCS+
C    TEMPHY:NCALL+ZETAPH:NCALL<=NUSHUF#init+NXPRNT+NXSCSC#init+NXSHUF+
C    NXXCSR+NXXRCS#init+TEMPHY:NCALL#init+ZETAPH:NCALL#init,
C    NUSHUF#init+NXPRNT+2NXSCSC#init+NXXCSR+TEMPHY:NCALL#init+
C    ZETAPH:NCALL#init<=NUSHUF+NXPRNT#init+2NXSCSC+NXXCSR#init+
C    TEMPHY:NCALL+ZETAPH:NCALL,
C    NUSHUF#init+NXPRNT+4NXSHUF+NXXCSR+4NXXRCS#init+TEMPHY:NCALL+
C    ZETAPH:NCALL#init<=NUSHUF+NXPRNT#init+4NXSHUF#init+NXXCSR#init+4
C    NXXRCS+TEMPHY:NCALL#init+ZETAPH:NCALL,
C    NUSHUF+NXPRNT#init+3NXSHUF#init+NXXCSR#init+3NXXRCS+TEMPHY:NCALL+
C    ZETAPH:NCALL<=NUSHUF#init+NXPRNT+3NXSHUF+NXXCSR+3NXXRCS#init+
C    TEMPHY:NCALL#init+ZETAPH:NCALL#init,
C    NUSHUF+NXPRNT#init+2NXSHUF#init+NXXCSR#init+2NXXRCS+TEMPHY:NCALL+
C    ZETAPH:NCALL+2<=NUSHUF#init+NXPRNT+2NXSHUF+NXXCSR+2NXXRCS#init+
C    TEMPHY:NCALL#init+ZETAPH:NCALL#init,
C    NUSHUF+NXPRNT#init+2NXSHUF#init+NXXCSR#init+2NXXRCS+TEMPHY:NCALL+
C    3ZETAPH:NCALL<=NUSHUF#init+NXPRNT+2NXSHUF+NXXCSR+2NXXRCS#init+
C    TEMPHY:NCALL#init+3ZETAPH:NCALL#init,
C    3NUSHUF+3NXPRNT#init+2NXSHUF#init+NXXCSR#init+2NXXRCS+
C    TEMPHY:NCALL+ZETAPH:NCALL<=3NUSHUF#init+3NXPRNT+2NXSHUF+NXXCSR+2
C    NXXRCS#init+TEMPHY:NCALL#init+ZETAPH:NCALL#init,
C    NXPRNT#init+TEMPHY:NCALL+ZETAPH:NCALL<=NXPRNT+TEMPHY:NCALL#init+
C    ZETAPH:NCALL#init, NXSHUF#init<=NXSHUF,
C    TEMPHY:NCALL#init<=TEMPHY:NCALL, ZETAPH:NCALL#init<=ZETAPH:NCALL}

C
C     1993 version - Modified by Beatrice Creusillet for PIPS -
C
C     MODIFICATIONS:
C
C     AUGUST 1995:
C     ~~~~~~~~~~~~
C     - CXxxxxx and CYyyyyy commentaries removed for clarity.
C     - CPUTIM and ELAPSE subroutines uncommented.
C     - BLOCK DATA moved in main procedure (Francois Irigoin) .
C     - Macro definition LSTMOD(MODEHI) in module DEALSE replaced where
C       it is used.
C     - (1.,0.) replaced by CMPLX(1.,0.) wherever needed.
C     - In RUNINF, computed GOTO's are replaced by block if's.
C     - Passed through stf; one empty if block removed afterwards.
C     - Add common /TIMING/ in DATAST, TEMPFO, TEMPHY, PSIFOU, PSIPHY,
C       ZETAFO, ZETAPH, VVELFO, VVELPH, UVELFO, UVELPH, DEALSE, in order
C       to help the interprocedural propagation.
C     - Common /NMBRS/ declared in RCS, CSR, ACAC, SCSC to
C       propagate major predicates (like N2P==129) downwards to FTRVMT 
C       (fi, June 1993).
C     - Add common /FT/ in TEMPHY
C     - Add common /MEMORY/ in OCEAN
C     - variable NUMBER in common /DEBUG/ renamed into NUM1 to avoid clashes
C       with variable NUMBER in common /OPTONS/
C     - use full declaration of /FT/ in UVELFO (Francois Irigoin)
C     - Syntactic construct IF(.TRUE.) THEN ... ENDIF added around the
C       time loop to compute accuracte preconditions and transformers.
C       This should be useless with unspaghettify...
C       (Francois Irigoin)
C     - useless STOP in OCEAN commented out to avoid problems with
C       Ronan's dead code elimination (Francois Irigoin)
C     - management of NPTS in SCSC modified to restore
C       exactly NPTS; preconditions fail to find this because they use
C       a transformer computed with no knowledge of NPTS parity;
C       Same transform in ACAC.
C       Note that NPTS is directly saved and restored in RCS.
C       (Francois Irigoin)
C     - artificial IF(.TRUE.)THEN removed; do not forget to unspaghettify
C       the code before processing (Francois Irigoin)
C     - combination of arithmetic IF and RETURNs restructured manually
C       in CPRINT
C     - forwarding of N1's assignment in subsequent WRITE in CPRINT;
C       I guess the programmer did not realize N1 was directly available
C       in COMMON /OPTONS/; he did not realize the potential impact
C       of N1 reassignement in the middle of the time loop; common
C       /OPTONS/ might be useless!
C
C******NOTE: USE OF MACHINE-DEPENDENT CONSTANT: ZERO IN SUBROUTINE RUNIN
C
C            ZERO = 1.0E-200 (MAY HAVE TO REPLACE WITH YOUR MACHINES
C                             RELATIVE PRECISION FOR REAL DATA TYPE)
C

C***********************************************************************
C                        OCEAN FORTRAN PROGRAMS
C                        CREATION DATE: 3/22/81
C***********************************************************************
      PROGRAM OCEAN
C
C  D(Z)/DT + (U,V).GRAD(Z) = RNU*DELSQ(Z) + ALPHA*D(TEMP)/DX
C
C  D(TEMP)/DT + (U,V).GRAD(TEMP) = RKAPA*DELSQ(TEMP) + BETA*V
C
C
C
C THIS PROGRAM SIMULATES TWO-DIMENSIONAL FLUID FLOW ON A   (N2+1) * N1
C GRID. IT IS POSSIBLE TO SPECIFY NON-LINEAR DISTRIBUTION OF DATA POINTS
C THE Y-DIRECTION (THE FIRST INDEX CORRESPONDS TO Y DIRECTION, SECOND TO
C X DIRECTION). N1 AND N2 HAVE TO BE POWERS OF TWO GREATER OR EQUAL TO 8
C
C THE PROGRAM USES LARGE CORE MEMORY. IT REQUIRES 8*(N2+1)*N1+(N2-1)*(N2
C WORDS OF IT. IF NOTEMP = 1 IT IS POSSIBLE TO SAVE 2*(N2+1)*N1 WORDS,
C IF LMAPP = 1 YOU SAVE ADDITIONAL (N2-1)*(N2+1) WORDS.
C
C IF  LMAPP = 2 , LCM REQUIREMENTS ARE AT LEAST  3 * (N2-1) * (N2-1)
C MORE MEMORY COULD BE NEEDED IN THIS CASE BECAUSE OF EIGSET AND LCMRQR.
C
C
C FOR CDC7600 RUNS: DELETE ROUTINES LCMREQ, IN AND OUT FROM THE END OF
C                   THIS PACKAGE. ON CDC7600 THE LCM IS USED THROUGH
C                   THE ASSEMBLY ROUTINES.
C
C                   LIBRARY.
C FOR CRAY-1 RUNS : DELETE ROUTINES SECOND, DATE, TIME, EXSET AND
C                   LOG2 FROM THE END OF THIS PACKAGE. THEY ARE
C                   OBTAINED AT LOAD TIME FROM CRAY LIBRARIES AND
C                   FFTLIB.
C                   ALSO, ADJUST THE SIZE OF PARAMETER LCMSIZ IN
C                   THE ROUTINE LCMREQ SO THAT THE COMMON IS LARGE
C                   ENOUGH TO EMULATE CDC7600 LCM REQUIRED FOR THE RUN.
C
C THE FOLLOWING PARAMETERS DEFINE THE SIZE OF THE RUN:
C
      PARAMETER (NX=128,NY=128)
      PARAMETER (NA1=2* (NY+1),NA2=NX/2,NE=NY-1,NW1=NY+1)
      PARAMETER (NW2=128,NEX=256)
      PARAMETER (NI=2*NY-1,NEQ=3*NY-2,NCW2=2*NW1+1,NCW3=4*NW1+1)
C
C PLEASE REFER TO THE DIMENSIONING AND EQUIVALENCING INSTRUCTIONS IN
C THE CASE YOUR COMPILER CANNOT HANDLE PARAMETER STATEMENTS...
C COMMON BLOCKS:
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
C
C THE DIMENSION OF  GSOLV  HAS TO BE AT LEAST (N2-1)
C
      COMMON /SOLV/LVECT,LSKIP,NVECT,NVSKIP,GSOLV(127)
C
C THE DIMENSIONS OF  GMAPP  AND  G  HAVE TO BE AT LEAST (N2+1)
C
      COMMON /MAPING/GMAPP(129),G(129)
      COMMON /MFLOW/U(129)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /PI/PI
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMMON /EXSIZE/NMAX2
      COMMON /LADDR/LZN,LTN,LPN,LZO,LTO,LPY,LZX,LZY,LEIG,LE,LH,LEV
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      PARAMETER (LCMSIZ=165117)
      COMMON /MEMORY/MEMSIZ,RM(LCMSIZ)
C
C
C COMPLEX ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            CA        (N2+1) X N1/2
C            CWORK     N2+1
C            CWORK2    N2+1
C            CWORK3    N2+1
C            EX        MAX(2*N2, N1)
C
C EX ARRAY MUST NOT BE THE FIRST ARRAY IN THE MEMORY.
C
      COMPLEX CA(NW1,NA2),CWORK(NW1),CWORK2(NW1)
      COMPLEX CWORK3(NW1),EX(NEX),CF
C
C REAL ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            A      2*(N2+1) X N1/2
C            E      (N2-1)   X (N2-1)
C            WORK   N2+1     X MAX(6, 2*MIN(64, N1/2))   (AT LEAST)
C            EVAL   N2-1
C            IR     N2-1
C            IC     N2-1
C
      REAL A(NA1,NA2),E(NE,NE)
      REAL WORK(NW1*NW2)
      REAL EVAL(NE),IR(NE),IC(NE)
      INTEGER VALID
C
C EQUIVALENCE STATEMENTS ARE SAVING MEMORY SPACE. THE FOLLOWING PATTERN
C HAS TO BE FOLLOWED EXACTLY:
C
C     A-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CA+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     EVAL+-+IR-+-+-IC+-+-+E+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C
C
C     WORK+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CWORK-+-+-+CWORK2-+-+-CWORK3+-+-+
C
C      EQUIVALENCE (A,CA,EVAL), (A(NY),IR), (A(NI),IC), A(NEQ),E) - ORGI
C      EQUIVALENCE (A,CA,EVAL), (EVAL(NY),IR), (EVAL(NI),IC),
C     *             (EVAL(NEQ),E) - MACFARLANE'S FIX. BAD.
C POINTER'S FIX. ANSI REQUIRES THAT THE NUMBER OF SUBSCRIPTS MATCH
C THE NUMBER OF DIMENSIONS OF THE ARRAY. THAT WAS THE PROBLEM WITH
C THE ORGINAL STATEMENT. THE PROBLEM WITH MACFARLANE'S FIX IS THAT
C NY,NI,NEQ>NE (THE DIMENSION OF EVAL). HERE 3*NE+1-NA1 IS THE 3*NE+1TH
C ELEMENT OF A AND 3*NE+1 = NEQ.
      EQUIVALENCE (A,CA,EVAL), (A(NY,1),IR), (A(NI,1),IC),
     +            (A(3*NE+1-NA1,2),E)
      EQUIVALENCE (WORK,CWORK), (WORK(NCW2),CWORK2), (WORK(NCW3),CWORK3)
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /DEBUG/NUM1,TLAST
C
C     former BLOCK DATA
C
C
      DATA TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT/0.,0.,0.,0.,
     +     0.,0.,0./
      DATA TXSHUF,TUSHUF,TXPRNT,TXLOG2/0.,0.,0.,0./
      DATA EXXRCS,EXXCSR,EXSCSC,EXACAC,EFTVMT/0.,0.,0.,0.,0./
      DATA NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT/0,0,0,0,0,0,
     +     0/
      DATA NXSHUF,NUSHUF,NXPRNT,NXLOG2/0,0,0,0/
      DATA VDAT/0.10000E+03,-0.10000E+03,0.10000E-04,-0.10000E+03,
     +     -0.15708E+01,0.99983E+02,-0.18147E+01,-0.20427E+01,
     +     -0.22452E+01,-0.24181E+01,0.95976E+02,-0.95977E+02,
     +     0.10000E-04,-0.95978E+02,-0.25589E+01/
C
C PI IS A USEFULL CONSTANT
C
      DATA PI/3.141592653589793/
      DATA NUM1/1/,TLAST/0.0/

C  T() {}

C
C
C
C NOW WE CAN START WITH THE PROGRAM...
C SUBROUTINE START TELLS OCEAN WHAT TO DO:
C
      CALL CPUTIM(CPU1)                                                 0001

C  T() {}

      CALL ELAPSE(TCLCK1)                                               0002

C  T() {}

      OPEN (UNIT=1,FILE='OCV')                                          0003

C  T() {}

      OPEN (UNIT=6,FILE='OCO6')                                         0004

C  T() {}

      WRITE (1, 9000)                                                   0005

C  T(KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,KVF,KVP,KZF,
C    KZP,LMAPP,N1,N2,NOALS,NOTEMP,NUMBER) {KDATA==1, KPF==1, KPP==249,
C    KPRESS==1, KSM==1, KTA==50, KTAPE==0, KTF==1, KTP==50, KUF==1,
C    KUP==249, KVF==1, KVP==249, KZF==1, KZP==249, LMAPP==1, N1==128,
C    N2==128, NOALS==1, NOTEMP==0, NUMBER==250}


      CALL START(NX, NY)                                                0006

C  T() {}

C
C IF  LMAPP = 1 , H  (THE SIZE OF THE BOX IN Y DIRECTION)  SHOULD BE
C SPECIFIED IN THE MAIN PROGRAM.
C
      H = PI                                                            0007

C  T(N1H) {2N1H<=N1, N1<=2N1H+1}

C
C DEFINING CONSTANTS THAT WILL BE NEEDED:
C
      N1H = N1/2                                                        0008

C  T(N1Q) {4N1Q<=N1, N1<=4N1Q+3}

      N1Q = N1/4                                                        0009

C  T(N1E) {8N1E<=N1, N1<=8N1E+7}

      N1E = N1/8                                                        0010

C  T(N2M) {N2==N2M+1}

      N2M = N2-1                                                        0011

C  T(N2P) {N2==N2P-1}

      N2P = N2+1                                                        0012

C  T(N2DP) {2N2==N2DP-1}

      N2DP = 2*N2+1                                                     0013

C  T(N2DM) {2N2==N2DM+1}

      N2DM = 2*N2-1                                                     0014

C  T(N2PD) {2N2P==N2PD}

      N2PD = 2*N2P                                                      0015

C  T(NW) {}

      NW = N2PD*N1H                                                     0016

C  T(NWH) {2NWH<=NW, NW<=2NWH+1}

      NWH = NW/2                                                        0017

C  T(NWQ) {4NWQ<=NW, NW<=4NWQ+3}

      NWQ = NW/4                                                        0018

C  T(NWEIG) {N2M==NWEIG}

      NWEIG = N2M                                                       0019

C  T(NWEIG) {}

      IF (LMAPP.NE.1) NWEIG = (N2M+3)*N2M                               0020

C  T(NMAX2) {N1<=NMAX2, 2N2<=NMAX2}

      NMAX2 = MAX(2*N2, N1)                                             0022

C  T(K1Q) {K1Q==N1E+1}

      K1Q = N1E+1                                                       0023

C  T(K2Q) {K1Q+N1E==K2Q}

      K2Q = K1Q+N1E                                                     0024

C  T(K3Q) {K2Q+N1E==K3Q}

      K3Q = K2Q+N1E                                                     0025

C  T(K1QM) {K1Q==K1QM+1}

      K1QM = K1Q-1                                                      0026

C  T(K2QM) {K2Q==K2QM+1}

      K2QM = K2Q-1                                                      0027

C  T(K3QM) {K3Q==K3QM+1}

      K3QM = K3Q-1                                                      0028

C  T(LARGE) {LARGE==8NW}

C
C LCM ALLOCATION AND COMPUTATION OF ADDRESSES:
C
      LARGE = 8*NW                                                      0029

C  T(LARGE) {}

      IF (NOTEMP.EQ.1) LARGE = 6*NW                                     0030

C  T(LARGE) {}

      IF (LMAPP.NE.2) THEN                                              0032

C  T(LARGE) {LARGE#init+NWEIG==LARGE}

C
         LARGE = LARGE+NWEIG                                            0033

      ELSE

C  T(LARGE) {}

C
         IF (KPRESS.GT.1) LARGE = MAX(LARGE, 3*N2M*N2M)+NWEIG+NWEIG     0034

C  T(LARGE) {}

         IF (KPRESS.LE.1) LARGE = MAX(LARGE+NWEIG, 3*N2M*N2M)           0036
      ENDIF

C  T(LZN,MEMSIZ) {LARGE==MEMSIZ, LZN==1, LARGE<=165117}

C
      LZN = LCMREQ(LARGE)                                               0038

C  T(LTN) {LZN+NW==LTN}

      LTN = LZN+NW                                                      0039

C  T(LTN) {}

      IF (NOTEMP.EQ.1) LTN = LZN                                        0040

C  T(LPN) {LTN+NW==LPN}

      LPN = LTN+NW                                                      0042

C  T(LZO) {LPN+NW==LZO}

      LZO = LPN+NW                                                      0043

C  T(LTO) {LZO+NW==LTO}

      LTO = LZO+NW                                                      0044

C  T(LTO) {}

      IF (NOTEMP.EQ.1) LTO = LZO                                        0045

C  T(LPY) {LTO+NW==LPY}

      LPY = LTO+NW                                                      0047

C  T(LZX) {LPY+NW==LZX}

      LZX = LPY+NW                                                      0048

C  T(LZY) {LZX+NW==LZY}

      LZY = LZX+NW                                                      0049

C  T(LPRESS) {LARGE+LZN==LPRESS+NWEIG}

      LPRESS = LZN+LARGE-NWEIG                                          0050

C  T(LEIG) {LEIG==LPRESS}

      LEIG = LPRESS                                                     0051

C  T(LEIG) {}

      IF (KPRESS.GT.1.AND.LMAPP.NE.1) LEIG = LPRESS-NWEIG               0052

C  T(LE) {LE==LZN}

C
C THESE LCM ADDRESSES ARE USED BY EIGSET AND LCMRQR
C
      LE = LZN                                                          0054

C  T(LH) {}

      LH = LE+N2M*N2M                                                   0055

C  T(LEV) {}

      LEV = LH+N2M*N2M                                                  0056

C  T() {}

C
      CALL EXSET(EX, NMAX2)                                             0057

C  T(I) {1<=I}

C
C SET ALL  U(I) TO 0. TO AVOID TROUBLE IF NO MEAN FLOW IS DESIRED
C
      DO 10 I = 1, N2P                                                  0058

C  T() {}

         U(I) = 0.                                                      0059

C  T() {}

10       CONTINUE                                                       0060

C  T(I,NXXOUT) {NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

C
C SET UP ARRAYS ASSOCIATED WITH THE MAPPING FUNCTION:
C
      IF (LMAPP.EQ.1) THEN                                              0061

C  T() {}

C
C LINEAR MAPPING - EIGENVALUES KNOWN, EIGENFUNCTIONS ARE SIMPLY SINES
C AND COSINES, SO THAT NO MATRICES ARE NEEDED:
C
         F = H/REAL(N2)                                                 0062

C  T() {}

         FZ = PI/H                                                      0063

C  T() {}

         FZSQ = FZ*FZ                                                   0064

C  T() {}

         GMAPP(1) = 0.                                                  0065

C  T() {}

         G(1) = FZ                                                      0066

C  T(I) {1<=I}

         DO 20 I = 1, N2M                                               0067

C  T() {}

            GMAPP(I+1) = F*REAL(I)                                      0068

C  T() {}

            G(I+1) = FZ                                                 0069

C  T() {}

            EVAL(I) = -REAL(I)**2*FZSQ                                  0070

C  T() {}

20          CONTINUE                                                    0071

C  T() {}

         GMAPP(N2P) = H                                                 0072

C  T() {}

         G(N2P) = FZ                                                    0073

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LEIG, LEIG+NWEIG<=MEMSIZ+1,
C    1<=NWEIG}

         CALL OUT(EVAL, LEIG, NWEIG)                                    0074
C
      ENDIF

C  T(NXXOUT) {NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+2}

C
C READ THE DATA:
C
      IF (KDATA.EQ.1.OR.KDATA.EQ.2) CALL DATAST(A, N2P, N1, GMAPP)      0075

C  T() {}

      FX = 2.0*PI/BOXX                                                  0077

C  T() {}

      FX2 = 2.*FX                                                       0078

C  T(I,IEXSHF,ISIGN,J,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN)
C    {NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT,
C    2NXACAC+NXXOUT#init==2NXACAC#init+NXXOUT,
C    NXLOG2+NXXOUT#init==NXLOG2#init+NXXOUT,
C    2NXSHUF+NXXOUT#init==2NXSHUF#init+NXXOUT,
C    NXXOUT+2NXXRCS#init==NXXOUT#init+2NXXRCS,
C    NXXOUT+2NXXXIN#init==NXXOUT#init+2NXXXIN, NXXOUT#init<=NXXOUT,
C    NXXOUT<=NXXOUT#init+2}

C
C PREPARE THE INPUT FOR PROCESSING:
C
      IF (KDATA.EQ.1) THEN                                              0079

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

C
C THE INPUT WAS STREAMFUNCTION IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER SPACE:
C
         CALL IN(A, LPN, NW)                                            0080

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

         CALL SHUF(A, N2P, N1, WORK)                                    0081

C  T(NPTS) {N1==NPTS}

         NPTS = N1                                                      0082

C  T(NSKIP) {N2P==NSKIP}

         NSKIP = N2P                                                    0083

C  T(MTRN) {MTRN==N2P}

         MTRN = N2P                                                     0084

C  T(MSKIP) {MSKIP==1}

         MSKIP = 1                                                      0085

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0086

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0087

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0088

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXRCS==NXXRCS#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL RCS(A, EX)                                                0089

C  T(NPTS) {2N2==NPTS}

         NPTS = 2*N2                                                    0090

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0091

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0092

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0093

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0094

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0095

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0096

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL ACAC(A, EX, WORK)                                         0097

C  T() {}

C           F = 0.125/REAL(N1*N2)
         F = 0.0625/REAL(N1*N2)                                         0098

C  T(I,J) {1<=J}

         DO 30 J = 1, N1H                                               0099

C  T(I) {1<=I}

            DO 40 I = 1, N2PD                                           0100

C  T() {}

               A(I,J) = A(I,J)*F                                        0101

C  T() {}

40             CONTINUE                                                 0102

C  T() {}

30          CONTINUE                                                    0103

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LPN, NW)                                           0104

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZN, NW)                                           0105
      ENDIF

C  T(I,IEXSHF,ISIGN,J,KZN,LOG,LSKIP,LVECT,MSKIP,MTRN,NFTVMT,NPTS,
C    NSKIP,NSTEPS,NVECT,NVSKIP,NXACAC,NXLOG2,NXSHUF,NXXOUT,NXXRCS,
C    NXXXIN)
C    {NFTVMT+NXACAC#init+NXSHUF#init==NFTVMT#init+NXACAC+NXSHUF,
C    NFTVMT+NXLOG2#init==NFTVMT#init+NXLOG2,
C    NXSHUF+NXXRCS#init==NXSHUF#init+NXXRCS,
C    NFTVMT#init+3NXSHUF+NXXOUT#init+NXXXIN<=NFTVMT+3NXSHUF#init+
C    NXXOUT+NXXXIN#init,
C    NFTVMT+3NXSHUF#init+2NXXOUT+2NXXXIN#init<=NFTVMT#init+3NXSHUF+2
C    NXXOUT#init+2NXXXIN, NFTVMT+NXXOUT#init<=NFTVMT#init+NXXOUT,
C    NXSHUF#init<=NXSHUF,
C    NXSHUF+NXXOUT#init+NXXXIN<=NXSHUF#init+NXXOUT+NXXXIN#init+1}

C
CC*****C H E C K   F O U R I E R   C O E F F I C I E N T S**************
C
C         WRITE (6,7010) A(1,1),A(1,2),A(1,3)
C         WRITE (6,7020) A(2,1),A(2,2),A(2,3)
C         WRITE (6,7030) A(3,1),A(3,2),A(3,3)
C 7010    FORMAT(/2X,26HCHECK FOURIER COEFFICIENTS/4X,8HA(1,1) =,1PE13.6
C     1   2X,8HA(1,2) =,1PE13.6,2X,8HA(1,3) =,1PE13.6)
C 7020    FORMAT(4X,8HA(2,1) =,1PE13.6,2X,8HA(2,2) =,1PE13.6,2X,
C     1   8HA(2,3) =,1PE13.6)
C 7030    FORMAT(4X,8HA(3,1) =,1PE13.6,2X,8HA(3,2) =,1PE13.6,2X,
C     1   8HA(3,3) =,1PE13.6/)
C
C
      IF (KDATA.NE.3) THEN                                              0106

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LEIG, LEIG+NWEIG<=MEMSIZ+1,
C    1<=NWEIG}

C                                                     2
C STREAMFUNCTION KNOWN - FIND THE VORTICITY:  Z =  DEL  (PSI):
C
         CALL IN(EVAL, LEIG, NWEIG)                                     0107

C  T(KZN) {KZN==LZN}

         KZN = LZN                                                      0108

C  T(LVECT) {LVECT==N2M}

         LVECT = N2M                                                    0109

C  T(LSKIP) {LSKIP==2}

         LSKIP = 2                                                      0110

C  T(NVECT) {NVECT==2}

         NVECT = 2                                                      0111

C  T(NVSKIP) {NVSKIP==1}

         NVSKIP = 1                                                     0112

C  T(I,J,KZN,NXXOUT,NXXXIN) {J+NXXOUT#init==NXXOUT+1,
C    J+NXXXIN#init==NXXXIN+1, 1<=J, J+KZN#init<=KZN+1}

         DO 50 J = 1, N1H                                               0113

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL IN(CWORK, KZN, N2PD)                                   0114

C  T() {}

            F = REAL((J-1)*(J-1))*FX*FX                                 0115

C  T(I) {2<=I}

            DO 60 I = 2, N2                                             0116

C  T() {}

               CWORK(I) = (EVAL(I-1)-F)*CWORK(I)                        0117

C  T() {}

60             CONTINUE                                                 0118

C  T() {}

            CWORK(1) = -F*CWORK(1)                                      0119

C  T() {}

            CWORK(N2P) = 0.0                                            0120

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL OUT(CWORK, KZN, N2PD)                                  0121

C  T(KZN) {KZN#init+N2PD==KZN}

            KZN = KZN+N2PD                                              0122

C  T() {}

50          CONTINUE                                                    0123

C  T(NPTS) {2N2==NPTS}

         NPTS = 2*N2                                                    0124

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0125

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0126

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0127

C  T(ISIGN) {ISIGN==1}

         ISIGN = 1                                                      0128

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0129

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0130

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZN, NW)                                            0131

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL ACAC(A, EX, WORK)                                         0132

C  T(I,J) {1<=J}

         DO 70 J = 1, N1H                                               0133

C  T(I) {1<=I}

            DO 80 I = 1, N2PD                                           0134

C  T() {}

               A(I,J) = 0.5*A(I,J)                                      0135

C  T() {}

80             CONTINUE                                                 0136

C  T() {}

70          CONTINUE                                                    0137

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZO, LZO+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZO, NW)                                           0138

C  T(I,IEXSHF,ISIGN,J,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN)
C    {NFTVMT+NXACAC#init+NXXRCS#init==NFTVMT#init+NXACAC+NXXRCS,
C    NFTVMT+NXLOG2#init==NFTVMT#init+NXLOG2,
C    NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT,
C    NFTVMT+NXXRCS#init+NXXXIN#init==NFTVMT#init+NXXRCS+NXXXIN,
C    NXSHUF+NXXRCS#init==NXSHUF#init+NXXRCS,
C    NFTVMT#init+2NXXRCS<=NFTVMT+2NXXRCS#init,
C    NFTVMT+NXXRCS#init<=NFTVMT#init+NXXRCS+1, NXXRCS#init<=NXXRCS}

         IF (NOTEMP.NE.1) THEN                                          0139

C  T(I,IEXSHF,ISIGN,J,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN) {ISIGN+2NXXOUT==2NXXOUT#init+3,
C    MSKIP==N2P, MTRN==N1H, 2N2==NPTS,
C    NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT, NSKIP==1,
C    NXACAC==NXACAC#init+1, NXLOG2+NXXOUT#init==NXLOG2#init+NXXOUT,
C    NXSHUF+NXXOUT#init==NXSHUF#init+NXXOUT-1,
C    NXXOUT+NXXRCS#init==NXXOUT#init+NXXRCS+1, NXXXIN==NXXXIN#init+1,
C    1<=J, N1H+1<=J, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=LTO,
C    LTO+NW<=MEMSIZ+1, 1<=NW, NXXOUT#init+1<=NXXOUT,
C    NXXOUT<=NXXOUT#init+2}

            IF (KDATA.NE.1) THEN                                        0140

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

               CALL IN(A, LTN, NW)                                      0141

C  T(NPTS) {2N2==NPTS}

C
C NEW TEMPERATURE KNOWN - SET UP T(OLD):
C
               NPTS = 2*N2                                              0142

C  T(NSKIP) {NSKIP==1}

               NSKIP = 1                                                0143

C  T(MTRN) {MTRN==N1H}

               MTRN = N1H                                               0144

C  T(MSKIP) {MSKIP==N2P}

               MSKIP = N2P                                              0145

C  T(ISIGN) {ISIGN==1}

               ISIGN = 1                                                0146

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

               CALL XLOG2(NPTS, LOG)                                    0147

C  T(IEXSHF) {}

               IEXSHF = NMAX2/NPTS                                      0148

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

               CALL ACAC(A, EX, WORK)                                   0149

C  T(I,J) {1<=J}

               DO 90 J = 1, N1H                                         0150

C  T(I) {1<=I}

                  DO 100 I = 1, N2PD                                    0151

C  T() {}

                     A(I,J) = A(I,J)*0.5                                0152

C  T() {}

100                  CONTINUE                                           0153

C  T() {}

90                CONTINUE                                              0154

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

               CALL OUT(A, LTO, NW)                                     0155

            ELSE

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

C
C TEMPERATURE IS SUPPLIED IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER REPRESENTATION:
C
               CALL IN(A, LTN, NW)                                      0156

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

               CALL SHUF(A, N2P, N1, WORK)                              0157

C  T(NPTS) {N1==NPTS}

               NPTS = N1                                                0158

C  T(NSKIP) {N2P==NSKIP}

               NSKIP = N2P                                              0159

C  T(MTRN) {MTRN==N2P}

               MTRN = N2P                                               0160

C  T(MSKIP) {MSKIP==1}

               MSKIP = 1                                                0161

C  T(ISIGN) {ISIGN==-1}

               ISIGN = -1                                               0162

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

               CALL XLOG2(NPTS, LOG)                                    0163

C  T(IEXSHF) {}

               IEXSHF = NMAX2/NPTS                                      0164

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXRCS==NXXRCS#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

               CALL RCS(A, EX)                                          0165

C  T() {}

               F = 0.5/REAL(N1)                                         0166

C  T(I,J) {1<=J}

               DO 110 J = 1, N1H                                        0167

C  T(I) {1<=I}

                  DO 120 I = 1, N2PD                                    0168

C  T() {}

                     A(I,J) = F*A(I,J)                                  0169

C  T() {}

120                  CONTINUE                                           0170

C  T() {}

110               CONTINUE                                              0171

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

               CALL OUT(A, LTO, NW)                                     0172

C  T(NPTS) {2N2==NPTS}

               NPTS = 2*N2                                              0173

C  T(NSKIP) {NSKIP==1}

               NSKIP = 1                                                0174

C  T(MTRN) {MTRN==N1H}

               MTRN = N1H                                               0175

C  T(MSKIP) {MSKIP==N2P}

               MSKIP = N2P                                              0176

C  T(ISIGN) {ISIGN==-1}

               ISIGN = -1                                               0177

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

               CALL XLOG2(NPTS, LOG)                                    0178

C  T(IEXSHF) {}

               IEXSHF = NMAX2/NPTS                                      0179

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

               CALL ACAC(A, EX, WORK)                                   0180

C  T() {}

C           F = 0.25/REAL(N2)
               F = 0.125/REAL(N2)                                       0181

C  T(I,J) {1<=J}

               DO 130 J = 1, N1H                                        0182

C  T(I) {1<=I}

                  DO 140 I = 1, N2PD                                    0183

C  T() {}

                     A(I,J) = F*A(I,J)                                  0184

C  T() {}

140                  CONTINUE                                           0185

C  T() {}

130               CONTINUE                                              0186

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

               CALL OUT(A, LTN, NW)                                     0187
            ENDIF

         ENDIF

C  T() {}


         T = 0.                                                         0188

C  T() {}

         DTT = DT                                                       0189

C  T(NSTEPS) {NSTEPS==1}

         NSTEPS = 1                                                     0190
      ENDIF

C  T() {}


      CALL RUNINF                                                       0191

C  T(NUM1) {NUM1==NUM1#init+1}

      CALL BUG('AFT INITAL')                                            0192

C  T() {}


C#
c      IF (.TRUE.) THEN    
150   CONTINUE                                                          0193

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

C
C THIS IS THE BEGINNING OF THE TIME STEP.
C
      IF (MOD(NSTEPS, KTF).EQ.1.AND.NOTEMP.NE.1) CALL TEMPFO(CA, N2P    0194
     &, N1H, CWORK)                                                     0194

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KPF).EQ.1) CALL PSIFOU(CA, N2P, N1H, CWORK)       0196

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KZF).EQ.1) CALL ZETAFO(CA, N2P, N1H, CWORK)       0198

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KVF).EQ.1) CALL VVELFO(CA, N2P, N1H, FX, CWORK)   0200

C  T(I,IEXSHF,ISIGN,J,K,K2QJ,KTN,KTO,KZN,KZO,LOG,MSKIP,MTRN,NFTVMT,
C    NPTS,NSKIP,NXACAC,NXLOG2,NXXOUT,NXXXIN)
C    {NFTVMT+NXACAC#init==NFTVMT#init+NXACAC,
C    5NXACAC+3NXXOUT#init==5NXACAC#init+3NXXOUT,
C    5NXACAC+3NXXXIN#init==5NXACAC#init+3NXXXIN,
C    NXACAC#init+3NXLOG2<=NXACAC+3NXLOG2#init,
C    NXACAC+6NXLOG2#init<=NXACAC#init+6NXLOG2, NXLOG2<=NXLOG2#init+1}

      IF (MOD(NSTEPS+1, KTA).EQ.1) THEN                                 0202

C  T() {}

C
C TIME AVERAGE VORTICITY:
C
         DTT = DT                                                       0203

C  T() {}

         T = T-0.5*DT                                                   0204

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZO, LZO+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZO, NW)                                            0205

C  T(NPTS) {2N2==NPTS}

         NPTS = 2*N2                                                    0206

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0207

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0208

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0209

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0210

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0211

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0212

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL ACAC(A, EX, WORK)                                         0213

C  T() {}

         F = 0.125/REAL(N2)                                             0214

C  T(I,J) {1<=J}

         DO 160 J = 1, N1H                                              0215

C  T(I) {1<=I}

            DO 170 I = 1, N2PD                                          0216

C  T() {}

               A(I,J) = A(I,J)*F                                        0217

C  T() {}

170            CONTINUE                                                 0218

C  T() {}

160         CONTINUE                                                    0219

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZO, LZO+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZO, NW)                                           0220

C  T(ISIGN) {ISIGN==1}

         ISIGN = 1                                                      0221

C  T(MTRN) {MTRN==N1Q}

         MTRN = N1Q                                                     0222

C  T(KZN) {KZN==LZN}

         KZN = LZN                                                      0223

C  T(KZO) {KZO==LZO}

         KZO = LZO                                                      0224

C  T(I,IEXSHF,J,K,K2QJ,KZN,KZO,LOG,NFTVMT,NPTS,NXACAC,NXXOUT,NXXXIN)
C    {K+NFTVMT#init==NFTVMT+1, K+NXACAC#init==NXACAC+1,
C    2K+NXXOUT#init==NXXOUT+2, 2K+NXXXIN#init==NXXXIN+2,
C    KZN+KZO#init==KZN#init+KZO, LOG==LOG#init, NPTS==NPTS#init,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init, 1<=K,
C    K+KZN#init<=KZN+1}

         DO 180 K = 1, 2                                                0225

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(A, KZO, NWH)                                        0226

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(A(1,K2Q), KZN, NWH)                                 0227

C  T(I,J,K2QJ) {1<=J}

            DO 190 J = 1, N1Q                                           0228

C  T(K2QJ) {J+K2QM==K2QJ}

               K2QJ = J+K2QM                                            0229

C  T(I) {1<=I}

               DO 200 I = 1, N2PD                                       0230

C  T() {}

                  A(I,J) = A(I,J)+0.5*A(I,K2QJ)                         0231

C  T() {}

200               CONTINUE                                              0232

C  T() {}

190            CONTINUE                                                 0233

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(A, KZN, NWH)                                       0234

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

            CALL ACAC(A, EX, WORK)                                      0235

C  T(I,J) {1<=J}

            DO 210 J = 1, N1Q                                           0236

C  T(I) {1<=I}

               DO 220 I = 1, N2PD                                       0237

C  T() {}

                  A(I,J) = 0.5*A(I,J)                                   0238

C  T() {}

220               CONTINUE                                              0239

C  T() {}

210            CONTINUE                                                 0240

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(A, KZO, NWH)                                       0241

C  T(KZO) {KZO#init+NWH==KZO}

            KZO = KZO+NWH                                               0242

C  T(KZN) {KZN#init+NWH==KZN}

            KZN = KZN+NWH                                               0243

C  T() {}

180         CONTINUE                                                    0244

C  T(I,IEXSHF,ISIGN,J,K,K2QJ,KTN,KTO,LOG,MTRN,NFTVMT,NPTS,NXACAC,
C    NXXOUT,NXXXIN) {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    5NFTVMT+3NXXOUT#init==5NFTVMT#init+3NXXOUT, NPTS==NPTS#init,
C    5NXACAC+3NXXOUT#init==5NXACAC#init+3NXXOUT,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN, NXXOUT#init<=NXXOUT,
C    NXXOUT<=NXXOUT#init+5}

         IF (NOTEMP.NE.1) THEN                                          0245

C  T(ISIGN) {ISIGN==-1}

C
C TIME AVERAGE TEMPERATURE:
C
            ISIGN = -1                                                  0246

C  T(MTRN) {MTRN==N1H}

            MTRN = N1H                                                  0247

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

            CALL IN(A, LTO, NW)                                         0248

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

            CALL ACAC(A, EX, WORK)                                      0249

C  T() {}

            F = 0.125/REAL(N2)                                          0250

C  T(I,J) {1<=J}

            DO 230 J = 1, N1H                                           0251

C  T(I) {1<=I}

               DO 240 I = 1, N2PD                                       0252

C  T() {}

                  A(I,J) = F*A(I,J)                                     0253

C  T() {}

240               CONTINUE                                              0254

C  T() {}

230            CONTINUE                                                 0255

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

            CALL OUT(A, LTO, NW)                                        0256

C  T(ISIGN) {ISIGN==1}

            ISIGN = 1                                                   0257

C  T(MTRN) {MTRN==N1Q}

            MTRN = N1Q                                                  0258

C  T(KTO) {KTO==LTO}

            KTO = LTO                                                   0259

C  T(KTN) {KTN==LTN}

            KTN = LTN                                                   0260

C  T(I,IEXSHF,J,K,K2QJ,KTN,KTO,LOG,NFTVMT,NPTS,NXACAC,NXXOUT,NXXXIN)
C    {K+NFTVMT#init==NFTVMT+1, K+NXACAC#init==NXACAC+1,
C    2K+NXXOUT#init==NXXOUT+2, 2K+NXXXIN#init==NXXXIN+2,
C    KTN+KTO#init==KTN#init+KTO, LOG==LOG#init, NPTS==NPTS#init,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init, 1<=K,
C    K+KTN#init<=KTN+1}

            DO 250 K = 1, 2                                             0261

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL IN(A, KTO, NWH)                                     0262

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL IN(A(1,K2Q), KTN, NWH)                              0263

C  T(I,J,K2QJ) {1<=J}

               DO 260 J = 1, N1Q                                        0264

C  T(K2QJ) {J+K2QM==K2QJ}

                  K2QJ = J+K2QM                                         0265

C  T(I) {1<=I}

                  DO 270 I = 1, N2PD                                    0266

C  T() {}

                     A(I,J) = A(I,J)+0.5*A(I,K2QJ)                      0267

C  T() {}

270                  CONTINUE                                           0268

C  T() {}

260               CONTINUE                                              0269

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL OUT(A, KTN, NWH)                                    0270

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

               CALL ACAC(A, EX, WORK)                                   0271

C  T(I,J) {1<=J}

               DO 280 J = 1, N1Q                                        0272

C  T(I) {1<=I}

                  DO 290 I = 1, N2PD                                    0273

C  T() {}

                     A(I,J) = 0.5*A(I,J)                                0274

C  T() {}

290                  CONTINUE                                           0275

C  T() {}

280               CONTINUE                                              0276

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL OUT(A, KTO, NWH)                                    0277

C  T(KTO) {KTO#init+NWH==KTO}

               KTO = KTO+NWH                                            0278

C  T(KTN) {KTN#init+NWH==KTN}

               KTN = KTN+NWH                                            0279

C  T() {}

250            CONTINUE                                                 0280
         ENDIF

      ENDIF

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR,NXXXIN) {NFTVMT+NXLOG2#init==NFTVMT#init+NXLOG2,
C    2NUSHUF+NXLOG2#init==2NUSHUF#init+NXLOG2,
C    2NXACAC+NXLOG2#init==2NXACAC#init+NXLOG2,
C    NXLOG2+2NXXCSR#init==NXLOG2#init+2NXXCSR, NXXXIN==NXXXIN#init+1,
C    1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW, NXLOG2#init<=NXLOG2,
C    NXLOG2<=NXLOG2#init+2}

C
C THE BEGINING OF A NORMAL TIME STEP
C (U IS X VELOCITY AND V IS Y VELOCITY)
C FIND (-U) = D(PSI)/DY
C
C
      IF (NSTEPS.LT.3) THEN                                             0281

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LPN, NW)                                           0282

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR) {ISIGN==1, MSKIP==1, MTRN==N2P, 2N1H==NPTS,
C    N2P==NSKIP, NFTVMT==NFTVMT#init+2, NUSHUF==NUSHUF#init+1,
C    NXACAC==NXACAC#init+1, NXLOG2==NXLOG2#init+2,
C    NXXCSR==NXXCSR#init+1}

         CALL PSIPHY(CA, N2P, N1H, EX, G, U, WORK, CWORK3, 1)           0283

      ELSE

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LPN, NW)                                           0284

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR) {NFTVMT+NXLOG2#init==NFTVMT#init+NXLOG2,
C    2NUSHUF+NXLOG2#init==2NUSHUF#init+NXLOG2,
C    2NXACAC+NXLOG2#init==2NXACAC#init+NXLOG2,
C    NXLOG2+2NXXCSR#init==NXLOG2#init+2NXXCSR, NXLOG2#init<=NXLOG2,
C    NXLOG2<=NXLOG2#init+2}

         IF (MOD(NSTEPS, KPP).EQ.1) CALL PSIPHY(CA, N2P, N1H, EX, G,    0285
     &   U, WORK, CWORK3, -1)                                           0285
      ENDIF

C  T(NPTS) {2N2==NPTS}

C
      NPTS = 2*N2                                                       0287

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0288

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0289

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0290

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0291

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0292

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0293

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPN, NW)                                              0294

C  T() {}

      F = 0.                                                            0295

C  T(I,J) {1<=I}

      DO 300 I = 1, N2                                                  0296

C  T(J) {1<=J}

         DO 310 J = 1, N1H                                              0297

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0298

C  T() {}

310         CONTINUE                                                    0299

C  T() {}

         F = F+1.                                                       0300

C  T() {}

300      CONTINUE                                                       0301

C  T(J) {1<=J}

      DO 320 J = 1, N1H                                                 0302

C  T() {}

         CA(N2P,J) = 0.                                                 0303

C  T() {}

320      CONTINUE                                                       0304

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXSCSC==NXSCSC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL SCSC(CA, EX, WORK)                                           0305

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPY, LPY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPY, NW)                                             0306

C  T() {}

      IF (KSM.EQ.1) CALL MEAN(CA, U, G)                                 0307

C  T(IEXSHF,ISIGN,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT+NXSCSC#init==NFTVMT#init+NXSCSC,
C    NPTS==NPTS#init, NXSCSC#init<=NXSCSC, NXSCSC<=NXSCSC#init+1}

      IF (MOD(NSTEPS, KUF).EQ.1) CALL UVELFO(CA, N2P, N1H, G, EX,       0309
     &CWORK)                                                            0309

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPN, NW)                                              0311

C  T() {}

C
C FIND  V = D(PSI)/DX
C
      F = 0.                                                            0312

C  T(I,J) {1<=J}

      DO 330 J = 1, N1H                                                 0313

C  T(I) {1<=I}

         DO 340 I = 1, N2P                                              0314

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0315

C  T() {}

340         CONTINUE                                                    0316

C  T() {}

         F = F+FX                                                       0317

C  T() {}

330      CONTINUE                                                       0318

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL ACAC(CA, EX, WORK)                                           0319

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPN, NW)                                             0320

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KPP).EQ.1.AND.NOTEMP.NE.1) CALL IN(CA, LPN, NW)   0321

C  T(NPTS) {2N2==NPTS}

      NPTS = 2*N2                                                       0323

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0324

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0325

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0326

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0327

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0328

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0329

C  T(I,J,KTO,NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXOUT#init<=NXXOUT}

      IF (NOTEMP.NE.1) THEN                                             0330

C  T(KTO) {KTO==LTO}

C
C T(TOTAL) = T-BETA*Y
C WHERE BETA < 0 MEANS   STABLE STRATIFICATION AND
C       BETA > 0 MEANS UNSTABLE STRATIFICATION
C
         KTO = LTO                                                      0331

C  T() {}

         DTB = 0.5*BETA*DTT                                             0332

C  T(I,J,KTO,NXXOUT,NXXXIN) {J+NXXOUT#init==NXXOUT+1,
C    J+NXXXIN#init==NXXXIN+1, 1<=J, J+KTO#init<=KTO+1}

         DO 350 J = 1, N1H                                              0333

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTO, KTO+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL IN(CWORK, KTO, N2PD)                                   0334

C  T() {}

            F = -REAL(J-1)*FX*DTT*0.25                                  0335

C  T(I) {1<=I}

            DO 360 I = 1, N2P                                           0336

C  T() {}

               CWORK(I) = CWORK(I)*CMPLX(1., U(I)*F)+DTB*CA(I,J)        0337

C  T() {}

360            CONTINUE                                                 0338

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTO, KTO+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL OUT(CWORK, KTO, N2PD)                                  0339

C  T(KTO) {KTO#init+N2PD==KTO}

            KTO = KTO+N2PD                                              0340

C  T() {}

350         CONTINUE                                                    0341
      ENDIF

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}


      CALL IN(CA, LZN, NW)                                              0342

C  T() {}

C
C FIND DZ/DY:
C
      F = 0.                                                            0343

C  T(I,J) {1<=I}

      DO 370 I = 1, N2                                                  0344

C  T(J) {1<=J}

         DO 380 J = 1, N1H                                              0345

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0346

C  T() {}

380         CONTINUE                                                    0347

C  T() {}

         F = F+1.                                                       0348

C  T() {}

370      CONTINUE                                                       0349

C  T(J) {1<=J}

      DO 390 J = 1, N1H                                                 0350

C  T() {}

         CA(N2P,J) = 0.                                                 0351

C  T() {}

390      CONTINUE                                                       0352

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXSCSC==NXSCSC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL SCSC(CA, EX, WORK)                                           0353

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZY, NW)                                             0354

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LZN, NW)                                              0355

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL ACAC(CA, EX, WORK)                                           0356

C  T(I,J) {1<=J}

      DO 400 J = 1, N1H                                                 0357

C  T(I) {1<=I}

         DO 410 I = 1, N2P                                              0358

C  T() {}

            CA(I,J) = CA(I,J)*0.5                                       0359

C  T() {}

410         CONTINUE                                                    0360

C  T() {}

400      CONTINUE                                                       0361

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZN, NW)                                             0362

C  T(NPTS) {N1==NPTS}

      NPTS = N1                                                         0363

C  T(NSKIP) {N2P==NSKIP}

      NSKIP = N2P                                                       0364

C  T(MTRN) {MTRN==N2P}

      MTRN = N2P                                                        0365

C  T(MSKIP) {MSKIP==1}

      MSKIP = 1                                                         0366

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0367

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0368

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0369

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,ZETAPH:NCALL)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    NFTVMT+NXXCSR#init==NFTVMT#init+NXXCSR, NPTS==NPTS#init,
C    NUSHUF+NXXCSR#init==NUSHUF#init+NXXCSR,
C    NXPRNT+NXXCSR#init==NXPRNT#init+NXXCSR,
C    NXXCSR+ZETAPH:NCALL#init==NXXCSR#init+ZETAPH:NCALL,
C    NXXCSR#init<=NXXCSR, NXXCSR<=NXXCSR#init+1}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL ZETAPH(CA, N2PD, N1H, EX, WORK    0370
     &, -1)                                                             0370

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL IN(CA, LZN, NW)                   0372

C  T() {}

C
C FIND DZ/DX:
C
      F = 0.                                                            0374

C  T(I,J) {1<=J}

      DO 420 J = 1, N1H                                                 0375

C  T(I) {1<=I}

         DO 430 I = 1, N2P                                              0376

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0377

C  T() {}

430         CONTINUE                                                    0378

C  T() {}

         F = F+FX2                                                      0379

C  T() {}

420      CONTINUE                                                       0380

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL CSR(CA, EX)                                                  0381

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZX, LZX+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZX, NW)                                             0382

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LZY, NW)                                              0383

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL CSR(CA, EX)                                                  0384

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZY, NW)                                             0385

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPN, NW)                                              0386

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL CSR(CA, EX)                                                  0387

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPN, NW)                                             0388

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPY, LPY+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPY, NW)                                              0389

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL CSR(CA, EX)                                                  0390

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPY, LPY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPY, NW)                                             0391

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF+NXXXIN#init==NUSHUF#init+NXXXIN,
C    NXPRNT+NXXXIN#init==NXPRNT#init+NXXXIN, NXXXIN#init<=NXXXIN,
C    NXXXIN<=NXXXIN#init+1}

C
C WE ARE IN PHYSICAL SPACE NOW - FIND  (U,V).GRAD (Z):
C
      IF (MOD(NSTEPS, KUP).EQ.1) CALL UVELPH(A, N2PD, N1H, WORK, -1)    0392

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF+NXXXIN#init==NUSHUF#init+NXXXIN,
C    NXPRNT+NXXXIN#init==NXPRNT#init+NXXXIN, NXXXIN#init<=NXXXIN,
C    NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KVP).EQ.1) CALL VVELPH(A, N2PD, N1H, WORK, -1)    0394

C  T(KPY) {KPY==LPY}

      KPY = LPY                                                         0396

C  T(KPN) {KPN==LPN}

      KPN = LPN                                                         0397

C  T(KZY) {KZY==LZY}

      KZY = LZY                                                         0398

C  T(KZX) {KZX==LZX}

      KZX = LZX                                                         0399

C  T() {}

      UKSM1F = REAL(2-KSM)                                              0400

C  T(I,IPH,J,K,KPN,KPY,KZX,KZY,NXXOUT,NXXXIN)
C    {2K+NXXOUT#init==NXXOUT+2, 4K+NXXXIN#init==NXXXIN+4,
C    KPN+KZY#init==KPN#init+KZY, KPY+KZY#init==KPY#init+KZY,
C    KZX+KZY#init==KZX#init+KZY, 1<=K, K+KZY#init<=KZY+1}

      DO 440 K = 1, 4                                                   0401

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A, KPY, NWQ)                                           0402

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A(1,K1Q), KPN, NWQ)                                    0403

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A(1,K2Q), KZY, NWQ)                                    0404

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZX, KZX+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A(1,K3Q), KZX, NWQ)                                    0405

C  T(I,IPH,J) {1<=I}

         DO 450 I = 1, N2PD                                             0406

C  T(IPH) {2IPH<=I+1, I<=2IPH}

            IPH = (I+1)/2                                               0407

C  T() {}

            GG = G(IPH)                                                 0408

C  T() {}

            UU = U(IPH)*UKSM1F                                          0409

C  T(J) {1<=J}

            DO 460 J = 1, N1E                                           0410

C  T() {}

               A(I,J) = A(I,J)*GG+UU                                    0411

C  T() {}

               A(I,K2QM+J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+   0412
     &         J)*GG                                                    0412

C  T() {}

460            CONTINUE                                                 0413

C  T() {}

450         CONTINUE                                                    0414

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL OUT(A, KPY, NWQ)                                          0415

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL OUT(A(1,K2Q), KZY, NWQ)                                   0416

C  T(KPN) {KPN#init+NWQ==KPN}

         KPN = KPN+NWQ                                                  0417

C  T(KPY) {KPY#init+NWQ==KPY}

         KPY = KPY+NWQ                                                  0418

C  T(KZX) {KZX#init+NWQ==KZX}

         KZX = KZX+NWQ                                                  0419

C  T(KZY) {KZY#init+NWQ==KZY}

         KZY = KZY+NWQ                                                  0420

C  T() {}

440      CONTINUE                                                       0421

C  T(ISIGN) {ISIGN==-1}

C
C [Z(OLD) + (MEAN -U) * (-DZ(OLD)/DX)] + (U,V).GRAD(Z)
C
      ISIGN = -1                                                        0422

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(A, LZY, NW)                                               0423

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXRCS==NXXRCS#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL RCS(A, EX)                                                   0424

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(A, LZY, NW)                                              0425

C  T(KZO) {KZO==LZO}

      KZO = LZO                                                         0426

C  T(KZN) {KZN==LZN}

      KZN = LZN                                                         0427

C  T(KZY) {KZY==LZY}

      KZY = LZY                                                         0428

C  T() {}

      DTFAC = 0.125*DTT/REAL(N1)                                        0429

C  T() {}

      F1 = DTT*FX*0.25                                                  0430

C  T() {}

      F = F1                                                            0431

C  T(I,J,K,K2QJ,KZN,KZO,KZY,NXXOUT,NXXXIN) {2K+NXXOUT#init==NXXOUT+2,
C    3K+NXXXIN#init==NXXXIN+3, KZN+KZY#init==KZN#init+KZY,
C    KZO+KZY#init==KZO#init+KZY, 1<=K, K+KZY#init<=KZY+1}

      DO 470 K = 1, 2                                                   0432

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA, KZO, NWH)                                          0433

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0434

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL OUT(CA(1,K2Q), KZO, NWH)                                  0435

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA(1,K2Q), KZY, NWH)                                   0436

C  T(I,J,K2QJ) {1<=J}

         DO 480 J = 1, N1Q                                              0437

C  T(K2QJ) {J+K2QM==K2QJ}

            K2QJ = J+K2QM                                               0438

C  T() {}

            F = F-F1                                                    0439

C  T(I) {1<=I}

            DO 490 I = 1, N2P                                           0440

C  T() {}

               CA(I,J) = CA(I,J)*CMPLX(1., F*U(I))+DTFAC*CA(I,K2QJ)     0441

C  T() {}

490            CONTINUE                                                 0442

C  T() {}

480         CONTINUE                                                    0443

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL OUT(CA, KZN, NWH)                                         0444

C  T(KZN) {KZN#init+NWH==KZN}

         KZN = KZN+NWH                                                  0445

C  T(KZO) {KZO#init+NWH==KZO}

         KZO = KZO+NWH                                                  0446

C  T(KZY) {KZY#init+NWH==KZY}

         KZY = KZY+NWH                                                  0447

C  T() {}

470      CONTINUE                                                       0448

C  T(I,IEXSHF,IPH,ISIGN,J,K,K2QJ,KPN,KPY,KTN,KTO,KZN,KZX,KZY,LOG,
C    MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,NXLOG2,NXPRNT,NXSCSC,
C    NXXCSR,NXXOUT,NXXRCS,NXXXIN,TEMPHY:NCALL)
C    {NFTVMT+NXXCSR#init+3NXXRCS#init==NFTVMT#init+NXXCSR+3NXXRCS,
C    NUSHUF+NXXCSR#init+2NXXRCS==NUSHUF#init+NXXCSR+2NXXRCS#init,
C    NXACAC+NXXRCS#init==NXACAC#init+NXXRCS,
C    NXLOG2+2NXXRCS#init==NXLOG2#init+2NXXRCS,
C    NXPRNT+NXXCSR#init+2NXXRCS==NXPRNT#init+NXXCSR+2NXXRCS#init,
C    NXSCSC+NXXRCS#init==NXSCSC#init+NXXRCS,
C    NXXCSR+29NXXRCS+NXXXIN#init==NXXCSR#init+29NXXRCS#init+NXXXIN,
C    NXXCSR+2NXXRCS#init+TEMPHY:NCALL#init==NXXCSR#init+2NXXRCS+
C    TEMPHY:NCALL, NXXOUT+17NXXRCS#init==NXXOUT#init+17NXXRCS,
C    NXXCSR#init+2NXXRCS<=NXXCSR+2NXXRCS#init,
C    NXXCSR+3NXXRCS#init<=NXXCSR#init+3NXXRCS, NXXRCS<=NXXRCS#init+1}

      IF (NOTEMP.NE.1) THEN                                             0449

C  T(NPTS) {2N2==NPTS}

C
C FIND DT/DY:
C
         NPTS = 2*N2                                                    0450

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0451

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0452

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0453

C  T(ISIGN) {ISIGN==1}

         ISIGN = 1                                                      0454

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0455

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0456

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LTN, NW)                                           0457

C  T() {}

         F = 0.                                                         0458

C  T(I,J) {1<=I}

         DO 500 I = 1, N2                                               0459

C  T(J) {1<=J}

            DO 510 J = 1, N1H                                           0460

C  T() {}

               CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))      0461

C  T() {}

510            CONTINUE                                                 0462

C  T() {}

            F = F+1.                                                    0463

C  T() {}

500         CONTINUE                                                    0464

C  T(J) {1<=J}

         DO 520 J = 1, N1H                                              0465

C  T() {}

            CA(N2P,J) = 0.                                              0466

C  T() {}

520         CONTINUE                                                    0467

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXSCSC==NXSCSC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL SCSC(CA, EX, WORK)                                        0468

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(CA, LZY, NW)                                          0469

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LTN, NW)                                           0470

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL ACAC(CA, EX, WORK)                                        0471

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(CA, LTN, NW)                                          0472

C  T(NPTS) {N1==NPTS}

         NPTS = N1                                                      0473

C  T(NSKIP) {N2P==NSKIP}

         NSKIP = N2P                                                    0474

C  T(MTRN) {MTRN==N2P}

         MTRN = N2P                                                     0475

C  T(MSKIP) {MSKIP==1}

         MSKIP = 1                                                      0476

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0477

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0478

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    NFTVMT+NXPRNT#init==NFTVMT#init+NXPRNT, NPTS==NPTS#init,
C    NUSHUF+NXPRNT#init==NUSHUF#init+NXPRNT,
C    NXPRNT+NXXCSR#init==NXPRNT#init+NXXCSR,
C    NXPRNT+NXXXIN#init==NXPRNT#init+NXXXIN,
C    NXPRNT+TEMPHY:NCALL#init==NXPRNT#init+TEMPHY:NCALL,
C    NXPRNT#init<=NXPRNT, NXPRNT<=NXPRNT#init+1}

         IF (NSTEPS.EQ.1) THEN                                          0479

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NUSHUF==NUSHUF#init+1, NXPRNT==NXPRNT#init+1,
C    NXXCSR==NXXCSR#init+1, NXXXIN==NXXXIN#init+1,
C    TEMPHY:NCALL==TEMPHY:NCALL#init+1, IEXSHF#init<=IEXSHF,
C    IEXSHF<=IEXSHF#init, 1<=LTN, LTN<=MEMSIZ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, 0)                      0480

         ELSEIF (MOD(NSTEPS, KTP).EQ.1.OR.MOD(NSTEPS, KPP).EQ.1) THEN   0479

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NUSHUF==NUSHUF#init+1, NXPRNT==NXPRNT#init+1,
C    NXXCSR==NXXCSR#init+1, NXXXIN==NXXXIN#init+1,
C    TEMPHY:NCALL==TEMPHY:NCALL#init+1, IEXSHF#init<=IEXSHF,
C    IEXSHF<=IEXSHF#init, 1<=LTN, LTN<=MEMSIZ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, -1)                     0482
         ENDIF

C  T() {}

C
C TEMPERATURE INFLUENCE:
C
         F = -FX                                                        0483

C  T(KZN) {KZN==LZN}

         KZN = LZN                                                      0484

C  T(KZX) {KZX==LZX}

         KZX = LZX                                                      0485

C  T(KTN) {KTN==LTN}

         KTN = LTN                                                      0486

C  T() {}

         DTA = 0.5*ALPHA*DTT                                            0487

C  T(I,J,K,K2QJ,KTN,KZN,KZX,NXXOUT,NXXXIN) {2K+NXXOUT#init==NXXOUT+2,
C    2K+NXXXIN#init==NXXXIN+2, KTN+KZN#init==KTN#init+KZN,
C    KZN+KZX#init==KZN#init+KZX, 1<=K, K+KZN#init<=KZN+1}

         DO 530 K = 1, 2                                                0488

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA, KZN, NWH)                                       0489

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA(1,K2Q), KTN, NWH)                                0490

C  T(I,J,K2QJ) {1<=J}

            DO 540 J = 1, N1Q                                           0491

C  T(K2QJ) {J+K2QM==K2QJ}

               K2QJ = J+K2QM                                            0492

C  T() {}

               F = F+FX                                                 0493

C  T(I) {1<=I}

               DO 550 I = 1, N2P                                        0494

C  T() {}

                  CA(I,K2QJ) = CMPLX(-F*AIMAG(CA(I,K2QJ)), F*REAL(CA(   0495
     &            I,K2QJ)))                                             0495

C  T() {}

                  CA(I,J) = CA(I,J)+DTA*CA(I,K2QJ)                      0496

C  T() {}

550               CONTINUE                                              0497

C  T() {}

540            CONTINUE                                                 0498

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(CA, KZN, NWH)                                      0499

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZX, KZX+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(CA(1,K2Q), KZX, NWH)                               0500

C  T(KZX) {KZX#init+NWH==KZX}

            KZX = KZX+NWH                                               0501

C  T(KTN) {KTN#init+NWH==KTN}

            KTN = KTN+NWH                                               0502

C  T(KZN) {KZN#init+NWH==KZN}

            KZN = KZN+NWH                                               0503

C  T() {}

530         CONTINUE                                                    0504

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZX, LZX+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZX, NW)                                            0505

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL CSR(A, EX)                                                0506

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZX, LZX+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZX, NW)                                           0507

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZY, NW)                                            0508

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL CSR(A, EX)                                                0509

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZY, NW)                                           0510

C  T(KPN) {KPN==LPN}

         KPN = LPN                                                      0511

C  T(KPY) {KPY==LPY}

         KPY = LPY                                                      0512

C  T(KZX) {KZX==LZX}

         KZX = LZX                                                      0513

C  T(KZY) {KZY==LZY}

         KZY = LZY                                                      0514

C  T(I,IPH,J,K,KPN,KPY,KZX,KZY,NXXOUT,NXXXIN)
C    {K+NXXOUT#init==NXXOUT+1, 4K+NXXXIN#init==NXXXIN+4,
C    KPN+KZY#init==KPN#init+KZY, KPY+KZY#init==KPY#init+KZY,
C    KZX+KZY#init==KZX#init+KZY, 1<=K, K+KZY#init<=KZY+1}

C
C IN PHYSICAL SPACE - FIND  (U,V).GRAD(T):
C
         DO 560 K = 1, 4                                                0515

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A, KPY, NWQ)                                        0516

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A(1,K1Q), KPN, NWQ)                                 0517

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A(1,K2Q), KZY, NWQ)                                 0518

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZX, KZX+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A(1,K3Q), KZX, NWQ)                                 0519

C  T(I,IPH,J) {1<=I}

            DO 570 I = 1, N2PD                                          0520

C  T(IPH) {2IPH<=I+1, I<=2IPH}

               IPH = (I+1)/2                                            0521

C  T() {}

               GG = G(IPH)                                              0522

C  T(J) {1<=J}

               DO 580 J = 1, N1E                                        0523

C  T() {}

                  A(I,J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+J)   0524
     &            *GG                                                   0524

C  T() {}

580               CONTINUE                                              0525

C  T() {}

570            CONTINUE                                                 0526

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL OUT(A, KZY, NWQ)                                       0527

C  T(KPN) {KPN#init+NWQ==KPN}

            KPN = KPN+NWQ                                               0528

C  T(KPY) {KPY#init+NWQ==KPY}

            KPY = KPY+NWQ                                               0529

C  T(KZX) {KZX#init+NWQ==KZX}

            KZX = KZX+NWQ                                               0530

C  T(KZY) {KZY#init+NWQ==KZY}

            KZY = KZY+NWQ                                               0531

C  T() {}

560         CONTINUE                                                    0532

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0533

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZY, NW)                                            0534

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXRCS==NXXRCS#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL RCS(A, EX)                                                0535

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZY, NW)                                           0536

C  T(KTN) {KTN==LTN}

         KTN = LTN                                                      0537

C  T(KTO) {KTO==LTO}

         KTO = LTO                                                      0538

C  T(KZY) {KZY==LZY}

         KZY = LZY                                                      0539

C  T(I,J,K,K2QJ,KTN,KTO,KZY,NXXOUT,NXXXIN) {2K+NXXOUT#init==NXXOUT+2,
C    3K+NXXXIN#init==NXXXIN+3, KTN+KZY#init==KTN#init+KZY,
C    KTO+KZY#init==KTO#init+KZY, 1<=K, K+KZY#init<=KZY+1}

         DO 590 K = 1, 2                                                0540

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA, KTO, NWH)                                       0541

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(A(1,K2Q), KTN, NWH)                                 0542

C  T(I,J) {K2Q<=J}

            DO 600 J = K2Q, N1H                                         0543

C  T(I) {1<=I}

               DO 610 I = 1, N2PD                                       0544

C  T() {}

                  A(I,J) = 0.5*A(I,J)                                   0545

C  T() {}

610               CONTINUE                                              0546

C  T() {}

600            CONTINUE                                                 0547

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(A(1,K2Q), KTO, NWH)                                0548

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA(1,K2Q), KZY, NWH)                                0549

C  T(I,J,K2QJ) {1<=J}

            DO 620 J = 1, N1Q                                           0550

C  T(K2QJ) {J+K2QM==K2QJ}

               K2QJ = J+K2QM                                            0551

C  T(I) {1<=I}

               DO 630 I = 1, N2P                                        0552

C  T() {}

                  CA(I,J) = CA(I,J)+DTFAC*CA(I,K2QJ)                    0553

C  T() {}

630               CONTINUE                                              0554

C  T() {}

620            CONTINUE                                                 0555

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(CA, KTN, NWH)                                      0556

C  T(KTN) {KTN#init+NWH==KTN}

            KTN = KTN+NWH                                               0557

C  T(KTO) {KTO#init+NWH==KTO}

            KTO = KTO+NWH                                               0558

C  T(KZY) {KZY#init+NWH==KZY}

            KZY = KZY+NWH                                               0559

C  T() {}

590         CONTINUE                                                    0560
      ENDIF

C  T() {}


      DTF = 0.25*DTT*FX                                                 0561

C  T() {}

      F = -DTF                                                          0562

C  T(KZN) {KZN==LZN}

      KZN = LZN                                                         0563

C  T(KTN) {KTN==LTN}

      KTN = LTN                                                         0564

C  T(I,J,K,K2QJ,KTN,KZN,NXXOUT,NXXXIN) {KTN+KZN#init==KTN#init+KZN,
C    K+KZN#init<=KZN+1, NXXOUT+2<=2K+NXXOUT#init,
C    K+NXXOUT#init<=NXXOUT+1, NXXXIN+2<=2K+NXXXIN#init,
C    K+NXXXIN#init<=NXXXIN+1}

      DO 640 K = 1, 2                                                   0565

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

         IF (NOTEMP.NE.1) CALL IN(CA, KTN, NWH)                         0566

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0568

C  T(I,J,K2QJ) {1<=J}

         DO 650 J = 1, N1Q                                              0569

C  T(K2QJ) {J+K2QM==K2QJ}

            K2QJ = J+K2QM                                               0570

C  T() {}

            F = F+DTF                                                   0571

C  T(I) {}

            IF (NOTEMP.NE.1) THEN                                       0572

C  T(I) {1<=I}

               DO 660 I = 1, N2P                                        0573

C  T() {}

                  WORK(I) = F*U(I)                                      0574

C  T() {}

                  CA(I,J) = CMPLX(1.0, -WORK(I))*CA(I,J)/(1.0+WORK(I)   0575
     &            *WORK(I))                                             0575

C  T() {}

660               CONTINUE                                              0576
            ENDIF

C  T(I) {1<=I}


            DO 670 I = 1, N2P                                           0577

C  T() {}

               WORK(I) = F*U(I)                                         0578

C  T() {}

               CA(I,K2QJ) = CMPLX(1.0, -WORK(I))*CA(I,K2QJ)/(1.0+WORK   0579
     &         (I)*WORK(I))                                             0579

C  T() {}

670            CONTINUE                                                 0580

C  T() {}

650         CONTINUE                                                    0581

C  T(NXXOUT) {NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

         IF (NOTEMP.NE.1) CALL OUT(CA, KTN, NWH)                        0582

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL OUT(CA(1,K2Q), KZN, NWH)                                  0584

C  T(KTN) {KTN#init+NWH==KTN}

         KTN = KTN+NWH                                                  0585

C  T(KZN) {KZN#init+NWH==KZN}

         KZN = KZN+NWH                                                  0586

C  T() {}

640      CONTINUE                                                       0587

C  T(NPTS) {2N2==NPTS}

      NPTS = 2*N2                                                       0588

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0589

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0590

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0591

C  T(ISIGN) {ISIGN==-1}

      ISIGN = -1                                                        0592

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0593

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0594

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(A, LZN, NW)                                               0595

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL ACAC(A, EX, WORK)                                            0596

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(A, LZN, NW)                                              0597

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC,NXXOUT,NXXXIN)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT, NPTS==NPTS#init,
C    NXACAC+NXXOUT#init==NXACAC#init+NXXOUT,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN, NXXOUT#init<=NXXOUT,
C    NXXOUT<=NXXOUT#init+1}

      IF (NOTEMP.NE.1) THEN                                             0598

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LTN, NW)                                            0599

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

         CALL ACAC(A, EX, WORK)                                         0600

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LTN, NW)                                           0601
      ENDIF

C  T(KZN) {KZN==LZN}


      KZN = LZN                                                         0602

C  T(KPN) {KPN==LPN}

      KPN = LPN                                                         0603

C  T() {}

      F2 = 1./(4.*REAL(N2))                                             0604

C  T() {}

      F1 = RNU*DTT                                                      0605

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LEIG, LEIG+NWEIG<=MEMSIZ+1,
C    1<=NWEIG}

C
C FIND PRESSURE NOW OR NEVER (IF REQUIRED...)
C
      CALL IN(EVAL, LEIG, NWEIG)                                        0606

C  T(LVECT) {LVECT==N2M}

      LVECT = N2M                                                       0607

C  T(LSKIP) {LSKIP==2}

      LSKIP = 2                                                         0608

C  T(NVECT) {NVECT==2}

      NVECT = 2                                                         0609

C  T(NVSKIP) {NVSKIP==1}

      NVSKIP = 1                                                        0610

C  T() {}

      FXSQ = FX*FX                                                      0611

C  T(I,J,KPN,KZN,NXXOUT,NXXXIN) {2J+NXXOUT#init==NXXOUT+2,
C    J+NXXXIN#init==NXXXIN+1, KPN+KZN#init==KPN#init+KZN, 1<=J,
C    J+KZN#init<=KZN+1}

C
C UPDATE VORTICITY AND FIND THE NEW STREAMFUNCTION:
C
      DO 680 J = 1, N1H                                                 0612

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

         CALL IN(CWORK, KZN, N2PD)                                      0613

C  T() {}

         F = REAL((J-1)*(J-1))*FXSQ                                     0614

C  T(I) {2<=I}

         DO 690 I = 2, N2                                               0615

C  T() {}

            CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))               0616

C  T() {}

            CWORK2(I) = CWORK(I)/(EVAL(I-1)-F)                          0617

C  T() {}

690         CONTINUE                                                    0618

C  T() {}

         CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                              0619

C  T() {}

         CWORK2(1) = 0.0                                                0620

C  T() {}

         IF (F.NE.0.0) CWORK2(1) = -CWORK(1)/F                          0621

C  T() {}

         CWORK(N2P) = 0.0                                               0623

C  T() {}

         CWORK2(N2P) = 0.0                                              0624

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

         CALL OUT(CWORK, KZN, N2PD)                                     0625

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KPN, KPN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

         CALL OUT(CWORK2, KPN, N2PD)                                    0626

C  T(KPN) {KPN#init+N2PD==KPN}

         KPN = KPN+N2PD                                                 0627

C  T(KZN) {KZN#init+N2PD==KZN}

         KZN = KZN+N2PD                                                 0628

C  T() {}

680      CONTINUE                                                       0629

C  T(NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

C
C DE-ALIASE UPDATED FIELDS IF REQUESTED:
C
      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LZN)                    0630

C  T(NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LPN)                    0632

C  T(I,J,KTN,NXXOUT,NXXXIN) {NXXOUT#init<=NXXOUT,
C    NXXOUT#init+NXXXIN<=NXXOUT+NXXXIN#init+1,
C    NXXOUT+NXXXIN#init<=NXXOUT#init+NXXXIN}

      IF (NOTEMP.NE.1) THEN                                             0634

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

C
C UPDATE TEMPERATURE:
C
         IF (NOALS.EQ.1) CALL IN(EVAL, LEIG, NWEIG)                     0635

C  T(KTN) {KTN==LTN}

         KTN = LTN                                                      0637

C  T() {}

         F1 = RKAPA*DTT                                                 0638

C  T(I,J,KTN,NXXOUT,NXXXIN) {J+NXXOUT#init==NXXOUT+1,
C    J+NXXXIN#init==NXXXIN+1, 1<=J, J+KTN#init<=KTN+1}

         DO 700 J = 1, N1H                                              0639

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL IN(CWORK, KTN, N2PD)                                   0640

C  T() {}

            F = REAL((J-1)*(J-1))*FXSQ                                  0641

C  T(I) {2<=I}

            DO 710 I = 2, N2                                            0642

C  T() {}

               CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))            0643

C  T() {}

710            CONTINUE                                                 0644

C  T() {}

            CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                           0645

C  T() {}

            CWORK(N2P) = 0.0                                            0646

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTN, KTN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL OUT(CWORK, KTN, N2PD)                                  0647

C  T(KTN) {KTN#init+N2PD==KTN}

            KTN = KTN+N2PD                                              0648

C  T() {}

700         CONTINUE                                                    0649

C  T(NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

C
C DE-ALIASE IF REQUESTED:
C
         IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LTN)                 0650
      ENDIF

C  T() {}

C
C AT LAST, THE END OF THE TIME STEP:
C
      DTT = DT+DT                                                       0652

C  T() {}

      T = T+DT                                                          0653

C  T(NSTEPS) {NSTEPS==NSTEPS#init+1}

      NSTEPS = NSTEPS+1                                                 0654

C  T() {}

      IF (NUMBER.GE.NSTEPS) GOTO 150                                    0655
C#
c      END IF
C

C  T() {}

      WRITE (6, 9010) TXXXIN, TXXOUT, TXXRCS, TXXCSR, TXSCSC, TXACAC    0657
     &, TFTVMT, TXSHUF, TUSHUF, TXPRNT, TXLOG2                          0657

C  T() {}

      WRITE (6, 9020) EXXRCS, EXXCSR, EXSCSC, EXACAC, EFTVMT            0658

C  T() {}

      WRITE (6, 9030) NXXXIN, NXXOUT, NXXRCS, NXXCSR, NXSCSC, NXACAC    0659
     &, NFTVMT, NXSHUF, NUSHUF, NXPRNT, NXLOG2                          0659

C  T(NUM1) {NUM1==NUM1#init+1}

C
      CALL BUG('AFTER  ALL')                                            0660

C  T() {}

C
      CALL CPUTIM(CPU2)                                                 0661

C  T() {}

      CALL ELAPSE(TCLCK2)                                               0662

C  T() {}

C
      TWALL = MOD(TCLCK2-TCLCK1+1000000.0, 1000000.0)                   0663

C  T() {}

      WRITE (6, 9040) TWALL                                             0664

C  T() {}

      WRITE (1, *)                                                      0665

C  T() {}

      WRITE (1, *) 'ELAPSED CPU TIME IN SECONDS: ', CPU2-CPU1           0666

C  T() {}

C MFLOPS RATE = MFLOP 1 CPU CRAY X-MP/CPU TIME
      WRITE (1, *) 'MFLOPS RATE: ', 1657.863/(CPU2-CPU1)                0667

C  T() {}

      WRITE (1, *) 'ELAPSED WALLCLOCK TIME IN SECONDS: ', TWALL         0668

C  T() {}

      WRITE (1, 9050)                                                   0669

C  T(I) {}

      WRITE (1, 9080) (CDAT(I), I = 1, 15)                              0670

C  T(VALID) {VALID==1}

      VALID = 1                                                         0671

C  T(I,VALID) {1<=I}

      DO 720 I = 1, 15                                                  0672

C  T(VALID) {}

         IF (I.EQ.3.OR.I.EQ.13) THEN                                    0673

C  T(VALID) {}

            IF (ABS(CDAT(I)).GT.ABS(VDAT(I))) VALID = 0                 0674

         ELSEIF (ABS(VDAT(I)-CDAT(I)).GT.ABS(.01*VDAT(I))) THEN         0673

C  T(VALID) {VALID==0}

            VALID = 0                                                   0677
         ENDIF

C  T() {}


720      CONTINUE                                                       0678

C  T() {}

C
      IF (VALID.EQ.1) THEN                                              0679

C  T() {}

         WRITE (1, 9060)                                                0680

      ELSE

C  T() {}

         WRITE (1, 9070)                                                0681
      ENDIF

C  T() {}


c      STOP

9000  FORMAT(1X,'OUTPUT FOR PERFECT CLUB BENCHMARK: OCEAN INSTRUMENTED V
     &ERSION',/,1X,'$Revision: 1.A.1 $ $Author: psharma $',/)           0682

C  T() {}

C
9010  FORMAT(/,2X,'SUBROUTINE    IN, EX-TIME FOR FIRST CALL =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   OUT, EX-TIME FOR FIRST CALL =',1P,E1
     &3.6,/,2X,'SUBROUTINE   RCS, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2
     &X,'SUBROUTINE   CSR, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBR
     &OUTINE  SCSC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE 
     & ACAC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE FTRVMT 
     &EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE  SHUF, EX-TIME
     & FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE UNSHUF EX-TIME FOR FI
     &RST CALL =',1P,E13.6,/,2X,'SUBROUTINE RPRINT EX-TIME FOR FIRST CAL
     &L =',1P,E13.6,/,2X,'SUBROUTINE XLOG2, EX-TIME FOR FIRST CALL =',1P
     &,E13.6)                                                           0683

C  T() {}

9020  FORMAT(/,2X,'SUBROUTINE   RCS, EX-TIME LAST TIMESTEP  =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   CSR, EX-TIME LAST TIMESTEP  =',1P,E1
     &3.6,/,2X,'SUBROUTINE  SCSC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2
     &X,'SUBROUTINE  ACAC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2X,'SUBR
     &OUTINE FTRVMT EX-TIME LAST TIMESTEP  =',1P,E13.6)                 0684

C  T() {}

9030  FORMAT(/,2X,'SUBROUTINE    IN, CUMULATIVE CALLS TO    =',I12,/,2X,
     &'SUBROUTINE   OUT, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE 
     &  RCS, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE   CSR, CUMUL
     &ATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE  SCSC, CUMULATIVE CALLS 
     &TO    =',I12,/,2X,'SUBROUTINE  ACAC, CUMULATIVE CALLS TO    =',I12
     &,/,2X,'SUBROUTINE FTRVMT CUMULATIVE CALLS TO    =',I12,/,2X,'SUBRO
     &UTINE  SHUF, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE UNSHUF
     & CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE RPRINT CUMULATIVE 
     &CALLS TO    =',I12,/,2X,'SUBROUTINE XLOG2, CUMULATIVE CALLS TO    
     &=',I12)                                                           0685

C  T() {}

9040  FORMAT(/,2X,'MEASURE OF WALL-CLOCK TIME (ENVIRONMENT SENSITIVE)',/
     &,2X,'FOR EXECUTION ONLY =',1P,E13.6,1X,'SECONDS')                 0686

C  T() {}

C
9050  FORMAT(/,1X,'VALIDATION PARAMETERS:',/)                           0687

C  T() {}

9060  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE:   VALID')                0688

C  T() {}

9070  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE: INVALID')                0689

C  T() {}

9080  FORMAT(5E15.5)                                                    0690

      END

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C***********************************************************************
C
      SUBROUTINE OUT(ARRAY,LOC,NW)
      COMMON /MEMORY/MEMSIZ,RM(165117)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION ARRAY(1)
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0001

C  T(I,LOCM,NXXOUT) {LOC==LOCM+1, NXXOUT==NXXOUT#init+1, 1<=I,
C    NW+1<=I, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C
      IF (LOC.LT.1.OR.LOC+NW-1.GT.MEMSIZ.OR.NW.LT.1) THEN               0003

C  T() {}

C
         WRITE (6, 9000) LOC, NW, MEMSIZ                                0004

C  T() {0==-1}

         STOP                                                           0005

      ELSE

C  T(LOCM) {LOC==LOCM+1}

         LOCM = LOC-1                                                   0006

C  T(I) {1<=I}

         DO 10 I = 1, NW                                                0007

C  T() {}

            RM(LOCM+I) = ARRAY(I)                                       0008

C  T() {}

10          CONTINUE                                                    0009

C  T() {}

C
         IF (LFIRST) THEN                                               0010

C  T() {}

            LFIRST = .FALSE.                                            0011

C  T() {}

            CALL CPUTIM(T2)                                             0012

C  T() {}

            TXXOUT = T2-T1                                              0013
         ENDIF

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1}

C
         NXXOUT = NXXOUT+1                                              0014
C
      ENDIF

C  T() {}


9000  FORMAT(/,/,/,' OUT: ILLEGAL REQUEST. LOCATION:',I22,' ;   NUMBER O
     &F WORDS:',I22,' ;  MEMSIZ:',I7)                                   0015

      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE PSIFOU(CA,N2P,N1H,CWORK)
      COMMON /LADDR/LDUMMY(2),LPN,LDUMY1(9)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0001

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LPN, NW)                                              0002

C  T() {}

      CALL CPRINT(CA, 'PSI FOU', N1H, N2P, -1)                          0003
      END

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR) {ISIGN==1, MSKIP==1, MTRN==N2P, 2N1H==NPTS,
C    N2P==NSKIP, NFTVMT==NFTVMT#init+2, NUSHUF==NUSHUF#init+1,
C    NXACAC==NXACAC#init+1, NXLOG2==NXLOG2#init+2,
C    NXXCSR==NXXCSR#init+1}

C***********************************************************************
C
C     FGPS  2-APR-88 REWROTE SUBROUTINE SO AS TO RECEIVE THE COMPLEX ARR
C                    CA IN FOURIER SPACE, TRANSFORM THIS ONTO PHYSICAL S
C                    AND CALL CPRINT TO PRINT OUT THE RESULT
C
      SUBROUTINE PSIPHY(CA,N2P,N1H,EX,G,U,WORK,CWORK3,IMODE)
      COMMON /EXSIZE/NMAX2
      COMMON /DATA/ALPHA,BETA,FX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK3(1),EX(1)
      REAL U(1),G(1),WORK(1)

C  T(N2PD) {2N2P==N2PD}

C
      N2PD = N2P+N2P                                                    0001

C  T(NPTS) {N2PD==NPTS+2}

      NPTS = N2PD-2                                                     0002

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0003

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0004

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0005

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0006

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0007

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0008

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXACAC==NXACAC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL ACAC(CA, EX, WORK)                                           0009

C  T(N1) {N1==2N1H}

C
      N1 = N1H+N1H                                                      0010

C  T(NPTS) {N1==NPTS}

      NPTS = N1                                                         0011

C  T(NSKIP) {N2P==NSKIP}

      NSKIP = N2P                                                       0012

C  T(MTRN) {MTRN==N2P}

      MTRN = N2P                                                        0013

C  T(MSKIP) {MSKIP==1}

      MSKIP = 1                                                         0014

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0015

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0016

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0017

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL CSR(CA, EX)                                                  0018

C  T() {}

C
      CALL TELTIM                                                       0019

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(CA, N2P, N1, WORK)                                    0020

C  T() {}

      CALL CPRINT(CA, 'PSI PHYS', N1H, N2P, IMODE)                      0021
C      CALL PLOTME (CA,WORK,NCALL)
C
      END

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXRCS==NXXRCS#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

C
      SUBROUTINE RCS(A,EX)
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMPLEX A(1),EX(1),BJ,BJSTAR
C
C   PERFORM A REAL TO CONJUGATE SYMMETRIC TRANFORM, SAVING ONLY HALF OF
C   THE RESULTING CONJUGATE SYMMETRIC ARRAY, AND PACKING A(0) AND A(N/2)
C   INTO A(0) SINCE THEY ARE BOTH REAL
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0001

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0003

C  T() {}

      IF (LXSTEP) THEN                                                  0005

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0006
      ENDIF

C  T(N) {N==NPTS}

C
      N = NPTS                                                          0008

C  T(NPTS) {NPTS#init<=2NPTS+1, 2NPTS<=NPTS#init}

      NPTS = NPTS/2                                                     0009

C  T(M) {M==NPTS}

      M = NPTS                                                          0010

C  T(ISHIFT) {ISHIFT==0}

      ISHIFT = 0                                                        0011

C  T(ISHIFT) {}

      IF (ISIGN.LT.0) ISHIFT = M*IEXSHF                                 0012

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0014

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0015

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0016

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = 2*IEXSHF                                                 0017

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(A(1), EX(1))                                          0018

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0019

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0020

C  T(NPTS) {N==NPTS}

      NPTS = N                                                          0021

C  T(I,IEXH,IEXL,IST,ISTP,J,JSTAR,LOOP) {1<=LOOP}

      DO 10 LOOP = 1, MTRN                                              0022

C  T(IST) {}

         IST = (LOOP-1)*MSKIP                                           0023

C  T(ISTP) {IST==ISTP-1}

         ISTP = IST+1                                                   0024

C  T() {}

         A(ISTP) = CMPLX(2.*(REAL(A(ISTP))+AIMAG(A(ISTP))), 2.*(REAL(   0025
     &   A(ISTP))-AIMAG(A(ISTP))))                                      0025

C  T(I,IEXH,IEXL,J,JSTAR) {2<=I}

         DO 20 I = 2, MH                                                0026

C  T(J) {}

            J = (I-1)*NSKIP+ISTP                                        0027

C  T(JSTAR) {}

            JSTAR = (M-I+1)*NSKIP+ISTP                                  0028

C  T() {}

            BJ = A(J)                                                   0029

C  T() {}

            BJSTAR = A(JSTAR)                                           0030

C  T(IEXL) {}

            IEXL = IEXSHF*(I-1)+1+ISHIFT                                0031

C  T(IEXH) {}

            IEXH = IEXSHF*(M-I+1)+1+ISHIFT                              0032

C  T() {}

            A(J) = BJ+CONJG(BJSTAR)+CMPLX(0., -1.)*EX(IEXL)*(BJ-CONJG   0033
     &      (BJSTAR))                                                   0033

C  T() {}

            A(JSTAR) = BJSTAR+CONJG(BJ)+CMPLX(0., -1.)*EX(IEXH)*(       0034
     &      BJSTAR-CONJG(BJ))                                           0034

C  T() {}

20          CONTINUE                                                    0035

C  T(J) {}

         J = MH*NSKIP+ISTP                                              0036

C  T() {}

         A(J) = 2.*A(J)                                                 0037

C  T() {}

         IF (ISIGN.LT.0) A(J) = CONJG(A(J))                             0038

C  T() {}

10       CONTINUE                                                       0040

C  T() {}

C
      IF (LFIRST) THEN                                                  0041

C  T() {}

         LFIRST = .FALSE.                                               0042

C  T() {}

         CALL CPUTIM(T2)                                                0043

C  T() {}

         TXXRCS = T2-T1                                                 0044
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0045

C  T() {}

         IF (LXTIME) THEN                                               0046

C  T() {}

            LXTIME = .FALSE.                                            0047

C  T() {}

            CALL CPUTIM(T2)                                             0048

C  T() {}

            EXXRCS = T2-T1                                              0049
         ENDIF

      ENDIF

C  T(NXXRCS) {NXXRCS==NXXRCS#init+1}

C
      NXXRCS = NXXRCS+1                                                 0050
C
      END

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
C***********************************************************************
C
C     FGPS 25-MAR-88 CHANGED THE DIMENSIONING OF R(1,1) TO R(N2PD,1)
C     FGPS 7-MAR-88 SUBROUTINE RPRINT REPROGRAMMED
C
C     N O T E :  THE INDEXING OF ARRAYS HANDLING VARIABLES REPRESENTED I
C     PHYSICAL SPACE IS USUALLY OF THE FORM
C
C                        A (1<=JY<=N2PD,1<=IX<=N1H)
C
C     WHERE "JY" IS THE COUNT ALONG THE Y-AXIS AND "IX" RUNS ALONG THE X
C     AXIS, AND WHERE
C
C                        N2PD = 2 * (N2+1)                 FOR THE Y-AXI
C     AND
C                         N1H = N1/2                       FOR THE X-AXI
C
C     AND WHERE THE BASIC GRID IS DIMENSIONED 2*(N2+1) BY N1.
C
C
      SUBROUTINE RPRINT(R,NAME,N1H,N2PD,IMODE)
C
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      REAL R(N2PD,1)
      CHARACTER*8 NAME

C  T() {}

C
C
      WRITE (6, 9000) NSTEPS                                            0001

C  T() {}

C
C     SELECT THE PRINT-OUT MODE
C
      IF (IMODE.LT.0) GOTO 10                                           0002

C  T() {}

      IF (IMODE.EQ.0) GOTO 20                                           0002

C  T() {}

C
30    CONTINUE                                                          0032

C  T(JY1) {3N2PD<=4JY1+3, 4JY1<=3N2PD}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF X (I.E., 1<=IX<=N1H WITH STRIDE = 2) AT CONS
C     Y (I.E., JY = N2PD/4)
C
      JY1 = 3*N2PD/4                                                    0033

C  T(IX) {}

      WRITE (6, 9050) (IX,NAME,JY1,R(JY1,IX), IX = 1, N1H, 2)           0034

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
      NXPRNT = NXPRNT+1                                                 0035

C  T() {}

C
C
C
9000  FORMAT(/,2X,'NSTEPS =',I7)                                        0036

C  T() {}

9010  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6)                  0037

C  T() {}

9020  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6,/)                0038

C  T() {}

C
9030  FORMAT(34(2X,'JY =',I5,2X,A8,'(JY,IX=',I3,') =',1P,E13.6,/))      0039

C  T() {}

9040  FORMAT(/,/,/)                                                     0040

C  T() {}

C
9050  FORMAT(/,32(2X,'IX =',I5,2X,A8,'(JY=',I3,',IX) =',1P,E13.6,6X,'IX 
     &=',I5,2X,A8,'(JY=',I3,',IX) =',1P,E13.6,/))                       0041
      RETURN

C  T() {}

C
20    CONTINUE                                                          0024

C  T(IX1) {N1H+1<=2IX1, 2IX1<=N1H+2}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF Y (I.E., 1<=JY<=N2P WITH STRIDE = 4) AT CONS
C     X (I.E., IX = 1+N1H/2)
C
      IX1 = 1+N1H/2                                                     0025

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0026

C  T(JY) {}

      WRITE (6, 9030) (JY,NAME,IX1,R(JY,IX1), JY = 1, N2P, 4)           0027

C  T() {}

      WRITE (6, 9040)                                                   0028

C  T() {}

      IF (NSTEPS.EQ.1.AND.NAME.EQ.'TEMP PHY') CDAT(5) = R(65,IX1)       0029

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
      NXPRNT = NXPRNT+1                                                 0031
C
      RETURN

C  T() {}

C
10    CONTINUE                                                          0003

C  T(IX1) {N1H+1<=4IX1, 4IX1<=N1H+4}

C
      IX1 = 1+N1H/4                                                     0004

C  T(IX2) {N1H+1<=2IX2, 2IX2<=N1H+2}

      IX2 = 1+N1H/2                                                     0005

C  T(JY1) {N2PD+1<=4JY1, 4JY1<=N2PD+4}

      JY1 = 1+N2PD/4                                                    0006

C  T() {}

      WRITE (6, 9010) NAME, JY1, IX1, R(JY1,IX1)                        0007

C  T() {}

C
      WRITE (6, 9020) NAME, JY1, IX2, R(JY1,IX2)                        0008

C  T() {}

      IF (NSTEPS.EQ.1) THEN                                             0009

C  T() {}

         IF (NAME.EQ.'ZETA PHY') THEN                                   0010

C  T() {}

            CDAT(2) = R(JY1,IX1)                                        0011

         ELSEIF (NAME.EQ.'UVEL PHY') THEN                               0010

C  T() {}

            CDAT(3) = R(JY1,IX2)                                        0013

         ELSEIF (NAME.EQ.'VVEL PHY') THEN                               0010

C  T() {}

            CDAT(4) = R(JY1,IX2)                                        0015
         ENDIF

      ELSEIF (NSTEPS.EQ.NUMBER) THEN                                    0009

C  T() {}

         IF (NAME.EQ.'ZETA PHY') THEN                                   0017

C  T() {}

            CDAT(12) = R(JY1,IX1)                                       0018

         ELSEIF (NAME.EQ.'UVEL PHY') THEN                               0017

C  T() {}

            CDAT(13) = R(JY1,IX2)                                       0020

         ELSEIF (NAME.EQ.'VVEL PHY') THEN                               0017

C  T() {}

            CDAT(14) = R(JY1,IX2)                                       0022
         ENDIF

      ENDIF

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
C
      NXPRNT = NXPRNT+1                                                 0023
C

      END

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C***********************************************************************
C
C     FGPS  8-APR-88 SET UP RPRNT2 AS A MODIFICATION OF RPRINT.  THE IN
C                    TENT IS TO PRINT THE VALUE OF A QUANTITY AT THE CEN
C                    OF THE FIRST VORTEX CELL IN ORDER TO MONITOR EXECUT
C
      SUBROUTINE RPRNT2(R,NAME,N1H,N2PD,IMODE)
C
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      REAL R(N2PD,1)
      CHARACTER*8 NAME
C
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0001

C  T() {}

C
      WRITE (6, 9000) NSTEPS                                            0003

C  T(IX1) {N1H+1<=4IX1, 4IX1<=N1H+4}

C
C
      IX1 = 1+N1H/4                                                     0004

C  T(IX2) {N1H+1<=2IX2, 2IX2<=N1H+2}

      IX2 = 1+N1H/2                                                     0005

C  T(JY1) {N2PD+1<=4JY1, 4JY1<=N2PD+4}

      JY1 = 1+N2PD/4                                                    0006

C  T() {}

      WRITE (6, 9010) NAME, JY1, IX1, R(JY1,IX1)                        0007

C  T() {}

      WRITE (6, 9020) NAME, JY1, IX2, R(JY1,IX2)                        0008

C  T() {}

      IF (NSTEPS.EQ.51) THEN                                            0009

C  T() {}

         CDAT(7) = R(JY1,IX2)                                           0010

      ELSEIF (NSTEPS.EQ.101) THEN                                       0009

C  T() {}

         CDAT(8) = R(JY1,IX2)                                           0012

      ELSEIF (NSTEPS.EQ.151) THEN                                       0009

C  T() {}

         CDAT(9) = R(JY1,IX2)                                           0014

      ELSEIF (NSTEPS.EQ.201) THEN                                       0009

C  T() {}

         CDAT(10) = R(JY1,IX2)                                          0016

      ELSEIF (NSTEPS.EQ.NUMBER) THEN                                    0009

C  T() {}

         CDAT(15) = R(JY1,IX2)                                          0018
      ENDIF

C  T() {}

C
      IF (LFIRST) THEN                                                  0019

C  T() {}

         LFIRST = .FALSE.                                               0020

C  T() {}

         CALL CPUTIM(T2)                                                0021

C  T() {}

         TXPRNT = T2-T1                                                 0022
      ENDIF

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
      NXPRNT = NXPRNT+1                                                 0023

C  T() {}

C
C
9000  FORMAT(/,2X,'NSTEPS =',I7)                                        0024

C  T() {}


9010  FORMAT(2X,'TEMPERATURE DROP:',/,2X,'AT THE CENTER OF FIRST CONVECT
     &ION CELL = ',A8,'(JY=',I3,',IX=',I2,') =',1P,E13.6)               0025

C  T() {}

9020  FORMAT(2X,'AT CENTER OF CONVECTION-CELL BOUNDARY  = ',A8,'(JY=',I3
     &,',IX=',I2,') =',1P,E13.6,/)                                      0026

      END

C  T() {}

C***********************************************************************
      SUBROUTINE RUNINF
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS

C  T() {}

C
C THIS SUBROUTINE TELLS US WHAT  OCEAN  WILL BE DOING:
C
C*****MACHINE-DEPENDENT CONSTANT (REPLACE FOR YOUR MACHINE)
C
C*********************
      ZERO = 1.0E-200                                                   0001

C  T() {}

C*********************
C
      WRITE (6, 9000)                                                   0002

C  T() {}

C
      CALL CPUTIM(CPUTM)                                                0003

C  T() {}

C      CALL DATE   (TODAY)
C      CALL TIME   (NOW)
      WRITE (6, 9010) CPUTM                                             0004

C  T(MOREST) {MOREST+NSTEPS==NUMBER+1}

C
      MOREST = NUMBER-NSTEPS+1                                          0005

C  T() {}

      WRITE (6, 9020) N1, N2, MOREST, KTA                               0006

C  T() {}

      IF (KSM.EQ.1) WRITE (6, 9030)                                     0007

C  T() {}

      IF (KSM.EQ.2) WRITE (6, 9040)                                     0009

C  T() {}

C
C#      GO TO (1,2,3), KDATA
C#      WRITE(6,400)
C#      GO TO 10
C#1     WRITE(6,401)
C#      GO TO 10
C#2     WRITE(6,402)
C#      GO TO 10
C#3     WRITE(6,403)
C
      IF (KDATA.EQ.1) THEN                                              0011

C  T() {}

         WRITE (6, 9060)                                                0012

      ELSEIF (KDATA.EQ.2) THEN                                          0011

C  T() {}

         WRITE (6, 9070)                                                0014

      ELSEIF (KDATA.EQ.3) THEN                                          0011

C  T() {}

         WRITE (6, 9080)                                                0016

      ELSE

C  T() {}

         WRITE (6, 9050)                                                0017
      ENDIF

C  T() {}

C
C#10    GO TO (11,123,123), LMAPP
C#      WRITE(6,500)
C#      GO TO 20
C#11    WRITE(6,501)
C#      GO TO 20
C#123   WRITE(6,523)
C
      IF (LMAPP.EQ.1) THEN                                              0018

C  T() {}

         WRITE (6, 9100)                                                0019

      ELSEIF (LMAPP.EQ.2) THEN                                          0018

C  T() {}

         WRITE (6, 9110)                                                0021

      ELSEIF (LMAPP.EQ.3) THEN                                          0018

C  T() {}

         WRITE (6, 9110)                                                0023

      ELSE

C  T() {}

         WRITE (6, 9090)                                                0024
      ENDIF

C  T() {}

C
C#20    GO TO (21), NOTEMP
C#      WRITE(6,600)
C#      GO TO 30
C#21    WRITE(6,601)
C
      IF (NOTEMP.EQ.1) THEN                                             0025

C  T() {}

         WRITE (6, 9130)                                                0026

      ELSE

C  T() {}

         WRITE (6, 9120)                                                0027
      ENDIF

C  T() {}

C
C#30    GO TO (31,32,33), KTAPE
C#      WRITE(6,700)
C#      GO TO 40
C#31    WRITE(6,701)
C#      GO TO 40
C#32    WRITE(6,702)
C#      GO TO 40
C#33    WRITE(6,703)
C
      IF (KTAPE.EQ.1) THEN                                              0028

C  T() {}

         WRITE (6, 9150)                                                0029

      ELSEIF (KTAPE.EQ.2) THEN                                          0028

C  T() {}

         WRITE (6, 9160)                                                0031

      ELSEIF (KTAPE.EQ.3) THEN                                          0028

C  T() {}

         WRITE (6, 9170)                                                0033

      ELSE

C  T() {}

         WRITE (6, 9140)                                                0034
      ENDIF

C  T() {}

C
      IF (KPP.NE.1) WRITE (6, 9180) KPP                                 0035

C  T() {}

      IF (KZP.NE.1) WRITE (6, 9190) KZP                                 0037

C  T() {}

      IF (KTP.NE.1) WRITE (6, 9200) KTP                                 0039

C  T() {}

      IF (KUP.NE.1) WRITE (6, 9210) KUP                                 0041

C  T() {}

      IF (KVP.NE.1) WRITE (6, 9220) KVP                                 0043

C  T() {}

      IF (KPF.NE.1) WRITE (6, 9230) KPF                                 0045

C  T() {}

      IF (KZF.NE.1) WRITE (6, 9240) KZF                                 0047

C  T() {}

      IF (KTF.NE.1) WRITE (6, 9250) KTF                                 0049

C  T() {}

      IF (KUF.NE.1) WRITE (6, 9260) KUF                                 0051

C  T() {}

      IF (KVF.NE.1) WRITE (6, 9270) KVF                                 0053

C  T() {}

      IF (KPRESS.NE.1) WRITE (6, 9280) KPRESS                           0055

C  T() {}

C
      IF (NOALS.EQ.1) WRITE (6, 9290)                                   0057

C  T() {}

C
      REY = 1.0/(RNU+ZERO)                                              0059

C  T() {}

      RH = H*H*H*H*ABS(ALPHA*BETA)/(RNU*RKAPA+ZERO)                     0060

C  T() {}

C
C CRITICAL RAYLEIGH NUMBER IS   (PI**4) * 27/4:
C
      RHCRIT = 657.5113648                                              0061

C  T() {}

      RRATIO = RH/RHCRIT                                                0062

C  T() {}

      PR = RNU/(RKAPA+ZERO)                                             0063

C  T() {}

      WRITE (6, 9300) BOXX, H, RNU, RKAPA, ALPHA, BETA, REY, RH,        0064
     &RRATIO, PR, DT, T                                                 0064

C  T() {}

C
C
C FORMAT STATEMENTS:
C
9000  FORMAT(/,12X,' OOOOOO     CCCCCC    EEEEEEE    AAAAAA    N     N',
     &/,12X,'O      O   C      C   E         A      A   NN    N',/,12X,'
     &O      O   C          E         A      A   N N   N',/,12X,'O      
     &O   C          EEEE      AAAAAAAA   N  N  N',/,12X,'O      O   C  
     &        E         A      A   N   N N',/,12X,'O      O   C      C  
     & E         A      A   N    NN',/,12X,' OOOOOO     CCCCCC    EEEEEE
     &E   A      A   N     N')                                          0065

C  T() {}

C
C200   FORMAT (////' THIS RUN BEGINS ON DATE ',A8,' AT TIME ',A8,/,
C     1            ' CPU TIME USED SO FAR IS',F9.6,' SECONDS.')
9010  FORMAT(/,/,/,/,' CPU TIME USED SO FAR IS',F9.6,' SECONDS.',/,/,'W 
     &A R N I N G ******** POSSIBLE UNDERFLOW ********',/,'THE STATEMENT
     & "ZERO = 1.0E-200" APPEARS IN RUNINF.')                           0066

C  T() {}

C
9020  FORMAT(/,/,' THIS RUN USES ',I3,' BY ',I3,' GRID, AND DOES',I5,' T
     &IME STEPS',/,' TIME AVERAGING IS DONE EVERY',I3,' STEPS')         0067

C  T() {}

9030  FORMAT(' MEAN FLOW IS INCLUDED IN CALCULATIONS')                  0068

C  T() {}

9040  FORMAT(' MEAN FLOW IS SPECIFIED BY USER')                         0069

C  T() {}

C
9050  FORMAT(' KDATA HAS ILLEGAL VALUE')                                0070

C  T() {}

9060  FORMAT(' INITIAL DATA IN PHYSICAL SPACE')                         0071

C  T() {}

9070  FORMAT(' INITIAL DATA IN FOURIER SPACE')                          0072

C  T() {}

9080  FORMAT(/,' THIS IS A RESTART RUN',/)                              0073

C  T() {}

C
9090  FORMAT(' LMAPP HAS AN ILLEGAL VALUE')                             0074

C  T() {}

9100  FORMAT(' LINEAR MAPPING IN BOTH DIRECTIONS')                      0075

C  T() {}

9110  FORMAT(' NON-LINEAR MAPPING IN Y DIRECTION')                      0076

C  T() {}

C
9120  FORMAT(' TEMPERATURE FIELD INCLUDED IN CALCULATIONS')             0077

C  T() {}

9130  FORMAT(' CALCULATIONS DONE WITHOUT TEMPERATURE FIELD')            0078

C  T() {}

C
9140  FORMAT(/,' NO HISTORY TAPE WILL BE WRITTEN',/)                    0079

C  T() {}

9150  FORMAT(/,' HISTORY TAPE WILL INCLUDE OPERATOR MATRICES ONLY',/)   0080

C  T() {}

9160  FORMAT(/,' HISTORY TAPE WILL NOT INCLUDE OPERATOR MATRICES',/)    0081

C  T() {}

9170  FORMAT(/,' HISTORY TAPE WILL INCLUDE ALL IMPORTANT ARRAYS',/)     0082

C  T() {}

C
9180  FORMAT                                                            0083
     &(' OUTPUT PHYSICAL STREAMFUNCTION EVERY',I4,' TIME STEPS')        0083

C  T() {}

9190  FORMAT                                                            0084
     &(' OUTPUT PHYSICAL VORTICITY      EVERY',I4,' TIME STEPS')        0084

C  T() {}

9200  FORMAT                                                            0085
     &(' OUTPUT PHYSICAL TEMPERATURE    EVERY',I4,' TIME STEPS')        0085

C  T() {}

9210  FORMAT                                                            0086
     &(' OUTPUT PHYSICAL X VELOCITY     EVERY',I4,' TIME STEPS')        0086

C  T() {}

9220  FORMAT                                                            0087
     &(' OUTPUT PHYSICAL Y VELOCITY     EVERY',I4,' TIME STEPS')        0087

C  T() {}

9230  FORMAT                                                            0088
     &(' OUTPUT FOURIER  STREAMFUNCTION EVERY',I4,' TIME STEPS')        0088

C  T() {}

9240  FORMAT                                                            0089
     &(' OUTPUT FOURIER  VORTICITY      EVERY',I4,' TIME STEPS')        0089

C  T() {}

9250  FORMAT                                                            0090
     &(' OUTPUT FOURIER  TEMPERATURE    EVERY',I4,' TIME STEPS')        0090

C  T() {}

9260  FORMAT                                                            0091
     &(' OUTPUT FOURIER  X VELOCITY     EVERY',I4,' TIME STEPS')        0091

C  T() {}

9270  FORMAT                                                            0092
     &(' OUTPUT FOURIER  V VELOCITY     EVERY',I4,' TIME STEPS')        0092

C  T() {}

9280  FORMAT                                                            0093
     &(' OUTPUT PHYSICAL PRESSURE       EVERY',I4,' TIME STEPS')        0093

C  T() {}

C
9290  FORMAT(' DE-ALIASING TURNED ON.')                                 0094

C  T() {}

C
9300  FORMAT(/,/,/,/,' PHYSICAL PARAMETERS FOR THIS RUN ARE:',/,' BOX DI
     &MENSIONS          : ',F10.6,' BY ',F10.6,/,' VISCOSITY (NU)       
     &   : ',E24.14,/,' HEAT CONDUCTIVITY (KAPA): ',E24.14,/,' ALPHA AND
     & BETA          : ',F10.6,' AND',F10.6,/,' REYNOLDS NUMBER         
     &: ',E24.14,/,' RAYLEIGH NUMBER         : ',E24.14,/,' RATIO RAY/RA
     &Y(CRITICAL) : ',E24.14,/,' PRANDTL  NUMBER         : ',E24.14,/,/,
     &' THE TIME STEP IS',F10.6,/,' WE BEGIN AT  T =',F10.6,/,/,/,' ',60
     &('+-'),/,/)                                                       0095

      END

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXSCSC==NXSCSC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

C
      SUBROUTINE SCSC(AC,EX,WORK)
C
C COMPLEX SYMMETRIC TO COMPLEX SYMMETRIC
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX AC(1),WORK(1),TEMP1,TEMP2,X,Y,BJ,BJSYM
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      DIMENSION EX(1)
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0001

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0003

C  T() {}

      IF (LXSTEP) THEN                                                  0005

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0006
      ENDIF

C  T(NPTSINIT) {NPTS==NPTSINIT}

C
      NPTSINIT = NPTS                                                   0008

C  T(M) {NPTS<=2M+1, 2M<=NPTS}

      M = NPTS/2                                                        0009

C  T(NPTS) {M==NPTS}

      NPTS = M                                                          0010

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0011

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0012

C  T(ISTOP) {}

      ISTOP = 1+(MTRN-1)*MSKIP                                          0013

C  T(MNSKIP) {}

      MNSKIP = M*NSKIP                                                  0014

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0015

C  T(NSKIP2) {2NSKIP==NSKIP2}

      NSKIP2 = NSKIP*2                                                  0016

C  T(MP2) {M==MP2-2}

      MP2 = M+2                                                         0017

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = IEXSHF*2                                                 0018

C  T() {}

      FACT = REAL(ISIGN)/2.                                             0019

C  T(MNSH) {MNSKIP<=2MNSH+1, 2MNSH<=MNSKIP}

      MNSH = MNSKIP/2                                                   0020

C  T(IPROD) {IPROD+NSKIP==MNSH}

      IPROD = MNSH-NSKIP                                                0021

C  T(IEXSYM) {}

      IEXSYM = 4+M*IEXSHF                                               0022

C  T(I,IAC,ISUM,LOOP) {}

      DO 10 LOOP = 1, ISTOP, MSKIP                                      0023

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0024

C  T() {}

         WORK(1) = AC(LOOP)                                             0025

C  T() {}

         WORK(MHP) = AC(ISUM)                                           0026

C  T(IAC) {LOOP+NSKIP==IAC}

         IAC = LOOP+NSKIP                                               0027

C  T() {}

         Y = AC(IAC)                                                    0028

C  T(I,IAC) {2<=I}

         DO 20 I = 2, MH                                                0029

C  T(IAC) {IAC#init+NSKIP2==IAC}

            IAC = IAC+NSKIP2                                            0030

C  T() {}

            Y = Y+AC(IAC)                                               0031

C  T() {}

            TEMP1 = CMPLX(0., 1.)*(AC(IAC)-AC(IAC-NSKIP2))              0032

C  T() {}

            TEMP2 = AC(IAC-NSKIP)                                       0033

C  T() {}

            WORK(I) = TEMP2+TEMP1                                       0034

C  T() {}

            WORK(MP2-I) = TEMP2-TEMP1                                   0035

C  T() {}

20          CONTINUE                                                    0036

C  T(IAC) {IAC==LOOP}

         IAC = LOOP                                                     0037

C  T(I,IAC) {1<=I}

         DO 30 I = 1, M                                                 0038

C  T() {}

            AC(IAC) = WORK(I)                                           0039

C  T(IAC) {IAC#init+NSKIP==IAC}

            IAC = IAC+NSKIP                                             0040

C  T() {}

30          CONTINUE                                                    0041

C  T() {}

         AC(ISUM) = 4.*Y                                                0042

C  T() {}

10       CONTINUE                                                       0043

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(AC, EX)                                               0044

C  T(I,IFIN,ISTART,ISUM,J,JSUM,JSYM,LOOP) {}

      DO 40 LOOP = 1, ISTOP, MSKIP                                      0045

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0046

C  T(JSUM) {ISUM+LOOP==JSUM}

         JSUM = ISUM+LOOP                                               0047

C  T() {}

         X = 2.*AC(LOOP)                                                0048

C  T() {}

         Y = AC(ISUM)                                                   0049

C  T() {}

         AC(LOOP) = X+Y                                                 0050

C  T() {}

         AC(ISUM) = X-Y                                                 0051

C  T() {}

         AC(LOOP+MNSH) = 2.*AC(LOOP+MNSH)                               0052

C  T(ISTART) {LOOP+NSKIP==ISTART}

         ISTART = LOOP+NSKIP                                            0053

C  T(IFIN) {IPROD+LOOP==IFIN}

         IFIN = LOOP+IPROD                                              0054

C  T(I) {I==2}

         I = 2                                                          0055

C  T(I,J,JSYM) {}

         DO 50 J = ISTART, IFIN, NSKIP                                  0056

C  T(I) {I#init+IEXSHF==I}

            I = I+IEXSHF                                                0057

C  T(JSYM) {J+JSYM==JSUM}

            JSYM = JSUM-J                                               0058

C  T() {}

            BJ = AC(J)                                                  0059

C  T() {}

            BJSYM = AC(JSYM)                                            0060

C  T() {}

            TEMP1 = BJ+BJSYM                                            0061

C  T() {}

            TEMP2 = CMPLX(FACT/EX(I), 0.)*(BJ-BJSYM)                    0062

C  T() {}

            AC(J) = TEMP1+TEMP2                                         0063

C  T() {}

            AC(JSYM) = TEMP1-TEMP2                                      0064

C  T() {}

50          CONTINUE                                                    0065

C  T() {}

40       CONTINUE                                                       0066

C  T(NPTS) {NPTS==NPTSINIT}

c      NPTS = M*2
      NPTS = NPTSINIT                                                   0067

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0068

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0069

C  T() {}

C
      IF (LFIRST) THEN                                                  0070

C  T() {}

         LFIRST = .FALSE.                                               0071

C  T() {}

         CALL CPUTIM(T2)                                                0072

C  T() {}

         TXSCSC = T2-T1                                                 0073
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0074

C  T() {}

         IF (LXTIME) THEN                                               0075

C  T() {}

            LXTIME = .FALSE.                                            0076

C  T() {}

            CALL CPUTIM(T2)                                             0077

C  T() {}

            EXSCSC = T2-T1                                              0078
         ENDIF

      ENDIF

C  T(NXSCSC) {NXSCSC==NXSCSC#init+1}

C
      NXSCSC = NXSCSC+1                                                 0079
C
      END

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

C***********************************************************************
      SUBROUTINE SHUF(A,N2P,N1,WORK)
      DIMENSION A(N2P,1),WORK(1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0001

C  T(I,II,J) {1<=J}

C
      DO 10 J = 1, N1, 2                                                0003

C  T(I,II) {1<=I}

         DO 20 I = 1, N2P                                               0004

C  T(II) {2I==II}

            II = I+I                                                    0005

C  T() {}

            WORK(II-1) = A(I,J)                                         0006

C  T() {}

            WORK(II) = A(I,J+1)                                         0007

C  T() {}

20          CONTINUE                                                    0008

C  T(I) {1<=I}

         DO 30 I = 1, N2P                                               0009

C  T() {}

            A(I,J) = WORK(I)                                            0010

C  T() {}

            A(I,J+1) = WORK(I+N2P)                                      0011

C  T() {}

30          CONTINUE                                                    0012

C  T() {}

10       CONTINUE                                                       0013

C  T() {}

C
      IF (LFIRST) THEN                                                  0014

C  T() {}

         LFIRST = .FALSE.                                               0015

C  T() {}

         CALL CPUTIM(T2)                                                0016

C  T() {}

         TXSHUF = T2-T1                                                 0017
      ENDIF

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

C
      NXSHUF = NXSHUF+1                                                 0018
C
      END

C  T(KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,KVF,KVP,KZF,
C    KZP,LMAPP,N1,N2,NOALS,NOTEMP,NUMBER) {KDATA==1, KPF==1, KPP==249,
C    KPRESS==1, KSM==1, KTA==50, KTAPE==0, KTF==1, KTP==50, KUF==1,
C    KUP==249, KVF==1, KVP==249, KZF==1, KZP==249, LMAPP==1, N1==NX,
C    N2==NY, NOALS==1, NOTEMP==0, NUMBER==250}

C***********************************************************************
C     FGPS  2-MAY-99 SET KPP = KZP = KUP = KVP = 249 AND NUMBER = 250
C     FGPS 18-APR-88 SET KPP = KZP = KUP = KVP = 499 AND NUMBER = 500
C
      SUBROUTINE START(NX,NY)
C
C THIS SUBROUTINE IS USED TO SPECIFY OPTIONS FOR PROGRAM OCEAN.
C
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS

C  T(N1) {N1==NX}

C
C N1 AND N2 ARE THE DIMENSIONS OF THE MATRIX. THEY HAVE TO BE POWERS
C OF  2  AND GREATER THAN OR EQUAL TO  8
C
      N1 = NX                                                           0001

C  T(N2) {N2==NY}

      N2 = NY                                                           0002

C  T(KDATA) {KDATA==1}

C
C KDATA SPECIFIES THE WAY DATA IS SUPPLIED TO THE PROGRAM.
C
C            KDATA = 1     MEANS THAT IT WILL BE IN PHYSICAL SPACE
C                  = 2     MEANS THAT IT WILL BE IN FOURIER SPACE
C                  = 3     MEANS THAT THIS IS A RESTART RUN (->READ TAPE
C
      KDATA = 1                                                         0003

C  T(LMAPP) {LMAPP==1}

C
C LMAPP SPECIFIES THE MAPPING IN THE Y DIRECTION.
C
C            LMAPP = 1     MEANS LINEAR MAPPING (-> EIGSET NOT CALLED)
C                  = 2     MEANS NON-LINEAR MAPPING
C                  = 3     MEANS RESTART RUN, NON-LINEAR MAPPING
C
      LMAPP = 1                                                         0004

C  T(NOTEMP) {NOTEMP==0}

C
C NOTEMP EXCLUDES TEMPERATURE FIELD FROM CALCULATIONS WHEN SET TO 1.
C
      NOTEMP = 0                                                        0005

C  T(NOALS) {NOALS==1}

C
C NOALS TURNS ON DEALIASING AT EACH TIME STEP WHEN SET TO 1:
C (TO BE USED ONLY WITH LINEAR MAPPING)
C
      NOALS = 1                                                         0006

C  T(KTA) {KTA==50}

C
C TIME AVERAGING IS PERFORMED EACH KTA TIME STEPS:
C
      KTA = 50                                                          0007

C  T(KPP) {KPP==249}

C
C THE FOLLOWING PARAMETERS SPECIFY WHEN TO CALL CORRESPONDING OUTPUT
C SUBROUTINES. IF YOU WANT, FOR EXAMPLE, PSIPHY TO BE CALLED EVERY
C 50 TIME STEPS, YOU SHOULD SET KPP TO 50.
C
C WARNING: SETTING A PARAMETER TO 1 TURNS OFF THE SUBROUTINE. IT DOES
C          NOT CAUSE IT TO BE CALLED EVERY TIME STEP.
C          YOU SHOULD NEVER SET ANY OF THEM TO 0, SINCE THEY ARE USED
C          WITH THE FUNCTION MOD(NSTEPS,KXYZ).
C
      KPP = 249                                                         0008

C  T(KZP) {KZP==249}

      KZP = 249                                                         0009

C  T(KTP) {KTP==50}

      KTP = 50                                                          0010

C  T(KUP) {KUP==249}

      KUP = 249                                                         0011

C  T(KVP) {KVP==249}

      KVP = 249                                                         0012

C  T(KPF) {KPF==1}

      KPF = 1                                                           0013

C  T(KZF) {KZF==1}

      KZF = 1                                                           0014

C  T(KTF) {KTF==1}

      KTF = 1                                                           0015

C  T(KUF) {KUF==1}

      KUF = 1                                                           0016

C  T(KVF) {KVF==1}

      KVF = 1                                                           0017

C  T(KPRESS) {KPRESS==1}

      KPRESS = 1                                                        0018

C  T(KTAPE) {KTAPE==0}

C
C KTAPE SPECIFIES HOW WILL HISTORY TAPE BE WRITTEN:
C
C          KTAPE = 1  WRITE ONLY EIG-STUFF ON TAPE
C                = 2  WRITE ONLY DATA ON TAPE
C                = 3  WRITE BOTH EIG-STUFF AND DATA ON TAPE
C
C ANY OTHER VALUE WILL PREVENT THE HISTORY TAPE FROM BEING WRITTEN.
C
      KTAPE = 0                                                         0019

C  T(NUMBER) {NUMBER==250}

C
C NUMBER SPECIFIES THE NUMBER OF TIME STEPS IN A SINGLE RUN:
C
      NUMBER = 250                                                      0020

C  T(KSM) {KSM==1}

C
C KSM GOVERNS THE USE OF THE MEAN FLOW OPTION.
C
C                   KSM = 0       MEANS THAT U(MEAN) IS ZERO
C                         1       MEANS THAT IT SHOULD BE COMPUTED
C                         2       MEANS THAT IT IS USER-SPECIFIED
C
      KSM = 1                                                           0021
C
C THAT WAS ALL. RETURN TO MOTHER OCEAN.
C
      END

C  T() {}

C***********************************************************************
      SUBROUTINE TELTIM
      COMMON /DATA/DUMMY(8),TIME,IDUMY1

C  T() {}


      WRITE (6, 9000) TIME                                              0001

C  T() {}


9000  FORMAT(' TIME = ',F20.6)                                          0002

      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE TEMPFO(CA,N2P,N1H,CWORK)
      COMMON /LADDR/LDUMMY,LTN,LDUMY1(10)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0001

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LTN, NW)                                              0002

C  T() {}

      CALL CPRINT(CA, 'TEMP FOU', N1H, N2P, -1)                         0003
      END

C  T(IEXSHF,LOG,NCALL,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN)
C    {LOG==LOG#init, NCALL==NCALL#init+1, NFTVMT==NFTVMT#init+1,
C    NPTS==NPTS#init, NUSHUF==NUSHUF#init+1, NXPRNT==NXPRNT#init+1,
C    NXXCSR==NXXCSR#init+1, NXXXIN==NXXXIN#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init, 1<=LTN,
C    LTN<=OUT:MEMSIZ}

C***********************************************************************
C
C
C     FGPS  9-APR-88 MADE TO CALL RPRNT2 (NOT RPRINT) WHENEVER IMODE =
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C     FGPS 10-FEB-88 ADDED "COMPLEX  EX(1)"
C
      SUBROUTINE TEMPHY(A,N2PD,N1H,EX,WORK,IMODE)
      COMMON /LADDR/LDUMMY,LTN,LDUMY1(10)
      DIMENSION A(N2PD,1),WORK(1)
      COMPLEX EX(1)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /MAPING/GMAPP(129),GDUMY1(129)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      SAVE NCALL
      DATA NCALL/0/

C  T(NW) {}


      NW = N2PD*N1H                                                     0001

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0002

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0003

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(A, LTN, NW)                                               0004

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXXCSR==NXXCSR#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL CSR(A, EX)                                                   0005

C  T(J) {1<=J}

      DO 10 J = 1, N1H                                                  0006

C  T() {}

         WORK(J) = 0.0                                                  0007

C  T() {}

10       CONTINUE                                                       0008

C  T(I,IPH,J) {1<=I}

      DO 20 I = 1, N2PD                                                 0009

C  T(IPH) {2IPH<=I+1, I<=2IPH}

         IPH = (I+1)/2                                                  0010

C  T() {}

         ADJUST = BETA*GMAPP(IPH)                                       0011

C  T(J) {1<=J}

C WHEN INTERESTED IN TEMPERATURE DISTURBANCE ONLY, USE THIS INSTEAD:
C        ADJUST = 0.0
         DO 30 J = 1, N1H                                               0012

C  T() {}

            WORK(J) = WORK(J)+A(I,J)*A(I,J)                             0013

C  T() {}

            A(I,J) = 0.5*A(I,J)-ADJUST                                  0014

C  T() {}

30          CONTINUE                                                    0015

C  T() {}

20       CONTINUE                                                       0016

C  T() {}

      SUMSQ = 0.0                                                       0017

C  T(J) {1<=J}

      DO 40 J = 1, N1H                                                  0018

C  T() {}

         SUMSQ = SUMSQ+WORK(J)                                          0019

C  T() {}

40       CONTINUE                                                       0020

C  T() {}

      ZRMS = 0.5*SQRT(SUMSQ/(REAL(N1)*REAL(N2P)))                       0021

C  T() {}

      WRITE (6, 9000) ZRMS                                              0022

C  T(NCALL) {NCALL==NCALL#init+1}

      NCALL = NCALL+1                                                   0023

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0024

C  T() {}

      CALL TELTIM                                                       0025

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      IF (IMODE.LT.0) THEN                                              0026

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

         CALL RPRNT2(A, 'TEMP PHY', N1H, N2PD, IMODE)                   0027

      ELSE

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

         CALL RPRINT(A, 'TEMP PHY', N1H, N2PD, IMODE)                   0028
      ENDIF

C  T() {}

C      CALL PLOTME (A,WORK,NCALL)
9000  FORMAT(/,' SQRT (AVERAGE TEMPERATURESQUARED) =',F30.15)           0029

      END

C  T() {}

C***********************************************************************
      SUBROUTINE TESTDT(A,N2P,N1,WORK,G)
      COMMON /PI/PI
      DIMENSION A(N2P,N1),WORK(N2P),G(N2P)

C  T(I) {1<=I}

C
C FIND MAXIMUM DT:
C
      DO 10 I = 1, N2P                                                  0001

C  T() {}

         WORK(I) = 0.0                                                  0002

C  T() {}

10       CONTINUE                                                       0003

C  T(I,J) {1<=J}

      DO 20 J = 1, N1                                                   0004

C  T(I) {1<=I}

         DO 30 I = 1, N2P                                               0005

C  T() {}

            WORK(I) = MAX(WORK(I), ABS(G(I)*A(I,J)))                    0006

C  T() {}

30          CONTINUE                                                    0007

C  T() {}

20       CONTINUE                                                       0008

C  T(I) {2<=I}

C
C G WAS 1.0/(DY/DX), AND X GOES FROM 0.0 TO PI, HENCE IF WE WANT
C ((DY/DI)/V)=((DY/DX)(DX/DI)/V)=PI/(N1*G(I)*V(I))
C REMEMBER, A CONTAINS 2.0*V:
      DO 40 I = 2, N2P                                                  0009

C  T() {}

         WORK(1) = MAX(WORK(1), WORK(I))                                0010

C  T() {}

40       CONTINUE                                                       0011

C  T() {}

C
C SO, WORK(1) = MAX (G(I)*2*V(I,J)):
C DT(MAX) = 0.2* MIN (DY/V) = 0.2*2.0*PI/(N1*WORK(1)):
CSRD  DTMAX = 0.4*PI/(REAL(N1)*WORK(1)+1.0E-1000)
      DTMAX = 0.4*PI/(REAL(N1)*WORK(1)+1.0E-300)                        0012

C  T() {}

      WRITE (6, 9000) DTMAX                                             0013

C  T() {}


9000  FORMAT(/,/,' DTMAX =',F16.10)                                     0014

      END

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

C***********************************************************************
      SUBROUTINE UNSHUF(A,N2P,N1,WORK)
      DIMENSION A(N2P,1),WORK(1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0001

C  T(I,II,J) {1<=J}

C
      DO 10 J = 1, N1, 2                                                0003

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0004

C  T() {}

            WORK(I) = A(I,J)                                            0005

C  T() {}

            WORK(I+N2P) = A(I,J+1)                                      0006

C  T() {}

20          CONTINUE                                                    0007

C  T(I,II) {1<=I}

         DO 30 I = 1, N2P                                               0008

C  T(II) {2I==II}

            II = I+I                                                    0009

C  T() {}

            A(I,J) = WORK(II-1)                                         0010

C  T() {}

            A(I,J+1) = WORK(II)                                         0011

C  T() {}

30          CONTINUE                                                    0012

C  T() {}

10       CONTINUE                                                       0013

C  T() {}

C
      IF (LFIRST) THEN                                                  0014

C  T() {}

         LFIRST = .FALSE.                                               0015

C  T() {}

         CALL CPUTIM(T2)                                                0016

C  T() {}

         TUSHUF = T2-T1                                                 0017
      ENDIF

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

C
      NUSHUF = NUSHUF+1                                                 0018
C
      END

C  T(IEXSHF,ISIGN,LOG,NFTVMT,NPTS,NXSCSC) {ISIGN==1, LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXSCSC==NXSCSC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

C***********************************************************************
      SUBROUTINE UVELFO(CA,N2P,N1H,G,EX,CWORK)
c      COMMON /FT/NDUMMY(4),ISIGN,NDUMY2(2)
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMPLEX CA(N2P,1),CWORK(1),EX(1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION G(1)

C  T(I,J) {1<=I}


      DO 10 I = 1, N2P                                                  0001

C  T(J) {1<=J}

         DO 20 J = 1, N1H                                               0002

C  T() {}

            CA(I,J) = G(I)*CA(I,J)                                      0003

C  T() {}

20          CONTINUE                                                    0004

C  T() {}

10       CONTINUE                                                       0005

C  T(ISIGN) {ISIGN==-1}

      ISIGN = -1                                                        0006

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {LOG==LOG#init,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NXSCSC==NXSCSC#init+1,
C    IEXSHF#init<=IEXSHF, IEXSHF<=IEXSHF#init}

      CALL SCSC(CA, EX, CWORK)                                          0007

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0008

C  T() {}

      F = 0.125/REAL(N2P-1)                                             0009

C  T(I,J) {1<=J}

      DO 30 J = 1, N1H                                                  0010

C  T(I) {1<=I}

         DO 40 I = 1, N2P                                               0011

C  T() {}

            CA(I,J) = F*CA(I,J)                                         0012

C  T() {}

40          CONTINUE                                                    0013

C  T() {}

30       CONTINUE                                                       0014

C  T() {}

      CALL CPRINT(CA, 'UVEL FOU', N1H, N2P, -1)                         0015
      END

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF==NUSHUF#init+1,
C    NXPRNT==NXPRNT#init+1, NXXXIN==NXXXIN#init+1, 1<=LPY,
C    LPY<=OUT:MEMSIZ}

C***********************************************************************
C
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C
      SUBROUTINE UVELPH(A,N2PD,N1H,WORK,IMODE)
      COMMON /LADDR/LDUMMY(5),LPY,LDUMY1(6)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION A(N2PD,1),WORK(1)
      COMMON /DATA/DUMY1(2),BOXX,DUMY2(6),IDUMY1

C  T(I) {1<=I}


      DO 10 I = 1, N2PD                                                 0001

C  T() {}

         WORK(I) = 0.0                                                  0002

C  T() {}

10       CONTINUE                                                       0003

C  T(NW) {}

      NW = N2PD*N1H                                                     0004

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0005

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0006

C  T() {}

      CALL TELTIM                                                       0007

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPY, LPY+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(A, LPY, NW)                                               0008

C  T(I,J) {1<=J}

      DO 20 J = 1, N1H                                                  0009

C  T(I) {1<=I}

         DO 30 I = 1, N2PD                                              0010

C  T() {}

            WORK(I) = MAX(WORK(I), ABS(A(I,J)))                         0011

C  T() {}

30          CONTINUE                                                    0012

C  T() {}

20       CONTINUE                                                       0013

C  T() {}

      WRKMAX = 0.0                                                      0014

C  T(I) {1<=I}

      DO 40 I = 1, N2PD                                                 0015

C  T() {}

         WRKMAX = MAX(WRKMAX, WORK(I))                                  0016

C  T() {}

40       CONTINUE                                                       0017

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0018

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      CALL RPRINT(A, 'UVEL PHY', N1H, N2PD, IMODE)                      0019

C  T() {}

C
C AT THIS POINT A(N2P,N1) CONTAINS 2.0*U
C
      UMAX = 0.5*WRKMAX+1.0E-32                                         0020

C  T() {}

      DTMAX = 0.2*BOXX/REAL(N1)/UMAX                                    0021

C  T() {}

      WRITE (6, 9000) DTMAX                                             0022

C  T() {}


9000  FORMAT(/,/,' DTMAX =',F16.10)                                     0023

      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE VVELFO(CA,N2P,N1H,FX,CWORK)
      COMMON /LADDR/LDUMMY(2),LPN,LDUMY1(9)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0001

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LPN, NW)                                              0002

C  T() {}

      F = 0.                                                            0003

C  T(I,J) {1<=J}

      DO 10 J = 1, N1H                                                  0004

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0005

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0006

C  T() {}

20          CONTINUE                                                    0007

C  T() {}

         F = F+FX                                                       0008

C  T() {}

10       CONTINUE                                                       0009

C  T() {}

      CALL CPRINT(CA, 'VVEL FOU', N1H, N2P, -1)                         0010
      END

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF==NUSHUF#init+1,
C    NXPRNT==NXPRNT#init+1, NXXXIN==NXXXIN#init+1, 1<=LPN,
C    LPN<=OUT:MEMSIZ}

C***********************************************************************
C
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C
      SUBROUTINE VVELPH(A,N2PD,N1H,WORK,IMODE)
      COMMON /LADDR/LDUMMY(2),LPN,LDUMY1(9)
      DIMENSION A(N2PD,1),WORK(1)
      COMMON /MAPING/GMAPP(129),G(129)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2

C  T(NW) {}


      NW = N2PD*N1H                                                     0001

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0002

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0003

C  T() {}

      CALL TELTIM                                                       0004

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(A, LPN, NW)                                               0005

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0006

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      CALL RPRINT(A, 'VVEL PHY', N1H, N2PD, IMODE)                      0007

C  T() {}

C
C AT THIS POINT A(N2P,N1) CONTAINS 2.0*V
C
      CALL TESTDT(A, N2P, N1, WORK, G)                                  0008
      END

C  T(NB,NXLOG2) {NXLOG2==NXLOG2#init+1}

C***********************************************************************
C
C     FGPS 29-APR-88 INTRODUCED "SUBROUTINE XLOG2 (NA,NB)" IN ORDER TO I
C                    PROVE EFFICIENCY.  THIS REPLACES "FUNCTION LOG2 (N)
C
C      FUNCTION LOG2 (N)
C      LOG2 = LOG(REAL(N))/LOG(2.)+0.01
C      RETURN
C      END
C
      SUBROUTINE XLOG2(NA,NB)
C
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
C
      LOGICAL INITL1,INITL2
      DATA INITL1,INITL2/.TRUE.,.TRUE./
      REAL T1,T2,F1,B
      SAVE INITL1,INITL2,F1

C  T() {}

C
      IF (INITL1) CALL CPUTIM(T1)                                       0001

C  T() {}

C
      IF (INITL2) THEN                                                  0003

C  T() {}

         INITL2 = .FALSE.                                               0004

C  T() {}

         F1 = 1.0/LOG(2.0)                                              0005
      ENDIF

C  T() {}

C
      B = F1*LOG(REAL(NA))+0.01                                         0006

C  T(NB) {}

      NB = INT(B)                                                       0007

C  T() {}

C
      IF (INITL1) THEN                                                  0008

C  T() {}

         INITL1 = .FALSE.                                               0009

C  T() {}

         CALL CPUTIM(T2)                                                0010

C  T() {}

         TXLOG2 = T2-T1                                                 0011
      ENDIF

C  T(NXLOG2) {NXLOG2==NXLOG2#init+1}

C
      NXLOG2 = NXLOG2+1                                                 0012
C
      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE ZETAFO(CA,N2P,N1H,CWORK)
      COMMON /LADDR/LZN,LDUMY1(11)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0001

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LZN, NW)                                              0002

C  T() {}

      CALL CPRINT(CA, 'ZETA FOU', N1H, N2P, -1)                         0003
      END

C  T(ACAC:IEXSHF,ACAC:LOG,ACAC:NPTS,NCALL,NFTVMT,NUSHUF,NXPRNT,NXXCSR)
C    {ACAC:LOG==ACAC:LOG#init, ACAC:NPTS==ACAC:NPTS#init,
C    NCALL==NCALL#init+1, NFTVMT==NFTVMT#init+1,
C    NUSHUF==NUSHUF#init+1, NXPRNT==NXPRNT#init+1,
C    NXXCSR==NXXCSR#init+1, ACAC:IEXSHF#init<=ACAC:IEXSHF,
C    ACAC:IEXSHF<=ACAC:IEXSHF#init}

C***********************************************************************
C
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C
      SUBROUTINE ZETAPH(A,N2PD,N1H,EX,WORK,IMODE)
      DIMENSION A(N2PD,1),EX(1),WORK(1)
      SAVE NCALL
      DATA NCALL/0/
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2

C  T(ACAC:IEXSHF,ACAC:LOG,ACAC:NPTS,NFTVMT,NXXCSR)
C    {ACAC:LOG==ACAC:LOG#init, ACAC:NPTS==ACAC:NPTS#init,
C    NFTVMT==NFTVMT#init+1, NXXCSR==NXXCSR#init+1,
C    ACAC:IEXSHF#init<=ACAC:IEXSHF, ACAC:IEXSHF<=ACAC:IEXSHF#init}


      CALL CSR(A, EX)                                                   0001

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0002

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0003

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0004

C  T() {}

      CALL TELTIM                                                       0005

C  T(J) {1<=J}

      DO 10 J = 1, N1H                                                  0006

C  T() {}

         WORK(J) = 0.0                                                  0007

C  T() {}

10       CONTINUE                                                       0008

C  T(I,J) {1<=I}

      DO 20 I = 1, N2PD                                                 0009

C  T(J) {1<=J}

         DO 30 J = 1, N1H                                               0010

C  T() {}

            WORK(J) = WORK(J)+A(I,J)*A(I,J)                             0011

C  T() {}

30          CONTINUE                                                    0012

C  T() {}

20       CONTINUE                                                       0013

C  T() {}

      SUMSQ = 0.0                                                       0014

C  T(J) {1<=J}

      DO 40 J = 1, N1H                                                  0015

C  T() {}

         SUMSQ = SUMSQ+WORK(J)                                          0016

C  T() {}

40       CONTINUE                                                       0017

C  T() {}

      ZRMS = SQRT(SUMSQ/(REAL(N1)*REAL(N2P)))                           0018

C  T() {}

      WRITE (6, 9000) ZRMS                                              0019

C  T(NCALL) {NCALL==NCALL#init+1}

      NCALL = NCALL+1                                                   0020

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      CALL RPRINT(A, 'ZETA PHY', N1H, N2PD, IMODE)                      0021

C  T() {}

C      CALL PLOTME (A,WORK,NCALL)
9000  FORMAT(/,' SQRT (AVERAGE ZETASQUARED) =',F30.15)                  0022

      END

C  P() {}

C
C     1993 version - Modified by Beatrice Creusillet for PIPS -
C
C     MODIFICATIONS:
C
C     AUGUST 1995:
C     ~~~~~~~~~~~~
C     - CXxxxxx and CYyyyyy commentaries removed for clarity.
C     - CPUTIM and ELAPSE subroutines uncommented.
C     - BLOCK DATA moved in main procedure (Francois Irigoin) .
C     - Macro definition LSTMOD(MODEHI) in module DEALSE replaced where
C       it is used.
C     - (1.,0.) replaced by CMPLX(1.,0.) wherever needed.
C     - In RUNINF, computed GOTO's are replaced by block if's.
C     - Passed through stf; one empty if block removed afterwards.
C     - Add common /TIMING/ in DATAST, TEMPFO, TEMPHY, PSIFOU, PSIPHY,
C       ZETAFO, ZETAPH, VVELFO, VVELPH, UVELFO, UVELPH, DEALSE, in order
C       to help the interprocedural propagation.
C     - Common /NMBRS/ declared in RCS, CSR, ACAC, SCSC to
C       propagate major predicates (like N2P==129) downwards to FTRVMT 
C       (fi, June 1993).
C     - Add common /FT/ in TEMPHY
C     - Add common /MEMORY/ in OCEAN
C     - variable NUMBER in common /DEBUG/ renamed into NUM1 to avoid clashes
C       with variable NUMBER in common /OPTONS/
C     - use full declaration of /FT/ in UVELFO (Francois Irigoin)
C     - Syntactic construct IF(.TRUE.) THEN ... ENDIF added around the
C       time loop to compute accuracte preconditions and transformers.
C       This should be useless with unspaghettify...
C       (Francois Irigoin)
C     - useless STOP in OCEAN commented out to avoid problems with
C       Ronan's dead code elimination (Francois Irigoin)
C     - management of NPTS in SCSC modified to restore
C       exactly NPTS; preconditions fail to find this because they use
C       a transformer computed with no knowledge of NPTS parity;
C       Same transform in ACAC.
C       Note that NPTS is directly saved and restored in RCS.
C       (Francois Irigoin)
C     - artificial IF(.TRUE.)THEN removed; do not forget to unspaghettify
C       the code before processing (Francois Irigoin)
C     - combination of arithmetic IF and RETURNs restructured manually
C       in CPRINT
C     - forwarding of N1's assignment in subsequent WRITE in CPRINT;
C       I guess the programmer did not realize N1 was directly available
C       in COMMON /OPTONS/; he did not realize the potential impact
C       of N1 reassignement in the middle of the time loop; common
C       /OPTONS/ might be useless!
C
C******NOTE: USE OF MACHINE-DEPENDENT CONSTANT: ZERO IN SUBROUTINE RUNIN
C
C            ZERO = 1.0E-200 (MAY HAVE TO REPLACE WITH YOUR MACHINES
C                             RELATIVE PRECISION FOR REAL DATA TYPE)
C

C***********************************************************************
C                        OCEAN FORTRAN PROGRAMS
C                        CREATION DATE: 3/22/81
C***********************************************************************
      PROGRAM OCEAN
C
C  D(Z)/DT + (U,V).GRAD(Z) = RNU*DELSQ(Z) + ALPHA*D(TEMP)/DX
C
C  D(TEMP)/DT + (U,V).GRAD(TEMP) = RKAPA*DELSQ(TEMP) + BETA*V
C
C
C
C THIS PROGRAM SIMULATES TWO-DIMENSIONAL FLUID FLOW ON A   (N2+1) * N1
C GRID. IT IS POSSIBLE TO SPECIFY NON-LINEAR DISTRIBUTION OF DATA POINTS
C THE Y-DIRECTION (THE FIRST INDEX CORRESPONDS TO Y DIRECTION, SECOND TO
C X DIRECTION). N1 AND N2 HAVE TO BE POWERS OF TWO GREATER OR EQUAL TO 8
C
C THE PROGRAM USES LARGE CORE MEMORY. IT REQUIRES 8*(N2+1)*N1+(N2-1)*(N2
C WORDS OF IT. IF NOTEMP = 1 IT IS POSSIBLE TO SAVE 2*(N2+1)*N1 WORDS,
C IF LMAPP = 1 YOU SAVE ADDITIONAL (N2-1)*(N2+1) WORDS.
C
C IF  LMAPP = 2 , LCM REQUIREMENTS ARE AT LEAST  3 * (N2-1) * (N2-1)
C MORE MEMORY COULD BE NEEDED IN THIS CASE BECAUSE OF EIGSET AND LCMRQR.
C
C
C FOR CDC7600 RUNS: DELETE ROUTINES LCMREQ, IN AND OUT FROM THE END OF
C                   THIS PACKAGE. ON CDC7600 THE LCM IS USED THROUGH
C                   THE ASSEMBLY ROUTINES.
C
C                   LIBRARY.
C FOR CRAY-1 RUNS : DELETE ROUTINES SECOND, DATE, TIME, EXSET AND
C                   LOG2 FROM THE END OF THIS PACKAGE. THEY ARE
C                   OBTAINED AT LOAD TIME FROM CRAY LIBRARIES AND
C                   FFTLIB.
C                   ALSO, ADJUST THE SIZE OF PARAMETER LCMSIZ IN
C                   THE ROUTINE LCMREQ SO THAT THE COMMON IS LARGE
C                   ENOUGH TO EMULATE CDC7600 LCM REQUIRED FOR THE RUN.
C
C THE FOLLOWING PARAMETERS DEFINE THE SIZE OF THE RUN:
C
      PARAMETER (NX=128,NY=128)
      PARAMETER (NA1=2* (NY+1),NA2=NX/2,NE=NY-1,NW1=NY+1)
      PARAMETER (NW2=128,NEX=256)
      PARAMETER (NI=2*NY-1,NEQ=3*NY-2,NCW2=2*NW1+1,NCW3=4*NW1+1)
C
C PLEASE REFER TO THE DIMENSIONING AND EQUIVALENCING INSTRUCTIONS IN
C THE CASE YOUR COMPILER CANNOT HANDLE PARAMETER STATEMENTS...
C COMMON BLOCKS:
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
C
C THE DIMENSION OF  GSOLV  HAS TO BE AT LEAST (N2-1)
C
      COMMON /SOLV/LVECT,LSKIP,NVECT,NVSKIP,GSOLV(127)
C
C THE DIMENSIONS OF  GMAPP  AND  G  HAVE TO BE AT LEAST (N2+1)
C
      COMMON /MAPING/GMAPP(129),G(129)
      COMMON /MFLOW/U(129)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /PI/PI
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMMON /EXSIZE/NMAX2
      COMMON /LADDR/LZN,LTN,LPN,LZO,LTO,LPY,LZX,LZY,LEIG,LE,LH,LEV
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      PARAMETER (LCMSIZ=165117)
      COMMON /MEMORY/MEMSIZ,RM(LCMSIZ)
C
C
C COMPLEX ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            CA        (N2+1) X N1/2
C            CWORK     N2+1
C            CWORK2    N2+1
C            CWORK3    N2+1
C            EX        MAX(2*N2, N1)
C
C EX ARRAY MUST NOT BE THE FIRST ARRAY IN THE MEMORY.
C
      COMPLEX CA(NW1,NA2),CWORK(NW1),CWORK2(NW1)
      COMPLEX CWORK3(NW1),EX(NEX),CF
C
C REAL ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            A      2*(N2+1) X N1/2
C            E      (N2-1)   X (N2-1)
C            WORK   N2+1     X MAX(6, 2*MIN(64, N1/2))   (AT LEAST)
C            EVAL   N2-1
C            IR     N2-1
C            IC     N2-1
C
      REAL A(NA1,NA2),E(NE,NE)
      REAL WORK(NW1*NW2)
      REAL EVAL(NE),IR(NE),IC(NE)
      INTEGER VALID
C
C EQUIVALENCE STATEMENTS ARE SAVING MEMORY SPACE. THE FOLLOWING PATTERN
C HAS TO BE FOLLOWED EXACTLY:
C
C     A-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CA+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     EVAL+-+IR-+-+-IC+-+-+E+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C
C
C     WORK+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CWORK-+-+-+CWORK2-+-+-CWORK3+-+-+
C
C      EQUIVALENCE (A,CA,EVAL), (A(NY),IR), (A(NI),IC), A(NEQ),E) - ORGI
C      EQUIVALENCE (A,CA,EVAL), (EVAL(NY),IR), (EVAL(NI),IC),
C     *             (EVAL(NEQ),E) - MACFARLANE'S FIX. BAD.
C POINTER'S FIX. ANSI REQUIRES THAT THE NUMBER OF SUBSCRIPTS MATCH
C THE NUMBER OF DIMENSIONS OF THE ARRAY. THAT WAS THE PROBLEM WITH
C THE ORGINAL STATEMENT. THE PROBLEM WITH MACFARLANE'S FIX IS THAT
C NY,NI,NEQ>NE (THE DIMENSION OF EVAL). HERE 3*NE+1-NA1 IS THE 3*NE+1TH
C ELEMENT OF A AND 3*NE+1 = NEQ.
      EQUIVALENCE (A,CA,EVAL), (A(NY,1),IR), (A(NI,1),IC),
     +            (A(3*NE+1-NA1,2),E)
      EQUIVALENCE (WORK,CWORK), (WORK(NCW2),CWORK2), (WORK(NCW3),CWORK3)
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /DEBUG/NUM1,TLAST
C
C     former BLOCK DATA
C
C
      DATA TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT/0.,0.,0.,0.,
     +     0.,0.,0./
      DATA TXSHUF,TUSHUF,TXPRNT,TXLOG2/0.,0.,0.,0./
      DATA EXXRCS,EXXCSR,EXSCSC,EXACAC,EFTVMT/0.,0.,0.,0.,0./
      DATA NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT/0,0,0,0,0,0,
     +     0/
      DATA NXSHUF,NUSHUF,NXPRNT,NXLOG2/0,0,0,0/
      DATA VDAT/0.10000E+03,-0.10000E+03,0.10000E-04,-0.10000E+03,
     +     -0.15708E+01,0.99983E+02,-0.18147E+01,-0.20427E+01,
     +     -0.22452E+01,-0.24181E+01,0.95976E+02,-0.95977E+02,
     +     0.10000E-04,-0.95978E+02,-0.25589E+01/
C
C PI IS A USEFULL CONSTANT
C
      DATA PI/3.141592653589793/
      DATA NUM1/1/,TLAST/0.0/

C  P() {}

C
C
C
C NOW WE CAN START WITH THE PROGRAM...
C SUBROUTINE START TELLS OCEAN WHAT TO DO:
C
      CALL CPUTIM(CPU1)                                                 0001

C  P() {}

      CALL ELAPSE(TCLCK1)                                               0002

C  P() {}

      OPEN (UNIT=1,FILE='OCV')                                          0003

C  P() {}

      OPEN (UNIT=6,FILE='OCO6')                                         0004

C  P() {}

      WRITE (1, 9000)                                                   0005

C  P() {}


      CALL START(NX, NY)                                                0006

C  P() {}

C
C IF  LMAPP = 1 , H  (THE SIZE OF THE BOX IN Y DIRECTION)  SHOULD BE
C SPECIFIED IN THE MAIN PROGRAM.
C
      H = PI                                                            0007

C  P(N1) {N1==128}

C
C DEFINING CONSTANTS THAT WILL BE NEEDED:
C
      N1H = N1/2                                                        0008

C  P(N1) {N1==128}

      N1Q = N1/4                                                        0009

C  P(N1) {N1==128}

      N1E = N1/8                                                        0010

C  P(N2) {N2==128}

      N2M = N2-1                                                        0011

C  P(N2) {N2==128}

      N2P = N2+1                                                        0012

C  P(N2) {N2==128}

      N2DP = 2*N2+1                                                     0013

C  P(N2) {N2==128}

      N2DM = 2*N2-1                                                     0014

C  P(N2P) {N2P==129}

      N2PD = 2*N2P                                                      0015

C  P(N1H,N2PD) {N2PD==258, 64<=N1H, N1H<=64}

      NW = N2PD*N1H                                                     0016

C  P(NW) {}

      NWH = NW/2                                                        0017

C  P(NW) {2NWH<=NW, NW<=2NWH+1}

      NWQ = NW/4                                                        0018

C  P(N2M) {N2M==127}

      NWEIG = N2M                                                       0019

C  P(LMAPP,N2M,NWEIG) {LMAPP==1, N2M==NWEIG, NWEIG==127}

      IF (LMAPP.NE.1) NWEIG = (N2M+3)*N2M                               0020

C  P(N1,N2) {N1==128, N2==128}

      NMAX2 = MAX(2*N2, N1)                                             0022

C  P(N1E) {16<=N1E, N1E<=16}

      K1Q = N1E+1                                                       0023

C  P(K1Q,N1E) {K1Q==N1E+1, 16<=N1E, N1E<=16}

      K2Q = K1Q+N1E                                                     0024

C  P(K2Q,N1E) {K1Q==N1E+1, K2Q==2N1E+1, 16<=N1E, N1E<=16}

      K3Q = K2Q+N1E                                                     0025

C  P(K1Q) {K1Q==N1E+1, K2Q==2N1E+1, K3Q==3N1E+1, 16<=N1E, N1E<=16}

      K1QM = K1Q-1                                                      0026

C  P(K2Q) {K1Q==K1QM+1, K1QM==N1E, K2Q+N1E==K3Q, K2Q==2N1E+1, 16<=N1E,
C    N1E<=16}

      K2QM = K2Q-1                                                      0027

C  P(K3Q) {K1Q==N1E+1, 2K1QM==K2QM, 3K1QM==K3Q-1, K2Q==K2QM+1,
C    K2QM==2N1E, 16<=K1QM, K1QM<=16}

      K3QM = K3Q-1                                                      0028

C  P(NW) {2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

C
C LCM ALLOCATION AND COMPUTATION OF ADDRESSES:
C
      LARGE = 8*NW                                                      0029

C  P(LARGE,NOTEMP,NW) {LARGE==8NW, NOTEMP==0, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3}

      IF (NOTEMP.EQ.1) LARGE = 6*NW                                     0030

C  P(KPRESS,LARGE,LMAPP,N2M,NWEIG) {KPRESS==1, LARGE==8NW, LMAPP==1,
C    N2M==127, NWEIG==127, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

      IF (LMAPP.NE.2) THEN                                              0032

C  P(LARGE,NWEIG) {LARGE==8NW, NWEIG==127, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3}

C
         LARGE = LARGE+NWEIG                                            0033

      ELSE

C  P(KPRESS,LARGE,N2M,NWEIG) {0==-1}

C
         IF (KPRESS.GT.1) LARGE = MAX(LARGE, 3*N2M*N2M)+NWEIG+NWEIG     0034

C  P(KPRESS,LARGE,N2M,NWEIG) {0==-1}

         IF (KPRESS.LE.1) LARGE = MAX(LARGE+NWEIG, 3*N2M*N2M)           0036
      ENDIF

C  P(LARGE) {LARGE==8NW+127, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3}

C
      LZN = LCMREQ(LARGE)                                               0038

C  P(LZN,NW) {LARGE==MEMSIZ, LZN==1, MEMSIZ==8NW+127, NW<=20623,
C    2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

      LTN = LZN+NW                                                      0039

C  P(LTN,LZN,NOTEMP) {LARGE==8LTN+119, 8LTN==MEMSIZ-119, LTN==NW+1,
C    LZN==1, NOTEMP==0, MEMSIZ<=165117, 16NWH+127<=MEMSIZ,
C    MEMSIZ<=16NWH+135, 32NWQ+127<=MEMSIZ, MEMSIZ<=32NWQ+151}

      IF (NOTEMP.EQ.1) LTN = LZN                                        0040

C  P(LTN,NW) {LARGE==8LTN+119, 8LTN==MEMSIZ-119, LTN==NW+1,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LPN = LTN+NW                                                      0042

C  P(LPN,NW) {LARGE==8LTN+119, 4LPN==MEMSIZ-123, 8LTN==MEMSIZ-119,
C    LTN==NW+1, MEMSIZ<=165117, 16NWH+127<=MEMSIZ, MEMSIZ<=16NWH+135,
C    32NWQ+127<=MEMSIZ, MEMSIZ<=32NWQ+151}

      LZO = LPN+NW                                                      0043

C  P(LZO,NW) {LARGE==8LTN+119, LPN==2LTN-1, 3LTN==LZO+2,
C    8LTN==MEMSIZ-119, LTN==NW+1, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LTO = LZO+NW                                                      0044

C  P(LTO,LZO,NOTEMP) {LARGE==8LTN+119, 8LPN+MEMSIZ==8LZO+127,
C    4LPN==MEMSIZ-123, 8LTN==MEMSIZ-119, LTN==NW+1,
C    8LZO+MEMSIZ==8LTO+127, NOTEMP==0, MEMSIZ<=165117,
C    16NWH+127<=MEMSIZ, MEMSIZ<=16NWH+135, 32NWQ+127<=MEMSIZ,
C    MEMSIZ<=32NWQ+151}

      IF (NOTEMP.EQ.1) LTO = LZO                                        0045

C  P(LTO,NW) {LARGE==8LTN+119, LPN==2LTN-1, 4LPN==MEMSIZ-123,
C    LTN+LZO==LTO+1, 3LTN==LZO+2, LTN==NW+1, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LPY = LTO+NW                                                      0047

C  P(LPY,NW) {LARGE==8LTN+119, 3LPN==2LZO+1, 4LPN==MEMSIZ-123,
C    3LTO+LZO==3LPY+1, 8LTN==MEMSIZ-119, LTN==NW+1, 3LTO==4LZO-1,
C    LZO<=61872, 6NWH+1<=LZO, LZO<=6NWH+4, 12NWQ+1<=LZO,
C    LZO<=12NWQ+10}

      LZX = LPY+NW                                                      0048

C  P(LZX,NW) {LARGE==8LTN+119, LPN==2LTN-1, 4LPN==MEMSIZ-123,
C    LTN+LTO==LPY+1, LPY+LTN==LZX+1, LTN+LZO==LTO+1, 3LTN==LZO+2,
C    LTN==NW+1, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      LZY = LZX+NW                                                      0049

C  P(LARGE,LZN,NWEIG) {LARGE==8LTN+119, 3LPN==2LZO+1,
C    4LPN==MEMSIZ-123, 3LTO+LZO==3LPY+1, 3LPY+LZO==3LZX+1,
C    8LTN==MEMSIZ-119, LTN==NW+1, 3LTO==4LZO-1, LZN==1,
C    LZO+3LZX==3LZY+1, NWEIG==127, LZO<=61872, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10}

      LPRESS = LZN+LARGE-NWEIG                                          0050

C  P(LPRESS) {LARGE==LPRESS+126, LPN==2LTN-1, 4LPN==MEMSIZ-123,
C    LPRESS==8LTN-7, LTN+LTO==LPY+1, LPY+LTN==LZX+1, LTN+LZO==LTO+1,
C    3LTN==LZO+2, LTN+LZX==LZY+1, LTN==NW+1, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LEIG = LPRESS                                                     0051

C  P(KPRESS,LEIG,LMAPP,LPRESS,NWEIG) {KPRESS==1, LARGE==8LTN+119,
C    LEIG==LPRESS, LMAPP==1, 3LPN==2LZO+1, 4LPN==MEMSIZ-123,
C    LPRESS+8LTO==8LPY+1, LPRESS+8LPY==8LZX+1, LPRESS==2LTO-1,
C    3LPRESS==8LZO-5, LPRESS+8LZX==8LZY+1, 8LTN==MEMSIZ-119,
C    LTN==NW+1, NWEIG==127, LPRESS<=164991, 16NWH+1<=LPRESS,
C    LPRESS<=16NWH+9, 32NWQ+1<=LPRESS, LPRESS<=32NWQ+25}

      IF (KPRESS.GT.1.AND.LMAPP.NE.1) LEIG = LPRESS-NWEIG               0052

C  P(LZN) {LZN==1}

C
C THESE LCM ADDRESSES ARE USED BY EIGSET AND LCMRQR
C
      LE = LZN                                                          0054

C  P(LE,N2M) {LE==1, N2M==127}

      LH = LE+N2M*N2M                                                   0055

C  P(LH,N2M) {N2M==127}

      LEV = LH+N2M*N2M                                                  0056

C  P(NMAX2) {256<=NMAX2}

C
      CALL EXSET(EX, NMAX2)                                             0057

C  P(N2P) {N2P==129}

C
C SET ALL  U(I) TO 0. TO AVOID TROUBLE IF NO MEAN FLOW IS DESIRED
C
      DO 10 I = 1, N2P                                                  0058

C  P(I,N2P) {N2P==129, 1<=I, I<=129}

         U(I) = 0.                                                      0059

C  P(N2P) {N2P==129}

10       CONTINUE                                                       0060

C  P(I,LEIG,LMAPP,MEMSIZ,N2,N2M,N2P,NWEIG) {I==130, LARGE==LPRESS+126,
C    LEIG==8LTN-7, LMAPP==1, LPN==2LTN-1, 4LPN==MEMSIZ-123,
C    LPRESS==8LTN-7, 4LPY==5LTO-1, 6LPY==5LZX+1, LPY+5LZX==5LZY+1,
C    3LTN==LZO+2, LTN==NW+1, 3LTO==4LZO-1, N2==128, N2M==127,
C    N2P==129, NWEIG==127, NXXOUT==0, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16}

C
C SET UP ARRAYS ASSOCIATED WITH THE MAPPING FUNCTION:
C
      IF (LMAPP.EQ.1) THEN                                              0061

C  P(N2) {N2==128}

C
C LINEAR MAPPING - EIGENVALUES KNOWN, EIGENFUNCTIONS ARE SIMPLY SINES
C AND COSINES, SO THAT NO MATRICES ARE NEEDED:
C
         F = H/REAL(N2)                                                 0062

C  P() {}

         FZ = PI/H                                                      0063

C  P() {}

         FZSQ = FZ*FZ                                                   0064

C  P() {}

         GMAPP(1) = 0.                                                  0065

C  P() {}

         G(1) = FZ                                                      0066

C  P(I,N2M) {I==130, N2M==127}

         DO 20 I = 1, N2M                                               0067

C  P(I,N2M) {N2M==127, 1<=I, I<=127}

            GMAPP(I+1) = F*REAL(I)                                      0068

C  P(I,N2M) {N2M==127, 1<=I, I<=127}

            G(I+1) = FZ                                                 0069

C  P(I,N2M) {N2M==127, 1<=I, I<=127}

            EVAL(I) = -REAL(I)**2*FZSQ                                  0070

C  P(N2M) {N2M==127}

20          CONTINUE                                                    0071

C  P(N2P) {N2P==129}

         GMAPP(N2P) = H                                                 0072

C  P(N2P) {N2P==129}

         G(N2P) = FZ                                                    0073

C  P(LEIG,MEMSIZ,NWEIG) {LARGE==4LPN+123, LEIG==8LTN-7, LPN==2LTN-1,
C    2LPN==LTO+1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7, 4LPY==5LTO-1,
C    4LPY+LTO==4LZX+1, 3LTN==LZO+2, LTN==NW+1, LTO+4LZX==4LZY+1,
C    NWEIG==127, NXXOUT==0, LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5,
C    16NWQ+1<=LTO, LTO<=16NWQ+13}

         CALL OUT(EVAL, LEIG, NWEIG)                                    0074
C
      ENDIF

C  P(KDATA,LPN,LTN,MEMSIZ,N1,N2P,NXXOUT) {KDATA==1, 5LARGE==8LPY+627,
C    LARGE==8LTN+119, LARGE==MEMSIZ, LEIG==8LTN-7, 5LPN==2LPY+3,
C    2LPN==LTO+1, LPRESS==8LTN-7, 3LTN==LZO+2, LTN==NW+1, 2LZO==LZX+1,
C    LZO+3LZX==3LZY+1, N1==128, N2P==129, NXXOUT==1, 1<=LZO,
C    LZO<=61870, 6NWH+1<=LZO, LZO<=6NWH+4, 12NWQ+1<=LZO,
C    LZO<=12NWQ+10}

C
C READ THE DATA:
C
      IF (KDATA.EQ.1.OR.KDATA.EQ.2) CALL DATAST(A, N2P, N1, GMAPP)      0075

C  P() {}

      FX = 2.0*PI/BOXX                                                  0077

C  P() {}

      FX2 = 2.*FX                                                       0078

C  P(I,KDATA,LPN,LZN,MEMSIZ,N1,N1H,N2,N2P,N2PD,NMAX2,NUMBER,NW,NXXOUT)
C    {I==128, KDATA==1, LARGE==4LPN+123, LEIG==8LTN-7, 5LPN==2LPY+3,
C    LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7, 4LPY==5LTO-1,
C    3LTN==LZO+2, LTN==NW+1, LZN==1, 2LZO==LZX+1, LZO+3LZX==3LZY+1,
C    N1==128, N1H==64, N2==128, N2P==129, N2PD==258, NFTVMT==0,
C    NUMBER==250, NXACAC==0, NXLOG2==0, NXSHUF==0, NXXOUT==3,
C    NXXRCS==0, NXXXIN==0, 1<=LZO, LZO<=61870, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10, 256<=NMAX2}

C
C PREPARE THE INPUT FOR PROCESSING:
C
      IF (KDATA.EQ.1) THEN                                              0079

C  P(LPN,MEMSIZ,NW) {LARGE==4LPN+123, LEIG==8LTN-7, LPN==2LTN-1,
C    2LPN==LTO+1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7, 4LPY==5LTO-1,
C    3LTN==LZO+2, LTN==NW+1, 3LTO==2LZX+1, 7LTO==4LZY+3, NXXXIN==0,
C    1<=LTO, LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO,
C    LTO<=16NWQ+13}

C
C THE INPUT WAS STREAMFUNCTION IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER SPACE:
C
         CALL IN(A, LPN, NW)                                            0080

C  P(N1,N2P) {N1==128, N2P==129, NXSHUF==0}

         CALL SHUF(A, N2P, N1, WORK)                                    0081

C  P(N1) {N1==128}

         NPTS = N1                                                      0082

C  P(N2P) {N2P==129}

         NSKIP = N2P                                                    0083

C  P(N2P) {N2P==129}

         MTRN = N2P                                                     0084

C  P() {}

         MSKIP = 1                                                      0085

C  P() {}

         ISIGN = -1                                                     0086

C  P(NPTS) {NPTS==128, NXLOG2==0}

         CALL XLOG2(NPTS, LOG)                                          0087

C  P(NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0088

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NPTS,NSKIP,NUMBER) {ISIGN==-1,
C    MSKIP==1, MTRN==129, NFTVMT==0, NPTS==128, NSKIP==129,
C    NUMBER==250, NXXRCS==0}

         CALL RCS(A, EX)                                                0089

C  P(N2,NPTS) {N2==128, NPTS==128}

         NPTS = 2*N2                                                    0090

C  P(NSKIP) {NSKIP==129}

         NSKIP = 1                                                      0091

C  P(MTRN,N1H) {MTRN==129, N1H==64}

         MTRN = N1H                                                     0092

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

         MSKIP = N2P                                                    0093

C  P(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0094

C  P(LOG,NPTS,NXLOG2) {NPTS==256, NXLOG2==1}

         CALL XLOG2(NPTS, LOG)                                          0095

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0096

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER) {ISIGN==-1,
C    MSKIP==129, MTRN==64, NFTVMT==1, NPTS==256, NSKIP==1,
C    NUMBER==250, NXACAC==0}

         CALL ACAC(A, EX, WORK)                                         0097

C  P(N1,N2) {N1==128, N2==128}

C           F = 0.125/REAL(N1*N2)
         F = 0.0625/REAL(N1*N2)                                         0098

C  P(I,N1H,N2PD) {I==128, N1H==64, N2PD==258}

         DO 30 J = 1, N1H                                               0099

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

            DO 40 I = 1, N2PD                                           0100

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

               A(I,J) = A(I,J)*F                                        0101

C  P(N1H,N2PD) {N1H==64, N2PD==258}

40             CONTINUE                                                 0102

C  P(N1H) {N1H==64}

30          CONTINUE                                                    0103

C  P(LPN,MEMSIZ,NW,NXXOUT) {LARGE==4LPN+123, LEIG==8LTN-7,
C    LPN==2LTN-1, 2LPN==LTO+1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    4LPY==5LTO-1, 3LTN==LZO+2, LTN==NW+1, 3LTO==2LZX+1, 7LTO==4LZY+3,
C    NXXOUT==3, 5<=LTO, LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5,
C    16NWQ+1<=LTO, LTO<=16NWQ+13}

         CALL OUT(A, LPN, NW)                                           0104

C  P(LZN,MEMSIZ,NW,NXXOUT) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, LZN==1,
C    7LZX==6LZY+1, NXXOUT==4, 4<=LZO, LZO<=61870, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10}

         CALL OUT(A, LZN, NW)                                           0105
      ENDIF

C  P(I,IEXSHF,ISIGN,J,KDATA,LEIG,LOG,LTN,LTO,LZN,LZO,MEMSIZ,MSKIP,
C    MTRN,N1,N1H,N2,N2M,N2P,N2PD,NFTVMT,NMAX2,NOTEMP,NPTS,NSKIP,
C    NUMBER,NW,NWEIG,NXACAC,NXLOG2,NXSHUF,NXXOUT,NXXRCS,NXXXIN)
C    {I==259, ISIGN==-1, J==65, KDATA==1, LARGE==4LPN+123,
C    LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123,
C    LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1,
C    7LTO==4LZY+3, LZN==1, 7LZX==6LZY+1, MSKIP==129, MTRN==64,
C    N1==128, N1H==64, N2==128, N2M==127, N2P==129, N2PD==258,
C    NFTVMT==2, NOTEMP==0, NPTS==256, NSKIP==1, NUMBER==250,
C    NWEIG==127, NXACAC==1, NXLOG2==2, NXSHUF==1, NXXOUT==5,
C    NXXRCS==1, NXXXIN==1, 4<=LZO, LZO<=61870, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10, 256<=NMAX2}

C
CC*****C H E C K   F O U R I E R   C O E F F I C I E N T S**************
C
C         WRITE (6,7010) A(1,1),A(1,2),A(1,3)
C         WRITE (6,7020) A(2,1),A(2,2),A(2,3)
C         WRITE (6,7030) A(3,1),A(3,2),A(3,3)
C 7010    FORMAT(/2X,26HCHECK FOURIER COEFFICIENTS/4X,8HA(1,1) =,1PE13.6
C     1   2X,8HA(1,2) =,1PE13.6,2X,8HA(1,3) =,1PE13.6)
C 7020    FORMAT(4X,8HA(2,1) =,1PE13.6,2X,8HA(2,2) =,1PE13.6,2X,
C     1   8HA(2,3) =,1PE13.6)
C 7030    FORMAT(4X,8HA(3,1) =,1PE13.6,2X,8HA(3,2) =,1PE13.6,2X,
C     1   8HA(3,3) =,1PE13.6/)
C
C
      IF (KDATA.NE.3) THEN                                              0106

C  P(LEIG,MEMSIZ,NWEIG,NXXXIN) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1,
C    NWEIG==127, NXXXIN==1, 4<=LZO, LZO<=61870, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10}

C                                                     2
C STREAMFUNCTION KNOWN - FIND THE VORTICITY:  Z =  DEL  (PSI):
C
         CALL IN(EVAL, LEIG, NWEIG)                                     0107

C  P(LZN) {LZN==1}

         KZN = LZN                                                      0108

C  P(N2M) {N2M==127}

         LVECT = N2M                                                    0109

C  P() {}

         LSKIP = 2                                                      0110

C  P() {}

         NVECT = 2                                                      0111

C  P() {}

         NVSKIP = 1                                                     0112

C  P(I,J,KZN,MEMSIZ,N1H,N2,N2P,N2PD,NXXOUT,NXXXIN) {I==259, J==65,
C    KZN==1, LARGE==4LPN+123, LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1,
C    4LPN==MEMSIZ-123, LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1, N1H==64, N2==128,
C    N2P==129, N2PD==258, NXXOUT==5, NXXXIN==2, 4<=LZO, LZO<=61870,
C    6NWH+1<=LZO, LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10}

         DO 50 J = 1, N1H                                               0113

C  P(KZN,MEMSIZ,N1H,N2PD,NXXXIN) {J==NXXOUT-4, J==NXXXIN-1,
C    LARGE==4LPN+123, LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1,
C    4LPN==MEMSIZ-123, LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1, N1H==64, N2PD==258, 1<=J,
C    J<=64, J<=KZN, 4<=LZO, LZO<=61870, 6NWH+1<=LZO, LZO<=6NWH+4,
C    12NWQ+1<=LZO, LZO<=12NWQ+10}

            CALL IN(CWORK, KZN, N2PD)                                   0114

C  P(J,N1H) {J==NXXOUT-4, J==NXXXIN-2, LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1,
C    N1H==64, 1<=J, J<=64, J<=KZN, 1<=KZN, KZN+132<=2LTO, 5<=LTO,
C    LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO,
C    LTO<=16NWQ+13}

            F = REAL((J-1)*(J-1))*FX*FX                                 0115

C  P(I,N1H,N2) {N1H==64, N2==128}

            DO 60 I = 2, N2                                             0116

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

               CWORK(I) = (EVAL(I-1)-F)*CWORK(I)                        0117

C  P(N1H,N2) {N1H==64, N2==128}

60             CONTINUE                                                 0118

C  P(N1H) {N1H==64}

            CWORK(1) = -F*CWORK(1)                                      0119

C  P(N1H,N2P) {N1H==64, N2P==129}

            CWORK(N2P) = 0.0                                            0120

C  P(KZN,MEMSIZ,N1H,N2PD,NXXOUT) {J==NXXOUT-4, J==NXXXIN-2,
C    LARGE==4LPN+123, LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1,
C    4LPN==MEMSIZ-123, LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1, N1H==64, N2PD==258, 1<=J,
C    J<=64, J<=KZN, 1<=KZN, KZN+132<=2LTO, 5<=LTO, LTO<=82493,
C    8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

            CALL OUT(CWORK, KZN, N2PD)                                  0121

C  P(KZN,N1H,N2PD) {J==NXXOUT-5, J==NXXXIN-2, LARGE==4LPN+123,
C    LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123,
C    LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1,
C    7LTO==4LZY+3, 7LZX==6LZY+1, N1H==64, N2PD==258, 1<=J, J<=64,
C    J<=KZN, 1<=KZN, 3KZN+398<=8LZO, 4<=LZO, LZO<=61870, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10}

            KZN = KZN+N2PD                                              0122

C  P(N1H) {N1H==64}

50          CONTINUE                                                    0123

C  P(N2,NPTS) {N2==128, NPTS==256}

         NPTS = 2*N2                                                    0124

C  P(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0125

C  P(MTRN,N1H) {MTRN==64, N1H==64}

         MTRN = N1H                                                     0126

C  P(MSKIP,N2P) {MSKIP==129, N2P==129}

         MSKIP = N2P                                                    0127

C  P(ISIGN) {ISIGN==-1}

         ISIGN = 1                                                      0128

C  P(LOG,NPTS,NXLOG2) {NPTS==256, NXLOG2==2}

         CALL XLOG2(NPTS, LOG)                                          0129

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0130

C  P(LZN,MEMSIZ,NW,NXXXIN) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, LZN==1,
C    7LZX==6LZY+1, NXXXIN==66, 322<=KZN, 3KZN<=8LZO+376, 4<=LZO,
C    LZO<=61870, 6NWH+1<=LZO, LZO<=6NWH+4, 12NWQ+1<=LZO,
C    LZO<=12NWQ+10}

         CALL IN(A, LZN, NW)                                            0131

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXACAC)
C    {ISIGN==1, MSKIP==129, MTRN==64, NFTVMT==2, NPTS==256, NSKIP==1,
C    NUMBER==250, NXACAC==1}

         CALL ACAC(A, EX, WORK)                                         0132

C  P(I,J,N1H,N2PD) {I==129, J==65, N1H==64, N2PD==258}

         DO 70 J = 1, N1H                                               0133

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

            DO 80 I = 1, N2PD                                           0134

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

               A(I,J) = 0.5*A(I,J)                                      0135

C  P(N1H,N2PD) {N1H==64, N2PD==258}

80             CONTINUE                                                 0136

C  P(N1H) {N1H==64}

70          CONTINUE                                                    0137

C  P(LZO,MEMSIZ,NW,NXXOUT) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1,
C    NXXOUT==69, 322<=KZN, KZN<=2LTO+126, 5<=LTO, LTO<=82493,
C    8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

         CALL OUT(A, LZO, NW)                                           0138

C  P(I,IEXSHF,ISIGN,J,KDATA,LOG,LTN,LTO,MEMSIZ,MSKIP,MTRN,N1,N1H,N2,
C    N2P,N2PD,NFTVMT,NMAX2,NOTEMP,NPTS,NSKIP,NUMBER,NW,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN) {I==259, ISIGN==1, J==65, KDATA==1,
C    LARGE==4LPN+123, LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1,
C    4LPN==MEMSIZ-123, LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1, MSKIP==129, MTRN==64,
C    N1==128, N1H==64, N2==128, N2P==129, N2PD==258, NFTVMT==3,
C    NOTEMP==0, NPTS==256, NSKIP==1, NUMBER==250, NXACAC==2,
C    NXLOG2==3, NXSHUF==1, NXXOUT==70, NXXRCS==1, NXXXIN==67,
C    322<=KZN, 3KZN<=8LZO+376, 4<=LZO, LZO<=61870, 6NWH+1<=LZO,
C    LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10, 256<=NMAX2}

         IF (NOTEMP.NE.1) THEN                                          0139

C  P(I,IEXSHF,ISIGN,J,KDATA,LOG,LTN,LTO,MEMSIZ,MSKIP,MTRN,N1,N1H,N2,
C    N2P,N2PD,NFTVMT,NMAX2,NPTS,NSKIP,NUMBER,NW,NXACAC,NXLOG2,NXSHUF,
C    NXXOUT,NXXRCS,NXXXIN) {I==259, ISIGN==1, J==65, KDATA==1,
C    LARGE==4LPN+123, LEIG==8LTN-7, 5LPN==2LPY+3, LPN==2LTN-1,
C    4LPN==MEMSIZ-123, LPRESS==8LTN-7, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1, MSKIP==129, MTRN==64,
C    N1==128, N1H==64, N2==128, N2P==129, N2PD==258, NFTVMT==3,
C    NPTS==256, NSKIP==1, NUMBER==250, NXACAC==2, NXLOG2==3,
C    NXSHUF==1, NXXOUT==70, NXXRCS==1, NXXXIN==67, 322<=KZN,
C    3KZN<=8LZO+376, 4<=LZO, LZO<=61870, 6NWH+1<=LZO, LZO<=6NWH+4,
C    12NWQ+1<=LZO, LZO<=12NWQ+10, 256<=NMAX2}

            IF (KDATA.NE.1) THEN                                        0140

C  P(LTN,MEMSIZ,NW,NXXXIN) {0==-1}

               CALL IN(A, LTN, NW)                                      0141

C  P(N2,NPTS) {0==-1}

C
C NEW TEMPERATURE KNOWN - SET UP T(OLD):
C
               NPTS = 2*N2                                              0142

C  P(NSKIP) {0==-1}

               NSKIP = 1                                                0143

C  P(MTRN,N1H) {0==-1}

               MTRN = N1H                                               0144

C  P(MSKIP,N2P) {0==-1}

               MSKIP = N2P                                              0145

C  P(ISIGN) {0==-1}

               ISIGN = 1                                                0146

C  P(LOG,NPTS,NXLOG2) {0==-1}

               CALL XLOG2(NPTS, LOG)                                    0147

C  P(IEXSHF,NMAX2,NPTS) {0==-1}

               IEXSHF = NMAX2/NPTS                                      0148

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXACAC)
C    {0==-1}

               CALL ACAC(A, EX, WORK)                                   0149

C  P(I,J,N1H,N2PD) {0==-1}

               DO 90 J = 1, N1H                                         0150

C  P() {0==-1}

                  DO 100 I = 1, N2PD                                    0151

C  P() {0==-1}

                     A(I,J) = A(I,J)*0.5                                0152

C  P() {0==-1}

100                  CONTINUE                                           0153

C  P() {0==-1}

90                CONTINUE                                              0154

C  P(LTO,MEMSIZ,NW,NXXOUT) {0==-1}

               CALL OUT(A, LTO, NW)                                     0155

            ELSE

C  P(LTN,MEMSIZ,NW,NXXXIN) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1,
C    NXXXIN==67, 322<=KZN, KZN<=2LTO+126, 5<=LTO, LTO<=82493,
C    8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

C
C TEMPERATURE IS SUPPLIED IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER REPRESENTATION:
C
               CALL IN(A, LTN, NW)                                      0156

C  P(N1,N2P,NXSHUF) {N1==128, N2P==129, NXSHUF==1}

               CALL SHUF(A, N2P, N1, WORK)                              0157

C  P(N1,NPTS) {N1==128, NPTS==256}

               NPTS = N1                                                0158

C  P(N2P,NSKIP) {N2P==129, NSKIP==1}

               NSKIP = N2P                                              0159

C  P(MTRN,N2P) {MTRN==64, N2P==129}

               MTRN = N2P                                               0160

C  P(MSKIP) {MSKIP==129}

               MSKIP = 1                                                0161

C  P(ISIGN) {ISIGN==1}

               ISIGN = -1                                               0162

C  P(LOG,NPTS,NXLOG2) {NPTS==128, NXLOG2==3}

               CALL XLOG2(NPTS, LOG)                                    0163

C  P(IEXSHF,NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

               IEXSHF = NMAX2/NPTS                                      0164

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXXRCS)
C    {ISIGN==-1, MSKIP==1, MTRN==129, NFTVMT==3, NPTS==128,
C    NSKIP==129, NUMBER==250, NXXRCS==1}

               CALL RCS(A, EX)                                          0165

C  P(N1) {N1==128}

               F = 0.5/REAL(N1)                                         0166

C  P(I,J,N1H,N2PD) {I==259, J==65, N1H==64, N2PD==258}

               DO 110 J = 1, N1H                                        0167

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

                  DO 120 I = 1, N2PD                                    0168

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

                     A(I,J) = F*A(I,J)                                  0169

C  P(N1H,N2PD) {N1H==64, N2PD==258}

120                  CONTINUE                                           0170

C  P(N1H) {N1H==64}

110               CONTINUE                                              0171

C  P(LTO,MEMSIZ,NW,NXXOUT) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1,
C    NXXOUT==70, 322<=KZN, KZN<=2LTO+126, 5<=LTO, LTO<=82493,
C    8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

               CALL OUT(A, LTO, NW)                                     0172

C  P(N2,NPTS) {N2==128, NPTS==128}

               NPTS = 2*N2                                              0173

C  P(NSKIP) {NSKIP==129}

               NSKIP = 1                                                0174

C  P(MTRN,N1H) {MTRN==129, N1H==64}

               MTRN = N1H                                               0175

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

               MSKIP = N2P                                              0176

C  P(ISIGN) {ISIGN==-1}

               ISIGN = -1                                               0177

C  P(LOG,NPTS,NXLOG2) {NPTS==256, NXLOG2==4}

               CALL XLOG2(NPTS, LOG)                                    0178

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

               IEXSHF = NMAX2/NPTS                                      0179

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXACAC)
C    {ISIGN==-1, MSKIP==129, MTRN==64, NFTVMT==4, NPTS==256, NSKIP==1,
C    NUMBER==250, NXACAC==2}

               CALL ACAC(A, EX, WORK)                                   0180

C  P(N2) {N2==128}

C           F = 0.25/REAL(N2)
               F = 0.125/REAL(N2)                                       0181

C  P(I,J,N1H,N2PD) {I==259, J==65, N1H==64, N2PD==258}

               DO 130 J = 1, N1H                                        0182

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

                  DO 140 I = 1, N2PD                                    0183

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

                     A(I,J) = F*A(I,J)                                  0184

C  P(N1H,N2PD) {N1H==64, N2PD==258}

140                  CONTINUE                                           0185

C  P(N1H) {N1H==64}

130               CONTINUE                                              0186

C  P(LTN,MEMSIZ,NW,NXXOUT) {LARGE==4LPN+123, LEIG==8LTN-7,
C    5LPN==2LPY+3, LPN==2LTN-1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, 3LTN==LZO+2, LTN==NW+1, 7LTO==4LZY+3, 7LZX==6LZY+1,
C    NXXOUT==71, 322<=KZN, 3KZN<=8LZO+376, 4<=LZO, LZO<=61870,
C    6NWH+1<=LZO, LZO<=6NWH+4, 12NWQ+1<=LZO, LZO<=12NWQ+10}

               CALL OUT(A, LTN, NW)                                     0187
            ENDIF

         ENDIF

C  P() {}


         T = 0.                                                         0188

C  P() {}

         DTT = DT                                                       0189

C  P() {}

         NSTEPS = 1                                                     0190
      ENDIF

C  P(KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,KVF,KVP,KZF,
C    KZP,LMAPP,N1,N2,NOALS,NOTEMP,NSTEPS,NUMBER) {KDATA==1, KPF==1,
C    KPP==249, KPRESS==1, KSM==1, KTA==50, KTAPE==0, KTF==1, KTP==50,
C    KUF==1, KUP==249, KVF==1, KVP==249, KZF==1, KZP==249, LMAPP==1,
C    N1==128, N2==128, NOALS==1, NOTEMP==0, NSTEPS==1, NUMBER==250}


      CALL RUNINF                                                       0191

C  P() {NUM1==1}

      CALL BUG('AFT INITAL')                                            0192

C  P() {}


C#
c      IF (.TRUE.) THEN    
150   CONTINUE                                                          0193

C  P(KTF,LTN,MEMSIZ,N1H,N2P,NOTEMP,NSTEPS,NUMBER,NXXXIN) {KTF==1,
C    LARGE==4LPN+123, LEIG==8LTN-7, 3LEIG==8LZO-5, 5LPN==2LPY+3,
C    LPN==2LTN-1, 2LPN==LTO+1, 4LPN==MEMSIZ-123, LPRESS==8LTN-7,
C    6LPY==5LZX+1, LZO==3NW+1, 7LZX==6LZY+1, N1H==64, N2P==129,
C    NOTEMP==0, NUMBER==250, LZY<=144362, 14NWH+1<=LZY, LZY<=14NWH+8,
C    28NWQ+1<=LZY, LZY<=28NWQ+22, NSTEPS<=250, 1<=NWQ}

C
C THIS IS THE BEGINNING OF THE TIME STEP.
C
      IF (MOD(NSTEPS, KTF).EQ.1.AND.NOTEMP.NE.1) CALL TEMPFO(CA, N2P    0194
     &, N1H, CWORK)                                                     0194

C  P(KPF,LPN,MEMSIZ,N1H,N2P,NSTEPS,NUMBER,NXXXIN) {KPF==1,
C    LARGE==8LTN+119, LEIG==4LPN-3, 4LPN==LPRESS+3, LPN==2LTN-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 4LPY==5LTO-1, 6LPY==5LZX+1,
C    8LTN==MEMSIZ-119, LZO==3NW+1, LZY==7NW+1, N1H==64, N2P==129,
C    NUMBER==250, LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7,
C    24NWQ+1<=LZX, LZX<=24NWQ+19, NSTEPS<=250, 1<=NWQ}

      IF (MOD(NSTEPS, KPF).EQ.1) CALL PSIFOU(CA, N2P, N1H, CWORK)       0196

C  P(KZF,LZN,MEMSIZ,N1H,N2P,NSTEPS,NUMBER,NXXXIN) {KZF==1,
C    LARGE==8NW+127, LEIG==4LPN-3, 4LPN==LPRESS+3, 3LPN==LZX+2,
C    7LPN==2LZY+5, LPN==2NW+1, 4LPY==5LTO-1, 3LTN==LZO+2,
C    7LTO==4LZY+3, LZN==1, 7LZO==3LZY+4, MEMSIZ==8NW+127, N1H==64,
C    N2P==129, NUMBER==250, LPY<=103116, 10NWH+1<=LPY, LPY<=10NWH+6,
C    20NWQ+1<=LPY, LPY<=20NWQ+16, NSTEPS<=250, 1<=NWQ}

      IF (MOD(NSTEPS, KZF).EQ.1) CALL ZETAFO(CA, N2P, N1H, CWORK)       0198

C  P(KVF,LPN,MEMSIZ,N1H,N2P,NSTEPS,NUMBER,NXXXIN) {KVF==1,
C    LARGE==4LPN+123, LEIG==4LPN-3, LEIG==8LTN-7, LEIG==2LTO-1,
C    4LPN==LPRESS+3, 4LPN==MEMSIZ-123, LPY==5LTN-4, 6LTN==LZX+5,
C    7LTN==LZY+6, 7LZO==3LZY+4, LZO==3NW+1, N1H==64, N2P==129,
C    NUMBER==250, LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO,
C    LTO<=16NWQ+13, NSTEPS<=250, 1<=NWQ}

      IF (MOD(NSTEPS, KVF).EQ.1) CALL VVELFO(CA, N2P, N1H, FX, CWORK)   0200

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KTA,KTN,KTO,KZN,KZO,LOG,LTN,LTO,LZN,
C    LZO,MEMSIZ,MSKIP,MTRN,N1H,N1Q,N2,N2P,N2PD,NFTVMT,NMAX2,NOTEMP,
C    NPTS,NSKIP,NSTEPS,NUMBER,NW,NWH,NXACAC,NXLOG2,NXXOUT,NXXXIN)
C    {ISIGN==-1, K2QM==32, KTA==50, LARGE==8LTN+119, LEIG==8LTN-7,
C    2LPN==LTO+1, LPN==2NW+1, LPRESS==8LTN-7, LPY==5NW+1, 3LTN==LZO+2,
C    8LTN==MEMSIZ-119, LZN==1, 7LZO==3LZY+4, LZX==6NW+1, LZY==7NW+1,
C    MSKIP==129, MTRN==64, N1H==64, N1Q==32, N2==128, N2P==129,
C    N2PD==258, NOTEMP==0, NPTS==256, NSKIP==1, NUMBER==250, 65<=KZN,
C    256<=NMAX2, NSTEPS<=250, NW<=20623, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

      IF (MOD(NSTEPS+1, KTA).EQ.1) THEN                                 0202

C  P() {}

C
C TIME AVERAGE VORTICITY:
C
         DTT = DT                                                       0203

C  P() {}

         T = T-0.5*DT                                                   0204

C  P(LZO,MEMSIZ,NW,NXXXIN) {LARGE==LEIG+126, LEIG==LPRESS,
C    3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1, 3LPN==LZX+2,
C    LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1, LZY==7NW+1,
C    LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG,
C    LEIG<=32NWQ+25, 1<=NWQ}

         CALL IN(A, LZO, NW)                                            0205

C  P(N2,NPTS) {N2==128, NPTS==256}

         NPTS = 2*N2                                                    0206

C  P(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0207

C  P(MTRN,N1H) {MTRN==64, N1H==64}

         MTRN = N1H                                                     0208

C  P(MSKIP,N2P) {MSKIP==129, N2P==129}

         MSKIP = N2P                                                    0209

C  P(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0210

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0211

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

         CALL XLOG2(NPTS, LOG)                                          0212

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250, NSTEPS<=250}

         CALL ACAC(A, EX, WORK)                                         0213

C  P(N2) {N2==128}

         F = 0.125/REAL(N2)                                             0214

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258}

         DO 160 J = 1, N1H                                              0215

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

            DO 170 I = 1, N2PD                                          0216

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

               A(I,J) = A(I,J)*F                                        0217

C  P(N1H,N2PD) {N1H==64, N2PD==258}

170            CONTINUE                                                 0218

C  P(N1H) {N1H==64}

160         CONTINUE                                                    0219

C  P(LZO,MEMSIZ,NW,NXXOUT) {LARGE==LEIG+126, 3LEIG==8LZO-5,
C    LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5, LPRESS==8NW+1,
C    LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1, LZY==7NW+1, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

         CALL OUT(A, LZO, NW)                                           0220

C  P(ISIGN) {ISIGN==-1}

         ISIGN = 1                                                      0221

C  P(MTRN,N1Q) {MTRN==64, N1Q==32}

         MTRN = N1Q                                                     0222

C  P(KZN,LZN) {LZN==1, 65<=KZN}

         KZN = LZN                                                      0223

C  P(KZO,LZO) {LARGE==LEIG+126, 3LEIG==8LZO-5, LEIG==MEMSIZ-126,
C    LPN==2NW+1, 3LPRESS==8LZO-5, LPRESS==8NW+1, LPY==5NW+1,
C    LTN==NW+1, LTO==4NW+1, LZX==6NW+1, LZY==7NW+1, 1<=NW, NW<=20623,
C    2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

         KZO = LZO                                                      0224

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KZN,KZO,LOG,MEMSIZ,MSKIP,MTRN,N1Q,
C    N2PD,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,NWH,NXACAC,NXXOUT,NXXXIN)
C    {I==259, ISIGN==1, J==65, K2QM==32, KZN==1, KZO==LZO,
C    LARGE==LEIG+126, LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126,
C    LPN==2LTN-1, 3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3,
C    LZO==3NW+1, LZY==7NW+1, MSKIP==129, MTRN==32, N1Q==32, N2PD==258,
C    NPTS==256, NSKIP==1, NUMBER==250, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25,
C    NSTEPS<=250, 1<=NWQ}

         DO 180 K = 1, 2                                                0225

C  P(KZO,MEMSIZ,NWH,NXXXIN) {8KZN+3LEIG==8KZO+3, LARGE==LEIG+126,
C    LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1,
C    3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1,
C    LZY==7NW+1, 1<=K, K<=2, K<=KZN, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25,
C    1<=NWQ}

            CALL IN(A, KZO, NWH)                                        0226

C  P(KZN,MEMSIZ,NWH,NXXXIN) {KZN+3NW==KZO, LARGE==LEIG+126,
C    3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5,
C    LPRESS==8NW+1, LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1,
C    LZY==7NW+1, 1<=K, K<=2, K<=KZN, 1<=KZO, KZO+NWH<=8NW+128, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWH,
C    1<=NWQ}

            CALL IN(A(1,K2Q), KZN, NWH)                                 0227

C  P(I,J,K2QJ,K2QM,N1Q,N2PD) {K2QM==32, N1Q==32, N2PD==258}

            DO 190 J = 1, N1Q                                           0228

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

               K2QJ = J+K2QM                                            0229

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 33<=K2QJ,
C    K2QJ<=64}

               DO 200 I = 1, N2PD                                       0230

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 1<=I, I<=258,
C    33<=K2QJ, K2QJ<=64}

                  A(I,J) = A(I,J)+0.5*A(I,K2QJ)                         0231

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

200               CONTINUE                                              0232

C  P(N1Q) {N1Q==32}

190            CONTINUE                                                 0233

C  P(KZN,MEMSIZ,NWH,NXXOUT) {8KZN+3LEIG==8KZO+3, LARGE==LEIG+126,
C    LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1,
C    3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1,
C    LZY==7NW+1, 1<=K, K<=2, K<=KZN, 1<=KZN, KZN+NWH<=LEIG+127,
C    1<=KZO, KZO+NWH<=LEIG+127, 9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG,
C    LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25, 1<=NWH, 1<=NWQ}

            CALL OUT(A, KZN, NWH)                                       0234

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==32, NPTS==256, NSKIP==1,
C    NUMBER==250, NSTEPS<=250}

            CALL ACAC(A, EX, WORK)                                      0235

C  P(I,J,N1Q,N2PD) {I==259, J==33, N1Q==32, N2PD==258}

            DO 210 J = 1, N1Q                                           0236

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=J, J<=32}

               DO 220 I = 1, N2PD                                       0237

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=I, I<=258, 1<=J, J<=32}

                  A(I,J) = 0.5*A(I,J)                                   0238

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

220               CONTINUE                                              0239

C  P(N1Q) {N1Q==32}

210            CONTINUE                                                 0240

C  P(KZO,MEMSIZ,NWH,NXXOUT) {KZN+3NW==KZO, LARGE==LEIG+126,
C    3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5,
C    LPRESS==8NW+1, LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1,
C    LZY==7NW+1, 1<=K, K<=2, K<=KZN, 1<=KZN, KZN+NWH<=8NW+128, 1<=KZO,
C    KZO+NWH<=8NW+128, 1<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3, 1<=NWH, 1<=NWQ}

            CALL OUT(A, KZO, NWH)                                       0241

C  P(KZO,NWH) {8KZN+3LEIG==8KZO+3, LARGE==LEIG+126, LEIG==LPRESS,
C    3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1, 3LPN==LZX+2,
C    LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1, LZY==7NW+1,
C    1<=K, K<=2, K<=KZN, 1<=KZN, KZN+NWH<=LEIG+127, 1<=KZO,
C    KZO+NWH<=LEIG+127, 9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG,
C    LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25, 1<=NWH, 1<=NWQ}

            KZO = KZO+NWH                                               0242

C  P(KZN,NWH) {KZN+3NW+NWH==KZO, LARGE==LEIG+126, 3LEIG==8LZO-5,
C    LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5, LPRESS==8NW+1,
C    LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1, LZY==7NW+1, 1<=K,
C    K<=2, K<=KZN, 1<=KZN, KZN+NWH<=8NW+128, KZO<=8NW+128, NWH+1<=KZO,
C    1<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3,
C    1<=NWH, 1<=NWQ}

            KZN = KZN+NWH                                               0243

C  P() {}

180         CONTINUE                                                    0244

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KTN,KTO,LOG,LTN,LTO,MEMSIZ,MSKIP,
C    MTRN,N1H,N1Q,N2,N2PD,NFTVMT,NOTEMP,NPTS,NSKIP,NSTEPS,NUMBER,NW,
C    NWH,NXACAC,NXXOUT,NXXXIN) {I==259, ISIGN==1, J==33, K==3,
C    K2QJ==64, K2QM==32, 8KZN+3LEIG==8KZO+3, LARGE==LEIG+126,
C    LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1,
C    3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1,
C    LZY==7NW+1, MSKIP==129, MTRN==32, N1H==64, N1Q==32, N2==128,
C    N2PD==258, NOTEMP==0, NPTS==256, NSKIP==1, NUMBER==250,
C    KZN<=LEIG+127, NWH+2<=KZN, KZO<=LEIG+127, NWH+1<=KZO, 9<=LEIG,
C    LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG,
C    LEIG<=32NWQ+25, NSTEPS<=250, 1<=NWH, 1<=NWQ}

         IF (NOTEMP.NE.1) THEN                                          0245

C  P(ISIGN) {ISIGN==1}

C
C TIME AVERAGE TEMPERATURE:
C
            ISIGN = -1                                                  0246

C  P(MTRN,N1H) {MTRN==32, N1H==64}

            MTRN = N1H                                                  0247

C  P(LTO,MEMSIZ,NW,NXXXIN) {8KZN+3LEIG==8KZO+3, LARGE==LEIG+126,
C    LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1,
C    3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1,
C    LZY==7NW+1, KZN<=LEIG+127, NWH+2<=KZN, KZO<=LEIG+127, NWH+1<=KZO,
C    9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9,
C    32NWQ+1<=LEIG, LEIG<=32NWQ+25, 1<=NWH, 1<=NWQ}

            CALL IN(A, LTO, NW)                                         0248

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250, NSTEPS<=250}

            CALL ACAC(A, EX, WORK)                                      0249

C  P(N2) {N2==128}

            F = 0.125/REAL(N2)                                          0250

C  P(I,J,N1H,N2PD) {I==259, J==33, N1H==64, N2PD==258}

            DO 230 J = 1, N1H                                           0251

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

               DO 240 I = 1, N2PD                                       0252

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

                  A(I,J) = F*A(I,J)                                     0253

C  P(N1H,N2PD) {N1H==64, N2PD==258}

240               CONTINUE                                              0254

C  P(N1H) {N1H==64}

230            CONTINUE                                                 0255

C  P(LTO,MEMSIZ,NW,NXXOUT) {8KZN+3LEIG==8KZO+3, LARGE==LEIG+126,
C    LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1,
C    3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1,
C    LZY==7NW+1, KZN<=LEIG+127, NWH+2<=KZN, KZO<=LEIG+127, NWH+1<=KZO,
C    9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9,
C    32NWQ+1<=LEIG, LEIG<=32NWQ+25, 1<=NWH, 1<=NWQ}

            CALL OUT(A, LTO, NW)                                        0256

C  P(ISIGN) {ISIGN==-1}

            ISIGN = 1                                                   0257

C  P(MTRN,N1Q) {MTRN==64, N1Q==32}

            MTRN = N1Q                                                  0258

C  P(KTO,LTO) {KZN+3NW==KZO, LARGE==LEIG+126, 3LEIG==8LZO-5,
C    LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5, LPRESS==8NW+1,
C    LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1, LZY==7NW+1,
C    KZN<=8NW+128, NWH+2<=KZN, KZO<=8NW+128, NWH+1<=KZO, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWH,
C    1<=NWQ}

            KTO = LTO                                                   0259

C  P(KTN,LTN) {KTO==LTO, 8KZN+3LEIG==8KZO+3, LARGE==LEIG+126,
C    LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2LTN-1,
C    3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3, LZO==3NW+1,
C    LZY==7NW+1, KZN<=LEIG+127, NWH+2<=KZN, KZO<=LEIG+127, NWH+1<=KZO,
C    9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9,
C    32NWQ+1<=LEIG, LEIG<=32NWQ+25, 1<=NWH, 1<=NWQ}

            KTN = LTN                                                   0260

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KTN,KTO,LOG,MEMSIZ,MSKIP,MTRN,N1Q,
C    N2PD,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,NWH,NXACAC,NXXOUT,NXXXIN)
C    {I==259, ISIGN==1, J==65, K==3, K2QJ==64, K2QM==32, KTN==LTN,
C    KTO==4NW+1, KZN+3NW==KZO, LARGE==LEIG+126, 3LEIG==8LZO-5,
C    LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5, LPRESS==8NW+1,
C    LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1, LZY==7NW+1,
C    MSKIP==129, MTRN==32, N1Q==32, N2PD==258, NPTS==256, NSKIP==1,
C    NUMBER==250, KZN<=8NW+128, NWH+2<=KZN, KZO<=8NW+128, NWH+1<=KZO,
C    NSTEPS<=250, 1<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3, 1<=NWH, 1<=NWQ}

            DO 250 K = 1, 2                                             0261

C  P(KTO,MEMSIZ,NWH,NXXXIN) {KTN+3NW==KTO, KZN+3NW==KZO,
C    LARGE==LEIG+126, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2NW+1,
C    3LPRESS==8LZO-5, LPRESS==8NW+1, LPY==5NW+1, LTN==NW+1,
C    LTO==4NW+1, LZX==6NW+1, LZY==7NW+1, 1<=K, K<=2, K+4NW<=KTO,
C    KZN<=8NW+128, NWH+2<=KZN, KZO<=8NW+128, NWH+1<=KZO, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWH,
C    1<=NWQ}

               CALL IN(A, KTO, NWH)                                     0262

C  P(KTN,MEMSIZ,NWH,NXXXIN) {8KTN+3LEIG==8KTO+3, 8KZN+3LEIG==8KZO+3,
C    LARGE==LEIG+126, LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126,
C    LPN==2LTN-1, 3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3,
C    LZO==3NW+1, LZY==7NW+1, 1<=K, K<=2, 2K+LEIG<=2KTO+1, 1<=KTO,
C    KTO+NWH<=LEIG+127, KZN<=LEIG+127, NWH+2<=KZN, KZO<=LEIG+127,
C    NWH+1<=KZO, 9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9,
C    32NWQ+1<=LEIG, LEIG<=32NWQ+25, 1<=NWH, 1<=NWQ}

               CALL IN(A(1,K2Q), KTN, NWH)                              0263

C  P(I,J,K2QJ,K2QM,N1Q,N2PD) {K2QM==32, N1Q==32, N2PD==258}

               DO 260 J = 1, N1Q                                        0264

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

                  K2QJ = J+K2QM                                         0265

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 33<=K2QJ,
C    K2QJ<=64}

                  DO 270 I = 1, N2PD                                    0266

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 1<=I, I<=258,
C    33<=K2QJ, K2QJ<=64}

                     A(I,J) = A(I,J)+0.5*A(I,K2QJ)                      0267

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

270                  CONTINUE                                           0268

C  P(N1Q) {N1Q==32}

260               CONTINUE                                              0269

C  P(KTN,MEMSIZ,NWH,NXXOUT) {KTN+3NW==KTO, KZN+3NW==KZO,
C    LARGE==LEIG+126, 3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2NW+1,
C    3LPRESS==8LZO-5, LPRESS==8NW+1, LPY==5NW+1, LTN==NW+1,
C    LTO==4NW+1, LZX==6NW+1, LZY==7NW+1, 1<=K, K<=2, K+4NW<=KTO,
C    1<=KTN, KTN+NWH<=8NW+128, 1<=KTO, KTO+NWH<=8NW+128, KZN<=8NW+128,
C    NWH+2<=KZN, KZO<=8NW+128, NWH+1<=KZO, 1<=NW, NW<=20623, 2NWH<=NW,
C    NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWH, 1<=NWQ}

               CALL OUT(A, KTN, NWH)                                    0270

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==32, NPTS==256, NSKIP==1,
C    NUMBER==250, NSTEPS<=250}

               CALL ACAC(A, EX, WORK)                                   0271

C  P(I,J,N1Q,N2PD) {I==259, J==33, N1Q==32, N2PD==258}

               DO 280 J = 1, N1Q                                        0272

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=J, J<=32}

                  DO 290 I = 1, N2PD                                    0273

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=I, I<=258, 1<=J, J<=32}

                     A(I,J) = 0.5*A(I,J)                                0274

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

290                  CONTINUE                                           0275

C  P(N1Q) {N1Q==32}

280               CONTINUE                                              0276

C  P(KTO,MEMSIZ,NWH,NXXOUT) {8KTN+3LEIG==8KTO+3, 8KZN+3LEIG==8KZO+3,
C    LARGE==LEIG+126, LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126,
C    LPN==2LTN-1, 3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3,
C    LZO==3NW+1, LZY==7NW+1, 1<=K, K<=2, 2K+LEIG<=2KTO+1, 1<=KTN,
C    KTN+NWH<=LEIG+127, 1<=KTO, KTO+NWH<=LEIG+127, KZN<=LEIG+127,
C    NWH+2<=KZN, KZO<=LEIG+127, NWH+1<=KZO, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25,
C    1<=NWH, 1<=NWQ}

               CALL OUT(A, KTO, NWH)                                    0277

C  P(KTO,NWH) {KTN+3NW==KTO, KZN+3NW==KZO, LARGE==LEIG+126,
C    3LEIG==8LZO-5, LEIG==MEMSIZ-126, LPN==2NW+1, 3LPRESS==8LZO-5,
C    LPRESS==8NW+1, LPY==5NW+1, LTN==NW+1, LTO==4NW+1, LZX==6NW+1,
C    LZY==7NW+1, 1<=K, K<=2, K+4NW<=KTO, 1<=KTN, KTN+NWH<=8NW+128,
C    1<=KTO, KTO+NWH<=8NW+128, KZN<=8NW+128, NWH+2<=KZN, KZO<=8NW+128,
C    NWH+1<=KZO, 1<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3, 1<=NWH, 1<=NWQ}

               KTO = KTO+NWH                                            0278

C  P(KTN,NWH) {8KTN+3LEIG+8NWH==8KTO+3, 8KZN+3LEIG==8KZO+3,
C    LARGE==LEIG+126, LEIG==LPRESS, 3LEIG==8LZO-5, LEIG==MEMSIZ-126,
C    LPN==2LTN-1, 3LPN==LZX+2, LPN==2NW+1, LPY==5NW+1, 4LTN==LTO+3,
C    LZO==3NW+1, LZY==7NW+1, 1<=K, K<=2, 2K+LEIG+2NWH<=2KTO+1, 1<=KTN,
C    KTN+NWH<=LEIG+127, KTO<=LEIG+127, NWH+1<=KTO, KZN<=LEIG+127,
C    NWH+2<=KZN, KZO<=LEIG+127, NWH+1<=KZO, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25,
C    1<=NWH, 1<=NWQ}

               KTN = KTN+NWH                                            0279

C  P() {}

250            CONTINUE                                                 0280
         ENDIF

      ENDIF

C  P(IEXSHF,ISIGN,KPP,LOG,LPN,MEMSIZ,MSKIP,MTRN,N1H,N2P,NFTVMT,NMAX2,
C    NPTS,NSKIP,NSTEPS,NUMBER,NUSHUF,NW,NXACAC,NXLOG2,NXXCSR,NXXXIN)
C    {16ISIGN+MTRN==48, KPP==249, LARGE==LEIG+126, LEIG==LPRESS,
C    LEIG==8LTN-7, LEIG==MEMSIZ-126, LPN==2NW+1, LPY==5NW+1,
C    4LTN==LTO+3, LTN==NW+1, LZO==3NW+1, LZX==6NW+1, LZY==7NW+1,
C    MSKIP==129, N1H==64, N2P==129, NPTS==256, NSKIP==1, NUMBER==250,
C    LEIG+163991<=16KZN+5124MTRN, 61MTRN+32NWH<=32KZN+2LEIG+1822,
C    LEIG+30MTRN<=16KZN+32NWQ+905, 123MTRN<=64KZN+3712,
C    64NWH+656032<=64KZN+20497MTRN, 119MTRN+64NWH<=64KZN+128NWQ+3552,
C    LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG,
C    LEIG<=32NWQ+25, 32<=MTRN, MTRN<=64, 256<=NMAX2, NSTEPS<=250,
C    1<=NWQ}

C
C THE BEGINING OF A NORMAL TIME STEP
C (U IS X VELOCITY AND V IS Y VELOCITY)
C FIND (-U) = D(PSI)/DY
C
C
      IF (NSTEPS.LT.3) THEN                                             0281

C  P(LPN,MEMSIZ,NW,NXXXIN) {16ISIGN+MTRN==48, LARGE==8LTN+119,
C    LEIG==8NW+1, 5LPN==2LPY+3, 3LPN==LZX+2, 7LPN==2LZY+5,
C    LPRESS==8LTN-7, 4LPY==5LTO-1, 3LTN==LZO+2, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 7LZO==3LZY+4, 0<=ISIGN+1, ISIGN<=1,
C    137<=123ISIGN+4KZN, 40992ISIGN+LTO<=8KZN+40981,
C    8NWH+277<=244ISIGN+8KZN+LTO, LTO+267<=240ISIGN+8KZN+16NWQ,
C    20497ISIGN+4NWH<=4KZN+20489, 4NWH+135<=119ISIGN+4KZN+8NWQ,
C    LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO,
C    LTO<=16NWQ+13, 1<=NWQ}

         CALL IN(CA, LPN, NW)                                           0282

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,N1H,N2P,NFTVMT,NMAX2,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NXACAC,NXLOG2,NXXCSR) {16ISIGN+MTRN==48,
C    LARGE==8LTN+119, LEIG==8LTN-7, 5LPN==2LPY+3, 3LPN==LZX+2,
C    7LPN==2LZY+5, LPRESS==8LTN-7, 4LPY==5LTO-1, 3LTN==LZO+2,
C    8LTN==MEMSIZ-119, LTN==NW+1, 7LZO==3LZY+4, MSKIP==129, N1H==64,
C    N2P==129, NPTS==256, NSKIP==1, NUMBER==250,
C    LEIG+163991<=16KZN+5124MTRN, 61MTRN+32NWH<=32KZN+2LEIG+1822,
C    LEIG+30MTRN<=16KZN+32NWQ+905, 123MTRN<=64KZN+3712,
C    64NWH+656032<=64KZN+20497MTRN, 119MTRN+64NWH<=64KZN+128NWQ+3552,
C    9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9,
C    32NWQ+1<=LEIG, LEIG<=32NWQ+25, 32<=MTRN, MTRN<=64, 256<=NMAX2,
C    NSTEPS<=2, 1<=NWQ}

         CALL PSIPHY(CA, N2P, N1H, EX, G, U, WORK, CWORK3, 1)           0283

      ELSE

C  P(LPN,MEMSIZ,NW,NXXXIN) {16ISIGN+MTRN==48, LARGE==8LTN+119,
C    LEIG==8NW+1, 5LPN==2LPY+3, 3LPN==LZX+2, 7LPN==2LZY+5,
C    LPRESS==8LTN-7, 4LPY==5LTO-1, 3LTN==LZO+2, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 7LZO==3LZY+4, 0<=ISIGN+1, ISIGN<=1,
C    137<=123ISIGN+4KZN, 40992ISIGN+LTO<=8KZN+40981,
C    8NWH+277<=244ISIGN+8KZN+LTO, LTO+267<=240ISIGN+8KZN+16NWQ,
C    20497ISIGN+4NWH<=4KZN+20489, 4NWH+135<=119ISIGN+4KZN+8NWQ,
C    LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO,
C    LTO<=16NWQ+13, 1<=NWQ}

         CALL IN(CA, LPN, NW)                                           0284

C  P(IEXSHF,ISIGN,KPP,LOG,MSKIP,MTRN,N1H,N2P,NFTVMT,NMAX2,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NXACAC,NXLOG2,NXXCSR) {16ISIGN+MTRN==48,
C    KPP==249, LARGE==8LTN+119, LEIG==8LTN-7, 5LPN==2LPY+3,
C    3LPN==LZX+2, 7LPN==2LZY+5, LPRESS==8LTN-7, 4LPY==5LTO-1,
C    3LTN==LZO+2, 8LTN==MEMSIZ-119, LTN==NW+1, 7LZO==3LZY+4,
C    MSKIP==129, N1H==64, N2P==129, NPTS==256, NSKIP==1, NUMBER==250,
C    LEIG+163991<=16KZN+5124MTRN, 61MTRN+32NWH<=32KZN+2LEIG+1822,
C    LEIG+30MTRN<=16KZN+32NWQ+905, 123MTRN<=64KZN+3712,
C    64NWH+656032<=64KZN+20497MTRN, 119MTRN+64NWH<=64KZN+128NWQ+3552,
C    9<=LEIG, LEIG<=164985, 16NWH+1<=LEIG, LEIG<=16NWH+9,
C    32NWQ+1<=LEIG, LEIG<=32NWQ+25, 32<=MTRN, MTRN<=64, 256<=NMAX2,
C    3<=NSTEPS, NSTEPS<=250, 1<=NWQ}

         IF (MOD(NSTEPS, KPP).EQ.1) CALL PSIPHY(CA, N2P, N1H, EX, G,    0285
     &   U, WORK, CWORK3, -1)                                           0285
      ENDIF

C  P(N2,NPTS) {N2==128}

C
      NPTS = 2*N2                                                       0287

C  P(NSKIP) {}

      NSKIP = 1                                                         0288

C  P(MTRN,N1H) {N1H==64}

      MTRN = N1H                                                        0289

C  P(MSKIP,N2P) {N2P==129}

      MSKIP = N2P                                                       0290

C  P(ISIGN) {}

      ISIGN = 1                                                         0291

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

      CALL XLOG2(NPTS, LOG)                                             0292

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0293

C  P(LPN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LEIG==8NW+1, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      CALL IN(CA, LPN, NW)                                              0294

C  P() {}

      F = 0.                                                            0295

C  P(I,J,N1H,N2) {N1H==64, N2==128}

      DO 300 I = 1, N2                                                  0296

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128}

         DO 310 J = 1, N1H                                              0297

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0298

C  P(N1H,N2) {N1H==64, N2==128}

310         CONTINUE                                                    0299

C  P(N2) {N2==128}

         F = F+1.                                                       0300

C  P(N2) {N2==128}

300      CONTINUE                                                       0301

C  P(J,N1H,N2P) {J==65, N1H==64, N2P==129}

      DO 320 J = 1, N1H                                                 0302

C  P(J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         CA(N2P,J) = 0.                                                 0303

C  P(N1H) {N1H==64}

320      CONTINUE                                                       0304

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXSCSC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL SCSC(CA, EX, WORK)                                           0305

C  P(LPY,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LEIG==8NW+1, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      CALL OUT(CA, LPY, NW)                                             0306

C  P(KSM,N2P) {KSM==1, N2P==129}

      IF (KSM.EQ.1) CALL MEAN(CA, U, G)                                 0307

C  P(IEXSHF,ISIGN,KUF,LOG,MSKIP,MTRN,N1H,N2P,NFTVMT,NPTS,NSKIP,NSTEPS,
C    NUMBER,NXSCSC) {ISIGN==1, KUF==1, MSKIP==129, MTRN==64, N1H==64,
C    N2P==129, NPTS==256, NSKIP==1, NUMBER==250}

      IF (MOD(NSTEPS, KUF).EQ.1) CALL UVELFO(CA, N2P, N1H, G, EX,       0309
     &CWORK)                                                            0309

C  P(LPN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      CALL IN(CA, LPN, NW)                                              0311

C  P() {}

C
C FIND  V = D(PSI)/DX
C
      F = 0.                                                            0312

C  P(I,J,N1H,N2P) {I==129, J==65, N1H==64, N2P==129}

      DO 330 J = 1, N1H                                                 0313

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         DO 340 I = 1, N2P                                              0314

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=I, I<=129, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0315

C  P(N1H,N2P) {N1H==64, N2P==129}

340         CONTINUE                                                    0316

C  P(N1H) {N1H==64}

         F = F+FX                                                       0317

C  P(N1H) {N1H==64}

330      CONTINUE                                                       0318

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL ACAC(CA, EX, WORK)                                           0319

C  P(LPN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8NW+1,
C    5LPN==2LPY+3, 3LPN==LZX+2, 7LPN==2LZY+5, LPRESS==8LTN-7,
C    4LPY==5LTO-1, 3LTN==LZO+2, 8LTN==MEMSIZ-119, LTN==NW+1,
C    7LZO==3LZY+4, 5<=LTO, LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5,
C    16NWQ+1<=LTO, LTO<=16NWQ+13, 1<=NWQ}

      CALL OUT(CA, LPN, NW)                                             0320

C  P(KPP,LPN,MEMSIZ,NOTEMP,NSTEPS,NW,NXXXIN) {KPP==249,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, NOTEMP==0, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      IF (MOD(NSTEPS, KPP).EQ.1.AND.NOTEMP.NE.1) CALL IN(CA, LPN, NW)   0321

C  P(N2,NPTS) {N2==128, NPTS==256}

      NPTS = 2*N2                                                       0323

C  P(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0324

C  P(MTRN,N1H) {MTRN==64, N1H==64}

      MTRN = N1H                                                        0325

C  P(MSKIP,N2P) {MSKIP==129, N2P==129}

      MSKIP = N2P                                                       0326

C  P(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0327

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

      CALL XLOG2(NPTS, LOG)                                             0328

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0329

C  P(I,J,KTO,LTO,MEMSIZ,N1H,N2P,N2PD,NOTEMP,NXXOUT,NXXXIN) {I==130,
C    J==65, LARGE==LPRESS+126, LEIG==4LPN-3, 7LEIG==8LZY-1,
C    3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2, LTO==4NW+1, N1H==64,
C    N2P==129, N2PD==258, NOTEMP==0, NW<=20623, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0330

C  P(KTO,LTO) {LARGE==LPRESS+126, LEIG==4LPN-3, 7LEIG==8LZY-1,
C    3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2, LTO==4NW+1, NW<=20623,
C    2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

C
C T(TOTAL) = T-BETA*Y
C WHERE BETA < 0 MEANS   STABLE STRATIFICATION AND
C       BETA > 0 MEANS UNSTABLE STRATIFICATION
C
         KTO = LTO                                                      0331

C  P() {}

         DTB = 0.5*BETA*DTT                                             0332

C  P(I,J,KTO,MEMSIZ,N1H,N2P,N2PD,NXXOUT,NXXXIN) {I==130, J==65,
C    KTO==4NW+1, LARGE==LPRESS+126, LEIG==4LPN-3, 7LEIG==8LZY-1,
C    3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2, LTO==4NW+1, N1H==64,
C    N2P==129, N2PD==258, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3, 1<=NWQ}

         DO 350 J = 1, N1H                                              0333

C  P(KTO,MEMSIZ,N1H,N2PD,NXXXIN) {LARGE==LPRESS+126, LEIG==4LPN-3,
C    7LEIG==8LZY-1, 3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126,
C    LPRESS==8NW+1, 4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTO==4NW+1, N1H==64, N2PD==258, 1<=J, J<=64, J+4NW<=KTO,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

            CALL IN(CWORK, KTO, N2PD)                                   0334

C  P(J,N1H) {LARGE==LPRESS+126, LEIG==8LTN-7, LPN==2LTN-1,
C    3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, N1H==64,
C    1<=J, J<=64, 7J+4LZY<=7KTO+4, 1<=KTO, 7KTO+918<=8LZY,
C    LZY<=144362, 14NWH+1<=LZY, LZY<=14NWH+8, 28NWQ+1<=LZY,
C    LZY<=28NWQ+22, 1<=NWQ}

            F = -REAL(J-1)*FX*DTT*0.25                                  0335

C  P(I,J,N1H,N2P) {LARGE==LPRESS+126, LEIG==4LPN-3, 7LEIG==8LZY-1,
C    3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2, LTO==4NW+1, N1H==64,
C    N2P==129, 1<=J, J<=64, J+4NW<=KTO, 1<=KTO, KTO+130<=8NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

            DO 360 I = 1, N2P                                           0336

C  P(I,J,N1H,N2P) {LARGE==LPRESS+126, LEIG==4LPN-3, 7LEIG==8LZY-1,
C    3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2, LTO==4NW+1, N1H==64,
C    N2P==129, 1<=I, I<=129, 1<=J, J<=64, J+4NW<=KTO, 1<=KTO,
C    KTO+130<=8NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3, 1<=NWQ}

               CWORK(I) = CWORK(I)*CMPLX(1., U(I)*F)+DTB*CA(I,J)        0337

C  P(N1H,N2P) {N1H==64, N2P==129}

360            CONTINUE                                                 0338

C  P(KTO,MEMSIZ,N1H,N2PD,NXXOUT) {LARGE==LPRESS+126, LEIG==8LTN-7,
C    LPN==2LTN-1, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    N1H==64, N2PD==258, 1<=J, J<=64, 7J+4LZY<=7KTO+4, 1<=KTO,
C    7KTO+918<=8LZY, LZY<=144362, 14NWH+1<=LZY, LZY<=14NWH+8,
C    28NWQ+1<=LZY, LZY<=28NWQ+22, 1<=NWQ}

            CALL OUT(CWORK, KTO, N2PD)                                  0339

C  P(KTO,N1H,N2PD) {LARGE==LPRESS+126, LEIG==4LPN-3, 7LEIG==8LZY-1,
C    3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2, LTO==4NW+1, N1H==64,
C    N2PD==258, 1<=J, J<=64, J+4NW<=KTO, 1<=KTO, KTO+130<=8NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

            KTO = KTO+N2PD                                              0340

C  P(N1H) {N1H==64}

350         CONTINUE                                                    0341
      ENDIF

C  P(LZN,MEMSIZ,NW,NXXXIN) {LARGE==LPRESS+126, LEIG==4LPN-3,
C    7LEIG==8LZY-1, 3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126,
C    LPRESS==8NW+1, 4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTO==4NW+1, LZN==1, 259<=KTO, 4NW+322<=KTO, KTO<=8NW+128,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}


      CALL IN(CA, LZN, NW)                                              0342

C  P() {}

C
C FIND DZ/DY:
C
      F = 0.                                                            0343

C  P(I,J,N1H,N2) {I==130, J==65, N1H==64, N2==128}

      DO 370 I = 1, N2                                                  0344

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128}

         DO 380 J = 1, N1H                                              0345

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0346

C  P(N1H,N2) {N1H==64, N2==128}

380         CONTINUE                                                    0347

C  P(N2) {N2==128}

         F = F+1.                                                       0348

C  P(N2) {N2==128}

370      CONTINUE                                                       0349

C  P(J,N1H,N2P) {J==65, N1H==64, N2P==129}

      DO 390 J = 1, N1H                                                 0350

C  P(J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         CA(N2P,J) = 0.                                                 0351

C  P(N1H) {N1H==64}

390      CONTINUE                                                       0352

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXSCSC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL SCSC(CA, EX, WORK)                                           0353

C  P(LZY,MEMSIZ,NW,NXXOUT) {LARGE==LPRESS+126, LEIG==4LPN-3,
C    7LEIG==8LZY-1, 3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126,
C    LPRESS==8NW+1, 4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTO==4NW+1, 259<=KTO, 4NW+322<=KTO, KTO<=8NW+128, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

      CALL OUT(CA, LZY, NW)                                             0354

C  P(LZN,MEMSIZ,NW,NXXXIN) {LARGE==LPRESS+126, LEIG==8LTN-7,
C    LPN==2LTN-1, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    LZN==1, 259<=KTO, 4LZY+2250<=7KTO, 7KTO<=8LZY+888, 8<=LZY,
C    LZY<=144362, 14NWH+1<=LZY, LZY<=14NWH+8, 28NWQ+1<=LZY,
C    LZY<=28NWQ+22, 1<=NWQ}

      CALL IN(CA, LZN, NW)                                              0355

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL ACAC(CA, EX, WORK)                                           0356

C  P(I,J,N1H,N2P) {I==129, J==65, N1H==64, N2P==129}

      DO 400 J = 1, N1H                                                 0357

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         DO 410 I = 1, N2P                                              0358

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=I, I<=129, 1<=J, J<=64}

            CA(I,J) = CA(I,J)*0.5                                       0359

C  P(N1H,N2P) {N1H==64, N2P==129}

410         CONTINUE                                                    0360

C  P(N1H) {N1H==64}

400      CONTINUE                                                       0361

C  P(LZN,MEMSIZ,NW,NXXOUT) {LARGE==LPRESS+126, LEIG==4LPN-3,
C    7LEIG==8LZY-1, 3LPN==LZX+2, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126,
C    LPRESS==8NW+1, 4LPY==5LTO-1, 6LPY==5LZX+1, 3LTN==LZO+2,
C    LTO==4NW+1, LZN==1, 259<=KTO, 4NW+322<=KTO, KTO<=8NW+128, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3, 1<=NWQ}

      CALL OUT(CA, LZN, NW)                                             0362

C  P(N1,NPTS) {N1==128, NPTS==256}

      NPTS = N1                                                         0363

C  P(N2P,NSKIP) {N2P==129, NSKIP==1}

      NSKIP = N2P                                                       0364

C  P(MTRN,N2P) {MTRN==64, N2P==129}

      MTRN = N2P                                                        0365

C  P(MSKIP) {MSKIP==129}

      MSKIP = 1                                                         0366

C  P(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0367

C  P(LOG,NPTS,NXLOG2) {NPTS==128}

      CALL XLOG2(NPTS, LOG)                                             0368

C  P(IEXSHF,NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0369

C  P(IEXSHF,ISIGN,KZP,LOG,MSKIP,MTRN,N1H,N2PD,NFTVMT,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,ZETAPH:NCALL) {ISIGN==1,
C    KZP==249, MSKIP==1, MTRN==129, N1H==64, N2PD==258, NPTS==128,
C    NSKIP==129, NUMBER==250}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL ZETAPH(CA, N2PD, N1H, EX, WORK    0370
     &, -1)                                                             0370

C  P(KZP,LZN,MEMSIZ,NSTEPS,NW,NXXXIN) {KZP==249, LARGE==8NW+127,
C    LEIG==4LPN-3, 7LEIG==8LZY-1, 5LPN==2LPY+3, 3LPN==LZX+2,
C    3LPRESS==8LZO-5, LPRESS==8NW+1, 4LPY==5LTO-1, 7LTN==LZY+6,
C    3LTO==4LZO-1, LZN==1, MEMSIZ==8NW+127, 4LZO+962<=3KTO,
C    3KTO<=8LZO+376, LZO<=61870, 6NWH+1<=LZO, LZO<=6NWH+4,
C    12NWQ+1<=LZO, LZO<=12NWQ+10}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL IN(CA, LZN, NW)                   0372

C  P() {}

C
C FIND DZ/DX:
C
      F = 0.                                                            0374

C  P(I,J,N1H,N2P) {I==130, J==65, N1H==64, N2P==129}

      DO 420 J = 1, N1H                                                 0375

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         DO 430 I = 1, N2P                                              0376

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=I, I<=129, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0377

C  P(N1H,N2P) {N1H==64, N2P==129}

430         CONTINUE                                                    0378

C  P(N1H) {N1H==64}

         F = F+FX2                                                      0379

C  P(N1H) {N1H==64}

420      CONTINUE                                                       0380

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0381

C  P(LZX,MEMSIZ,NW,NXXOUT) {LARGE==MEMSIZ, LEIG==4LPN-3, 5LPN==2LPY+3,
C    3LPN==LZX+2, 7LPN==2LZY+5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 3LTN==LZO+2, 8LZO==3MEMSIZ-373, LZY==7NW+1,
C    LTO+321<=KTO, KTO<=2LTO+126, LTO<=82493, 8NWH+1<=LTO,
C    LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

      CALL OUT(CA, LZX, NW)                                             0382

C  P(LZY,MEMSIZ,NW,NXXXIN) {LARGE==LPRESS+126, 3LEIG==4LZX-1,
C    LPN==2LTN-1, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    LPY==5LTN-4, 4LTN==LTO+3, 7LTN==LZY+6, LTN==NW+1, 2LZO==LZX+1,
C    LEIG+643<=2KTO, KTO<=LEIG+127, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

      CALL IN(CA, LZY, NW)                                              0383

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0384

C  P(LZY,MEMSIZ,NW,NXXOUT) {LARGE==LPRESS+126, 3LEIG==4LZX-1,
C    LPN==2LTN-1, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    LPY==5LTN-4, 4LTN==LTO+3, 7LTN==LZY+6, LTN==NW+1, 2LZO==LZX+1,
C    LEIG+643<=2KTO, KTO<=LEIG+127, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

      CALL OUT(CA, LZY, NW)                                             0385

C  P(LPN,MEMSIZ,NW,NXXXIN) {LARGE==MEMSIZ, LEIG==4LPN-3, 5LPN==2LPY+3,
C    3LPN==LZX+2, 7LPN==2LZY+5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 3LTN==LZO+2, 8LZO==3MEMSIZ-373, LZY==7NW+1,
C    LTO+321<=KTO, KTO<=2LTO+126, 5<=LTO, LTO<=82493, 8NWH+1<=LTO,
C    LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

      CALL IN(CA, LPN, NW)                                              0386

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0387

C  P(LPN,MEMSIZ,NW,NXXOUT) {LARGE==MEMSIZ, LEIG==4LPN-3, 5LPN==2LPY+3,
C    3LPN==LZX+2, 7LPN==2LZY+5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 3LTN==LZO+2, 8LZO==3MEMSIZ-373, LZY==7NW+1,
C    LTO+321<=KTO, KTO<=2LTO+126, 5<=LTO, LTO<=82493, 8NWH+1<=LTO,
C    LTO<=8NWH+5, 16NWQ+1<=LTO, LTO<=16NWQ+13}

      CALL OUT(CA, LPN, NW)                                             0388

C  P(LPY,MEMSIZ,NW,NXXXIN) {LARGE==LPRESS+126, 3LEIG==4LZX-1,
C    LPN==2LTN-1, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    LPY==5LTN-4, 4LTN==LTO+3, 7LTN==LZY+6, LTN==NW+1, 2LZO==LZX+1,
C    LEIG+643<=2KTO, KTO<=LEIG+127, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

      CALL IN(CA, LPY, NW)                                              0389

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0390

C  P(LPY,MEMSIZ,NW,NXXOUT) {LARGE==LPRESS+126, 3LEIG==4LZX-1,
C    LPN==2LTN-1, 3LPRESS==8LZO-5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    LPY==5LTN-4, 4LTN==LTO+3, 7LTN==LZY+6, LTN==NW+1, 2LZO==LZX+1,
C    LEIG+643<=2KTO, KTO<=LEIG+127, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

      CALL OUT(CA, LPY, NW)                                             0391

C  P(KUP,LPY,MEMSIZ,N1H,N2PD,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXXIN)
C    {KUP==249, LARGE==MEMSIZ, LEIG==4LPN-3, 5LPN==2LPY+3,
C    3LPN==LZX+2, 7LPN==2LZY+5, LPRESS==MEMSIZ-126, LPRESS==8NW+1,
C    4LPY==5LTO-1, 3LTN==LZO+2, 8LZO==3MEMSIZ-373, LZY==7NW+1,
C    N1H==64, N2PD==258, NUMBER==250, LTO+321<=KTO, KTO<=2LTO+126,
C    5<=LTO, LTO<=82493, 8NWH+1<=LTO, LTO<=8NWH+5, 16NWQ+1<=LTO,
C    LTO<=16NWQ+13}

C
C WE ARE IN PHYSICAL SPACE NOW - FIND  (U,V).GRAD (Z):
C
      IF (MOD(NSTEPS, KUP).EQ.1) CALL UVELPH(A, N2PD, N1H, WORK, -1)    0392

C  P(KVP,LPN,MEMSIZ,N1H,N2PD,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXXIN)
C    {KVP==249, LARGE==8NW+127, LEIG==8LTN-7, 3LEIG==4LZX-1,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPRESS==8NW+1, LPY==5LTN-4,
C    4LTN==LTO+3, 7LTN==LZY+6, 2LZO==LZX+1, MEMSIZ==8NW+127, N1H==64,
C    N2PD==258, NUMBER==250, 2LZX+964<=3KTO, 3KTO<=4LZX+380,
C    LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19}

      IF (MOD(NSTEPS, KVP).EQ.1) CALL VVELPH(A, N2PD, N1H, WORK, -1)    0394

C  P(KPY,LPY) {LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1,
C    4LPY+1606<=5KTO, 5KTO<=8LPY+632, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16}

      KPY = LPY                                                         0396

C  P(KPN,LPN) {KPY==LPY, LARGE==LPRESS+126, LEIG==2LTO-1,
C    3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1,
C    7LTO==4LZY+3, 2LZX+964<=3KTO, 3KTO<=4LZX+380, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19}

      KPN = LPN                                                         0397

C  P(KZY,LZY) {KPN==LPN, KPY==LPY, LARGE==MEMSIZ, 3LEIG==8LZO-5,
C    7LEIG==8LZY-1, 2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, 3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377,
C    LZX==6NW+1, 4LPY+1606<=5KTO, 5KTO<=8LPY+632, LPY<=103116,
C    10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16}

      KZY = LZY                                                         0398

C  P(KZX,LZX) {3KPN==LZX+2, KPY==LPY, KZY==LZY, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, KPN<=41247, KTO<=4KPN+124,
C    2KPN+320<=KTO, 4NWH+1<=KPN, KPN<=4NWH+3, 8NWQ+1<=KPN,
C    KPN<=8NWQ+7}

      KZX = LZX                                                         0399

C  P(KSM) {KSM==1}

      UKSM1F = REAL(2-KSM)                                              0400

C  P(I,IPH,J,K,K1QM,K2QM,K3QM,KPN,KPY,KZX,KZY,MEMSIZ,N1E,N2PD,NWQ,
C    NXXOUT,NXXXIN) {I==130, J==65, K1QM==16, K2QM==32, K3QM==48,
C    3KPN==KZX+2, 3KPN==LZX+2, KPY==LPY, KZY==LZY, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, N1E==16, N2PD==258,
C    KPN<=41247, KTO<=4KPN+124, 2KPN+320<=KTO, 4NWH+1<=KPN,
C    KPN<=4NWH+3, 8NWQ+1<=KPN, KPN<=8NWQ+7}

      DO 440 K = 1, 4                                                   0401

C  P(KPY,MEMSIZ,NWQ,NXXXIN) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+1, LARGE==LPRESS+126, LEIG==2LTO-1, 3LEIG==8LZO-5,
C    3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K,
C    K<=4, K+LZX<=KZX+1, 2LZX+964<=3KTO, 3KTO<=4LZX+380, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19}

         CALL IN(A, KPY, NWQ)                                           0402

C  P(KPN,MEMSIZ,NWQ,NXXXIN) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZX+LPY==5KZY+1, LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K,
C    K<=4, 5K+6LPY<=5KZX+6, 1<=KPY, 5KPY+5NWQ<=8LPY+632,
C    4LPY+1606<=5KTO, 5KTO<=8LPY+632, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWQ}

         CALL IN(A(1,K1Q), KPN, NWQ)                                    0403

C  P(KZY,MEMSIZ,NWQ,NXXXIN) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+1, LARGE==LPRESS+126, LEIG==2LTO-1, 3LEIG==8LZO-5,
C    3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K,
C    K<=4, K+LZX<=KZX+1, 1<=KPN, 3KPN+3NWQ<=4LZX+380, 1<=KPY,
C    3KPY+3NWQ<=4LZX+380, 2LZX+964<=3KTO, 3KTO<=4LZX+380, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWQ}

         CALL IN(A(1,K2Q), KZY, NWQ)                                    0404

C  P(KZX,MEMSIZ,NWQ,NXXXIN) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZX+LPY==5KZY+1, LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K,
C    K<=4, 5K+6LPY<=5KZX+6, 1<=KPN, 5KPN+5NWQ<=8LPY+632, 1<=KPY,
C    5KPY+5NWQ<=8LPY+632, 4LPY+1606<=5KTO, 5KTO<=8LPY+632, 1<=KZY,
C    5KZY+5NWQ<=8LPY+632, LPY<=103116, 10NWH+1<=LPY, LPY<=10NWH+6,
C    20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWQ}

         CALL IN(A(1,K3Q), KZX, NWQ)                                    0405

C  P(I,IPH,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258}

         DO 450 I = 1, N2PD                                             0406

C  P(I,IPH,N2PD) {N2PD==258, 1<=I, I<=258}

            IPH = (I+1)/2                                               0407

C  P(IPH,N2PD) {N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

            GG = G(IPH)                                                 0408

C  P(IPH,N2PD) {N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

            UU = U(IPH)*UKSM1F                                          0409

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

            DO 460 J = 1, N1E                                           0410

C  P(I,J,N1E,N2PD) {N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1,
C    I<=2IPH, 1<=J, J<=16}

               A(I,J) = A(I,J)*GG+UU                                    0411

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH, 1<=J,
C    J<=16}

               A(I,K2QM+J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+   0412
     &         J)*GG                                                    0412

C  P(N1E,N2PD) {N1E==16, N2PD==258}

460            CONTINUE                                                 0413

C  P(N2PD) {N2PD==258}

450         CONTINUE                                                    0414

C  P(KPY,MEMSIZ,NWQ,NXXOUT) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZX+LPY==5KZY+1, LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K,
C    K<=4, 5K+6LPY<=5KZX+6, 1<=KPN, 5KPN+5NWQ<=8LPY+632, 1<=KPY,
C    5KPY+5NWQ<=8LPY+632, 4LPY+1606<=5KTO, 5KTO<=8LPY+632, 1<=KZX,
C    5KZX+5NWQ<=8LPY+632, 1<=KZY, 5KZY+5NWQ<=8LPY+632, LPY<=103116,
C    10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWQ}

         CALL OUT(A, KPY, NWQ)                                          0415

C  P(KZY,MEMSIZ,NWQ,NXXOUT) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+1, LARGE==LPRESS+126, LEIG==2LTO-1, 3LEIG==8LZO-5,
C    3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K,
C    K<=4, K+LZX<=KZX+1, 1<=KPN, 3KPN+3NWQ<=4LZX+380, 1<=KPY,
C    3KPY+3NWQ<=4LZX+380, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 1<=KZX,
C    3KZX+3NWQ<=4LZX+380, 1<=KZY, 3KZY+3NWQ<=4LZX+380, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWQ}

         CALL OUT(A(1,K2Q), KZY, NWQ)                                   0416

C  P(KPN,NWQ) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1, 5KZX+LPY==5KZY+1,
C    LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1, 2LPN==LTO+1,
C    3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, 3LPY==5LZO-2,
C    4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K, K<=4,
C    5K+6LPY<=5KZX+6, 1<=KPN, 5KPN+5NWQ<=8LPY+632, 1<=KPY,
C    5KPY+5NWQ<=8LPY+632, 4LPY+1606<=5KTO, 5KTO<=8LPY+632, 1<=KZX,
C    5KZX+5NWQ<=8LPY+632, 1<=KZY, 5KZY+5NWQ<=8LPY+632, LPY<=103116,
C    10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWQ}

         KPN = KPN+NWQ                                                  0417

C  P(KPY,NWQ) {3KPN+2LZX==3KZX+3NWQ+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+1, LARGE==LPRESS+126, LEIG==2LTO-1, 3LEIG==8LZO-5,
C    3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K,
C    K<=4, K+LZX<=KZX+1, 3KPN<=4LZX+380, NWQ+1<=KPN, 1<=KPY,
C    3KPY+3NWQ<=4LZX+380, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 1<=KZX,
C    3KZX+3NWQ<=4LZX+380, 1<=KZY, 3KZY+3NWQ<=4LZX+380, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWQ}

         KPY = KPY+NWQ                                                  0418

C  P(KZX,NWQ) {5KPN+4LPY==5KZX+5NWQ+4, 5KPY+LPY==5KZX+5NWQ+1,
C    5KZX+LPY==5KZY+1, LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K,
C    K<=4, 5K+6LPY<=5KZX+6, 5KPN<=8LPY+632, NWQ+1<=KPN,
C    5KPY<=8LPY+632, NWQ+1<=KPY, 4LPY+1606<=5KTO, 5KTO<=8LPY+632,
C    1<=KZX, 5KZX+5NWQ<=8LPY+632, 1<=KZY, 5KZY+5NWQ<=8LPY+632,
C    LPY<=103116, 10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY,
C    LPY<=20NWQ+16, 1<=NWQ}

         KZX = KZX+NWQ                                                  0419

C  P(KZY,NWQ) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+6NWQ+1, LARGE==LPRESS+126, LEIG==2LTO-1,
C    3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1,
C    7LTO==4LZY+3, 1<=K, K<=4, K+LZX+NWQ<=KZX+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 2LZX+964<=3KTO,
C    3KTO<=4LZX+380, 3KZX<=4LZX+380, NWQ+1<=KZX, 1<=KZY,
C    3KZY+3NWQ<=4LZX+380, LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7,
C    24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWQ}

         KZY = KZY+NWQ                                                  0420

C  P() {}

440      CONTINUE                                                       0421

C  P(ISIGN) {ISIGN==1}

C
C [Z(OLD) + (MEAN -U) * (-DZ(OLD)/DX)] + (U,V).GRAD(Z)
C
      ISIGN = -1                                                        0422

C  P(LZY,MEMSIZ,NW,NXXXIN) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+1, LARGE==LPRESS+126, LEIG==2LTO-1, 3LEIG==8LZO-5,
C    3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3,
C    3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY,
C    2LZX+964<=3KTO, 3KTO<=4LZX+380, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWQ+1<=KZY, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWQ}

      CALL IN(A, LZY, NW)                                               0423

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXRCS) {ISIGN==-1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL RCS(A, EX)                                                   0424

C  P(LZY,MEMSIZ,NW,NXXOUT) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZX+LZX==6KZY+1, LARGE==LPRESS+126, LEIG==2LTO-1, 3LEIG==8LZO-5,
C    3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1, 7LPRESS==8LZY-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3,
C    3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY,
C    2LZX+964<=3KTO, 3KTO<=4LZX+380, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWQ+1<=KZY, 7<=LZX, LZX<=123739,
C    12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWQ}

      CALL OUT(A, LZY, NW)                                              0425

C  P(KZO,LZO) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1, 5KZX+LPY==5KZY+1,
C    LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1, 2LPN==LTO+1,
C    3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, 3LPY==5LZO-2,
C    4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 5KPN<=8LPY+632,
C    NWQ+1<=KPN, 5KPY<=8LPY+632, NWQ+1<=KPY, 4LPY+1606<=5KTO,
C    5KTO<=8LPY+632, 5KZX<=8LPY+632, 6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX,
C    5KZY<=8LPY+632, NWQ+1<=KZY, 6<=LPY, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWQ}

      KZO = LZO                                                         0426

C  P(KZN,LZN) {LZN==1}

      KZN = LZN                                                         0427

C  P(KZY,LZY) {3KPN+4KZO==3KZX+4, 3KPY+KZO==3KZX+1, KZO+3KZX==3KZY+1,
C    5KZO==3LPY+2, LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1,
C    3KPN<=8KZO+376, NWQ+1<=KPN, 3KPY<=8KZO+376, NWQ+1<=KPY,
C    4KZO+962<=3KTO, 3KTO<=8KZO+376, 4<=KZO, KZO<=61870,
C    3KZX<=8KZO+376, 2KZO+NWQ+2<=KZX, 3KZY<=8KZO+376, 6NWH+1<=KZO,
C    KZO<=6NWH+4, 12NWQ+1<=KZO, KZO<=12NWQ+10, NWQ+1<=KZX, NWQ+1<=KZY,
C    1<=NWQ}

      KZY = LZY                                                         0428

C  P(N1) {N1==128}

      DTFAC = 0.125*DTT/REAL(N1)                                        0429

C  P() {}

      F1 = DTT*FX*0.25                                                  0430

C  P() {}

      F = F1                                                            0431

C  P(I,J,K,K2QJ,K2QM,KZN,KZO,KZY,MEMSIZ,N1Q,N2P,NWH,NXXOUT,NXXXIN)
C    {I==259, J==17, K==5, K2QM==32, 7KPN+4KZY==7KZX+4,
C    7KPY+KZY==7KZX+1, KZN==1, 7KZO==3KZY+4, 5KZO==3LPY+2,
C    LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1, 2LPN==LTO+1,
C    3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, 3LPY==5LZO-2,
C    4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, N1Q==32, N2P==129,
C    7KPN<=8KZY+888, NWQ+1<=KPN, 7KPY<=8KZY+888, NWQ+1<=KPY,
C    4KZY+2250<=7KTO, 7KTO<=8KZY+888, KZX<=KZY+127, 7KZX<=8KZY+888,
C    7NWQ+8<=7KZX+KZY, 6KZY+7NWQ+22<=7KZX, NWQ+1<=KZX, 8<=KZY,
C    KZY<=144362, 14NWH+1<=KZY, KZY<=14NWH+8, 28NWQ+1<=KZY,
C    KZY<=28NWQ+22, 1<=NWQ}

      DO 470 K = 1, 2                                                   0432

C  P(KZO,MEMSIZ,NWH,NXXXIN) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZN+7LPY==5KZY+7, 5KZO+4LPY==5KZY+4, LARGE==MEMSIZ,
C    3LEIG==8LZO-5, 7LEIG==8LZY-1, 2LPN==LTO+1, 3LPN==2LZO+1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, 3LPY==5LZO-2, 4LTN==LTO+3,
C    4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K, K<=2, 5K+7LPY<=5KZY+7,
C    5KPN<=8LPY+632, NWQ+1<=KPN, 5KPY<=8LPY+632, NWQ+1<=KPY,
C    4LPY+1606<=5KTO, 5KTO<=8LPY+632, 5KZX<=8LPY+632, 5KZX<=7LPY+633,
C    5NWQ+6<=5KZX+LPY, 6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 6<=LPY,
C    LPY<=103116, 10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY,
C    LPY<=20NWQ+16, 1<=NWQ}

         CALL IN(CA, KZO, NWH)                                          0433

C  P(KZN,MEMSIZ,NWH,NXXXIN) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K, K<=2,
C    6K+7LZX<=6KZY+7, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 1<=KZO,
C    3KZO+3NWH<=4LZX+380, 3KZX<=4LZX+380, 6KZX<=7LZX+761,
C    6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 7<=LZX,
C    LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0434

C  P(KZO,MEMSIZ,NWH,NXXOUT) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZN+7LPY==5KZY+7, 5KZO+4LPY==5KZY+4, LARGE==MEMSIZ,
C    3LEIG==8LZO-5, 7LEIG==8LZY-1, 2LPN==LTO+1, 3LPN==2LZO+1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, 3LPY==5LZO-2, 4LTN==LTO+3,
C    4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K, K<=2, 5K+7LPY<=5KZY+7,
C    5KPN<=8LPY+632, NWQ+1<=KPN, 5KPY<=8LPY+632, NWQ+1<=KPY,
C    4LPY+1606<=5KTO, 5KTO<=8LPY+632, 1<=KZN, 5KZN+5NWH<=8LPY+632,
C    1<=KZO, 5KZO+5NWH<=8LPY+632, 5KZX<=8LPY+632, 5KZX<=7LPY+633,
C    5NWQ+6<=5KZX+LPY, 6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 6<=LPY,
C    LPY<=103116, 10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY,
C    LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

         CALL OUT(CA(1,K2Q), KZO, NWH)                                  0435

C  P(KZY,MEMSIZ,NWH,NXXXIN) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K, K<=2,
C    6K+7LZX<=6KZY+7, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 1<=KZN,
C    3KZN+3NWH<=4LZX+380, 1<=KZO, 3KZO+3NWH<=4LZX+380, 3KZX<=4LZX+380,
C    6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    7<=LZX, LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

         CALL IN(CA(1,K2Q), KZY, NWH)                                   0436

C  P(I,J,K2QJ,K2QM,N1Q,N2P) {K2QM==32, N1Q==32, N2P==129}

         DO 480 J = 1, N1Q                                              0437

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

            K2QJ = J+K2QM                                               0438

C  P(N1Q) {N1Q==32}

            F = F-F1                                                    0439

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 33<=K2QJ,
C    K2QJ<=64}

            DO 490 I = 1, N2P                                           0440

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    33<=K2QJ, K2QJ<=64}

               CA(I,J) = CA(I,J)*CMPLX(1., F*U(I))+DTFAC*CA(I,K2QJ)     0441

C  P(N1Q,N2P) {N1Q==32, N2P==129}

490            CONTINUE                                                 0442

C  P(N1Q) {N1Q==32}

480         CONTINUE                                                    0443

C  P(KZN,MEMSIZ,NWH,NXXOUT) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K, K<=2,
C    6K+7LZX<=6KZY+7, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 1<=KZN,
C    3KZN+3NWH<=4LZX+380, 1<=KZO, 3KZO+3NWH<=4LZX+380, 3KZX<=4LZX+380,
C    6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    1<=KZY, 3KZY+3NWH<=4LZX+380, 7<=LZX, LZX<=123739, 12NWH+1<=LZX,
C    LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

         CALL OUT(CA, KZN, NWH)                                         0444

C  P(KZN,NWH) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1, 5KZN+7LPY==5KZY+7,
C    5KZO+4LPY==5KZY+4, LARGE==MEMSIZ, 3LEIG==8LZO-5, 7LEIG==8LZY-1,
C    2LPN==LTO+1, 3LPN==2LZO+1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    3LPY==5LZO-2, 4LTN==LTO+3, 4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K,
C    K<=2, 5K+7LPY<=5KZY+7, 5KPN<=8LPY+632, NWQ+1<=KPN,
C    5KPY<=8LPY+632, NWQ+1<=KPY, 4LPY+1606<=5KTO, 5KTO<=8LPY+632,
C    1<=KZN, 5KZN+5NWH<=8LPY+632, 1<=KZO, 5KZO+5NWH<=8LPY+632,
C    5KZX<=8LPY+632, 5KZX<=7LPY+633, 5NWQ+6<=5KZX+LPY,
C    6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 1<=KZY, 5KZY+5NWH<=8LPY+632,
C    6<=LPY, LPY<=103116, 10NWH+1<=LPY, LPY<=10NWH+6, 20NWQ+1<=LPY,
C    LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

         KZN = KZN+NWH                                                  0445

C  P(KZO,NWH) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+6NWH+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 1<=K, K<=2,
C    6K+7LZX<=6KZY+7, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 3KZN<=4LZX+380,
C    NWH+1<=KZN, 1<=KZO, 3KZO+3NWH<=4LZX+380, 3KZX<=4LZX+380,
C    6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    1<=KZY, 3KZY+3NWH<=4LZX+380, 7<=LZX, LZX<=123739, 12NWH+1<=LZX,
C    LZX<=12NWH+7, 24NWQ+1<=LZX, LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

         KZO = KZO+NWH                                                  0446

C  P(KZY,NWH) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZN+7LPY==5KZY+5NWH+7, 5KZO+4LPY==5KZY+5NWH+4, LARGE==MEMSIZ,
C    3LEIG==8LZO-5, 7LEIG==8LZY-1, 2LPN==LTO+1, 3LPN==2LZO+1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, 3LPY==5LZO-2, 4LTN==LTO+3,
C    4LZX==3MEMSIZ-377, LZX==6NW+1, 1<=K, K<=2, 5K+7LPY<=5KZY+7,
C    5KPN<=8LPY+632, NWQ+1<=KPN, 5KPY<=8LPY+632, NWQ+1<=KPY,
C    4LPY+1606<=5KTO, 5KTO<=8LPY+632, 5KZN<=8LPY+632, NWH+1<=KZN,
C    5KZO<=8LPY+632, NWH+1<=KZO, 5KZX<=8LPY+632, 5KZX<=7LPY+633,
C    5NWQ+6<=5KZX+LPY, 6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 1<=KZY,
C    5KZY+5NWH<=8LPY+632, 6<=LPY, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

         KZY = KZY+NWH                                                  0447

C  P() {}

470      CONTINUE                                                       0448

C  P(I,IEXSHF,IPH,ISIGN,J,K,K1QM,K2Q,K2QJ,K2QM,K3QM,KPN,KPP,KPY,KTN,
C    KTO,KTP,KZN,KZX,KZY,LOG,LPN,LPY,LTN,LTO,LZN,LZX,LZY,MEMSIZ,MSKIP,
C    MTRN,N1,N1E,N1H,N1Q,N2,N2P,N2PD,NFTVMT,NMAX2,NOTEMP,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NW,NWH,NWQ,NXACAC,NXLOG2,NXPRNT,NXSCSC,
C    NXXCSR,NXXOUT,NXXRCS,NXXXIN,TEMPHY:NCALL) {I==130, ISIGN==-1,
C    J==33, K==3, K1QM==16, K2Q==33, K2QJ==64, K2QM==32, K3QM==48,
C    3KPN+2LZX==3KZX+2, KPP==249, 6KPY+LZX==6KZX+1, KTP==50,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, LZN==1, MSKIP==1,
C    MTRN==129, N1==128, N1E==16, N1H==64, N1Q==32, N2==128, N2P==129,
C    N2PD==258, NOTEMP==0, NPTS==128, NSKIP==129, NUMBER==250,
C    129<=IPH, IPH<=129, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 3KZN<=4LZX+380,
C    NWH+1<=KZN, 3KZO<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380,
C    6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    3KZY<=4LZX+380, 7LZX+6NWH+5<=6KZY, NWH+1<=KZY, 7<=LZX,
C    LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19, 256<=NMAX2, 1<=NWH, 1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0449

C  P(N2,NPTS) {N2==128, NPTS==128}

C
C FIND DT/DY:
C
         NPTS = 2*N2                                                    0450

C  P(NSKIP) {NSKIP==129}

         NSKIP = 1                                                      0451

C  P(MTRN,N1H) {MTRN==129, N1H==64}

         MTRN = N1H                                                     0452

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

         MSKIP = N2P                                                    0453

C  P(ISIGN) {ISIGN==-1}

         ISIGN = 1                                                      0454

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

         CALL XLOG2(NPTS, LOG)                                          0455

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0456

C  P(LTN,MEMSIZ,NW,NXXXIN) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZN+7LPY==5KZY+7, 5KZO+4LPY==5KZY+4, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, LPY==5NW+1, LTN==NW+1,
C    3LTO==4LZO-1, 7LTO==4LZY+3, 5KPN<=8LPY+632, NWQ+1<=KPN,
C    5KPY<=8LPY+632, NWQ+1<=KPY, 4LPY+1606<=5KTO, 5KTO<=8LPY+632,
C    5KZN<=8LPY+632, NWH+1<=KZN, 5KZO<=8LPY+632, NWH+1<=KZO,
C    5KZX<=8LPY+632, 5KZX<=7LPY+633, 5NWQ+6<=5KZX+LPY,
C    6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 5KZY<=8LPY+632,
C    7LPY+5NWH+3<=5KZY, NWH+1<=KZY, 6<=LPY, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

         CALL IN(CA, LTN, NW)                                           0457

C  P() {}

         F = 0.                                                         0458

C  P(I,J,N1H,N2) {I==130, J==33, N1H==64, N2==128}

         DO 500 I = 1, N2                                               0459

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128}

            DO 510 J = 1, N1H                                           0460

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128, 1<=J, J<=64}

               CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))      0461

C  P(N1H,N2) {N1H==64, N2==128}

510            CONTINUE                                                 0462

C  P(N2) {N2==128}

            F = F+1.                                                    0463

C  P(N2) {N2==128}

500         CONTINUE                                                    0464

C  P(J,N1H,N2P) {J==65, N1H==64, N2P==129}

         DO 520 J = 1, N1H                                              0465

C  P(J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

            CA(N2P,J) = 0.                                              0466

C  P(N1H) {N1H==64}

520         CONTINUE                                                    0467

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXSCSC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL SCSC(CA, EX, WORK)                                        0468

C  P(LZY,MEMSIZ,NW,NXXOUT) {5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZN+7LPY==5KZY+7, 5KZO+4LPY==5KZY+4, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, LPY==5NW+1, LTN==NW+1,
C    3LTO==4LZO-1, 7LTO==4LZY+3, 5KPN<=8LPY+632, NWQ+1<=KPN,
C    5KPY<=8LPY+632, NWQ+1<=KPY, 4LPY+1606<=5KTO, 5KTO<=8LPY+632,
C    5KZN<=8LPY+632, NWH+1<=KZN, 5KZO<=8LPY+632, NWH+1<=KZO,
C    5KZX<=8LPY+632, 5KZX<=7LPY+633, 5NWQ+6<=5KZX+LPY,
C    6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 5KZY<=8LPY+632,
C    7LPY+5NWH+3<=5KZY, NWH+1<=KZY, 6<=LPY, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

         CALL OUT(CA, LZY, NW)                                          0469

C  P(LTN,MEMSIZ,NW,NXXXIN) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 3KPN<=4LZX+380, NWQ+1<=KPN,
C    3KPY<=4LZX+380, NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380,
C    3KZN<=4LZX+380, NWH+1<=KZN, 3KZO<=4LZX+380, NWH+1<=KZO,
C    3KZX<=4LZX+380, 6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, 7LZX+6NWH+5<=6KZY, NWH+1<=KZY,
C    7<=LZX, LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

         CALL IN(CA, LTN, NW)                                           0470

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL ACAC(CA, EX, WORK)                                        0471

C  P(LTN,MEMSIZ,NW,NXXOUT) {3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, 3KPN<=4LZX+380, NWQ+1<=KPN,
C    3KPY<=4LZX+380, NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380,
C    3KZN<=4LZX+380, NWH+1<=KZN, 3KZO<=4LZX+380, NWH+1<=KZO,
C    3KZX<=4LZX+380, 6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, 7LZX+6NWH+5<=6KZY, NWH+1<=KZY,
C    7<=LZX, LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

         CALL OUT(CA, LTN, NW)                                          0472

C  P(N1,NPTS) {N1==128, NPTS==256}

         NPTS = N1                                                      0473

C  P(N2P,NSKIP) {N2P==129, NSKIP==1}

         NSKIP = N2P                                                    0474

C  P(MTRN,N2P) {MTRN==64, N2P==129}

         MTRN = N2P                                                     0475

C  P(MSKIP) {MSKIP==129}

         MSKIP = 1                                                      0476

C  P(LOG,NPTS,NXLOG2) {NPTS==128}

         CALL XLOG2(NPTS, LOG)                                          0477

C  P(IEXSHF,NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0478

C  P(IEXSHF,ISIGN,KPP,KTP,LOG,LTN,MEMSIZ,MSKIP,MTRN,N1H,N2PD,NFTVMT,
C    NPTS,NSKIP,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,NXXXIN,
C    TEMPHY:NCALL) {ISIGN==1, 5KPN+4LPY==5KZX+4, KPP==249,
C    5KPY+LPY==5KZX+1, KTP==50, 5KZN+7LPY==5KZY+7, 5KZO+4LPY==5KZY+4,
C    LARGE==LPRESS+126, LEIG==2LTO-1, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, LPY==5NW+1,
C    LTN==NW+1, 3LTO==4LZO-1, 7LTO==4LZY+3, MSKIP==1, MTRN==129,
C    N1H==64, N2PD==258, NPTS==128, NSKIP==129, NUMBER==250,
C    5KPN<=8LPY+632, NWQ+1<=KPN, 5KPY<=8LPY+632, NWQ+1<=KPY,
C    4LPY+1606<=5KTO, 5KTO<=8LPY+632, 5KZN<=8LPY+632, NWH+1<=KZN,
C    5KZO<=8LPY+632, NWH+1<=KZO, 5KZX<=8LPY+632, 5KZX<=7LPY+633,
C    5NWQ+6<=5KZX+LPY, 6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 5KZY<=8LPY+632,
C    7LPY+5NWH+3<=5KZY, NWH+1<=KZY, 6<=LPY, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

         IF (NSTEPS.EQ.1) THEN                                          0479

C  P(IEXSHF,ISIGN,LOG,LTN,MEMSIZ,MSKIP,MTRN,N1H,N2PD,NFTVMT,NPTS,
C    NSKIP,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {ISIGN==1, 3KPN+2LZX==3KZX+2, 6KPY+LZX==6KZX+1,
C    6KZN+7LZX==6KZY+7, 3KZO+2LZX==3KZY+2, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LEIG==8LZO-5, 3LPN==2LZO+1, LPN==2NW+1,
C    3LPRESS==4LZX-1, 7LPRESS==8LZY-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, LTN==NW+1, 7LTO==4LZY+3, MSKIP==1, MTRN==129,
C    N1H==64, N2PD==258, NPTS==128, NSKIP==129, NSTEPS==1,
C    NUMBER==250, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 2LZX+964<=3KTO, 3KTO<=4LZX+380, 3KZN<=4LZX+380,
C    NWH+1<=KZN, 3KZO<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380,
C    6KZX<=7LZX+761, 6NWQ+7<=6KZX+LZX, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    3KZY<=4LZX+380, 7LZX+6NWH+5<=6KZY, NWH+1<=KZY, 7<=LZX,
C    LZX<=123739, 12NWH+1<=LZX, LZX<=12NWH+7, 24NWQ+1<=LZX,
C    LZX<=24NWQ+19, 1<=NWH, 1<=NWQ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, 0)                      0480

         ELSEIF (MOD(NSTEPS, KTP).EQ.1.OR.MOD(NSTEPS, KPP).EQ.1) THEN   0479

C  P(IEXSHF,ISIGN,LOG,LTN,MEMSIZ,MSKIP,MTRN,N1H,N2PD,NFTVMT,NPTS,
C    NSKIP,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {ISIGN==1, 5KPN+4LPY==5KZX+4, 5KPY+LPY==5KZX+1,
C    5KZN+7LPY==5KZY+7, 5KZO+4LPY==5KZY+4, LARGE==LPRESS+126,
C    LEIG==2LTO-1, 3LPN==2LZO+1, LPN==2NW+1, 3LPRESS==4LZX-1,
C    7LPRESS==8LZY-1, LPRESS==MEMSIZ-126, LPY==5NW+1, LTN==NW+1,
C    3LTO==4LZO-1, 7LTO==4LZY+3, MSKIP==1, MTRN==129, N1H==64,
C    N2PD==258, NPTS==128, NSKIP==129, NUMBER==250, 5KPN<=8LPY+632,
C    NWQ+1<=KPN, 5KPY<=8LPY+632, NWQ+1<=KPY, 4LPY+1606<=5KTO,
C    5KTO<=8LPY+632, 5KZN<=8LPY+632, NWH+1<=KZN, 5KZO<=8LPY+632,
C    NWH+1<=KZO, 5KZX<=8LPY+632, 5KZX<=7LPY+633, 5NWQ+6<=5KZX+LPY,
C    6LPY+5NWQ+14<=5KZX, NWQ+1<=KZX, 5KZY<=8LPY+632,
C    7LPY+5NWH+3<=5KZY, NWH+1<=KZY, 6<=LPY, LPY<=103116, 10NWH+1<=LPY,
C    LPY<=10NWH+6, 20NWQ+1<=LPY, LPY<=20NWQ+16, 1<=NWH, 1<=NWQ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, -1)                     0482
         ENDIF

C  P() {}

C
C TEMPERATURE INFLUENCE:
C
         F = -FX                                                        0483

C  P(KZN,LZN) {LZN==1, NWH+1<=KZN, NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

         KZN = LZN                                                      0484

C  P(KZX,LZX) {LARGE==LPRESS+126, LARGE==MEMSIZ, 3LPRESS==4LZX-1,
C    NWQ+1<=KPN, NWQ+1<=KPY, NWQ+1<=KZX, 1<=NWQ}

         KZX = LZX                                                      0485

C  P(KTN,LTN) {LPY==5LTN-4}

         KTN = LTN                                                      0486

C  P() {}

         DTA = 0.5*ALPHA*DTT                                            0487

C  P(I,J,K,K2QJ,K2QM,KTN,KZN,KZX,MEMSIZ,N1Q,N2P,NWH,NXXOUT,NXXXIN)
C    {I==129, J==65, K==3, K2QJ==64, K2QM==32, 5KTN==LPY+4, KZN==1,
C    KZX==LZX, LARGE==LPRESS+126, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    4LZX==3MEMSIZ-377, N1Q==32, N2P==129, NWH+1<=KZO, NWH+1<=KZY,
C    1<=NWH}

         DO 530 K = 1, 2                                                0488

C  P(KZN,MEMSIZ,NWH,NXXXIN) {5KZN+LPY==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 5K+LPY<=5KTN+1, NWH+1<=KZO,
C    NWH+1<=KZY, 1<=NWH}

            CALL IN(CA, KZN, NWH)                                       0489

C  P(KTN,MEMSIZ,NWH,NXXXIN) {KZN+LTN==KTN+1, KTN+LZX==KZX+LTN,
C    LARGE==LPRESS+126, LARGE==MEMSIZ, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    1<=K, K<=2, K+LTN<=KTN+1, 1<=KZN, 3KZN+3NWH<=4LZX+380,
C    NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

            CALL IN(CA(1,K2Q), KTN, NWH)                                0490

C  P(I,J,K2QJ,K2QM,N1Q,N2P) {K2QM==32, N1Q==32, N2P==129}

            DO 540 J = 1, N1Q                                           0491

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

               K2QJ = J+K2QM                                            0492

C  P(N1Q) {N1Q==32}

               F = F+FX                                                 0493

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 33<=K2QJ,
C    K2QJ<=64}

               DO 550 I = 1, N2P                                        0494

C  P(I,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    33<=K2QJ, K2QJ<=64}

                  CA(I,K2QJ) = CMPLX(-F*AIMAG(CA(I,K2QJ)), F*REAL(CA(   0495
     &            I,K2QJ)))                                             0495

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    33<=K2QJ, K2QJ<=64}

                  CA(I,J) = CA(I,J)+DTA*CA(I,K2QJ)                      0496

C  P(N1Q,N2P) {N1Q==32, N2P==129}

550               CONTINUE                                              0497

C  P(N1Q) {N1Q==32}

540            CONTINUE                                                 0498

C  P(KZN,MEMSIZ,NWH,NXXOUT) {5KZN+LPY==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 5K+LPY<=5KTN+1, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 1<=KZN, 3KZN+3NWH<=4LZX+380, NWH+1<=KZO,
C    NWH+1<=KZY, 1<=NWH}

            CALL OUT(CA, KZN, NWH)                                      0499

C  P(KZX,MEMSIZ,NWH,NXXOUT) {KZN+LTN==KTN+1, KTN+LZX==KZX+LTN,
C    LARGE==LPRESS+126, LARGE==MEMSIZ, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    1<=K, K<=2, K+LTN<=KTN+1, 1<=KTN, 3KTN+3NWH<=4LZX+380, 1<=KZN,
C    3KZN+3NWH<=4LZX+380, NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

            CALL OUT(CA(1,K2Q), KZX, NWH)                               0500

C  P(KZX,NWH) {5KZN+LPY==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 5K+LPY<=5KTN+1, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 1<=KZN, 3KZN+3NWH<=4LZX+380, NWH+1<=KZO,
C    1<=KZX, 3KZX+3NWH<=4LZX+380, NWH+1<=KZY, 1<=NWH}

            KZX = KZX+NWH                                               0501

C  P(KTN,NWH) {KZN+LTN==KTN+1, KTN+LZX+NWH==KZX+LTN,
C    LARGE==LPRESS+126, LARGE==MEMSIZ, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    1<=K, K<=2, K+LTN<=KTN+1, 1<=KTN, 3KTN+3NWH<=4LZX+380, 1<=KZN,
C    3KZN+3NWH<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, NWH+1<=KZX,
C    NWH+1<=KZY, 1<=NWH}

            KTN = KTN+NWH                                               0502

C  P(KZN,NWH) {5KZN+LPY+5NWH==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 5K+LPY+5NWH<=5KTN+1,
C    3KTN<=4LZX+380, NWH+1<=KTN, 1<=KZN, 3KZN+3NWH<=4LZX+380,
C    NWH+1<=KZO, 3KZX<=4LZX+380, NWH+1<=KZX, NWH+1<=KZY, 1<=NWH}

            KZN = KZN+NWH                                               0503

C  P() {}

530         CONTINUE                                                    0504

C  P(LZX,MEMSIZ,NW,NXXXIN) {KZN+LTN==KTN+1, KTN+LZX==KZX+LTN,
C    LARGE==LPRESS+126, LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, LTN+NWH+1<=KTN, 3KTN<=4LZX+380, NWH+1<=KTN,
C    3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380,
C    NWH+1<=KZX, NWH+1<=KZY, 1<=NWH}

         CALL IN(A, LZX, NW)                                            0505

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

         CALL CSR(A, EX)                                                0506

C  P(LZX,MEMSIZ,NW,NXXOUT) {KZN+LTN==KTN+1, KTN+LZX==KZX+LTN,
C    LARGE==LPRESS+126, LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, LTN+NWH+1<=KTN, 3KTN<=4LZX+380, NWH+1<=KTN,
C    3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380,
C    NWH+1<=KZX, NWH+1<=KZY, 3<=LPN, 3LPN<=2LZX+763, 1<=LZX, 1<=NWH}

         CALL OUT(A, LZX, NW)                                           0507

C  P(LZY,MEMSIZ,NW,NXXXIN) {5KZN+LPY==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, LPY+5NWH+9<=5KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3KZX<=4LZX+380, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX,
C    3NW<=LZX+380, 1<=NW, 1<=NWH}

         CALL IN(A, LZY, NW)                                            0508

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

         CALL CSR(A, EX)                                                0509

C  P(LZY,MEMSIZ,NW,NXXOUT) {5KZN+LPY==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, LPY+5NWH+9<=5KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3KZX<=4LZX+380, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH}

         CALL OUT(A, LZY, NW)                                           0510

C  P(KPN,LPN) {KZN+LTN==KTN+1, KTN+LZX==KZX+LTN, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, NWQ+1<=KPN, NWQ+1<=KPY, LTN+NWH+1<=KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3KZX<=4LZX+380, NWH+1<=KZX, NWH+1<=KZY, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH,
C    1<=NWQ}

         KPN = LPN                                                      0511

C  P(KPY,LPY) {KPN==LPN, 5KZN+LPY==5KTN+1, 5KTN+5LZX==5KZX+LPY+4,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, NWQ+1<=KPY, LPY+5NWH+9<=5KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3KZX<=4LZX+380, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         KPY = LPY                                                      0512

C  P(KZX,LZX) {KPN==LPN, KPY==LPY, KZN+LTN==KTN+1, KTN+LZX==KZX+LTN,
C    LARGE==LPRESS+126, LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, 7LTO==4LZY+3, LTN+NWH+1<=KTN, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO,
C    3KZX<=4LZX+380, NWH+1<=KZX, NWH+1<=KZY, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH}

         KZX = LZX                                                      0513

C  P(KZY,LZY) {KPN==LPN, KPY==LPY, 5KZN+LPY==5KTN+1, KZX==LZX,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, 15KTN<=3LPY+5LZX+1912,
C    LPY+5NWH+9<=5KTN+5LZX, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, NWH+1<=KZY,
C    1<=LZX, 3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH}

         KZY = LZY                                                      0514

C  P(I,IPH,J,K,K1QM,K2QM,K3QM,KPN,KPY,KZX,KZY,MEMSIZ,N1E,N2PD,NWQ,
C    NXXOUT,NXXXIN) {I==130, IPH==129, J==33, K==3, K1QM==16,
C    K2QM==32, K3QM==48, KPN==LPN, KPY==LPY, KZN+LTN==KTN+1, KZX==LZX,
C    KZY==LZY, LARGE==LPRESS+126, LARGE==MEMSIZ, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, N1E==16, N2PD==258,
C    3KTN<=3LTN+LZX+380, LTN+NWH+1<=KTN+LZX, LTN+NWH+1<=KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3<=LPN, 6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763,
C    1<=LTO, 1<=LZX, 1<=NWH, 1<=NWQ}

C
C IN PHYSICAL SPACE - FIND  (U,V).GRAD(T):
C
         DO 560 K = 1, 4                                                0515

C  P(KPY,MEMSIZ,NWQ,NXXXIN) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KZN+LTN==KTN+1, 4KZX+7LTO==4KZY+4LZX+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=4, K+LZX<=KZX+1, 3KTN<=3LTN+LZX+380,
C    LTN+NWH+1<=KTN+LZX, LTN+NWH+1<=KTN, 3KTN<=4LZX+380, NWH+1<=KTN,
C    3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH,
C    1<=NWQ}

            CALL IN(A, KPY, NWQ)                                        0516

C  P(KPN,MEMSIZ,NWQ,NXXXIN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, KZX+LZY==KZY+LZX, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=4, K+LZX<=KZX+1, 1<=KPY,
C    3KPY+3NWQ<=4LZX+380, 15KTN<=3LPY+5LZX+1912,
C    LPY+5NWH+9<=5KTN+5LZX, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(A(1,K1Q), KPN, NWQ)                                 0517

C  P(KZY,MEMSIZ,NWQ,NXXXIN) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KZN+LTN==KTN+1, 4KZX+7LTO==4KZY+4LZX+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=4, K+LZX<=KZX+1, 1<=KPN,
C    3KPN+3NWQ<=4LZX+380, 1<=KPY, 3KPY+3NWQ<=4LZX+380,
C    3KTN<=3LTN+LZX+380, LTN+NWH+1<=KTN+LZX, LTN+NWH+1<=KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3<=LPN, 6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763,
C    1<=LTO, 1<=LZX, 1<=NWH, 1<=NWQ}

            CALL IN(A(1,K2Q), KZY, NWQ)                                 0518

C  P(KZX,MEMSIZ,NWQ,NXXXIN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, KZX+LZY==KZY+LZX, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=4, K+LZX<=KZX+1, 1<=KPN,
C    3KPN+3NWQ<=4LZX+380, 1<=KPY, 3KPY+3NWQ<=4LZX+380,
C    15KTN<=3LPY+5LZX+1912, LPY+5NWH+9<=5KTN+5LZX, LPY+5NWH+9<=5KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 1<=KZY, 3KZY+3NWQ<=4LZX+380, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(A(1,K3Q), KZX, NWQ)                                 0519

C  P(I,IPH,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258}

            DO 570 I = 1, N2PD                                          0520

C  P(I,IPH,N2PD) {N2PD==258, 1<=I, I<=258}

               IPH = (I+1)/2                                            0521

C  P(IPH,N2PD) {N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

               GG = G(IPH)                                              0522

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

               DO 580 J = 1, N1E                                        0523

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH, 1<=J,
C    J<=16}

                  A(I,J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+J)   0524
     &            *GG                                                   0524

C  P(N1E,N2PD) {N1E==16, N2PD==258}

580               CONTINUE                                              0525

C  P(N2PD) {N2PD==258}

570            CONTINUE                                                 0526

C  P(KZY,MEMSIZ,NWQ,NXXOUT) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, KZX+LZY==KZY+LZX, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=4, K+LZX<=KZX+1, 1<=KPN,
C    3KPN+3NWQ<=4LZX+380, 1<=KPY, 3KPY+3NWQ<=4LZX+380,
C    15KTN<=3LPY+5LZX+1912, LPY+5NWH+9<=5KTN+5LZX, LPY+5NWH+9<=5KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 1<=KZX, 3KZX+3NWQ<=4LZX+380, 1<=KZY,
C    3KZY+3NWQ<=4LZX+380, 1<=LZX, 3LZY+3NW<=4LZX+380, 3NW<=LZX+380,
C    1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL OUT(A, KZY, NWQ)                                       0527

C  P(KPN,NWQ) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4, KZN+LTN==KTN+1,
C    4KZX+7LTO==4KZY+4LZX+3, LARGE==LPRESS+126, LARGE==MEMSIZ,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, 1<=K,
C    K<=4, K+LZX<=KZX+1, 1<=KPN, 3KPN+3NWQ<=4LZX+380, 1<=KPY,
C    3KPY+3NWQ<=4LZX+380, 3KTN<=3LTN+LZX+380, LTN+NWH+1<=KTN+LZX,
C    LTN+NWH+1<=KTN, 3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380,
C    NWH+1<=KZN, NWH+1<=KZO, 1<=KZX, 3KZX+3NWQ<=4LZX+380, 1<=KZY,
C    3KZY+3NWQ<=4LZX+380, 3<=LPN, 6LPN+21LTO<=16LZX+1535,
C    3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH, 1<=NWQ}

            KPN = KPN+NWQ                                               0528

C  P(KPY,NWQ) {KZX+2NW+NWQ==KPN+LZX-1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, KZX+LZY==KZY+LZX, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=4, K+LZX<=KZX+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 1<=KPY, 3KPY+3NWQ<=4LZX+380, 15KTN<=3LPY+5LZX+1912,
C    LPY+5NWH+9<=5KTN+5LZX, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, 1<=KZX,
C    3KZX+3NWQ<=4LZX+380, 1<=KZY, 3KZY+3NWQ<=4LZX+380, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KPY = KPY+NWQ                                               0529

C  P(KZX,NWQ) {KZX+LPN+NWQ==KPN+LZX, KZX+5LTN+NWQ==KPY+LZX+4,
C    KZN+LTN==KTN+1, 4KZX+7LTO==4KZY+4LZX+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=4, K+LZX<=KZX+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 3KTN<=3LTN+LZX+380,
C    LTN+NWH+1<=KTN+LZX, LTN+NWH+1<=KTN, 3KTN<=4LZX+380, NWH+1<=KTN,
C    3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO, 1<=KZX,
C    3KZX+3NWQ<=4LZX+380, 1<=KZY, 3KZY+3NWQ<=4LZX+380, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH,
C    1<=NWQ}

            KZX = KZX+NWQ                                               0530

C  P(KZY,NWQ) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY, 5KZN+LPY==5KTN+1,
C    KZY+LZX+NWQ==KZX+LZY, LARGE==LPRESS+126, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377,
C    1<=K, K<=4, K+LZX+NWQ<=KZX+1, 3KPN<=4LZX+380, NWQ+1<=KPN,
C    3KPY<=4LZX+380, NWQ+1<=KPY, 15KTN<=3LPY+5LZX+1912,
C    LPY+5NWH+9<=5KTN+5LZX, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN, NWH+1<=KZO,
C    3KZX<=4LZX+380, NWQ+1<=KZX, 1<=KZY, 3KZY+3NWQ<=4LZX+380, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KZY = KZY+NWQ                                               0531

C  P() {}

560         CONTINUE                                                    0532

C  P(ISIGN) {ISIGN==1}

         ISIGN = -1                                                     0533

C  P(LZY,MEMSIZ,NW,NXXXIN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, KZX+LZY==KZY+LZX, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 15KTN<=3LPY+5LZX+1912, LPY+5NWH+9<=5KTN+5LZX,
C    LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380,
C    NWH+1<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWQ+1<=KZY, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL IN(A, LZY, NW)                                            0534

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXRCS) {ISIGN==-1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

         CALL RCS(A, EX)                                                0535

C  P(LZY,MEMSIZ,NW,NXXOUT) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, KZX+LZY==KZY+LZX, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 15KTN<=3LPY+5LZX+1912, LPY+5NWH+9<=5KTN+5LZX,
C    LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380,
C    NWH+1<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWQ+1<=KZY, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL OUT(A, LZY, NW)                                           0536

C  P(KTN,LTN) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4, KZN+LTN==KTN+1,
C    4KZX+7LTO==4KZY+4LZX+3, LARGE==LPRESS+126, LARGE==MEMSIZ,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY,
C    3KTN<=3LTN+LZX+380, LTN+NWH+1<=KTN+LZX, LTN+NWH+1<=KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 3KZN<=4LZX+380, NWH+1<=KZN,
C    NWH+1<=KZO, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    3KZY<=4LZX+380, NWQ+1<=KZY, 3<=LPN, 6LPN+21LTO<=16LZX+1535,
C    3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH, 1<=NWQ}

         KTN = LTN                                                      0537

C  P(KTO,LTO) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY, KTN==LTN,
C    KZX+LZY==KZY+LZX, LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 15KZN+3LPY<=20LZX+1903,
C    5NWH+6<=5KZN+LPY, 3KZN<=4LZX+380, 3KZN<=LZX+383, NWH+2<=KZN+LZX,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWQ+1<=KZY, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         KTO = LTO                                                      0538

C  P(KZY,LZY) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4, KTN==LTN,
C    KTO==LTO, 4KZX+7LTO==4KZY+4LZX+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KZN+3LTN<=4LZX+383, NWH+2<=KZN+LTN, 3KZN<=4LZX+380,
C    3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    3KZX<=4LZX+380, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380,
C    NWQ+1<=KZY, 3<=LPN, 6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763,
C    1<=LTO, 1<=LZX, 1<=NWH, 1<=NWQ}

         KZY = LZY                                                      0539

C  P(I,J,K,K2Q,K2QJ,K2QM,KTN,KTO,KZY,MEMSIZ,N1H,N1Q,N2P,N2PD,NWH,
C    NXXOUT,NXXXIN) {I==259, J==17, K==5, K2Q==33, K2QJ==64, K2QM==32,
C    KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY, KTN==LTN, 7KTO==4LZY+3,
C    KZY==LZY, LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377, N1H==64, N1Q==32,
C    N2P==129, N2PD==258, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 1<=KTO, 21KTO+12KZX<=28LZX+1529,
C    4LZX+4NWQ+7<=7KTO+4KZX, 21KTO+12NW<=16LZX+1529,
C    15KZN+3LPY<=20LZX+1903, 5NWH+6<=5KZN+LPY, 3KZN<=4LZX+380,
C    3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    3KZX<=4LZX+380, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX, 3NW<=LZX+380,
C    1<=NW, 1<=NWH, 1<=NWQ}

         DO 590 K = 1, 2                                                0540

C  P(KTO,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    35KTN+20LZY==35KTO+7LPY+13, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 7K+4LZY<=7KTO+4, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 15KZN+3LPY<=20LZX+1903,
C    5NWH+6<=5KZN+LPY, 3KZN<=4LZX+380, 3KZN<=LZX+383, NWH+2<=KZN+LZX,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(CA, KTO, NWH)                                       0541

C  P(KTN,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KTN+LTO==KTO+LTN, 4KTO+3LTO==4KZY+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=2, K+LTO<=KTO+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 1<=KTO,
C    3KTO+3NWH<=4LZX+380, 3KZN+3LTN<=4LZX+383, NWH+2<=KZN+LTN,
C    3KZN<=4LZX+380, 3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN,
C    NWH+1<=KZO, 12KZX+21LTO<=28LZX+1529, 4LZX+4NWQ+7<=4KZX+7LTO,
C    3KZX<=4LZX+380, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH,
C    1<=NWQ}

            CALL IN(A(1,K2Q), KTN, NWH)                                 0542

C  P(I,J,K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258}

            DO 600 J = K2Q, N1H                                         0543

C  P(I,J,K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258, 33<=J, J<=64}

               DO 610 I = 1, N2PD                                       0544

C  P(I,J,K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258, 1<=I, I<=258,
C    33<=J, J<=64}

                  A(I,J) = 0.5*A(I,J)                                   0545

C  P(K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258}

610               CONTINUE                                              0546

C  P(K2Q,N1H) {K2Q==33, N1H==64}

600            CONTINUE                                                 0547

C  P(KTO,MEMSIZ,NWH,NXXOUT) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KTN+LTO==KTO+LTN, 4KTO+3LTO==4KZY+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=2, K+LTO<=KTO+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 1<=KTO, 3KTO+3NWH<=4LZX+380,
C    3KZN+3LTN<=4LZX+383, NWH+2<=KZN+LTN, 3KZN<=4LZX+380,
C    3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    12KZX+21LTO<=28LZX+1529, 4LZX+4NWQ+7<=4KZX+7LTO, 3KZX<=4LZX+380,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3<=LPN, 6LPN+21LTO<=16LZX+1535,
C    3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH, 1<=NWQ}

            CALL OUT(A(1,K2Q), KTO, NWH)                                0548

C  P(KZY,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    35KTN+20LZY==35KTO+7LPY+13, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 7K+4LZY<=7KTO+4, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 1<=KTO, 3KTO+3NWH<=4LZX+380,
C    15KZN+3LPY<=20LZX+1903, 5NWH+6<=5KZN+LPY, 3KZN<=4LZX+380,
C    3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX, 3LZY+3NW<=4LZX+380,
C    3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(CA(1,K2Q), KZY, NWH)                                0549

C  P(I,J,K2QJ,K2QM,N1Q,N2P) {I==259, J==65, K2QM==32, N1Q==32,
C    N2P==129}

            DO 620 J = 1, N1Q                                           0550

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

               K2QJ = J+K2QM                                            0551

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 33<=K2QJ,
C    K2QJ<=64}

               DO 630 I = 1, N2P                                        0552

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    33<=K2QJ, K2QJ<=64}

                  CA(I,J) = CA(I,J)+DTFAC*CA(I,K2QJ)                    0553

C  P(N1Q,N2P) {N1Q==32, N2P==129}

630               CONTINUE                                              0554

C  P(N1Q) {N1Q==32}

620            CONTINUE                                                 0555

C  P(KTN,MEMSIZ,NWH,NXXOUT) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KTN+LTO==KTO+LTN, 4KTO+3LTO==4KZY+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=2, K+LTO<=KTO+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 1<=KTO, 3KTO+3NWH<=4LZX+380,
C    3KZN+3LTN<=4LZX+383, NWH+2<=KZN+LTN, 3KZN<=4LZX+380,
C    3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    12KZX+21LTO<=28LZX+1529, 4LZX+4NWQ+7<=4KZX+7LTO, 3KZX<=4LZX+380,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY, 3KZY+3NWH<=4LZX+380, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH,
C    1<=NWQ}

            CALL OUT(CA, KTN, NWH)                                      0556

C  P(KTN,NWH) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    35KTN+20LZY==35KTO+7LPY+13, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 1<=K, K<=2, 7K+4LZY<=7KTO+4, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 1<=KTO, 3KTO+3NWH<=4LZX+380,
C    15KZN+3LPY<=20LZX+1903, 5NWH+6<=5KZN+LPY, 3KZN<=4LZX+380,
C    3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY, 3KZY+3NWH<=4LZX+380, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KTN = KTN+NWH                                               0557

C  P(KTO,NWH) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KTO+LTN+NWH==KTN+LTO, 4KTO+3LTO==4KZY+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 1<=K, K<=2, K+LTO<=KTO+1, 3KPN<=4LZX+380,
C    NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 1<=KTO, 3KTO+3NWH<=4LZX+380, 3KZN+3LTN<=4LZX+383,
C    NWH+2<=KZN+LTN, 3KZN<=4LZX+380, 3KZN<=LZX+383, NWH+2<=KZN+LZX,
C    NWH+2<=KZN, NWH+1<=KZO, 12KZX+21LTO<=28LZX+1529,
C    4LZX+4NWQ+7<=4KZX+7LTO, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 1<=KZY, 3KZY+3NWH<=4LZX+380, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 1<=LTO, 1<=LZX, 1<=NWH,
C    1<=NWQ}

            KTO = KTO+NWH                                               0558

C  P(KZY,NWH) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    35KTN+20LZY==35KTO+7LPY+13, 7KTO+3LZY==7KZY+7NWH+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, 1<=K, K<=2,
C    7K+4LZY+7NWH<=7KTO+4, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN, 3KTO<=4LZX+380,
C    NWH+1<=KTO, 15KZN+3LPY<=20LZX+1903, 5NWH+6<=5KZN+LPY,
C    3KZN<=4LZX+380, 3KZN<=LZX+383, NWH+2<=KZN+LZX, NWH+2<=KZN,
C    NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY,
C    3KZY+3NWH<=4LZX+380, 1<=LZX, 3LZY+3NW<=4LZX+380, 3NW<=LZX+380,
C    1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KZY = KZY+NWH                                               0559

C  P() {}

590         CONTINUE                                                    0560
      ENDIF

C  P() {}


      DTF = 0.25*DTT*FX                                                 0561

C  P() {}

      F = -DTF                                                          0562

C  P(KZN,LZN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    35KTN+20LZY==35KTO+7LPY+13, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, LZN==1,
C    4LZX==3MEMSIZ-377, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN, 3KTO<=4LZX+380,
C    4LZY+7NWH+10<=7KTO, NWH+1<=KTO, 15KZN+3LPY<=20LZX+1903,
C    5NWH+6<=5KZN+LPY, 3KZN<=4LZX+380, 3KZN<=LZX+383, NWH+2<=KZN+LZX,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380,
C    NWH+1<=KZY, 1<=LZX, 3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

      KZN = LZN                                                         0563

C  P(KTN,LTN) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+5LTN-4,
C    KTN+LTO==KTO+LTN, 4KTO+3LTO==4KZY+3, LARGE==LPRESS+126,
C    LARGE==MEMSIZ, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN, LTO+NWH+1<=KTO,
C    3KTO<=4LZX+380, NWH+1<=KTO, NWH+1<=KZO, 12KZX+21LTO<=28LZX+1529,
C    4LZX+4NWQ+7<=4KZX+7LTO, 3KZX<=4LZX+380, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY, 3<=LPN,
C    6LPN+21LTO<=16LZX+1535, 3LPN<=2LZX+763, 3NWH<=3LTN+4LZX+374,
C    3NWH<=3LTN+LZX+377, 3LTN+3NWH<=7LZX+377, 3LTN+3NWH<=4LZX+377,
C    1<=LTO, 1<=LZX, 3NWH<=7LZX+374, 3NWH<=4LZX+374, 3NWH<=LZX+377,
C    1<=NWH, 1<=NWQ}

      KTN = LTN                                                         0564

C  P(I,J,K,K2QJ,K2QM,KTN,KZN,MEMSIZ,N1Q,N2P,NOTEMP,NWH,NXXOUT,NXXXIN)
C    {I==130, J==33, K==3, K2QJ==64, K2QM==32, KPN+LZX==KZX+2NW+1,
C    KPY+LZX==KZX+LPY, KTN==LTN, 7KTO+3LZY==7KZY+3, KZN==1,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, N1Q==32, N2P==129, NOTEMP==0,
C    3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 3NWH<=7LZX+374, 3NWH<=4LZX+374,
C    3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

      DO 640 K = 1, 2                                                   0565

C  P(KTN,MEMSIZ,NOTEMP,NWH,NXXXIN) {KPN+LZX==KZX+2NW+1,
C    KPY+LZX==KZX+LPY, 5KZN+LPY==5KTN+1, 7KTO+3LZY==7KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, NOTEMP==0, 1<=K, K<=2, K<=KZN,
C    3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 3NWH<=7LZX+374, 3NWH<=4LZX+374,
C    3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         IF (NOTEMP.NE.1) CALL IN(CA, KTN, NWH)                         0566

C  P(KZN,MEMSIZ,NWH,NXXXIN) {4KPN+3MEMSIZ==4KZX+4LPN+377,
C    4KPY+3MEMSIZ==4KZX+20LTN+361, KZN+LTN==KTN+1, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, 1<=K, K<=2,
C    K<=KZN, KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    1<=KTN, KTN+NWH<=MEMSIZ+1, KTO+LTN<=LTO+MEMSIZ+1,
C    LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    NWH+1<=KZO, 4KZX+7LTO+370<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+7LTO+370,
C    KZX<=MEMSIZ+1, 3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1,
C    NWH+1<=KZY, 3<=LPN, 2LPN+7LTO<=4MEMSIZ+9, 2LPN<=MEMSIZ+383,
C    4NWH<=4LTN+MEMSIZ+377, NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ,
C    4LTN+4NWH+377<=7MEMSIZ, 1<=LTO, 127<=MEMSIZ, 4NWH+381<=7MEMSIZ,
C    NWH+1<=MEMSIZ, 4NWH<=MEMSIZ+377, 1<=NWH, 1<=NWQ}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0568

C  P(I,J,K2QJ,K2QM,N1Q,N2P,NOTEMP) {K2QM==32, N1Q==32, N2P==129,
C    NOTEMP==0}

         DO 650 J = 1, N1Q                                              0569

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

            K2QJ = J+K2QM                                               0570

C  P(N1Q) {N1Q==32}

            F = F+DTF                                                   0571

C  P(I,J,N1Q,N2P,NOTEMP) {J==K2QJ-32, N1Q==32, N2P==129, NOTEMP==0,
C    33<=K2QJ, K2QJ<=64}

            IF (NOTEMP.NE.1) THEN                                       0572

C  P(I,J,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 33<=K2QJ, K2QJ<=64}

               DO 660 I = 1, N2P                                        0573

C  P(I,N1Q,N2P) {N1Q==32, N2P==129, 1<=I, I<=129}

                  WORK(I) = F*U(I)                                      0574

C  P(I,J,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    33<=K2QJ, K2QJ<=64}

                  CA(I,J) = CMPLX(1.0, -WORK(I))*CA(I,J)/(1.0+WORK(I)   0575
     &            *WORK(I))                                             0575

C  P(N1Q,N2P) {N1Q==32, N2P==129}

660               CONTINUE                                              0576
            ENDIF

C  P(I,K2QJ,N1Q,N2P) {I==130, J==K2QJ-32, N1Q==32, N2P==129, 33<=K2QJ,
C    K2QJ<=64}


            DO 670 I = 1, N2P                                           0577

C  P(I,N1Q,N2P) {N1Q==32, N2P==129, 1<=I, I<=129}

               WORK(I) = F*U(I)                                         0578

C  P(I,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    33<=K2QJ, K2QJ<=64}

               CA(I,K2QJ) = CMPLX(1.0, -WORK(I))*CA(I,K2QJ)/(1.0+WORK   0579
     &         (I)*WORK(I))                                             0579

C  P(N1Q,N2P) {N1Q==32, N2P==129}

670            CONTINUE                                                 0580

C  P(N1Q) {N1Q==32}

650         CONTINUE                                                    0581

C  P(KTN,MEMSIZ,NOTEMP,NWH,NXXOUT) {KPN+LZX==KZX+2NW+1,
C    KPY+LZX==KZX+LPY, 5KZN+LPY==5KTN+1, 7KTO+3LZY==7KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, 4LZX==3MEMSIZ-377, NOTEMP==0, 1<=K, K<=2, K<=KZN,
C    3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380, NWQ+1<=KPY, 1<=KTN,
C    3KTN+3NWH<=4LZX+380, 105KTO+21LPY<=140LZX+60LZY+13261,
C    20LZY+35NWH+22<=35KTO+7LPY, 3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO,
C    NWH+1<=KTO, 1<=KZN, 3KZN+3NWH<=4LZX+380, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=LZX+380, 3NWH<=7LZX+374, 3NWH<=4LZX+374,
C    3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         IF (NOTEMP.NE.1) CALL OUT(CA, KTN, NWH)                        0582

C  P(KZN,MEMSIZ,NWH,NXXOUT) {4KPN+3MEMSIZ==4KZX+4LPN+377,
C    4KPY+3MEMSIZ==4KZX+20LTN+361, KZN+LTN==KTN+1, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, 1<=K, K<=2,
C    K<=KZN, KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    1<=KTN, KTN+NWH<=MEMSIZ+1, KTO+LTN<=LTO+MEMSIZ+1,
C    LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    1<=KZN, KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, 4KZX+7LTO+370<=7MEMSIZ,
C    3MEMSIZ+4NWQ<=4KZX+7LTO+370, KZX<=MEMSIZ+1,
C    3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1, NWH+1<=KZY,
C    3<=LPN, 2LPN+7LTO<=4MEMSIZ+9, 2LPN<=MEMSIZ+383,
C    4NWH<=4LTN+MEMSIZ+377, NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ,
C    4LTN+4NWH+377<=7MEMSIZ, 1<=LTO, 127<=MEMSIZ, 4NWH+381<=7MEMSIZ,
C    NWH+1<=MEMSIZ, 4NWH<=MEMSIZ+377, 1<=NWH, 1<=NWQ}

         CALL OUT(CA(1,K2Q), KZN, NWH)                                  0584

C  P(KTN,NWH) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY, 5KZN+LPY==5KTN+1,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377,
C    1<=K, K<=2, K<=KZN, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 1<=KTN, 3KTN+3NWH<=4LZX+380,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, 1<=KZN,
C    3KZN+3NWH<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380,
C    3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY, 15NWH<=3LPY+20LZX+1882,
C    15NWH<=3LPY+5LZX+1897, 3LPY+15NWH<=35LZX+1873,
C    3LPY+15NWH<=20LZX+1873, 1<=LZX, 3LZY+3NW<=4LZX+380, 3NW<=LZX+380,
C    3NWH<=7LZX+374, 3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

         KTN = KTN+NWH                                                  0585

C  P(KZN,NWH) {4KPN+3MEMSIZ==4KZX+4LPN+377,
C    4KPY+3MEMSIZ==4KZX+20LTN+361, KZN+LTN+NWH==KTN+1,
C    4KTO+3LTO==4KZY+3, LARGE==LPRESS+126, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    1<=K, K<=2, K<=KZN, KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1,
C    NWQ+1<=KPY, KTN<=MEMSIZ+1, NWH+1<=KTN, KTO+LTN<=LTO+MEMSIZ+1,
C    LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    1<=KZN, KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, 4KZX+7LTO+370<=7MEMSIZ,
C    3MEMSIZ+4NWQ<=4KZX+7LTO+370, KZX<=MEMSIZ+1,
C    3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1, NWH+1<=KZY,
C    3<=LPN, 2LPN+7LTO<=4MEMSIZ+9, 2LPN<=MEMSIZ+383,
C    4NWH<=4LTN+MEMSIZ+377, NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ,
C    4LTN+4NWH+377<=7MEMSIZ, 1<=LTO, 127<=MEMSIZ, 4NWH+381<=7MEMSIZ,
C    NWH+1<=MEMSIZ, 4NWH<=MEMSIZ+377, 1<=NWH, 1<=NWQ}

         KZN = KZN+NWH                                                  0586

C  P() {}

640      CONTINUE                                                       0587

C  P(N2,NPTS) {N2==128, NPTS==128}

      NPTS = 2*N2                                                       0588

C  P(NSKIP) {NSKIP==129}

      NSKIP = 1                                                         0589

C  P(MTRN,N1H) {MTRN==129, N1H==64}

      MTRN = N1H                                                        0590

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

      MSKIP = N2P                                                       0591

C  P(ISIGN) {ISIGN==-1}

      ISIGN = -1                                                        0592

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0593

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

      CALL XLOG2(NPTS, LOG)                                             0594

C  P(LZN,MEMSIZ,NW,NXXXIN) {4KPN+3MEMSIZ==4KZX+4LPN+377,
C    4KPY+3MEMSIZ==4KZX+20LTN+361, KZN+LTN==KTN+1, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, LZN==1,
C    KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KTO+LTN<=LTO+MEMSIZ+1,
C    LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO, 4KZX+7LTO+370<=7MEMSIZ,
C    3MEMSIZ+4NWQ<=4KZX+7LTO+370, KZX<=MEMSIZ+1,
C    3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1, NWH+1<=KZY,
C    3<=LPN, 2LPN+7LTO<=4MEMSIZ+9, 2LPN<=MEMSIZ+383,
C    4NWH<=4LTN+MEMSIZ+377, NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ,
C    4LTN+4NWH+377<=7MEMSIZ, 1<=LTO, 127<=MEMSIZ, 4NWH+381<=7MEMSIZ,
C    NWH+1<=MEMSIZ, 4NWH<=MEMSIZ+377, 1<=NWH, 1<=NWQ}

      CALL IN(A, LZN, NW)                                               0595

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL ACAC(A, EX, WORK)                                            0596

C  P(LZN,MEMSIZ,NW,NXXOUT) {4KPN+3MEMSIZ==4KZX+4LPN+377,
C    4KPY+3MEMSIZ==4KZX+20LTN+361, KZN+LTN==KTN+1, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, LZN==1,
C    KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KTO+LTN<=LTO+MEMSIZ+1,
C    LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO, 4KZX+7LTO+370<=7MEMSIZ,
C    3MEMSIZ+4NWQ<=4KZX+7LTO+370, KZX<=MEMSIZ+1,
C    3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1, NWH+1<=KZY,
C    3<=LPN, 2LPN+7LTO<=4MEMSIZ+9, LPN<=2MEMSIZ+1, 2LPN<=MEMSIZ+383,
C    4NWH<=4LTN+MEMSIZ+377, NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ,
C    4LTN+4NWH+377<=7MEMSIZ, 1<=LTO, 127<=MEMSIZ, 4NWH+381<=7MEMSIZ,
C    NWH+1<=MEMSIZ, 4NWH<=MEMSIZ+377, 1<=NWH, 1<=NWQ}

      CALL OUT(A, LZN, NW)                                              0597

C  P(IEXSHF,ISIGN,LOG,LTN,MEMSIZ,MSKIP,MTRN,NFTVMT,NOTEMP,NPTS,NSKIP,
C    NSTEPS,NUMBER,NW,NXACAC,NXXOUT,NXXXIN) {ISIGN==-1,
C    KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY, 5KZN+LPY==5KTN+1,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377,
C    MSKIP==129, MTRN==64, NOTEMP==0, NPTS==256, NSKIP==1,
C    NUMBER==250, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, 3KZN<=4LZX+380,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380,
C    NWH+1<=KZY, 15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0598

C  P(LTN,MEMSIZ,NW,NXXXIN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, 3KZN<=4LZX+380,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380,
C    NWH+1<=KZY, 15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL IN(A, LTN, NW)                                            0599

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL ACAC(A, EX, WORK)                                         0600

C  P(LTN,MEMSIZ,NW,NXXOUT) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY,
C    5KZN+LPY==5KTN+1, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3,
C    4LZX==3MEMSIZ-377, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, 3KZN<=4LZX+380,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380,
C    NWH+1<=KZY, 1<=LPY, 3LPY+15NW<=20LZX+1888,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL OUT(A, LTN, NW)                                           0601
      ENDIF

C  P(KZN,LZN) {KPN+LZX==KZX+2NW+1, KPY+LZX==KZX+LPY, 5KZN+LPY==5KTN+1,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, LZN==1,
C    4LZX==3MEMSIZ-377, 3KPN<=4LZX+380, NWQ+1<=KPN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 3KTN<=4LZX+380, NWH+1<=KTN,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, 3KZN<=4LZX+380,
C    NWH+2<=KZN, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380,
C    NWH+1<=KZY, 1<=LPY, 3LPY+15NW<=20LZX+1888,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}


      KZN = LZN                                                         0602

C  P(KPN,LPN) {4KPN+3MEMSIZ==4KZX+4LPN+377,
C    4KPY+3MEMSIZ==4KZX+20LTN+361, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, KPN<=MEMSIZ+1,
C    NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY, KTN<=LTN+MEMSIZ,
C    LTN+NWH+1<=KTN, KTN<=MEMSIZ+1, NWH+1<=KTN, KTO+LTN<=LTO+MEMSIZ+1,
C    LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    NWH+1<=KZO, 4KZX+7LTO+370<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+7LTO+370,
C    KZX<=MEMSIZ+1, 3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1,
C    NWH+1<=KZY, 3<=LPN, LPN+2LTN<=2MEMSIZ+3, 2LPN+7LTO<=4MEMSIZ+9,
C    LPN<=2MEMSIZ+1, 2LPN<=MEMSIZ+383, 1<=LTN, 4NWH<=4LTN+MEMSIZ+377,
C    NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ, 4LTN+4NWH+377<=7MEMSIZ,
C    1<=LTO, 127<=MEMSIZ, 4NWH+381<=7MEMSIZ, NWH+1<=MEMSIZ,
C    4NWH<=MEMSIZ+377, 1<=NWH, 1<=NWQ}

      KPN = LPN                                                         0603

C  P(N2) {N2==128}

      F2 = 1./(4.*REAL(N2))                                             0604

C  P() {}

      F1 = RNU*DTT                                                      0605

C  P(LEIG,MEMSIZ,NWEIG,NXXXIN) {KPN==LPN, KPY+LZX==KZX+LPY,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377,
C    NWEIG==127, 3KPY<=4LZX+380, NWQ+1<=KPY, 15KTN<=3LPY+20LZX+1897,
C    LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380, NWH+1<=KTN,
C    105KTO+21LPY<=140LZX+60LZY+13261, 20LZY+35NWH+22<=35KTO+7LPY,
C    3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO, NWH+1<=KTO, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, LZX+NWQ+1<=KZX+LZY,
C    3KZX+6NW<=7LZX+377, LZX+NWQ<=KZX+2NW, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    3KZY<=4LZX+380, NWH+1<=KZY, 1<=LPY, 3LPY+15NW<=20LZX+1888,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

C
C FIND PRESSURE NOW OR NEVER (IF REQUIRED...)
C
      CALL IN(EVAL, LEIG, NWEIG)                                        0606

C  P(LVECT,N2M) {LVECT==127, N2M==127}

      LVECT = N2M                                                       0607

C  P(LSKIP) {LSKIP==2}

      LSKIP = 2                                                         0608

C  P(NVECT) {NVECT==2}

      NVECT = 2                                                         0609

C  P(NVSKIP) {NVSKIP==1}

      NVSKIP = 1                                                        0610

C  P() {}

      FXSQ = FX*FX                                                      0611

C  P(I,J,KPN,KZN,MEMSIZ,N1H,N2,N2P,N2PD,NXXOUT,NXXXIN) {I==130, J==33,
C    KPN==LPN, KPY+LZX==KZX+LPY, 7KTO+3LZY==7KZY+3, KZN==1,
C    LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377, N1H==64, N2==128,
C    N2P==129, N2PD==258, 3KPY<=4LZX+380, NWQ+1<=KPY,
C    15KTN<=3LPY+20LZX+1897, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    NWH+1<=KTN, 105KTO+21LPY<=140LZX+60LZY+13261,
C    20LZY+35NWH+22<=35KTO+7LPY, 3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO,
C    NWH+1<=KTO, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, 3KZX+6NW<=7LZX+377, LZX+NWQ<=KZX+2NW,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 3LPY+15NW<=20LZX+1888,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

C
C UPDATE VORTICITY AND FIND THE NEW STREAMFUNCTION:
C
      DO 680 J = 1, N1H                                                 0612

C  P(KZN,MEMSIZ,N1H,N2PD,NXXXIN) {KZN+2NW==KPN, KPY+LZX==KZX+LPY,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN, 3KPY<=4LZX+380,
C    NWQ+1<=KPY, 15KTN<=3LPY+20LZX+1897, LPY+5NWH+9<=5KTN,
C    3KTN<=4LZX+380, NWH+1<=KTN, 105KTO+21LPY<=140LZX+60LZY+13261,
C    20LZY+35NWH+22<=35KTO+7LPY, 3KTO<=4LZX+380, 4LZY+7NWH+10<=7KTO,
C    NWH+1<=KTO, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    LZX+NWQ+1<=KZX+LZY, 3KZX+6NW<=7LZX+377, LZX+NWQ<=KZX+2NW,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 3KZY<=4LZX+380, NWH+1<=KZY, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 3LPY+15NW<=20LZX+1888,
C    15NWH<=3LPY+20LZX+1882, 15NWH<=3LPY+5LZX+1897,
C    3LPY+15NWH<=35LZX+1873, 3LPY+15NWH<=20LZX+1873, 1<=LZX,
C    3LZY+3NW<=4LZX+380, 3NW<=4LZX+377, 3NW<=LZX+380, 3NWH<=7LZX+374,
C    3NWH<=4LZX+374, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL IN(CWORK, KZN, N2PD)                                      0613

C  P(J,N1H) {KZN+LPN==KPN+1, 4KPY+3MEMSIZ==4KZX+20LTN+361,
C    4KTO+3LTO==4KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    N1H==64, 1<=J, J<=64, J<=KZN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    KTN<=LTN+MEMSIZ, LTN+NWH+1<=KTN, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KTO+LTN<=LTO+MEMSIZ+1, LTO+NWH+1<=KTO+LTN, LTO+NWH+1<=KTO,
C    KTO<=MEMSIZ+1, NWH+1<=KTO, 1<=KZN, KZN+257<=MEMSIZ, NWH+1<=KZO,
C    4KZX+4LPN+373<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+4LPN+373,
C    4KZX+7LTO+370<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+7LTO+370,
C    KZX<=MEMSIZ+1, 3MEMSIZ+4NWQ<=4KZX+365, NWQ+1<=KZX, KZY<=MEMSIZ+1,
C    NWH+1<=KZY, 3<=LPN, LPN+2LTN<=2MEMSIZ+3, 2LPN+7LTO<=4MEMSIZ+9,
C    LPN<=2MEMSIZ+1, 2LPN<=MEMSIZ+383, 1<=LTN, 4NWH<=4LTN+MEMSIZ+377,
C    NWH+1<=LTN+MEMSIZ, LTN+NWH<=MEMSIZ, 4LTN+4NWH+377<=7MEMSIZ,
C    1<=LTO, 1<=LZO, 8LZO+373<=3MEMSIZ, 127<=MEMSIZ,
C    4NWH+381<=7MEMSIZ, NWH+1<=MEMSIZ, 4NWH<=MEMSIZ+377, 1<=NWH,
C    1<=NWQ}

         F = REAL((J-1)*(J-1))*FXSQ                                     0614

C  P(I,N1H,N2) {N1H==64, N2==128}

         DO 690 I = 2, N2                                               0615

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

            CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))               0616

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

            CWORK2(I) = CWORK(I)/(EVAL(I-1)-F)                          0617

C  P(N1H,N2) {N1H==64, N2==128}

690         CONTINUE                                                    0618

C  P(N1H) {N1H==64}

         CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                              0619

C  P(N1H) {N1H==64}

         CWORK2(1) = 0.0                                                0620

C  P(N1H) {N1H==64}

         IF (F.NE.0.0) CWORK2(1) = -CWORK(1)/F                          0621

C  P(N1H,N2P) {N1H==64, N2P==129}

         CWORK(N2P) = 0.0                                               0623

C  P(N1H,N2P) {N1H==64, N2P==129}

         CWORK2(N2P) = 0.0                                              0624

C  P(KZN,MEMSIZ,N1H,N2PD,NXXOUT) {KZN+2NW==KPN,
C    4KPY+3MEMSIZ==4KZX+4LPY+377, 7KTO+3LZY==7KZY+3, 3LARGE==4LZX+377,
C    LARGE==MEMSIZ, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, 7LTO==4LZY+3, N1H==64, N2PD==258, 1<=J, J<=64,
C    J<=KZN, KPY<=MEMSIZ+1, LPY+5NWH+9<=5KTN, KTN<=MEMSIZ+1,
C    35KTO+7LPY<=20LZY+35MEMSIZ+22, 4LZY+7NWH+10<=7KTO,
C    KZN+257<=MEMSIZ, NWH+1<=KZO, 4KZX+4LZY+373<=7MEMSIZ,
C    KZX<=MEMSIZ+1, 4KZX+8NW+377<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+365,
C    KZY<=MEMSIZ+1, 1<=LEIG, LEIG+126<=MEMSIZ, 1<=LPY, 1<=LZY,
C    LZY+NW<=MEMSIZ+1, 4NW<=MEMSIZ+381, 4NWH<=MEMSIZ+377, 1<=NW,
C    1<=NWH, 1<=NWQ}

         CALL OUT(CWORK, KZN, N2PD)                                     0625

C  P(KPN,MEMSIZ,N1H,N2PD,NXXOUT) {KZN+LPN==KPN+1,
C    4KPY+3LPRESS==4KZX+20LTN-17, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377, N1H==64, N2PD==258,
C    1<=J, J<=64, J<=KZN, KPY<=LPRESS+127, KTN<=LPRESS+127,
C    LTN+NWH+1<=KTN, KTO+LTN<=LPRESS+LTO+127, LTO+NWH+1<=KTO, 1<=KZN,
C    KZN+131<=LPRESS, NWH+1<=KZO, 4KZX+4LPN<=7LPRESS+509,
C    KZX<=LPRESS+127, 4KZX+7LTO<=7LPRESS+512, 3LPRESS+4NWQ+13<=4KZX,
C    KZY<=LPRESS+127, 3<=LPN, 2LPN<=LPRESS+509,
C    2LPN+7LTO<=4LPRESS+513, 8LZO<=3LPRESS+5, 4NWH<=LPRESS+503,
C    1<=LTN, 1<=LTO, 1<=LZO, 1<=NWH, 1<=NWQ}

         CALL OUT(CWORK2, KPN, N2PD)                                    0626

C  P(KPN,N1H,N2PD) {KZN+2NW==KPN, 4KPY+3MEMSIZ==4KZX+4LPY+377,
C    7KTO+3LZY==7KZY+3, 3LARGE==4LZX+377, LARGE==MEMSIZ,
C    3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1, LPY==5LTN-4,
C    7LTO==4LZY+3, N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN, 1<=KPN,
C    KPN+257<=MEMSIZ, KPY<=MEMSIZ+1, LPY+5NWH+9<=5KTN, KTN<=MEMSIZ+1,
C    35KTO+7LPY<=20LZY+35MEMSIZ+22, 4LZY+7NWH+10<=7KTO, 1<=KZN,
C    KZN+257<=MEMSIZ, NWH+1<=KZO, 4KZX+4LZY+373<=7MEMSIZ,
C    KZX<=MEMSIZ+1, 4KZX+8NW+377<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+365,
C    KZY<=MEMSIZ+1, 1<=LEIG, LEIG+126<=MEMSIZ, 1<=LPY, 1<=LZY,
C    LZY+NW<=MEMSIZ+1, 4NW<=MEMSIZ+381, 4NWH<=MEMSIZ+377, 1<=NW,
C    1<=NWH, 1<=NWQ}

         KPN = KPN+N2PD                                                 0627

C  P(KZN,N1H,N2PD) {KZN+LPN==KPN-257, 4KPY+3LPRESS==4KZX+20LTN-17,
C    4KTO+3LTO==4KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, 4LZX==3MEMSIZ-377,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN, 259<=KPN,
C    KPN<=LPRESS+127, KPY<=LPRESS+127, KTN<=LPRESS+127,
C    LTN+NWH+1<=KTN, KTO+LTN<=LPRESS+LTO+127, LTO+NWH+1<=KTO, 1<=KZN,
C    KZN+131<=LPRESS, NWH+1<=KZO, 4KZX+4LPN<=7LPRESS+509,
C    KZX<=LPRESS+127, 4KZX+7LTO<=7LPRESS+512, 3LPRESS+4NWQ+13<=4KZX,
C    KZY<=LPRESS+127, 3<=LPN, 2LPN<=LPRESS+509,
C    2LPN+7LTO<=4LPRESS+513, 8LZO<=3LPRESS+5, 4NWH<=LPRESS+503,
C    1<=LTN, 1<=LTO, 1<=LZO, 1<=NWH, 1<=NWQ}

         KZN = KZN+N2PD                                                 0628

C  P(N1H) {N1H==64}

680      CONTINUE                                                       0629

C  P(LZN,MEMSIZ,N1H,N2P,NOALS,NXXOUT,NXXXIN) {KZN+2NW==KPN,
C    4KPY+3MEMSIZ==4KZX+4LPY+377, 7KTO+3LZY==7KZY+3, 3LARGE==4LZX+377,
C    LARGE==MEMSIZ, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPY==5LTN-4, 7LTO==4LZY+3, LZN==1, N1H==64, N2P==129, NOALS==1,
C    259<=KPN, KPN<=MEMSIZ+1, KPY<=MEMSIZ+1, LPY+5NWH+9<=5KTN,
C    KTN<=MEMSIZ+1, 35KTO+7LPY<=20LZY+35MEMSIZ+22, 4LZY+7NWH+10<=7KTO,
C    322<=KZN, KZN<=MEMSIZ+1, NWH+1<=KZO, 4KZX+4LZY+373<=7MEMSIZ,
C    KZX<=MEMSIZ+1, 4KZX+8NW+377<=7MEMSIZ, 3MEMSIZ+4NWQ<=4KZX+365,
C    KZY<=MEMSIZ+1, 1<=LEIG, LEIG+126<=MEMSIZ, 1<=LPY, 1<=LZY,
C    LZY+NW<=MEMSIZ+1, 4NW<=MEMSIZ+381, 4NWH<=MEMSIZ+377, 1<=NW,
C    1<=NWH, 1<=NWQ}

C
C DE-ALIASE UPDATED FIELDS IF REQUESTED:
C
      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LZN)                    0630

C  P(LPN,MEMSIZ,N1H,N2P,NOALS,NXXOUT,NXXXIN) {KZN+2NW==KPN,
C    KPY+LZX==KZX+LPY, 7KTO+3LZY==7KZY+3, LARGE==LPRESS+126,
C    3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1, LPRESS==MEMSIZ-126,
C    LPY==5LTN-4, 7LTO==4LZY+3, N1H==64, N2P==129, NOALS==1, 259<=KPN,
C    3KPN<=4LZX+380, 3KPY<=4LZX+380, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    105KTO+21LPY<=140LZX+60LZY+13261, 4LZY+7NWH+10<=7KTO, 322<=KZN,
C    3KZN<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    3KZX+6NW<=7LZX+377, LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 0<=LZX+93, 3LZY+3NW<=4LZX+380,
C    3NW<=LZX+380, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LPN)                    0632

C  P(I,J,KTN,LEIG,LTN,MEMSIZ,N1H,N2,N2P,N2PD,NOALS,NOTEMP,NWEIG,
C    NXXOUT,NXXXIN) {I==129, J==65, KZN+2NW==KPN, KPY+LZX==KZX+LPY,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    N1H==64, N2==128, N2P==129, N2PD==258, NOALS==1, NOTEMP==0,
C    NWEIG==127, 259<=KPN, 3KPN<=4LZX+380, 3KPY<=4LZX+380,
C    LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    105KTO+21LPY<=140LZX+60LZY+13261, 4LZY+7NWH+10<=7KTO, 322<=KZN,
C    3KZN<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    3KZX+6NW<=7LZX+377, LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 0<=LZX+93, 3LZY+3NW<=4LZX+380,
C    3NW<=2LZX+187, 3NW<=LZX+380, 3NWH<=LZX+377, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0634

C  P(LEIG,MEMSIZ,NOALS,NWEIG,NXXXIN) {KZN+2NW==KPN, KPY+LZX==KZX+LPY,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    NOALS==1, NWEIG==127, 259<=KPN, 3KPN<=4LZX+380, 3KPY<=4LZX+380,
C    LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    105KTO+21LPY<=140LZX+60LZY+13261, 4LZY+7NWH+10<=7KTO, 322<=KZN,
C    3KZN<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    3KZX+6NW<=7LZX+377, LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 0<=LZX+93, 3LZY+3NW<=4LZX+380,
C    3NW<=2LZX+187, 3NW<=LZX+380, 3NWH<=LZX+377, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

C
C UPDATE TEMPERATURE:
C
         IF (NOALS.EQ.1) CALL IN(EVAL, LEIG, NWEIG)                     0635

C  P(KTN,LTN) {KZN+2NW==KPN, KPY+LZX==KZX+LPY, 7KTO+3LZY==7KZY+3,
C    LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, 259<=KPN,
C    3KPN<=4LZX+380, 3KPY<=4LZX+380, LPY+5NWH+9<=5KTN, 3KTN<=4LZX+380,
C    105KTO+21LPY<=140LZX+60LZY+13261, 4LZY+7NWH+10<=7KTO, 322<=KZN,
C    3KZN<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    3KZX+6NW<=7LZX+377, LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 0<=LZX+92, 3LZY+3NW<=4LZX+380,
C    3NW<=2LZX+187, 3NW<=LZX+380, 3NWH<=LZX+377, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

         KTN = LTN                                                      0637

C  P() {}

         F1 = RKAPA*DTT                                                 0638

C  P(I,J,KTN,MEMSIZ,N1H,N2,N2P,N2PD,NXXOUT,NXXXIN) {I==129, J==65,
C    KZN+2NW==KPN, KPY+LZX==5KTN+KZX-4, 5KTN==LPY+4,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    N1H==64, N2==128, N2P==129, N2PD==258, 259<=KPN, 3KPN<=4LZX+380,
C    3KPY<=4LZX+380, 1<=KTN, 21KTN+21KTO<=28LZX+12LZY+2669,
C    3KTN+3NWH<=4LZX+377, 4LZY+7NWH+10<=7KTO, 322<=KZN,
C    3KZN<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    3KZX+6NW<=7LZX+377, LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG,
C    3LEIG+1<=4LZX, 0<=LZX+92, 3LZY+3NW<=4LZX+380, 3NW<=2LZX+187,
C    3NW<=LZX+380, 3NWH<=LZX+377, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         DO 700 J = 1, N1H                                              0639

C  P(KTN,MEMSIZ,N1H,N2PD,NXXXIN) {KZN+2NW==KPN, KPY+LZX==KZX+LPY,
C    7KTO+3LZY==7KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    N1H==64, N2PD==258, 1<=J, J<=64, 5J+LPY<=5KTN+1, 259<=KPN,
C    3KPN<=4LZX+380, 3KPY<=4LZX+380, 105KTO+21LPY<=140LZX+60LZY+13261,
C    4LZY+7NWH+10<=7KTO, 322<=KZN, 3KZN<=4LZX+380, NWH+1<=KZO,
C    3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380, 3KZX+6NW<=7LZX+377,
C    LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG, 3LEIG+1<=4LZX, 1<=LPY,
C    3LPY+15NWH<=20LZX+1873, 0<=LZX+92, 3LZY+3NW<=4LZX+380,
C    3NW<=2LZX+187, 3NW<=LZX+380, 3NWH<=LZX+377, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

            CALL IN(CWORK, KTN, N2PD)                                   0640

C  P(J,N1H) {KZN+LPN==KPN+1, 4KPY+3LPRESS==4KZX+20LTN-17,
C    4KTO+3LTO==4KZY+3, LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1,
C    3LPRESS==4LZX-1, LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3,
C    N1H==64, 1<=J, J<=64, J+LTN<=KTN+1, 259<=KPN, KPN<=LPRESS+127,
C    KPY<=LPRESS+127, 1<=KTN, KTN+131<=LPRESS,
C    KTO+LTN<=LPRESS+LTO+127, LTO+NWH+1<=KTO, 322<=KZN,
C    KZN<=LPRESS+127, NWH+1<=KZO, 4KZX+4LPN<=7LPRESS+509,
C    KZX<=LPRESS+127, 4KZX+7LTO<=7LPRESS+512, 3LPRESS+4NWQ+13<=4KZX,
C    KZY<=LPRESS+127, 3<=LPN, LPN<=LPRESS+126, 2LPN<=LPRESS+509,
C    2LPN+7LTO<=4LPRESS+513, 0<=LPRESS+124, LTN+NWH<=LPRESS+126,
C    8LZO<=3LPRESS+5, 4NWH<=LPRESS+503, 1<=LTN, 1<=LTO, 1<=LZO,
C    1<=NWH, 1<=NWQ}

            F = REAL((J-1)*(J-1))*FXSQ                                  0641

C  P(I,N1H,N2) {N1H==64, N2==128}

            DO 710 I = 2, N2                                            0642

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

               CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))            0643

C  P(N1H,N2) {N1H==64, N2==128}

710            CONTINUE                                                 0644

C  P(N1H) {N1H==64}

            CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                           0645

C  P(N1H,N2P) {N1H==64, N2P==129}

            CWORK(N2P) = 0.0                                            0646

C  P(KTN,MEMSIZ,N1H,N2PD,NXXOUT) {KZN+LPN==KPN+1,
C    4KPY+3LPRESS==4KZX+20LTN-17, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, N1H==64,
C    N2PD==258, 1<=J, J<=64, J+LTN<=KTN+1, 259<=KPN, KPN<=LPRESS+127,
C    KPY<=LPRESS+127, 1<=KTN, KTN+131<=LPRESS,
C    KTO+LTN<=LPRESS+LTO+127, LTO+NWH+1<=KTO, 322<=KZN,
C    KZN<=LPRESS+127, NWH+1<=KZO, 4KZX+4LPN<=7LPRESS+509,
C    KZX<=LPRESS+127, 4KZX+7LTO<=7LPRESS+512, 3LPRESS+4NWQ+13<=4KZX,
C    KZY<=LPRESS+127, 3<=LPN, LPN<=LPRESS+126, 2LPN<=LPRESS+509,
C    2LPN+7LTO<=4LPRESS+513, 0<=LPRESS+124, LTN+NWH<=LPRESS+126,
C    8LZO<=3LPRESS+5, 4NWH<=LPRESS+503, 1<=LTN, 1<=LTO, 1<=LZO,
C    1<=NWH, 1<=NWQ}

            CALL OUT(CWORK, KTN, N2PD)                                  0647

C  P(KTN,N1H,N2PD) {KZN+2NW==KPN, KPY+LZX==KZX+LPY, 7KTO+3LZY==7KZY+3,
C    LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, N1H==64,
C    N2PD==258, 1<=J, J<=64, 5J+LPY<=5KTN+1, 259<=KPN, 3KPN<=4LZX+380,
C    3KPY<=4LZX+380, 1<=KTN, 3KTN+394<=4LZX,
C    105KTO+21LPY<=140LZX+60LZY+13261, 4LZY+7NWH+10<=7KTO, 322<=KZN,
C    3KZN<=4LZX+380, NWH+1<=KZO, 3KZX<=4LZX+380, 3KZX+3LZY<=7LZX+380,
C    3KZX+6NW<=7LZX+377, LZX+NWQ+3<=KZX, 3KZY<=4LZX+380, 1<=LEIG,
C    3LEIG+1<=4LZX, 1<=LPY, 3LPY+15NWH<=20LZX+1873, 0<=LZX+92,
C    3LZY+3NW<=4LZX+380, 3NW<=2LZX+187, 3NW<=LZX+380, 3NWH<=LZX+377,
C    1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KTN = KTN+N2PD                                              0648

C  P(N1H) {N1H==64}

700         CONTINUE                                                    0649

C  P(LTN,MEMSIZ,N1H,N2P,NOALS,NXXOUT,NXXXIN) {KZN+LPN==KPN+1,
C    4KPY+3LPRESS==4KZX+20LTN-17, 4KTO+3LTO==4KZY+3,
C    LARGE==LPRESS+126, 3LEIG==8LZO-5, LPN==2NW+1, 3LPRESS==4LZX-1,
C    LPRESS==MEMSIZ-126, LPY==5LTN-4, 7LTO==4LZY+3, N1H==64, N2P==129,
C    NOALS==1, 259<=KPN, KPN<=LPRESS+127, KPY<=LPRESS+127, 259<=KTN,
C    KTN<=LPRESS+127, LTN+321<=KTN, KTO+LTN<=LPRESS+LTO+127,
C    LTO+NWH+1<=KTO, 322<=KZN, KZN<=LPRESS+127, NWH+1<=KZO,
C    4KZX+4LPN<=7LPRESS+509, KZX<=LPRESS+127, 4KZX+7LTO<=7LPRESS+512,
C    3LPRESS+4NWQ+13<=4KZX, KZY<=LPRESS+127, 3<=LPN, LPN<=LPRESS+126,
C    2LPN<=LPRESS+509, 2LPN+7LTO<=4LPRESS+513, 0<=LPRESS+124,
C    LTN+NWH<=LPRESS+126, 8LZO<=3LPRESS+5, 4NWH<=LPRESS+503, 1<=LTN,
C    1<=LTO, 1<=LZO, 1<=NWH, 1<=NWQ}

C
C DE-ALIASE IF REQUESTED:
C
         IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LTN)                 0650
      ENDIF

C  P() {}

C
C AT LAST, THE END OF THE TIME STEP:
C
      DTT = DT+DT                                                       0652

C  P() {}

      T = T+DT                                                          0653

C  P(NSTEPS) {}

      NSTEPS = NSTEPS+1                                                 0654

C  P(NSTEPS,NUMBER) {NUMBER==250}

      IF (NUMBER.GE.NSTEPS) GOTO 150                                    0655
C#
c      END IF
C

C  P() {}

      WRITE (6, 9010) TXXXIN, TXXOUT, TXXRCS, TXXCSR, TXSCSC, TXACAC    0657
     &, TFTVMT, TXSHUF, TUSHUF, TXPRNT, TXLOG2                          0657

C  P() {}

      WRITE (6, 9020) EXXRCS, EXXCSR, EXSCSC, EXACAC, EFTVMT            0658

C  P(NFTVMT,NUSHUF,NXACAC,NXLOG2,NXPRNT,NXSCSC,NXSHUF,NXXCSR,NXXOUT,
C    NXXRCS,NXXXIN) {NXSHUF==2}

      WRITE (6, 9030) NXXXIN, NXXOUT, NXXRCS, NXXCSR, NXSCSC, NXACAC    0659
     &, NFTVMT, NXSHUF, NUSHUF, NXPRNT, NXLOG2                          0659

C  P(NUM1) {NUM1==2}

C
      CALL BUG('AFTER  ALL')                                            0660

C  P() {}

C
      CALL CPUTIM(CPU2)                                                 0661

C  P() {}

      CALL ELAPSE(TCLCK2)                                               0662

C  P() {}

C
      TWALL = MOD(TCLCK2-TCLCK1+1000000.0, 1000000.0)                   0663

C  P() {}

      WRITE (6, 9040) TWALL                                             0664

C  P() {}

      WRITE (1, *)                                                      0665

C  P() {}

      WRITE (1, *) 'ELAPSED CPU TIME IN SECONDS: ', CPU2-CPU1           0666

C  P() {}

C MFLOPS RATE = MFLOP 1 CPU CRAY X-MP/CPU TIME
      WRITE (1, *) 'MFLOPS RATE: ', 1657.863/(CPU2-CPU1)                0667

C  P() {}

      WRITE (1, *) 'ELAPSED WALLCLOCK TIME IN SECONDS: ', TWALL         0668

C  P() {}

      WRITE (1, 9050)                                                   0669

C  P(I) {I==129}

      WRITE (1, 9080) (CDAT(I), I = 1, 15)                              0670

C  P() {}

      VALID = 1                                                         0671

C  P(I,VALID) {VALID==1}

      DO 720 I = 1, 15                                                  0672

C  P(I,VALID) {1<=I, I<=15}

         IF (I.EQ.3.OR.I.EQ.13) THEN                                    0673

C  P(I,VALID) {3<=I, I<=13}

            IF (ABS(CDAT(I)).GT.ABS(VDAT(I))) VALID = 0                 0674

         ELSEIF (ABS(VDAT(I)-CDAT(I)).GT.ABS(.01*VDAT(I))) THEN         0673

C  P(VALID) {}

            VALID = 0                                                   0677
         ENDIF

C  P() {}


720      CONTINUE                                                       0678

C  P(VALID) {}

C
      IF (VALID.EQ.1) THEN                                              0679

C  P() {}

         WRITE (1, 9060)                                                0680

      ELSE

C  P() {}

         WRITE (1, 9070)                                                0681
      ENDIF

C  P() {}


c      STOP

9000  FORMAT(1X,'OUTPUT FOR PERFECT CLUB BENCHMARK: OCEAN INSTRUMENTED V
     &ERSION',/,1X,'$Revision: 1.A.1 $ $Author: psharma $',/)           0682

C  P() {}

C
9010  FORMAT(/,2X,'SUBROUTINE    IN, EX-TIME FOR FIRST CALL =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   OUT, EX-TIME FOR FIRST CALL =',1P,E1
     &3.6,/,2X,'SUBROUTINE   RCS, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2
     &X,'SUBROUTINE   CSR, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBR
     &OUTINE  SCSC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE 
     & ACAC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE FTRVMT 
     &EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE  SHUF, EX-TIME
     & FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE UNSHUF EX-TIME FOR FI
     &RST CALL =',1P,E13.6,/,2X,'SUBROUTINE RPRINT EX-TIME FOR FIRST CAL
     &L =',1P,E13.6,/,2X,'SUBROUTINE XLOG2, EX-TIME FOR FIRST CALL =',1P
     &,E13.6)                                                           0683

C  P() {}

9020  FORMAT(/,2X,'SUBROUTINE   RCS, EX-TIME LAST TIMESTEP  =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   CSR, EX-TIME LAST TIMESTEP  =',1P,E1
     &3.6,/,2X,'SUBROUTINE  SCSC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2
     &X,'SUBROUTINE  ACAC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2X,'SUBR
     &OUTINE FTRVMT EX-TIME LAST TIMESTEP  =',1P,E13.6)                 0684

C  P() {}

9030  FORMAT(/,2X,'SUBROUTINE    IN, CUMULATIVE CALLS TO    =',I12,/,2X,
     &'SUBROUTINE   OUT, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE 
     &  RCS, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE   CSR, CUMUL
     &ATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE  SCSC, CUMULATIVE CALLS 
     &TO    =',I12,/,2X,'SUBROUTINE  ACAC, CUMULATIVE CALLS TO    =',I12
     &,/,2X,'SUBROUTINE FTRVMT CUMULATIVE CALLS TO    =',I12,/,2X,'SUBRO
     &UTINE  SHUF, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE UNSHUF
     & CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE RPRINT CUMULATIVE 
     &CALLS TO    =',I12,/,2X,'SUBROUTINE XLOG2, CUMULATIVE CALLS TO    
     &=',I12)                                                           0685

C  P() {}

9040  FORMAT(/,2X,'MEASURE OF WALL-CLOCK TIME (ENVIRONMENT SENSITIVE)',/
     &,2X,'FOR EXECUTION ONLY =',1P,E13.6,1X,'SECONDS')                 0686

C  P() {}

C
9050  FORMAT(/,1X,'VALIDATION PARAMETERS:',/)                           0687

C  P() {}

9060  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE:   VALID')                0688

C  P() {}

9070  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE: INVALID')                0689

C  P() {}

9080  FORMAT(5E15.5)                                                    0690

      END
