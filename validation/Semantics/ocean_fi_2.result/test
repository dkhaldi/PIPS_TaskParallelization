
C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

C
      SUBROUTINE ACAC(AC,EX,WORK)
C
C COMPLEX ANTISYMMETRIC TO COMPLEX ANTISYMMETRIC
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMPLEX AC(1),WORK(1),TEMP1,TEMP2,X,Y,BJ,BJSYM
      DIMENSION EX(1)
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0021

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0022

C  T() {}

      IF (LXSTEP) THEN                                                  0023

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0024
      ENDIF

C  T(NPTSINIT) {NPTS==NPTSINIT}

C
      NPTSINIT = NPTS                                                   0027

C  T(M) {NPTS<=2M+1, 2M<=NPTS}

      M = NPTS/2                                                        0028

C  T(NPTS) {M==NPTS}

      NPTS = M                                                          0029

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0030

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0031

C  T(ISTOP) {}

      ISTOP = 1+(MTRN-1)*MSKIP                                          0032

C  T(MNSKIP) {}

      MNSKIP = M*NSKIP                                                  0033

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0034

C  T(NSKIP2) {2NSKIP==NSKIP2}

      NSKIP2 = NSKIP*2                                                  0035

C  T(MP2) {M==MP2-2}

      MP2 = M+2                                                         0036

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = IEXSHF*2                                                 0037

C  T() {}

      FACT = REAL(ISIGN)/2.                                             0038

C  T(MNSH) {MNSKIP<=2MNSH+1, 2MNSH<=MNSKIP}

      MNSH = MNSKIP/2                                                   0039

C  T(IPROD) {IPROD==MNSH}

      IPROD = MNSH                                                      0040

C  T(I,IAC,ISUM,LOOP) {}

      DO 10 LOOP = 1, ISTOP, MSKIP                                      0041

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0042

C  T(IAC) {LOOP+NSKIP==IAC}

         IAC = LOOP+NSKIP                                               0043

C  T() {}

         WORK(1) = CMPLX(0., 2.)*AC(IAC)                                0044

C  T(I,IAC) {2<=I}

         DO 20 I = 2, MH                                                0045

C  T(IAC) {IAC#init+NSKIP2==IAC}

            IAC = IAC+NSKIP2                                            0046

C  T() {}

            TEMP1 = CMPLX(0., 1.)*(AC(IAC)-AC(IAC-NSKIP2))              0047

C  T() {}

            TEMP2 = AC(IAC-NSKIP)                                       0048

C  T() {}

            WORK(I) = TEMP2+TEMP1                                       0049

C  T() {}

            WORK(MP2-I) = TEMP1-TEMP2                                   0050

C  T() {}

20          CONTINUE                                                    0051

C  T() {}

         WORK(MHP) = CMPLX(0., -2.)*AC(IAC)                             0052

C  T(IAC) {IAC==LOOP}

         IAC = LOOP                                                     0053

C  T(I,IAC) {1<=I}

         DO 30 I = 1, M                                                 0054

C  T() {}

            AC(IAC) = WORK(I)                                           0055

C  T(IAC) {IAC#init+NSKIP==IAC}

            IAC = IAC+NSKIP                                             0056

C  T() {}

30          CONTINUE                                                    0057

C  T() {}

10       CONTINUE                                                       0058

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(AC, EX)                                               0059

C  T(I,IFIN,ISTART,ISUM,J,JSUM,JSYM,LOOP) {}

      DO 40 LOOP = 1, ISTOP, MSKIP                                      0060

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0061

C  T(JSUM) {ISUM+LOOP==JSUM}

         JSUM = ISUM+LOOP                                               0062

C  T() {}

         AC(LOOP) = 0.                                                  0063

C  T(ISTART) {LOOP+NSKIP==ISTART}

         ISTART = LOOP+NSKIP                                            0064

C  T(IFIN) {IPROD+LOOP==IFIN}

         IFIN = LOOP+IPROD                                              0065

C  T(I) {I==2}

         I = 2                                                          0066

C  T(I,J,JSYM) {}

         DO 50 J = ISTART, IFIN, NSKIP                                  0067

C  T(I) {I#init+IEXSHF==I}

            I = I+IEXSHF                                                0068

C  T(JSYM) {J+JSYM==JSUM}

            JSYM = JSUM-J                                               0069

C  T() {}

            BJ = AC(J)                                                  0070

C  T() {}

            BJSYM = AC(JSYM)                                            0071

C  T() {}

            TEMP1 = BJ-BJSYM                                            0072

C  T() {}

            TEMP2 = CMPLX(FACT/EX(I), 0.)*(BJ+BJSYM)                    0073

C  T() {}

            AC(J) = TEMP1+TEMP2                                         0074

C  T() {}

            AC(JSYM) = TEMP2-TEMP1                                      0075

C  T() {}

50          CONTINUE                                                    0076

C  T() {}

40       CONTINUE                                                       0077

C  T(NPTS) {NPTS==NPTSINIT}

c      NPTS = M*2
      NPTS = NPTSINIT                                                   0079

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0080

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0081

C  T() {}

C
      IF (LFIRST) THEN                                                  0083

C  T() {}

         LFIRST = .FALSE.                                               0084

C  T() {}

         CALL CPUTIM(T2)                                                0085

C  T() {}

         TXACAC = T2-T1                                                 0086
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0089

C  T() {}

         IF (LXTIME) THEN                                               0090

C  T() {}

            LXTIME = .FALSE.                                            0091

C  T() {}

            CALL CPUTIM(T2)                                             0092

C  T() {}

            EXACAC = T2-T1                                              0093
         ENDIF

      ENDIF

C  T(NXACAC) {NXACAC==NXACAC#init+1}

C
      NXACAC = NXACAC+1                                                 0098
C
      END

C  T(NUM1) {NUM1==NUM1#init+1}

C***********************************************************************
C***********************************************************************
      SUBROUTINE BUG(POINT)
      CHARACTER*10 POINT
      COMMON /DEBUG/NUM1,TLAST

C  T() {}


      CALL CPUTIM(TNOW)                                                 0007

C  T() {}

      TSINCE = TNOW-TLAST                                               0008

C  T() {}

      WRITE (6, 9000) NUM1, TNOW, TSINCE, POINT                         0009

C  T(NUM1) {NUM1==NUM1#init+1}

      NUM1 = NUM1+1                                                     0010

C  T() {}

      TLAST = TNOW                                                      0011

C  T() {}


9000  FORMAT(' NUM1 =',I3,'; TNOW =',F9.3,' S; TSINCE =',F9.3,' S; LOCAT
     &ION IS: ',A10)                                                    0013

      END

C  T() {}

C***********************************************************************
C
C     FGPS 29-MAR-88 MODIFIED RPRINT =====> CPRINT SO AS TO PRINT OUT
C                    COMPLEX ARRAYS
C
C     N O T E :  THE INDEXING OF COMPLEX ARRAYS REPRESENTING PRINCIPAL V
C     IABLES IS OF THE FORM
C
C     COMPLEX  ======>  CA (1<=JY<=N2P,1<=IX<=N1H)
C
C     WHERE "JY" IS THE COUNT ALONG THE Y-AXIS AND "IX" RUNS ALONG THE X
C     AXIS, AND WHERE
C
C                          N2P = (N2+1)                    FOR THE Y-AXI
C     AND
C                           N1H = N1/2                     FOR THE X-AXI
C
C     AND WHERE THE GRID IS NOMINALLY DIMENSIONED (N2+1) BY N1.  MOREOVE
C     THE INDEX PAIR  JY = (N2+1)/2, IX= N1H/2  IS ASSUMED TO IDENTIFY T
C     CENTER OF THE VORTEX CELL.  HOWEVER, IN ACTUAL USE HERE, THE PROGR
C     MING INVOLVES THE REAL EQUIVALENT TO CA; I.E.,
C
C     REAL     ======>  RA (1<=JY<=N2P,1<=IX<=N1)
C
C
      SUBROUTINE CPRINT(RA,NAME,N1H,N2P,IMODE)
C
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      REAL RA(N2P,1)
      CHARACTER*8 NAME

C  T() {}

C
      WRITE (6, 9000) NSTEPS                                            0035

C  T(IX,IX1,IX2,JY,JY1) {}

C
C     SELECT THE PRINT-OUT MODE
C
c      IF (IMODE) 10,20,30
C
      IF (IMODE.LT.0) THEN                                              0041

C  T() {}

10       CONTINUE                                                       0042

C  T(IX1) {N1H+1<=4IX1, 4IX1<=N1H+4}

C
         IX1 = 1+N1H/4                                                  0044

C  T(IX2) {N1H+1<=2IX2, 2IX2<=N1H+2}

         IX2 = 1+N1H/2                                                  0045

C  T(JY1) {N2P+1<=2JY1, 2JY1<=N2P+2}

         JY1 = 1+N2P/2                                                  0046

C  T() {}

         WRITE (6, 9010) NAME, JY1, IX1, RA(JY1,IX1)                    0047

C  T() {}

         WRITE (6, 9020) NAME, JY1, IX2, RA(JY1,IX2)                    0048

C  T() {}

         IF (NAME.EQ.'PSI PHYS'.AND.NSTEPS.EQ.NUMBER) CDAT(11) = RA(    0049
     &   JY1,IX2)                                                       0049
C
c      RETURN
      ELSEIF (IMODE.EQ.0) THEN                                          0041

C  T() {}

C
20       CONTINUE                                                       0055

C  T(IX1) {N1H<=2IX1+1, 2IX1<=N1H}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF Y (I.E., 1<=JY<=N2P WITH STRIDE = 4) AT CONS
C     X (E.G., IX = N1H/2)
C
         IX1 = N1H/2                                                    0061

C  T(JY) {}

         WRITE (6, 9030) (JY, NAME, IX1, RA(JY,IX1), JY = 1, N2P, 4)    0062
C
c      RETURN
      ELSE

C  T() {}

C
30       CONTINUE                                                       0067

C  T(JY1) {N2P+1<=2JY1, 2JY1<=N2P+2}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF X (I.E., 1<=IX<=N1 WITH STRIDE = 4) AT CONST
C     Y (E.G., JY = N2P/2 + 1)
C
c      N1 = N1H + N1H
         JY1 = N2P/2+1                                                  0074

C  T(IX) {}

         WRITE (6, 9040) (IX, NAME, JY1, RA(JY1,IX), IX = 1, N1H+N1H    0075
     &   , 4)                                                           0075

C  T() {}

         IF (NAME.EQ.'PSI PHYS') THEN                                   0076

C  T() {}

            IF (NSTEPS.EQ.1) THEN                                       0077

C  T() {}

               CDAT(1) = RA(JY1,33)                                     0078

            ELSEIF (NSTEPS.EQ.2) THEN                                   0077

C  T() {}

               CDAT(6) = RA(JY1,33)                                     0081
            ENDIF

         ENDIF
      ENDIF

C  T() {}

C
C
C
9000  FORMAT(/,2X,'NSTEPS =',I7)                                        0089

C  T() {}

9010  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6)                  0090

C  T() {}

9020  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6,/)                0091

C  T() {}

C
9030  FORMAT(/,34(2X,'JY =',I5,2X,A8,'(JY,IX=',I3,') =',1P,E13.6,6X,'JY 
     &=',I5,2X,A8,'(JY,IX=',I3,') =',1P,E13.6,/))                       0093

C  T() {}

C
9040  FORMAT(/,34(2X,'IX =',I5,2X,A8,'(JY=',I3,',IX) =',1P,E13.6,/))    0096

      END

C  T() {}

C***********************************************************************
C
C     "CPUTIM" RETURNS ELAPSED USER (CPU) TIME, T, IN SECONDS, WHERE "T"
C     A REAL VARIABLE
C
C     ON THE CYBER205/ETA-10, THE INTRINSIC FUNCTION "SECOND()" IS REFER
C
      SUBROUTINE CPUTIM(T)
      REAL T

C  T() {}


      T = 1.0                                                           0011

      END

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

C
      SUBROUTINE CSR(A,EX)
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMPLEX A(1),EX(1),BJ,BJSTAR
C
C   PERFORM A CONJUGATE SYMMETRIC TO REAL TRANSFORM ON A PACKED
C   CONJUGATE SYMMETRIC ARRAY.  ONLY HALF THE ARRAY IS STORED, AND A(0)
C   AND A(N/2) ARE BOTH PACKED TOGETHER IN A(0) SINCE THEY ARE BOTH REAL
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0022

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0023

C  T() {}

      IF (LXSTEP) THEN                                                  0024

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0025
      ENDIF

C  T(N) {N==NPTS}

C
      N = NPTS                                                          0028

C  T(NPTS) {NPTS#init<=2NPTS+1, 2NPTS<=NPTS#init}

      NPTS = NPTS/2                                                     0029

C  T(M) {M==NPTS}

      M = NPTS                                                          0030

C  T(ISHIFT) {ISHIFT==0}

      ISHIFT = 0                                                        0031

C  T(ISHIFT) {}

      IF (ISIGN.LT.0) ISHIFT = M*IEXSHF                                 0032

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0033

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0034

C  T(I,IEXH,IEXL,IST,ISTP,J,JSTAR,LOOP) {1<=LOOP}

      DO 10 LOOP = 1, MTRN                                              0035

C  T(IST) {}

         IST = (LOOP-1)*MSKIP                                           0036

C  T(ISTP) {IST==ISTP-1}

         ISTP = IST+1                                                   0037

C  T() {}

         A(ISTP) = CMPLX(REAL(A(ISTP))+AIMAG(A(ISTP)), REAL(A(ISTP))-   0038
     &   AIMAG(A(ISTP)))                                                0038

C  T(I,IEXH,IEXL,J,JSTAR) {2<=I}

         DO 20 I = 2, MH                                                0040

C  T(J) {}

            J = (I-1)*NSKIP+ISTP                                        0041

C  T(JSTAR) {}

            JSTAR = (M-I+1)*NSKIP+ISTP                                  0042

C  T() {}

            BJ = A(J)                                                   0043

C  T() {}

            BJSTAR = A(JSTAR)                                           0044

C  T(IEXL) {}

            IEXL = IEXSHF*(I-1)+1+ISHIFT                                0045

C  T(IEXH) {}

            IEXH = IEXSHF*(M-I+1)+1+ISHIFT                              0046

C  T() {}

            A(J) = BJ+CONJG(BJSTAR)+CMPLX(0., 1.)*EX(IEXL)*(BJ-CONJG(   0047
     &      BJSTAR))                                                    0047

C  T() {}

            A(JSTAR) = BJSTAR+CONJG(BJ)+CMPLX(0., 1.)*EX(IEXH)*(        0049
     &      BJSTAR-CONJG(BJ))                                           0049

C  T() {}

20          CONTINUE                                                    0051

C  T(J) {}

         J = MH*NSKIP+ISTP                                              0052

C  T() {}

         A(J) = 2.*A(J)                                                 0053

C  T() {}

         IF (ISIGN.GT.0) A(J) = CONJG(A(J))                             0054

C  T() {}

10       CONTINUE                                                       0055

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0056

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = 2*IEXSHF                                                 0057

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(A(1), EX(1))                                          0058

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0059

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0060

C  T(NPTS) {N==NPTS}

      NPTS = N                                                          0061

C  T() {}

C
      IF (LFIRST) THEN                                                  0063

C  T() {}

         LFIRST = .FALSE.                                               0064

C  T() {}

         CALL CPUTIM(T2)                                                0065

C  T() {}

         TXXCSR = T2-T1                                                 0066
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0069

C  T() {}

         IF (LXTIME) THEN                                               0070

C  T() {}

            LXTIME = .FALSE.                                            0071

C  T() {}

            CALL CPUTIM(T2)                                             0072

C  T() {}

            EXXCSR = T2-T1                                              0073
         ENDIF

      ENDIF

C  T(NXXCSR) {NXXCSR==NXXCSR#init+1}

C
      NXXCSR = NXXCSR+1                                                 0078
C
      END

C  T(NXXOUT) {NXXOUT==NXXOUT#init+2, 1<=LPN, LPN<=OUT:MEMSIZ, 1<=LTN,
C    LTN<=OUT:MEMSIZ}

C***********************************************************************
C     FGPS 12-MAY-88 RESET "RLAMDA = 1.00"
C     FGPS 18-APR-88 RESET "DT" TO DT = 0.0001, OTHERWISE THE INCREASED
C                    FUNCTION RESULTS IN NUMERICAL INSTABILITY
C     FGPS 15-APR-88 INCREASED THE INITIAL AMPLITUDE PRESCRIBED FOR THE
C                    FUNCTION BY *50
C     FGPS 16-FEB-88 RESET "DT" TO DT = 0.001
C
      SUBROUTINE DATAST(A,N2P,N1,GMAPP)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /PI/PI
      COMMON /LADDR/LZN,LTN,LPN,LZO,LTO,LPY,LZX,LZY,LEIG,LDUMY1(3)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION A(N2P,1),GMAPP(1)
C
C PROGRAM TO INITIALIZE THE RUN (EITHER IN PHYSICAL OR FOURIER SPACE)
C PHYSICAL SPACE: KDATA=1    --> A (I,J) ... POINT (I-1, J-1)
C FOURIER SPACE : KDATA=2    --> CA(I,J) ... MODE  (I-1, J-1)
C
C ALSO, IF YOU WANT TO SPECIFY THE MEAN FLOW (KSM=2), DO IT HERE.
C
      COMMON /MFLOW/U(129)

C  T() {}

C
      ALPHA = 10.0                                                      0027

C  T() {}

C
C UNSTABLE CASE:
      BETA = 1.0                                                        0030

C  T() {}

C      RLAMDA = 1.35
C     WHEN CODE IS USED AS A BENCHMARK, SET RLAMDA = 1.00
      RLAMDA = 1.00                                                     0033

C  T() {}

      BOXX = 2.0*PI*RLAMDA                                              0034

C  T() {}

      FX = 2.0*PI/BOXX                                                  0035

C  T() {}

C
C ASSUMING THAT GSET IS CALLED. IF LMAPP = 1, H SHOULD BE SET TO
C A DEFINED POSITIVE NUMBER.
C
      H = GMAPP(N2P)                                                    0040

C  T() {}

C
C COMPUTE VISCOSITY AND HEAT CONDUCTIVITY FROM PRANDTL NUMBER
C AND THE RATIO OF RAYLEIGH NUMBER TO ITS CRITICAL VALUE:
C
      PRANDT = 10.0                                                     0045

C  T() {}

      RRATIO = 20.0                                                     0046

C  T() {}

      W = ALPHA*BETA*PRANDT*4.0/(27.0*RRATIO)                           0047

C  T() {}

      RNU = SQRT(ABS(W))                                                0048

C  T() {}

      RKAPA = RNU/PRANDT                                                0049

C  T() {}

C
C DETERMINE DIFFUSION LIMIT FOR THE TIME STEP AND COMPARE IT TO
C THE CHOSEN VALUE:
C
      DT = 0.0001                                                       0054

C  T() {}

      X = FX*REAL(N1/2-1)                                               0055

C  T() {}

      Y = REAL(N2P-1)                                                   0056

C  T() {}

      DTMAX = 1.0/((X*X+Y*Y)*MAX(RNU, RKAPA))                           0057

C  T() {}

      WRITE (6, 9000) DTMAX, DT                                         0058

C  T(NW) {}

      NW = N2P*N1                                                       0059

C  T() {}

C
C
      EPS = 100.                                                        0062

C  T(I,J) {1<=J}

      DO 10 J = 1, N1                                                   0063

C  T() {}

         X = REAL(J-1)*2.0*PI/REAL(N1)                                  0064

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0065

C  T() {}

            Y = REAL(I-1)*PI/REAL(N2P-1)                                0066

C  T() {}

            A(I,J) = EPS*SIN(X)*SIN(Y)                                  0067

C  T() {}

20          CONTINUE                                                    0068

C  T() {}

10       CONTINUE                                                       0069

C  T() {}

C
      WRITE (6, 9010)                                                   0071

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL OUT(A, LPN, NW)                                              0072

C  T(I,J) {1<=J}

      DO 30 J = 1, N1                                                   0073

C  T(I) {1<=I}

         DO 40 I = 1, N2P                                               0074

C  T() {}

            A(I,J) = 0.0                                                0075

C  T() {}

40          CONTINUE                                                    0076

C  T() {}

30       CONTINUE                                                       0077

C  T() {}

      WRITE (6, 9020)                                                   0078

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL OUT(A, LTN, NW)                                              0079

C  T() {}


9000  FORMAT(' DIFFUSION CONSTRAINT ON DT: DTMAX = ',F10.6,/,' ACTUAL DT
     & CHOSEN FOR THIS RUN: DT = ',F10.6)                               0081

C  T() {}

9010  FORMAT(/,/,/,' INITIAL STREAMFUNCTION IS   A SIN(X) SIN(Y),',/,' W
     &HERE  0 <= X <= 2*PI  AND  0 <= Y <= PI.',/,' THIS IMPLIES TWO CON
     &VECTION CELLS INITIALLY.',/,' NOTE THAT THE PRESCRIBED INITIAL STR
     &EAM-',/,' FUNCTION VS X, FOR Y=YMAX/2, IS PRINTED OUT',/,' BELOW F
     &OR NSTEPS=1 (TIME ZERO) AND ALSO FOR',/,' THE NEXT STEP, NSTEPS=2'
     &,/,/)                                                             0083

C  T() {}

9020  FORMAT(' INITIAL TEMPERATURE PERTURBATION IS ZERO.',/,' NOTE THAT 
     &THE INITIAL TEMPERATURE DROP VS',/,' Y IS PRINTED OUT BELOW, WHERE
     & INITIALLY',/,' THIS IS INDEPENDENT OF X,  I.E., 1 <= IX',/,' <= 6
     &4, AND WHERE THE Y REPRESENTATION IN',/,' PHYSICAL SPACE SPANS 1 <
     &= JY <= 129.   A',/,' KEY VARIABLE, THE EVOLUTION OF WHICH CAN',/,
     &' MONITOR CODE PERFORMANCE, IS  "TEMP PHY(',/,' JY=65,IX=33)"; I.E
     &., A MEASURE OF TEMPER-',/,' ATURE IN PHYSICAL SPACE AT THE CENTER
     &POINT',/,' OF THE BOUNDARY SEPARATING THE TWO CONVEC-',/,' TION CE
     &LLS.')                                                            0090

      END

C  T(NXXOUT,NXXXIN) {NXXOUT==NXXOUT#init+1, NXXXIN==NXXXIN#init+1,
C    1<=LOC, LOC<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE DEALSE(CA,N2P,N1H,LOC)
      COMPLEX CA(N2P,1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2

C  T(NW) {}

C
C THIS FUNCTION GIVES THE INDEX OF THE HIGHEST MODE TO BE RETAINED
C IN TERMS OF THE NUMBER OF MODES WHICH CAN BE RESOLVED:
C
C#      LSTMOD (MODEHI) = INT(0.666666666666666*REAL(MODEHI-1)+0.999)
C
      NW = 2*N2P*N1H                                                    0014

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LOC, LOC+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LOC, NW)                                              0015

C  T(N1CUT) {}

      N1CUT = INT(0.666666666666666*REAL(N1H-1)+0.999)+1                0016

C  T(N2CUT) {}

      N2CUT = INT(0.666666666666666*REAL(N2P-1)+0.999)+1                0017

C  T(I,J) {N1CUT<=J}

C
C THIS DEALIASING PROCEDURE HAS TO BE IMPROVED IF NONLINEAR MAPPING
C IN Y-DIRECTION IS USED:
C
      DO 10 J = N1CUT, N1H                                              0022

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0023

C  T() {}

            CA(I,J) = 0.0                                               0024

C  T() {}

20          CONTINUE                                                    0025

C  T() {}

10       CONTINUE                                                       0026

C  T(I,J) {1<=J}

      DO 30 J = 1, N1H                                                  0027

C  T(I) {N2CUT<=I}

         DO 40 I = N2CUT, N2P                                           0028

C  T() {}

            CA(I,J) = 0.0                                               0029

C  T() {}

40          CONTINUE                                                    0030

C  T() {}

30       CONTINUE                                                       0031

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LOC, LOC+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL OUT(CA, LOC, NW)                                             0032
C
      END

C  T() {}

C***********************************************************************
C
C     "ELAPSE" RETURNS ELAPSED WALL-CLOCK TIME, T, IN SECONDS
C
C     ON THE CYBER205 SYSTEM USE IS MADE OF THE SIL SUBROUTINE "Q5DCDMSC
C
C     FGPS 19-APR-88
C
      SUBROUTINE ELAPSE(T)

      REAL T

C  T() {}


      T = 1.0                                                           0013

      END

C  T() {}

C***********************************************************************
C
C     FGPS 12-FEB-1988 SUBR. PLOTME TEMPORARILY COMMENTED "C" OUT
C
C      SUBROUTINE PLOTME (Z,WORK,NCALL)
C      COMMON /DATA/ ALPHA,BETA,BOXX,H, RDUMY1(5), IDUMY1
C      COMMON /OPTONS/ NX,NY
C      DIMENSION Z(1), WORK(1)
C      COMMON /PLTDEF/ IDPAT, DXA, DXB, DYA, DYB
CC
CC THIS SUBROUTINE CAN BE USED FOR PLOTTING OF FIELDS IN PHYSICAL
CC SPACE. CONTOUR PLOTS ARE USUALLY BEST.
CC
C      ASPECT = BOXX/H
C      A = (DXB-DXA) / (DYB-DYA)
C      XMIN = DXA
C      XMAX = DXB
C      YMIN = DYA
C      YMAX = DYB
C      IF (A.LT.ASPECT) GO TO 10
C      SPANH = 0.5*(DYB-DYA) * ASPECT
C      RMEAN = 0.5*(DXA+DXB)
C      XMIN = RMEAN-SPANH
C      XMAX = RMEAN+SPANH
C      GO TO 30
C   10 SPANH = 0.5*(DXB-DXA) / ASPECT
C      RMEAN = 0.5*(DYA+DYB)
C      YMIN = RMEAN-SPANH
C      YMAX = RMEAN+SPANH
C   30 CALL SET (XMIN,XMAX,YMIN,YMAX,1.0,REAL(NX+1),1.0,REAL(NY+1),1)
C      CALL EDGES (-1)
C      CALL DRAWBOX (1.0,1.0,REAL(NX),REAL(NY+1))
C      CALL CONREC (Z,NY+1,NY+1,NX,0.0,0.0,0.0,1,0,0)
C      CALL FRAME
C      RETURN
C      END
C***********************************************************************
C      SUBROUTINE DATE (TODAY)
C      TODAY = DATEF(1.0)
C      RETURN
C      END
C***********************************************************************
C      SUBROUTINE TIME (NOW)
C      NOW = 8HNOW
C      RETURN
C      END
C***********************************************************************
C                           E - O - D
C***********************************************************************
C
C FFTFORTRANPACK3
C FFTFTN.5
C 10/16/80
C
      SUBROUTINE EXSET(EX,NPTS)
      COMPLEX EX(1)
      COMPLEX A1,A2

C  T() {}


      W = 6.283185307179586477/REAL(NPTS)                               0059

C  T(NH) {NPTS<=2NH+1, 2NH<=NPTS}

      NH = NPTS/2                                                       0060

C  T(J) {1<=J}

CVD$ NOVECTOR
CVD$ NOCONCUR
      DO 10 J = 1, NH                                                   0063

C  T() {}

C           EX( J ) = EXP( CMPLX( 0., REAL(J - 1)*W ) )
C10         EX( J + NH ) = EXP( CMPLX( 0., REAL(1 - J)*W ) )
         A1 = CMPLX(0., REAL(J-1)*W)                                    0066

C  T() {}

         EX(J) = EXP(A1)                                                0067

C  T() {}

         EX(J+NH) = EXP(-1.*A1)                                         0068

C  T() {}

10       CONTINUE                                                       0069
      END

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

C
      SUBROUTINE FTRVMT(DATA,EX)
C
C THIS IS A FORTRAN VERSION OF THE ASSEMBLY LANGUAGE SUBROUTINE
C FFT2, TO BE USED WITH THE NSSL SUBROUTINE PACKAGE FFTPOW2.
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
C
C DATA IS A COMPLEX ARRAY OF LENGTH NPTS WHICH SERVES FOR BOTH
C INPUT AND OUTPUT.
C
      COMMON /DATA/ALPHA,BETA,BOXX,H1,RNU,RKAPA,DT,DTT,T,NSTEP
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
C
      COMPLEX DATA(99),EXP1,EXK,EXJ,H,EX(1)
      REAL HH(2)
      EQUIVALENCE (HH,H)
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0025

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0026

C  T() {}

      IF (LXSTEP) THEN                                                  0027

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0028
      ENDIF

C  T(I2K) {I2K==NPTS}

C
      I2K = NPTS                                                        0031

C  T() {}

      IF (I2K.NE.1) THEN                                                0032
      ELSE
         GOTO 140
      ENDIF

C  T() {}

      SGN1 = ISIGN                                                      0033

C  T() {}

      EXK = EX(1+IEXSHF)                                                0034

C  T() {}

      IF (SGN1.LT.0.) EXK = CONJG(EXK)                                  0035

C  T() {}

10    CONTINUE                                                          0036

C  T(I2KP) {I2K==I2KP}

      I2KP = I2K                                                        0037

C  T(I2K) {I2K#init<=2I2K+1, 2I2K<=I2K#init}

      I2K = I2K/2                                                       0038

C  T(I2KS) {}

      I2KS = I2K*NSKIP                                                  0039

C  T() {}

      IF (2*I2K.NE.I2KP) GOTO 20                                        0040

C  T(JLI) {2JLI<=I2K+2, I2K+1<=2JLI}

      JLI = I2K/2+1                                                     0044

C  T(JJ,JL,JS,MM) {1<=JL}

      DO 30 JL = 1, I2K                                                 0045

C  T(JJ,JS,MM) {}

         IF (JL-1.LE.0) THEN                                            0046

C  T() {}

            EXJ = CMPLX(1., 0.)                                         0047

C  T(JJ,JS,MM) {}

            DO 40 JJ = JL, NPTS, I2KP                                   0048

C  T(JS,MM) {1<=MM}

               DO 50 MM = 1, MTRN                                       0049

C  T(JS) {}

                  JS = (JJ-1)*NSKIP+(MM-1)*MSKIP+1                      0050

C  T() {}

                  H = DATA(JS)-DATA(JS+I2KS)                            0051

C  T() {}

                  DATA(JS) = DATA(JS)+DATA(JS+I2KS)                     0052

C  T() {}

                  DATA(JS+I2KS) = H                                     0053

C  T() {}

50                CONTINUE                                              0054

C  T() {}

40             CONTINUE                                                 0055

         ELSEIF (JL-JLI.EQ.0) THEN                                      0046

C  T() {}

            EXJ = CMPLX(0., SGN1)                                       0058

C  T(JJ,JS,MM) {}

            DO 60 JJ = JL, NPTS, I2KP                                   0059

C  T(JS,MM) {1<=MM}

               DO 70 MM = 1, MTRN                                       0060

C  T(JS) {}

                  JS = (JJ-1)*NSKIP+(MM-1)*MSKIP+1                      0061

C  T() {}

                  H = DATA(JS)-DATA(JS+I2KS)                            0062

C  T() {}

                  DATA(JS) = DATA(JS)+DATA(JS+I2KS)                     0063

C  T() {}

                  DATA(JS+I2KS) = CMPLX(-SGN1*HH(2), SGN1*HH(1))        0064

C  T() {}

70                CONTINUE                                              0066

C  T() {}

60             CONTINUE                                                 0067

         ELSE

C  T() {}

C
C INCREMENT JL-DEPENDENT EXPONENTIAL FACTOR
C
            EXJ = EXJ*EXK                                               0073

C  T(JJ,JS,MM) {}

            DO 80 JJ = JL, NPTS, I2KP                                   0074

C  T(JS,MM) {1<=MM}

               DO 90 MM = 1, MTRN                                       0075

C  T(JS) {}

                  JS = (JJ-1)*NSKIP+(MM-1)*MSKIP+1                      0076

C  T() {}

                  H = DATA(JS)-DATA(JS+I2KS)                            0077

C  T() {}

                  DATA(JS) = DATA(JS)+DATA(JS+I2KS)                     0078

C  T() {}

                  DATA(JS+I2KS) = H*EXJ                                 0079

C  T() {}

90                CONTINUE                                              0080

C  T() {}

80             CONTINUE                                                 0081
         ENDIF

C  T() {}


30       CONTINUE                                                       0084

C  T() {}

C
C INCREMENT K-DEPENDENT EXPONENTIAL FACTOR
C
      EXK = EXK*EXK                                                     0088

C  T() {}

      IF (I2K-1.GT.0) GOTO 10                                           0089

C  T(I2K,J,JMAX,JMIN,JREV,JREV2,JREV2S,JREVS,JS,MM,NPTSD2) {}


      IF (NPTS.GT.2) THEN                                               0092

C  T(NPTSD2) {2NPTSD2<=NPTS, NPTS<=2NPTSD2+1}

         NPTSD2 = NPTS/2                                                0093

C  T(JMIN) {JMIN==0}

         JMIN = 0                                                       0094

C  T(JMAX) {JMAX==NPTS-4}

         JMAX = NPTS-4                                                  0095

C  T(JREV) {JREV==0}

         JREV = 0                                                       0096

C  T(I2K,J,JREV,JREV2,JREV2S,JREVS,JS,MM) {JMIN<=J}

         DO 100 J = JMIN, JMAX, 2                                       0097

C  T(I2K) {I2K==NPTSD2}

            I2K = NPTSD2                                                0098

C  T(JREV2) {I2K+JREV==JREV2}

            JREV2 = JREV+I2K                                            0099

C  T(JREV2S,JREVS,JS,MM) {}

            IF (JREV2-(J+1).GT.0) THEN                                  0100

C  T(JREV2S,JS,MM) {1<=MM}

               DO 110 MM = 1, MTRN                                      0101

C  T(JREV2S) {}

                  JREV2S = (MM-1)*MSKIP+JREV2*NSKIP                     0102

C  T(JS) {}

                  JS = (MM-1)*MSKIP+(J+1)*NSKIP                         0103

C  T() {}

                  H = DATA(JREV2S+1)                                    0104

C  T() {}

                  DATA(JREV2S+1) = DATA(JS+1)                           0105

C  T() {}

                  DATA(JS+1) = H                                        0106

C  T() {}

110               CONTINUE                                              0107

C  T(JREVS,JS,MM) {}

               IF (JREV-J.GT.0) THEN                                    0108

C  T(JREVS,JS,MM) {1<=MM}

                  DO 120 MM = 1, MTRN                                   0109

C  T(JREVS) {}

                     JREVS = JREV*NSKIP+(MM-1)*MSKIP                    0110

C  T(JS) {}

                     JS = J*NSKIP+(MM-1)*MSKIP                          0111

C  T() {}

                     H = DATA(JREVS+1)                                  0112

C  T() {}

                     DATA(JREVS+1) = DATA(JS+1)                         0113

C  T() {}

                     DATA(JS+1) = H                                     0114

C  T() {}

120                  CONTINUE                                           0115
               ENDIF

            ENDIF

C  T() {}


130         CONTINUE                                                    0120

C  T(I2K) {I2K#init<=2I2K+1, 2I2K<=I2K#init}

            I2K = I2K/2                                                 0121

C  T(JREV) {I2K+JREV==JREV#init}

            JREV = JREV-I2K                                             0122

C  T() {}

            IF (JREV.GE.0) GOTO 130                                     0123

C  T(JREV) {2I2K+JREV#init==JREV}

            JREV = JREV+2*I2K                                           0124

C  T() {}

100         CONTINUE                                                    0125
      ENDIF

      GOTO 140

C  T(IERR) {IERR==101}


20    IERR = 101                                                        0130

C  T() {}

C
140   CONTINUE                                                          0133

C  T() {}

C
      IF (LFIRST) THEN                                                  0135

C  T() {}

         LFIRST = .FALSE.                                               0136

C  T() {}

         CALL CPUTIM(T2)                                                0137

C  T() {}

         TFTVMT = T2-T1                                                 0138
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0141

C  T() {}

         IF (LXTIME) THEN                                               0142

C  T() {}

            LXTIME = .FALSE.                                            0143

C  T() {}

            CALL CPUTIM(T2)                                             0144

C  T() {}

            EFTVMT = T2-T1                                              0145
         ENDIF

      ENDIF

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

C
      NFTVMT = NFTVMT+1                                                 0150
C
      END

C  T() {}

C***********************************************************************
      SUBROUTINE GSET(GMAPP)
      DIMENSION GMAPP(1)
      COMMON /PI/PI
      COMMON /NMBRS/NSKIP(4),N2P,NDUMY1(3)

C  T() {}


      F = PI/REAL(N2P-1)                                                0007

C  T(I) {1<=I}

C
C GSET DEFINES THE MAPPING FUNCTION.
C
      DO 10 I = 1, N2P                                                  0011

C  T() {}

         GMAPP(I) = F*REAL(I-1)                                         0012

C  T() {}

10       CONTINUE                                                       0013
      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C***********************************************************************
C
      SUBROUTINE IN(ARRAY,LOC,NW)
      COMMON /MEMORY/MEMSIZ,RM(165117)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION ARRAY(1)
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0014

C  T(I,LOCM,NXXXIN) {LOC==LOCM+1, NXXXIN==NXXXIN#init+1, 1<=I,
C    NW+1<=I, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C
      IF (LOC.LT.1.OR.LOC+NW-1.GT.MEMSIZ.OR.NW.LT.1) THEN               0016

C  T() {}

C
         WRITE (6, 9000) LOC, NW                                        0018

C  T() {0==-1}

         STOP                                                           0019

      ELSE

C  T(LOCM) {LOC==LOCM+1}

         LOCM = LOC-1                                                   0022

C  T(I) {1<=I}

         DO 10 I = 1, NW                                                0023

C  T() {}

            ARRAY(I) = RM(LOCM+I)                                       0024

C  T() {}

10          CONTINUE                                                    0025

C  T() {}

C
         IF (LFIRST) THEN                                               0027

C  T() {}

            LFIRST = .FALSE.                                            0028

C  T() {}

            CALL CPUTIM(T2)                                             0029

C  T() {}

            TXXXIN = T2-T1                                              0030
         ENDIF

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1}

C
         NXXXIN = NXXXIN+1                                              0033
C
      ENDIF

C  T() {}


9000  FORMAT(/,/,/,' IN: ILLEGAL REQUEST. LOCATION:',I22,' ;   NUMBER OF
     & WORDS:',I22,' ;  MEMSIZ:',I7)                                    0037

      END

C  T(LCMREQ,MEMSIZ) {LARGE==MEMSIZ, LCMREQ==1, LARGE<=165117}

C***********************************************************************
      FUNCTION LCMREQ(LARGE)
      PARAMETER (LCMSIZ=165117)
      COMMON /MEMORY/MEMSIZ,RM(LCMSIZ)

C  T(LCMREQ,MEMSIZ) {LARGE==MEMSIZ, LCMREQ==1, LARGE<=165117}


      IF (LARGE.GT.LCMSIZ) THEN                                         0006

C  T() {}

C
         WRITE (6, 9010) MEMSIZ, LARGE                                  0008

C  T() {0==-1}

         STOP                                                           0009

      ELSE

C  T(MEMSIZ) {LARGE==MEMSIZ}

         MEMSIZ = LARGE                                                 0012

C  T(LCMREQ) {LCMREQ==1}

         LCMREQ = 1                                                     0013

C  T() {}

         WRITE (6, 9000) LARGE                                          0014
      ENDIF

C  T() {}


9000  FORMAT(/,/,' LCM REQUESTED:',I7,' WORDS',/,/)                     0017

C  T() {}

9010  FORMAT(/,/,/,' LCMREQ: REQUEST EXCEEDS MEMORY SIZE.',/,' MEMORY SI
     &ZE:',I7,' ;   WORDS REQUESTED:',I22)                              0018

      END

C  T() {}

C***********************************************************************
      SUBROUTINE MEAN(CA,U,G)
      DIMENSION U(1),G(1)
      COMPLEX CA(1)
      COMMON /NMBRS/NSKIP(4),N2P,NDUMY1(3)

C  T(I) {1<=I}


      DO 10 I = 1, N2P                                                  0007

C  T() {}

         U(I) = -G(I)*REAL(CA(I))                                       0008

C  T() {}

10       CONTINUE                                                       0009
      END

C  T(IEXSHF,ISIGN,KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,
C    KVF,KVP,KZF,KZP,LE,LEIG,LEV,LH,LMAPP,LOG,LPN,LPY,LSKIP,LTN,LTO,
C    LVECT,LZN,LZO,LZX,LZY,MEMSIZ,MSKIP,MTRN,N1,N1E,N1H,N1Q,N2,N2DM,
C    N2DP,N2M,N2P,N2PD,NFTVMT,NMAX2,NOALS,NOTEMP,NPTS,NSKIP,NSTEPS,
C    NUM1,NUMBER,NUSHUF,NVECT,NVSKIP,NXACAC,NXLOG2,NXPRNT,NXSCSC,
C    NXSHUF,NXXCSR,NXXOUT,NXXRCS,NXXXIN,TEMPHY:NCALL,ZETAPH:NCALL)
C    {ISIGN==-1, KDATA==1, KPF==1, KPP==249, KPRESS==1, KSM==1,
C    KTA==50, KTAPE==0, KTF==1, KTP==50, KUF==1, KUP==249, KVF==1,
C    KVP==249, KZF==1, KZP==249, LE==1, LMAPP==1, LPN+LZX==LTN+LZY,
C    LPN+LZY==LZO+LZX, LPY+LZX==LTO+LZY, LPY+LZY==2LZX, LSKIP==2,
C    LVECT==127, LZN==1, MSKIP==129, MTRN==64, N1==128, N1E==16,
C    N1H==64, N1Q==32, N2==128, N2DM==255, N2DP==257, N2M==127,
C    N2P==129, N2PD==258, NOALS==1, NOTEMP==0, NPTS==256, NSKIP==1,
C    NUM1==NUM1#init+2, NUMBER==250, NVECT==2, NVSKIP==1, 1<=LEIG,
C    LEIG<=MEMSIZ, LH<=LEV, 1<=LH, 1<=LPN,
C    4LPY+LZY<=4LPN+LZX+4MEMSIZ+3, 4LPN+LZY<=4LPY+LZX+4MEMSIZ+3,
C    LPY+1<=LPN+MEMSIZ, LPN+1<=LPY+MEMSIZ, 5LZY<=4LPN+LZX+4MEMSIZ+3,
C    3LZX+LZY<=4LPN+4MEMSIZ+3, 4LPN+LZY<=5LZX+4MEMSIZ+3,
C    4LPN<=LZX+3LZY+4MEMSIZ+3, 4LPN+LZY+5<=LZX+4MEMSIZ,
C    LZX+1<=LPN+MEMSIZ, LPN+1<=LZX+MEMSIZ, LZY+1<=LPN+MEMSIZ,
C    LPN+1<=LZY+MEMSIZ, LPN+3<=MEMSIZ, 1<=LPY,
C    5LZY<=4LPY+LZX+4MEMSIZ+3, 3LZX+LZY<=4LPY+4MEMSIZ+3,
C    4LPY<=LZX+3LZY+4MEMSIZ+3, 4LPY+LZY+5<=LZX+4MEMSIZ,
C    LZX+1<=LPY+MEMSIZ, LZY+1<=LPY+MEMSIZ, LPY+1<=LZY+MEMSIZ,
C    LPY+3<=MEMSIZ, LZY+1<=2LZO+LZX+2MEMSIZ, 3LZY<=2LZO+LZX+2MEMSIZ+1,
C    2LZO<=LZX+LZY+2MEMSIZ+1, 2LZO+LZY<=LZX+2MEMSIZ+1, 2<=LZO+MEMSIZ,
C    LZO+1<=MEMSIZ, 1<=LZX, LZX+4<=LZY, 1<=LZX+LZY+2MEMSIZ,
C    LZY<=LZX+4MEMSIZ+3, LZY+1<=LZX+2MEMSIZ, 2LZY<=LZX+MEMSIZ+1,
C    3LZY<=LZX+2MEMSIZ+1, 5LZY+5<=LZX+4MEMSIZ, LZX+1<=LZY+MEMSIZ,
C    3LZX<=3LZY+4MEMSIZ+3, 3LZX+LZY+5<=4MEMSIZ, LZX+3<=MEMSIZ, 1<=LZY,
C    2<=LZY+MEMSIZ, LZY+3<=MEMSIZ, 2<=MEMSIZ, MEMSIZ<=165117,
C    256<=NMAX2, 251<=NSTEPS, NXSHUF#init<=NXSHUF,
C    NXSHUF<=NXSHUF#init+2}

C
C     1993 version - Modified by Beatrice Creusillet for PIPS -
C
C     MODIFICATIONS:
C
C     AUGUST 1995:
C     ~~~~~~~~~~~~
C     - CXxxxxx and CYyyyyy commentaries removed for clarity.
C     - CPUTIM and ELAPSE subroutines uncommented.
C     - BLOCK DATA moved in main procedure (Francois Irigoin) .
C     - Macro definition LSTMOD(MODEHI) in module DEALSE replaced where
C       it is used.
C     - (1.,0.) replaced by CMPLX(1.,0.) wherever needed.
C     - In RUNINF, computed GOTO's are replaced by block if's.
C     - Passed through stf; one empty if block removed afterwards.
C     - Add common /TIMING/ in DATAST, TEMPFO, TEMPHY, PSIFOU, PSIPHY,
C       ZETAFO, ZETAPH, VVELFO, VVELPH, UVELFO, UVELPH, DEALSE, in order
C       to help the interprocedural propagation.
C     - Common /NMBRS/ declared in RCS, CSR, ACAC, SCSC to
C       propagate major predicates (like N2P==129) downwards to FTRVMT 
C       (fi, June 1993).
C     - Add common /FT/ in TEMPHY
C     - Add common /MEMORY/ in OCEAN
C     - variable NUMBER in common /DEBUG/ renamed into NUM1 to avoid clashes
C       with variable NUMBER in common /OPTONS/
C     - use full declaration of /FT/ in UVELFO (Francois Irigoin)
C     - Syntactic construct IF(.TRUE.) THEN ... ENDIF added around the
C       time loop to compute accuracte preconditions and transformers.
C       This should be useless with unspaghettify...
C       (Francois Irigoin)
C     - useless STOP in OCEAN commented out to avoid problems with
C       Ronan's dead code elimination (Francois Irigoin)
C     - management of NPTS in SCSC modified to restore
C       exactly NPTS; preconditions fail to find this because they use
C       a transformer computed with no knowledge of NPTS parity;
C       Same transform in ACAC.
C       Note that NPTS is directly saved and restored in RCS.
C       (Francois Irigoin)
C     - artificial IF(.TRUE.)THEN removed; do not forget to unspaghettify
C       the code before processing (Francois Irigoin)
C     - combination of arithmetic IF and RETURNs restructured manually
C       in CPRINT
C     - forwarding of N1's assignment in subsequent WRITE in CPRINT;
C       I guess the programmer did not realize N1 was directly available
C       in COMMON /OPTONS/; he did not realize the potential impact
C       of N1 reassignement in the middle of the time loop; common
C       /OPTONS/ might be useless!
C
C******NOTE: USE OF MACHINE-DEPENDENT CONSTANT: ZERO IN SUBROUTINE RUNIN
C
C            ZERO = 1.0E-200 (MAY HAVE TO REPLACE WITH YOUR MACHINES
C                             RELATIVE PRECISION FOR REAL DATA TYPE)
C

C***********************************************************************
C                        OCEAN FORTRAN PROGRAMS
C                        CREATION DATE: 3/22/81
C***********************************************************************
      PROGRAM OCEAN
C
C  D(Z)/DT + (U,V).GRAD(Z) = RNU*DELSQ(Z) + ALPHA*D(TEMP)/DX
C
C  D(TEMP)/DT + (U,V).GRAD(TEMP) = RKAPA*DELSQ(TEMP) + BETA*V
C
C
C
C THIS PROGRAM SIMULATES TWO-DIMENSIONAL FLUID FLOW ON A   (N2+1) * N1
C GRID. IT IS POSSIBLE TO SPECIFY NON-LINEAR DISTRIBUTION OF DATA POINTS
C THE Y-DIRECTION (THE FIRST INDEX CORRESPONDS TO Y DIRECTION, SECOND TO
C X DIRECTION). N1 AND N2 HAVE TO BE POWERS OF TWO GREATER OR EQUAL TO 8
C
C THE PROGRAM USES LARGE CORE MEMORY. IT REQUIRES 8*(N2+1)*N1+(N2-1)*(N2
C WORDS OF IT. IF NOTEMP = 1 IT IS POSSIBLE TO SAVE 2*(N2+1)*N1 WORDS,
C IF LMAPP = 1 YOU SAVE ADDITIONAL (N2-1)*(N2+1) WORDS.
C
C IF  LMAPP = 2 , LCM REQUIREMENTS ARE AT LEAST  3 * (N2-1) * (N2-1)
C MORE MEMORY COULD BE NEEDED IN THIS CASE BECAUSE OF EIGSET AND LCMRQR.
C
C
C FOR CDC7600 RUNS: DELETE ROUTINES LCMREQ, IN AND OUT FROM THE END OF
C                   THIS PACKAGE. ON CDC7600 THE LCM IS USED THROUGH
C                   THE ASSEMBLY ROUTINES.
C
C                   LIBRARY.
C FOR CRAY-1 RUNS : DELETE ROUTINES SECOND, DATE, TIME, EXSET AND
C                   LOG2 FROM THE END OF THIS PACKAGE. THEY ARE
C                   OBTAINED AT LOAD TIME FROM CRAY LIBRARIES AND
C                   FFTLIB.
C                   ALSO, ADJUST THE SIZE OF PARAMETER LCMSIZ IN
C                   THE ROUTINE LCMREQ SO THAT THE COMMON IS LARGE
C                   ENOUGH TO EMULATE CDC7600 LCM REQUIRED FOR THE RUN.
C
C THE FOLLOWING PARAMETERS DEFINE THE SIZE OF THE RUN:
C
      PARAMETER (NX=128,NY=128)
      PARAMETER (NA1=2* (NY+1),NA2=NX/2,NE=NY-1,NW1=NY+1)
      PARAMETER (NW2=128,NEX=256)
      PARAMETER (NI=2*NY-1,NEQ=3*NY-2,NCW2=2*NW1+1,NCW3=4*NW1+1)
C
C PLEASE REFER TO THE DIMENSIONING AND EQUIVALENCING INSTRUCTIONS IN
C THE CASE YOUR COMPILER CANNOT HANDLE PARAMETER STATEMENTS...
C COMMON BLOCKS:
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
C
C THE DIMENSION OF  GSOLV  HAS TO BE AT LEAST (N2-1)
C
      COMMON /SOLV/LVECT,LSKIP,NVECT,NVSKIP,GSOLV(127)
C
C THE DIMENSIONS OF  GMAPP  AND  G  HAVE TO BE AT LEAST (N2+1)
C
      COMMON /MAPING/GMAPP(129),G(129)
      COMMON /MFLOW/U(129)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /PI/PI
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMMON /EXSIZE/NMAX2
      COMMON /LADDR/LZN,LTN,LPN,LZO,LTO,LPY,LZX,LZY,LEIG,LE,LH,LEV
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      PARAMETER (LCMSIZ=165117)
      COMMON /MEMORY/MEMSIZ,RM(LCMSIZ)
C
C
C COMPLEX ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            CA        (N2+1) X N1/2
C            CWORK     N2+1
C            CWORK2    N2+1
C            CWORK3    N2+1
C            EX        MAX(2*N2, N1)
C
C EX ARRAY MUST NOT BE THE FIRST ARRAY IN THE MEMORY.
C
      COMPLEX CA(NW1,NA2),CWORK(NW1),CWORK2(NW1)
      COMPLEX CWORK3(NW1),EX(NEX),CF
C
C REAL ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            A      2*(N2+1) X N1/2
C            E      (N2-1)   X (N2-1)
C            WORK   N2+1     X MAX(6, 2*MIN(64, N1/2))   (AT LEAST)
C            EVAL   N2-1
C            IR     N2-1
C            IC     N2-1
C
      REAL A(NA1,NA2),E(NE,NE)
      REAL WORK(NW1*NW2)
      REAL EVAL(NE),IR(NE),IC(NE)
      INTEGER VALID
C
C EQUIVALENCE STATEMENTS ARE SAVING MEMORY SPACE. THE FOLLOWING PATTERN
C HAS TO BE FOLLOWED EXACTLY:
C
C     A-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CA+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     EVAL+-+IR-+-+-IC+-+-+E+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C
C
C     WORK+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CWORK-+-+-+CWORK2-+-+-CWORK3+-+-+
C
C      EQUIVALENCE (A,CA,EVAL), (A(NY),IR), (A(NI),IC), A(NEQ),E) - ORGI
C      EQUIVALENCE (A,CA,EVAL), (EVAL(NY),IR), (EVAL(NI),IC),
C     *             (EVAL(NEQ),E) - MACFARLANE'S FIX. BAD.
C POINTER'S FIX. ANSI REQUIRES THAT THE NUMBER OF SUBSCRIPTS MATCH
C THE NUMBER OF DIMENSIONS OF THE ARRAY. THAT WAS THE PROBLEM WITH
C THE ORGINAL STATEMENT. THE PROBLEM WITH MACFARLANE'S FIX IS THAT
C NY,NI,NEQ>NE (THE DIMENSION OF EVAL). HERE 3*NE+1-NA1 IS THE 3*NE+1TH
C ELEMENT OF A AND 3*NE+1 = NEQ.
      EQUIVALENCE (A,CA,EVAL), (A(NY,1),IR), (A(NI,1),IC),
     +            (A(3*NE+1-NA1,2),E)
      EQUIVALENCE (WORK,CWORK), (WORK(NCW2),CWORK2), (WORK(NCW3),CWORK3)
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /DEBUG/NUM1,TLAST
C
C     former BLOCK DATA
C
C
      DATA TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT/0.,0.,0.,0.,
     +     0.,0.,0./
      DATA TXSHUF,TUSHUF,TXPRNT,TXLOG2/0.,0.,0.,0./
      DATA EXXRCS,EXXCSR,EXSCSC,EXACAC,EFTVMT/0.,0.,0.,0.,0./
      DATA NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT/0,0,0,0,0,0,
     +     0/
      DATA NXSHUF,NUSHUF,NXPRNT,NXLOG2/0,0,0,0/
      DATA VDAT/0.10000E+03,-0.10000E+03,0.10000E-04,-0.10000E+03,
     +     -0.15708E+01,0.99983E+02,-0.18147E+01,-0.20427E+01,
     +     -0.22452E+01,-0.24181E+01,0.95976E+02,-0.95977E+02,
     +     0.10000E-04,-0.95978E+02,-0.25589E+01/
C
C PI IS A USEFULL CONSTANT
C
      DATA PI/3.141592653589793/
      DATA NUM1/1/,TLAST/0.0/

C  T() {}

C
C
C
C NOW WE CAN START WITH THE PROGRAM...
C SUBROUTINE START TELLS OCEAN WHAT TO DO:
C
      CALL CPUTIM(CPU1)                                                 0204

C  T() {}

      CALL ELAPSE(TCLCK1)                                               0205

C  T() {}

      OPEN (UNIT=1,FILE='OCV')                                          0206

C  T() {}

      OPEN (UNIT=6,FILE='OCO6')                                         0207

C  T() {}

      WRITE (1, 9000)                                                   0208

C  T(KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,KVF,KVP,KZF,
C    KZP,LMAPP,N1,N2,NOALS,NOTEMP,NUMBER) {KDATA==1, KPF==1, KPP==249,
C    KPRESS==1, KSM==1, KTA==50, KTAPE==0, KTF==1, KTP==50, KUF==1,
C    KUP==249, KVF==1, KVP==249, KZF==1, KZP==249, LMAPP==1, N1==128,
C    N2==128, NOALS==1, NOTEMP==0, NUMBER==250}


      CALL START(NX, NY)                                                0210

C  T() {}

C
C IF  LMAPP = 1 , H  (THE SIZE OF THE BOX IN Y DIRECTION)  SHOULD BE
C SPECIFIED IN THE MAIN PROGRAM.
C
      H = PI                                                            0215

C  T(N1H) {2N1H<=N1, N1<=2N1H+1}

C
C DEFINING CONSTANTS THAT WILL BE NEEDED:
C
      N1H = N1/2                                                        0219

C  T(N1Q) {4N1Q<=N1, N1<=4N1Q+3}

      N1Q = N1/4                                                        0220

C  T(N1E) {8N1E<=N1, N1<=8N1E+7}

      N1E = N1/8                                                        0221

C  T(N2M) {N2==N2M+1}

      N2M = N2-1                                                        0222

C  T(N2P) {N2==N2P-1}

      N2P = N2+1                                                        0223

C  T(N2DP) {2N2==N2DP-1}

      N2DP = 2*N2+1                                                     0224

C  T(N2DM) {2N2==N2DM+1}

      N2DM = 2*N2-1                                                     0225

C  T(N2PD) {2N2P==N2PD}

      N2PD = 2*N2P                                                      0226

C  T(NW) {}

      NW = N2PD*N1H                                                     0227

C  T(NWH) {2NWH<=NW, NW<=2NWH+1}

      NWH = NW/2                                                        0228

C  T(NWQ) {4NWQ<=NW, NW<=4NWQ+3}

      NWQ = NW/4                                                        0229

C  T(NWEIG) {N2M==NWEIG}

      NWEIG = N2M                                                       0230

C  T(NWEIG) {}

      IF (LMAPP.NE.1) NWEIG = (N2M+3)*N2M                               0231

C  T(NMAX2) {N1<=NMAX2, 2N2<=NMAX2}

      NMAX2 = MAX(2*N2, N1)                                             0232

C  T(K1Q) {K1Q==N1E+1}

      K1Q = N1E+1                                                       0233

C  T(K2Q) {K1Q+N1E==K2Q}

      K2Q = K1Q+N1E                                                     0234

C  T(K3Q) {K2Q+N1E==K3Q}

      K3Q = K2Q+N1E                                                     0235

C  T(K1QM) {K1Q==K1QM+1}

      K1QM = K1Q-1                                                      0236

C  T(K2QM) {K2Q==K2QM+1}

      K2QM = K2Q-1                                                      0237

C  T(K3QM) {K3Q==K3QM+1}

      K3QM = K3Q-1                                                      0238

C  T(LARGE) {LARGE==8NW}

C
C LCM ALLOCATION AND COMPUTATION OF ADDRESSES:
C
      LARGE = 8*NW                                                      0242

C  T(LARGE) {}

      IF (NOTEMP.EQ.1) LARGE = 6*NW                                     0243

C  T(LARGE) {}

      IF (LMAPP.NE.2) THEN                                              0244

C  T(LARGE) {LARGE#init+NWEIG==LARGE}

C
         LARGE = LARGE+NWEIG                                            0246

      ELSE

C  T(LARGE) {}

C
         IF (KPRESS.GT.1) LARGE = MAX(LARGE, 3*N2M*N2M)+NWEIG+NWEIG     0250

C  T(LARGE) {}

         IF (KPRESS.LE.1) LARGE = MAX(LARGE+NWEIG, 3*N2M*N2M)           0251
      ENDIF

C  T(LZN,MEMSIZ) {LARGE==MEMSIZ, LZN==1, LARGE<=165117}

C
      LZN = LCMREQ(LARGE)                                               0254

C  T(LTN) {LZN+NW==LTN}

      LTN = LZN+NW                                                      0255

C  T(LTN) {}

      IF (NOTEMP.EQ.1) LTN = LZN                                        0256

C  T(LPN) {LTN+NW==LPN}

      LPN = LTN+NW                                                      0257

C  T(LZO) {LPN+NW==LZO}

      LZO = LPN+NW                                                      0258

C  T(LTO) {LZO+NW==LTO}

      LTO = LZO+NW                                                      0259

C  T(LTO) {}

      IF (NOTEMP.EQ.1) LTO = LZO                                        0260

C  T(LPY) {LTO+NW==LPY}

      LPY = LTO+NW                                                      0261

C  T(LZX) {LPY+NW==LZX}

      LZX = LPY+NW                                                      0262

C  T(LZY) {LZX+NW==LZY}

      LZY = LZX+NW                                                      0263

C  T(LPRESS) {LARGE+LZN==LPRESS+NWEIG}

      LPRESS = LZN+LARGE-NWEIG                                          0264

C  T(LEIG) {LEIG==LPRESS}

      LEIG = LPRESS                                                     0265

C  T(LEIG) {}

      IF (KPRESS.GT.1.AND.LMAPP.NE.1) LEIG = LPRESS-NWEIG               0266

C  T(LE) {LE==LZN}

C
C THESE LCM ADDRESSES ARE USED BY EIGSET AND LCMRQR
C
      LE = LZN                                                          0270

C  T(LH) {LE<=LH}

      LH = LE+N2M*N2M                                                   0271

C  T(LEV) {LH<=LEV}

      LEV = LH+N2M*N2M                                                  0272

C  T() {}

C
      CALL EXSET(EX, NMAX2)                                             0274

C  T(I) {1<=I}

C
C SET ALL  U(I) TO 0. TO AVOID TROUBLE IF NO MEAN FLOW IS DESIRED
C
      DO 10 I = 1, N2P                                                  0278

C  T() {}

         U(I) = 0.                                                      0279

C  T() {}

10       CONTINUE                                                       0280

C  T(I,NXXOUT) {NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

C
C SET UP ARRAYS ASSOCIATED WITH THE MAPPING FUNCTION:
C
      IF (LMAPP.EQ.1) THEN                                              0284

C  T() {}

C
C LINEAR MAPPING - EIGENVALUES KNOWN, EIGENFUNCTIONS ARE SIMPLY SINES
C AND COSINES, SO THAT NO MATRICES ARE NEEDED:
C
         F = H/REAL(N2)                                                 0289

C  T() {}

         FZ = PI/H                                                      0290

C  T() {}

         FZSQ = FZ*FZ                                                   0291

C  T() {}

         GMAPP(1) = 0.                                                  0292

C  T() {}

         G(1) = FZ                                                      0293

C  T(I) {1<=I}

         DO 20 I = 1, N2M                                               0294

C  T() {}

            GMAPP(I+1) = F*REAL(I)                                      0295

C  T() {}

            G(I+1) = FZ                                                 0296

C  T() {}

            EVAL(I) = -REAL(I)**2*FZSQ                                  0297

C  T() {}

20          CONTINUE                                                    0298

C  T() {}

         GMAPP(N2P) = H                                                 0299

C  T() {}

         G(N2P) = FZ                                                    0300

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LEIG, LEIG+NWEIG<=MEMSIZ+1,
C    1<=NWEIG}

         CALL OUT(EVAL, LEIG, NWEIG)                                    0301
C
      ENDIF

C  T(NXXOUT) {NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+2}

C
C READ THE DATA:
C
      IF (KDATA.EQ.1.OR.KDATA.EQ.2) CALL DATAST(A, N2P, N1, GMAPP)      0307

C  T() {}

      FX = 2.0*PI/BOXX                                                  0308

C  T() {}

      FX2 = 2.*FX                                                       0309

C  T(I,IEXSHF,ISIGN,J,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN)
C    {NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT,
C    2NXACAC+NXXOUT#init==2NXACAC#init+NXXOUT,
C    NXLOG2+NXXOUT#init==NXLOG2#init+NXXOUT,
C    2NXSHUF+NXXOUT#init==2NXSHUF#init+NXXOUT,
C    NXXOUT+2NXXRCS#init==NXXOUT#init+2NXXRCS,
C    NXXOUT+2NXXXIN#init==NXXOUT#init+2NXXXIN, NXXOUT#init<=NXXOUT,
C    NXXOUT<=NXXOUT#init+2}

C
C PREPARE THE INPUT FOR PROCESSING:
C
      IF (KDATA.EQ.1) THEN                                              0313

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

C
C THE INPUT WAS STREAMFUNCTION IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER SPACE:
C
         CALL IN(A, LPN, NW)                                            0318

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

         CALL SHUF(A, N2P, N1, WORK)                                    0319

C  T(NPTS) {N1==NPTS}

         NPTS = N1                                                      0320

C  T(NSKIP) {N2P==NSKIP}

         NSKIP = N2P                                                    0321

C  T(MTRN) {MTRN==N2P}

         MTRN = N2P                                                     0322

C  T(MSKIP) {MSKIP==1}

         MSKIP = 1                                                      0323

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0324

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0325

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0326

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXRCS==NXXRCS#init+1}

         CALL RCS(A, EX)                                                0327

C  T(NPTS) {2N2==NPTS}

         NPTS = 2*N2                                                    0328

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0329

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0330

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0331

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0332

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0333

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0334

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

         CALL ACAC(A, EX, WORK)                                         0335

C  T() {}

C           F = 0.125/REAL(N1*N2)
         F = 0.0625/REAL(N1*N2)                                         0337

C  T(I,J) {1<=J}

         DO 30 J = 1, N1H                                               0338

C  T(I) {1<=I}

            DO 40 I = 1, N2PD                                           0339

C  T() {}

               A(I,J) = A(I,J)*F                                        0340

C  T() {}

40             CONTINUE                                                 0341

C  T() {}

30          CONTINUE                                                    0342

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LPN, NW)                                           0343

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZN, NW)                                           0344
      ENDIF

C  T(I,IEXSHF,ISIGN,J,KZN,LOG,LSKIP,LVECT,MSKIP,MTRN,NFTVMT,NPTS,
C    NSKIP,NSTEPS,NVECT,NVSKIP,NXACAC,NXLOG2,NXSHUF,NXXOUT,NXXRCS,
C    NXXXIN)
C    {NFTVMT+NXACAC#init+NXSHUF#init==NFTVMT#init+NXACAC+NXSHUF,
C    NFTVMT+NXLOG2#init==NFTVMT#init+NXLOG2,
C    NXSHUF+NXXRCS#init==NXSHUF#init+NXXRCS,
C    NFTVMT#init+3NXSHUF+NXXOUT#init+NXXXIN<=NFTVMT+3NXSHUF#init+
C    NXXOUT+NXXXIN#init,
C    NFTVMT+3NXSHUF#init+2NXXOUT+2NXXXIN#init<=NFTVMT#init+3NXSHUF+2
C    NXXOUT#init+2NXXXIN, NFTVMT+NXXOUT#init<=NFTVMT#init+NXXOUT,
C    NXSHUF#init<=NXSHUF,
C    NXSHUF+NXXOUT#init+NXXXIN<=NXSHUF#init+NXXOUT+NXXXIN#init+1}

C
CC*****C H E C K   F O U R I E R   C O E F F I C I E N T S**************
C
C         WRITE (6,7010) A(1,1),A(1,2),A(1,3)
C         WRITE (6,7020) A(2,1),A(2,2),A(2,3)
C         WRITE (6,7030) A(3,1),A(3,2),A(3,3)
C 7010    FORMAT(/2X,26HCHECK FOURIER COEFFICIENTS/4X,8HA(1,1) =,1PE13.6
C     1   2X,8HA(1,2) =,1PE13.6,2X,8HA(1,3) =,1PE13.6)
C 7020    FORMAT(4X,8HA(2,1) =,1PE13.6,2X,8HA(2,2) =,1PE13.6,2X,
C     1   8HA(2,3) =,1PE13.6)
C 7030    FORMAT(4X,8HA(3,1) =,1PE13.6,2X,8HA(3,2) =,1PE13.6,2X,
C     1   8HA(3,3) =,1PE13.6/)
C
C
      IF (KDATA.NE.3) THEN                                              0360

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LEIG, LEIG+NWEIG<=MEMSIZ+1,
C    1<=NWEIG}

C                                                     2
C STREAMFUNCTION KNOWN - FIND THE VORTICITY:  Z =  DEL  (PSI):
C
         CALL IN(EVAL, LEIG, NWEIG)                                     0364

C  T(KZN) {KZN==LZN}

         KZN = LZN                                                      0365

C  T(LVECT) {LVECT==N2M}

         LVECT = N2M                                                    0366

C  T(LSKIP) {LSKIP==2}

         LSKIP = 2                                                      0367

C  T(NVECT) {NVECT==2}

         NVECT = 2                                                      0368

C  T(NVSKIP) {NVSKIP==1}

         NVSKIP = 1                                                     0369

C  T(I,J,KZN,NXXOUT,NXXXIN) {J+NXXXIN#init==NXXXIN+1,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    KZN#init+NXXXIN<=KZN+NXXXIN#init, NXXXIN#init<=NXXXIN}

         DO 50 J = 1, N1H                                               0370

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL IN(CWORK, KZN, N2PD)                                   0371

C  T() {}

            F = REAL((J-1)*(J-1))*FX*FX                                 0372

C  T(I) {2<=I}

            DO 60 I = 2, N2                                             0373

C  T() {}

               CWORK(I) = (EVAL(I-1)-F)*CWORK(I)                        0374

C  T() {}

60             CONTINUE                                                 0375

C  T() {}

            CWORK(1) = -F*CWORK(1)                                      0376

C  T() {}

            CWORK(N2P) = 0.0                                            0377

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL OUT(CWORK, KZN, N2PD)                                  0378

C  T(KZN) {KZN#init+N2PD==KZN}

            KZN = KZN+N2PD                                              0379

C  T() {}

50          CONTINUE                                                    0380

C  T(NPTS) {2N2==NPTS}

         NPTS = 2*N2                                                    0381

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0382

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0383

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0384

C  T(ISIGN) {ISIGN==1}

         ISIGN = 1                                                      0385

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0386

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0387

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZN, NW)                                            0388

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

         CALL ACAC(A, EX, WORK)                                         0389

C  T(I,J) {1<=J}

         DO 70 J = 1, N1H                                               0390

C  T(I) {1<=I}

            DO 80 I = 1, N2PD                                           0391

C  T() {}

               A(I,J) = 0.5*A(I,J)                                      0392

C  T() {}

80             CONTINUE                                                 0393

C  T() {}

70          CONTINUE                                                    0394

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZO, LZO+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZO, NW)                                           0395

C  T(I,IEXSHF,ISIGN,J,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN)
C    {NFTVMT+NXACAC#init+NXXRCS#init==NFTVMT#init+NXACAC+NXXRCS,
C    NXACAC+NXLOG2#init+NXXRCS==NXACAC#init+NXLOG2+NXXRCS#init,
C    NXACAC+NXXOUT#init+NXXRCS==NXACAC#init+NXXOUT+NXXRCS#init,
C    NXACAC+NXXXIN#init==NXACAC#init+NXXXIN,
C    NXSHUF+NXXRCS#init==NXSHUF#init+NXXRCS, NXACAC<=NXACAC#init+1,
C    NXACAC#init+NXXRCS<=NXACAC+NXXRCS#init, NXXRCS#init<=NXXRCS}

         IF (NOTEMP.NE.1) THEN                                          0396

C  T(I,IEXSHF,ISIGN,J,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN) {ISIGN+2NXXOUT==2NXXOUT#init+3,
C    MSKIP==N2P, MTRN==N1H, 2N2==NPTS,
C    NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT, NSKIP==1,
C    NXACAC==NXACAC#init+1, NXLOG2+NXXOUT#init==NXLOG2#init+NXXOUT,
C    NXSHUF+NXXOUT#init==NXSHUF#init+NXXOUT-1,
C    NXXOUT+NXXRCS#init==NXXOUT#init+NXXRCS+1, NXXXIN==NXXXIN#init+1,
C    1<=J, MTRN+1<=J, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=LTO,
C    LTO+NW<=MEMSIZ+1, 1<=NW, NXXOUT#init+1<=NXXOUT,
C    NXXOUT<=NXXOUT#init+2}

            IF (KDATA.NE.1) THEN                                        0397

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

               CALL IN(A, LTN, NW)                                      0398

C  T(NPTS) {2N2==NPTS}

C
C NEW TEMPERATURE KNOWN - SET UP T(OLD):
C
               NPTS = 2*N2                                              0402

C  T(NSKIP) {NSKIP==1}

               NSKIP = 1                                                0403

C  T(MTRN) {MTRN==N1H}

               MTRN = N1H                                               0404

C  T(MSKIP) {MSKIP==N2P}

               MSKIP = N2P                                              0405

C  T(ISIGN) {ISIGN==1}

               ISIGN = 1                                                0406

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

               CALL XLOG2(NPTS, LOG)                                    0407

C  T(IEXSHF) {}

               IEXSHF = NMAX2/NPTS                                      0408

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

               CALL ACAC(A, EX, WORK)                                   0409

C  T(I,J) {1<=J}

               DO 90 J = 1, N1H                                         0410

C  T(I) {1<=I}

                  DO 100 I = 1, N2PD                                    0411

C  T() {}

                     A(I,J) = A(I,J)*0.5                                0412

C  T() {}

100                  CONTINUE                                           0413

C  T() {}

90                CONTINUE                                              0414

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

               CALL OUT(A, LTO, NW)                                     0415

            ELSE

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

C
C TEMPERATURE IS SUPPLIED IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER REPRESENTATION:
C
               CALL IN(A, LTN, NW)                                      0422

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

               CALL SHUF(A, N2P, N1, WORK)                              0423

C  T(NPTS) {N1==NPTS}

               NPTS = N1                                                0424

C  T(NSKIP) {N2P==NSKIP}

               NSKIP = N2P                                              0425

C  T(MTRN) {MTRN==N2P}

               MTRN = N2P                                               0426

C  T(MSKIP) {MSKIP==1}

               MSKIP = 1                                                0427

C  T(ISIGN) {ISIGN==-1}

               ISIGN = -1                                               0428

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

               CALL XLOG2(NPTS, LOG)                                    0429

C  T(IEXSHF) {}

               IEXSHF = NMAX2/NPTS                                      0430

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXRCS==NXXRCS#init+1}

               CALL RCS(A, EX)                                          0431

C  T() {}

               F = 0.5/REAL(N1)                                         0432

C  T(I,J) {1<=J}

               DO 110 J = 1, N1H                                        0433

C  T(I) {1<=I}

                  DO 120 I = 1, N2PD                                    0434

C  T() {}

                     A(I,J) = F*A(I,J)                                  0435

C  T() {}

120                  CONTINUE                                           0436

C  T() {}

110               CONTINUE                                              0437

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

               CALL OUT(A, LTO, NW)                                     0438

C  T(NPTS) {2N2==NPTS}

               NPTS = 2*N2                                              0439

C  T(NSKIP) {NSKIP==1}

               NSKIP = 1                                                0440

C  T(MTRN) {MTRN==N1H}

               MTRN = N1H                                               0441

C  T(MSKIP) {MSKIP==N2P}

               MSKIP = N2P                                              0442

C  T(ISIGN) {ISIGN==-1}

               ISIGN = -1                                               0443

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

               CALL XLOG2(NPTS, LOG)                                    0444

C  T(IEXSHF) {}

               IEXSHF = NMAX2/NPTS                                      0445

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

               CALL ACAC(A, EX, WORK)                                   0446

C  T() {}

C           F = 0.25/REAL(N2)
               F = 0.125/REAL(N2)                                       0448

C  T(I,J) {1<=J}

               DO 130 J = 1, N1H                                        0449

C  T(I) {1<=I}

                  DO 140 I = 1, N2PD                                    0450

C  T() {}

                     A(I,J) = F*A(I,J)                                  0451

C  T() {}

140                  CONTINUE                                           0452

C  T() {}

130               CONTINUE                                              0453

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

               CALL OUT(A, LTN, NW)                                     0454
            ENDIF

         ENDIF

C  T() {}


         T = 0.                                                         0459

C  T() {}

         DTT = DT                                                       0460

C  T(NSTEPS) {NSTEPS==1}

         NSTEPS = 1                                                     0461
      ENDIF

C  T() {}


      CALL RUNINF                                                       0464

C  T(NUM1) {NUM1==NUM1#init+1}

      CALL BUG('AFT INITAL')                                            0465

C  T() {}


C#
c      IF (.TRUE.) THEN    
150   CONTINUE                                                          0469

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

C
C THIS IS THE BEGINNING OF THE TIME STEP.
C
      IF (MOD(NSTEPS, KTF).EQ.1.AND.NOTEMP.NE.1) CALL TEMPFO(CA, N2P    0473
     &, N1H, CWORK)                                                     0473

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KPF).EQ.1) CALL PSIFOU(CA, N2P, N1H, CWORK)       0475

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KZF).EQ.1) CALL ZETAFO(CA, N2P, N1H, CWORK)       0476

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KVF).EQ.1) CALL VVELFO(CA, N2P, N1H, FX, CWORK)   0477

C  T(I,IEXSHF,ISIGN,J,K,K2QJ,KTN,KTO,KZN,KZO,LOG,MSKIP,MTRN,NFTVMT,
C    NPTS,NSKIP,NXACAC,NXLOG2,NXXOUT,NXXXIN)
C    {NFTVMT+NXACAC#init==NFTVMT#init+NXACAC,
C    5NXACAC+3NXXOUT#init==5NXACAC#init+3NXXOUT,
C    5NXACAC+3NXXXIN#init==5NXACAC#init+3NXXXIN,
C    NXACAC#init+3NXLOG2<=NXACAC+3NXLOG2#init,
C    NXACAC+6NXLOG2#init<=NXACAC#init+6NXLOG2, NXLOG2<=NXLOG2#init+1}

      IF (MOD(NSTEPS+1, KTA).EQ.1) THEN                                 0478

C  T() {}

C
C TIME AVERAGE VORTICITY:
C
         DTT = DT                                                       0482

C  T() {}

         T = T-0.5*DT                                                   0483

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZO, LZO+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZO, NW)                                            0484

C  T(NPTS) {2N2==NPTS}

         NPTS = 2*N2                                                    0485

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0486

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0487

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0488

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0489

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0490

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0491

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

         CALL ACAC(A, EX, WORK)                                         0492

C  T() {}

         F = 0.125/REAL(N2)                                             0493

C  T(I,J) {1<=J}

         DO 160 J = 1, N1H                                              0494

C  T(I) {1<=I}

            DO 170 I = 1, N2PD                                          0495

C  T() {}

               A(I,J) = A(I,J)*F                                        0496

C  T() {}

170            CONTINUE                                                 0497

C  T() {}

160         CONTINUE                                                    0498

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZO, LZO+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZO, NW)                                           0499

C  T(ISIGN) {ISIGN==1}

         ISIGN = 1                                                      0500

C  T(MTRN) {MTRN==N1Q}

         MTRN = N1Q                                                     0501

C  T(KZN) {KZN==LZN}

         KZN = LZN                                                      0502

C  T(KZO) {KZO==LZO}

         KZO = LZO                                                      0503

C  T(I,IEXSHF,J,K,K2QJ,KZN,KZO,LOG,NFTVMT,NPTS,NXACAC,NXXOUT,NXXXIN)
C    {IEXSHF==IEXSHF#init, K+NFTVMT#init==NFTVMT+1,
C    KZN+KZO#init==KZN#init+KZO, LOG==LOG#init,
C    NFTVMT+NXACAC#init==NFTVMT#init+NXACAC,
C    2NFTVMT+NXXOUT#init==2NFTVMT#init+NXXOUT,
C    2NFTVMT+NXXXIN#init==2NFTVMT#init+NXXXIN, NPTS==NPTS#init,
C    KZN#init+NFTVMT<=KZN+NFTVMT#init, NXXXIN#init<=NXXXIN}

         DO 180 K = 1, 2                                                0504

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(A, KZO, NWH)                                        0505

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(A(1,K2Q), KZN, NWH)                                 0506

C  T(I,J,K2QJ) {1<=J}

            DO 190 J = 1, N1Q                                           0507

C  T(K2QJ) {J+K2QM==K2QJ}

               K2QJ = J+K2QM                                            0508

C  T(I) {1<=I}

               DO 200 I = 1, N2PD                                       0509

C  T() {}

                  A(I,J) = A(I,J)+0.5*A(I,K2QJ)                         0510

C  T() {}

200               CONTINUE                                              0511

C  T() {}

190            CONTINUE                                                 0512

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(A, KZN, NWH)                                       0513

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

            CALL ACAC(A, EX, WORK)                                      0514

C  T(I,J) {1<=J}

            DO 210 J = 1, N1Q                                           0515

C  T(I) {1<=I}

               DO 220 I = 1, N2PD                                       0516

C  T() {}

                  A(I,J) = 0.5*A(I,J)                                   0517

C  T() {}

220               CONTINUE                                              0518

C  T() {}

210            CONTINUE                                                 0519

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(A, KZO, NWH)                                       0520

C  T(KZO) {KZO#init+NWH==KZO}

            KZO = KZO+NWH                                               0521

C  T(KZN) {KZN#init+NWH==KZN}

            KZN = KZN+NWH                                               0522

C  T() {}

180         CONTINUE                                                    0523

C  T(I,IEXSHF,ISIGN,J,K,K2QJ,KTN,KTO,LOG,MTRN,NFTVMT,NPTS,NXACAC,
C    NXXOUT,NXXXIN) {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    5NFTVMT+3NXXOUT#init==5NFTVMT#init+3NXXOUT, NPTS==NPTS#init,
C    5NXACAC+3NXXOUT#init==5NXACAC#init+3NXXOUT,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN, NXXOUT#init<=NXXOUT,
C    NXXOUT<=NXXOUT#init+5}

         IF (NOTEMP.NE.1) THEN                                          0524

C  T(ISIGN) {ISIGN==-1}

C
C TIME AVERAGE TEMPERATURE:
C
            ISIGN = -1                                                  0528

C  T(MTRN) {MTRN==N1H}

            MTRN = N1H                                                  0529

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

            CALL IN(A, LTO, NW)                                         0530

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

            CALL ACAC(A, EX, WORK)                                      0531

C  T() {}

            F = 0.125/REAL(N2)                                          0532

C  T(I,J) {1<=J}

            DO 230 J = 1, N1H                                           0533

C  T(I) {1<=I}

               DO 240 I = 1, N2PD                                       0534

C  T() {}

                  A(I,J) = F*A(I,J)                                     0535

C  T() {}

240               CONTINUE                                              0536

C  T() {}

230            CONTINUE                                                 0537

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTO, LTO+NW<=MEMSIZ+1, 1<=NW}

            CALL OUT(A, LTO, NW)                                        0538

C  T(ISIGN) {ISIGN==1}

            ISIGN = 1                                                   0539

C  T(MTRN) {MTRN==N1Q}

            MTRN = N1Q                                                  0540

C  T(KTO) {KTO==LTO}

            KTO = LTO                                                   0541

C  T(KTN) {KTN==LTN}

            KTN = LTN                                                   0542

C  T(I,IEXSHF,J,K,K2QJ,KTN,KTO,LOG,NFTVMT,NPTS,NXACAC,NXXOUT,NXXXIN)
C    {IEXSHF==IEXSHF#init, K+NFTVMT#init==NFTVMT+1,
C    KTN+KTO#init==KTN#init+KTO, LOG==LOG#init,
C    NFTVMT+NXACAC#init==NFTVMT#init+NXACAC,
C    2NFTVMT+NXXOUT#init==2NFTVMT#init+NXXOUT,
C    2NFTVMT+NXXXIN#init==2NFTVMT#init+NXXXIN, NPTS==NPTS#init,
C    KTN#init+NFTVMT<=KTN+NFTVMT#init, NXXXIN#init<=NXXXIN}

            DO 250 K = 1, 2                                             0543

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL IN(A, KTO, NWH)                                     0544

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL IN(A(1,K2Q), KTN, NWH)                              0545

C  T(I,J,K2QJ) {1<=J}

               DO 260 J = 1, N1Q                                        0546

C  T(K2QJ) {J+K2QM==K2QJ}

                  K2QJ = J+K2QM                                         0547

C  T(I) {1<=I}

                  DO 270 I = 1, N2PD                                    0548

C  T() {}

                     A(I,J) = A(I,J)+0.5*A(I,K2QJ)                      0549

C  T() {}

270                  CONTINUE                                           0550

C  T() {}

260               CONTINUE                                              0551

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL OUT(A, KTN, NWH)                                    0552

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

               CALL ACAC(A, EX, WORK)                                   0553

C  T(I,J) {1<=J}

               DO 280 J = 1, N1Q                                        0554

C  T(I) {1<=I}

                  DO 290 I = 1, N2PD                                    0555

C  T() {}

                     A(I,J) = 0.5*A(I,J)                                0556

C  T() {}

290                  CONTINUE                                           0557

C  T() {}

280               CONTINUE                                              0558

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

               CALL OUT(A, KTO, NWH)                                    0559

C  T(KTO) {KTO#init+NWH==KTO}

               KTO = KTO+NWH                                            0560

C  T(KTN) {KTN#init+NWH==KTN}

               KTN = KTN+NWH                                            0561

C  T() {}

250            CONTINUE                                                 0562
         ENDIF

      ENDIF

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR,NXXXIN) {NFTVMT+2NUSHUF#init==NFTVMT#init+2NUSHUF,
C    NUSHUF+NXACAC#init==NUSHUF#init+NXACAC,
C    2NUSHUF+NXLOG2#init==2NUSHUF#init+NXLOG2,
C    NUSHUF+NXXCSR#init==NUSHUF#init+NXXCSR, NXXXIN==NXXXIN#init+1,
C    1<=LPN, LPN+NW<=MEMSIZ+1, NUSHUF#init<=NUSHUF,
C    NUSHUF<=NUSHUF#init+1, 1<=NW}

C
C THE BEGINING OF A NORMAL TIME STEP
C (U IS X VELOCITY AND V IS Y VELOCITY)
C FIND (-U) = D(PSI)/DY
C
C
      IF (NSTEPS.LT.3) THEN                                             0572

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LPN, NW)                                           0573

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR) {ISIGN==1, MSKIP==1, MTRN==N2P, MTRN==NSKIP,
C    2N1H==NPTS, NFTVMT==NFTVMT#init+2, NUSHUF==NUSHUF#init+1,
C    NXACAC==NXACAC#init+1, NXLOG2==NXLOG2#init+2,
C    NXXCSR==NXXCSR#init+1}

         CALL PSIPHY(CA, N2P, N1H, EX, G, U, WORK, CWORK3, 1)           0574

      ELSE

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LPN, NW)                                           0577

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR) {NFTVMT+NXLOG2#init==NFTVMT#init+NXLOG2,
C    2NUSHUF+NXLOG2#init==2NUSHUF#init+NXLOG2,
C    2NXACAC+NXLOG2#init==2NXACAC#init+NXLOG2,
C    NXLOG2+2NXXCSR#init==NXLOG2#init+2NXXCSR, NXLOG2#init<=NXLOG2,
C    NXLOG2<=NXLOG2#init+2}

         IF (MOD(NSTEPS, KPP).EQ.1) CALL PSIPHY(CA, N2P, N1H, EX, G,    0578
     &   U, WORK, CWORK3, -1)                                           0578
      ENDIF

C  T(NPTS) {2N2==NPTS}

C
      NPTS = 2*N2                                                       0582

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0583

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0584

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0585

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0586

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0587

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0588

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPN, NW)                                              0589

C  T() {}

      F = 0.                                                            0590

C  T(I,J) {1<=I}

      DO 300 I = 1, N2                                                  0591

C  T(J) {1<=J}

         DO 310 J = 1, N1H                                              0592

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0593

C  T() {}

310         CONTINUE                                                    0594

C  T() {}

         F = F+1.                                                       0595

C  T() {}

300      CONTINUE                                                       0596

C  T(J) {1<=J}

      DO 320 J = 1, N1H                                                 0597

C  T() {}

         CA(N2P,J) = 0.                                                 0598

C  T() {}

320      CONTINUE                                                       0599

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXSCSC==NXSCSC#init+1}

      CALL SCSC(CA, EX, WORK)                                           0600

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPY, LPY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPY, NW)                                             0601

C  T() {}

      IF (KSM.EQ.1) CALL MEAN(CA, U, G)                                 0602

C  T(IEXSHF,ISIGN,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT+NXSCSC#init==NFTVMT#init+NXSCSC,
C    NPTS==NPTS#init, NFTVMT#init<=NFTVMT, NFTVMT<=NFTVMT#init+1}

      IF (MOD(NSTEPS, KUF).EQ.1) CALL UVELFO(CA, N2P, N1H, G, EX,       0603
     &CWORK)                                                            0603

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPN, NW)                                              0604

C  T() {}

C
C FIND  V = D(PSI)/DX
C
      F = 0.                                                            0608

C  T(I,J) {1<=J}

      DO 330 J = 1, N1H                                                 0609

C  T(I) {1<=I}

         DO 340 I = 1, N2P                                              0610

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0611

C  T() {}

340         CONTINUE                                                    0612

C  T() {}

         F = F+FX                                                       0613

C  T() {}

330      CONTINUE                                                       0614

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

      CALL ACAC(CA, EX, WORK)                                           0615

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPN, NW)                                             0616

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KPP).EQ.1.AND.NOTEMP.NE.1) CALL IN(CA, LPN, NW)   0617

C  T(NPTS) {2N2==NPTS}

      NPTS = 2*N2                                                       0618

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0619

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0620

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0621

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0622

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0623

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0624

C  T(I,J,KTO,NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXOUT#init<=NXXOUT}

      IF (NOTEMP.NE.1) THEN                                             0625

C  T(KTO) {KTO==LTO}

C
C T(TOTAL) = T-BETA*Y
C WHERE BETA < 0 MEANS   STABLE STRATIFICATION AND
C       BETA > 0 MEANS UNSTABLE STRATIFICATION
C
         KTO = LTO                                                      0631

C  T() {}

         DTB = 0.5*BETA*DTT                                             0632

C  T(I,J,KTO,NXXOUT,NXXXIN) {J+NXXXIN#init==NXXXIN+1,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    KTO#init+NXXXIN<=KTO+NXXXIN#init, NXXXIN#init<=NXXXIN}

         DO 350 J = 1, N1H                                              0633

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTO, KTO+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL IN(CWORK, KTO, N2PD)                                   0634

C  T() {}

            F = -REAL(J-1)*FX*DTT*0.25                                  0635

C  T(I) {1<=I}

            DO 360 I = 1, N2P                                           0636

C  T() {}

               CWORK(I) = CWORK(I)*CMPLX(1., U(I)*F)+DTB*CA(I,J)        0637

C  T() {}

360            CONTINUE                                                 0638

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTO, KTO+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL OUT(CWORK, KTO, N2PD)                                  0639

C  T(KTO) {KTO#init+N2PD==KTO}

            KTO = KTO+N2PD                                              0640

C  T() {}

350         CONTINUE                                                    0641
      ENDIF

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}


      CALL IN(CA, LZN, NW)                                              0644

C  T() {}

C
C FIND DZ/DY:
C
      F = 0.                                                            0648

C  T(I,J) {1<=I}

      DO 370 I = 1, N2                                                  0649

C  T(J) {1<=J}

         DO 380 J = 1, N1H                                              0650

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0651

C  T() {}

380         CONTINUE                                                    0652

C  T() {}

         F = F+1.                                                       0653

C  T() {}

370      CONTINUE                                                       0654

C  T(J) {1<=J}

      DO 390 J = 1, N1H                                                 0655

C  T() {}

         CA(N2P,J) = 0.                                                 0656

C  T() {}

390      CONTINUE                                                       0657

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXSCSC==NXSCSC#init+1}

      CALL SCSC(CA, EX, WORK)                                           0658

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZY, NW)                                             0659

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LZN, NW)                                              0660

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

      CALL ACAC(CA, EX, WORK)                                           0661

C  T(I,J) {1<=J}

      DO 400 J = 1, N1H                                                 0662

C  T(I) {1<=I}

         DO 410 I = 1, N2P                                              0663

C  T() {}

            CA(I,J) = CA(I,J)*0.5                                       0664

C  T() {}

410         CONTINUE                                                    0665

C  T() {}

400      CONTINUE                                                       0666

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZN, NW)                                             0667

C  T(NPTS) {N1==NPTS}

      NPTS = N1                                                         0668

C  T(NSKIP) {N2P==NSKIP}

      NSKIP = N2P                                                       0669

C  T(MTRN) {MTRN==N2P}

      MTRN = N2P                                                        0670

C  T(MSKIP) {MSKIP==1}

      MSKIP = 1                                                         0671

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0672

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0673

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0674

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,ZETAPH:NCALL)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    NFTVMT+NXXCSR#init==NFTVMT#init+NXXCSR, NPTS==NPTS#init,
C    NUSHUF+NXXCSR#init==NUSHUF#init+NXXCSR,
C    NXPRNT+NXXCSR#init==NXPRNT#init+NXXCSR,
C    NXXCSR+ZETAPH:NCALL#init==NXXCSR#init+ZETAPH:NCALL,
C    NXXCSR#init<=NXXCSR, NXXCSR<=NXXCSR#init+1}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL ZETAPH(CA, N2PD, N1H, EX, WORK    0675
     &, -1)                                                             0675

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL IN(CA, LZN, NW)                   0676

C  T() {}

C
C FIND DZ/DX:
C
      F = 0.                                                            0680

C  T(I,J) {1<=J}

      DO 420 J = 1, N1H                                                 0681

C  T(I) {1<=I}

         DO 430 I = 1, N2P                                              0682

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0683

C  T() {}

430         CONTINUE                                                    0684

C  T() {}

         F = F+FX2                                                      0685

C  T() {}

420      CONTINUE                                                       0686

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

      CALL CSR(CA, EX)                                                  0687

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZX, LZX+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZX, NW)                                             0688

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LZY, NW)                                              0689

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

      CALL CSR(CA, EX)                                                  0690

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LZY, NW)                                             0691

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPN, NW)                                              0692

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

      CALL CSR(CA, EX)                                                  0693

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPN, LPN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPN, NW)                                             0694

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPY, LPY+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(CA, LPY, NW)                                              0695

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

      CALL CSR(CA, EX)                                                  0696

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LPY, LPY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(CA, LPY, NW)                                             0697

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF+NXXXIN#init==NUSHUF#init+NXXXIN,
C    NXPRNT+NXXXIN#init==NXPRNT#init+NXXXIN, NXXXIN#init<=NXXXIN,
C    NXXXIN<=NXXXIN#init+1}

C
C WE ARE IN PHYSICAL SPACE NOW - FIND  (U,V).GRAD (Z):
C
      IF (MOD(NSTEPS, KUP).EQ.1) CALL UVELPH(A, N2PD, N1H, WORK, -1)    0701

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF+NXXXIN#init==NUSHUF#init+NXXXIN,
C    NXPRNT+NXXXIN#init==NXPRNT#init+NXXXIN, NXXXIN#init<=NXXXIN,
C    NXXXIN<=NXXXIN#init+1}

      IF (MOD(NSTEPS, KVP).EQ.1) CALL VVELPH(A, N2PD, N1H, WORK, -1)    0702

C  T(KPY) {KPY==LPY}

      KPY = LPY                                                         0703

C  T(KPN) {KPN==LPN}

      KPN = LPN                                                         0704

C  T(KZY) {KZY==LZY}

      KZY = LZY                                                         0705

C  T(KZX) {KZX==LZX}

      KZX = LZX                                                         0706

C  T() {}

      UKSM1F = REAL(2-KSM)                                              0707

C  T(I,IPH,J,K,KPN,KPY,KZX,KZY,NXXOUT,NXXXIN)
C    {2K+NXXOUT#init==NXXOUT+2, 4K+NXXXIN#init==NXXXIN+4,
C    KPN+KZY#init==KPN#init+KZY, KPY+KZY#init==KPY#init+KZY,
C    KZX+KZY#init==KZX#init+KZY, K+KZY#init<=KZY+1,
C    NXXXIN#init<=NXXXIN}

      DO 440 K = 1, 4                                                   0708

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A, KPY, NWQ)                                           0709

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A(1,K1Q), KPN, NWQ)                                    0710

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A(1,K2Q), KZY, NWQ)                                    0711

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZX, KZX+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL IN(A(1,K3Q), KZX, NWQ)                                    0712

C  T(I,IPH,J) {1<=I}

         DO 450 I = 1, N2PD                                             0713

C  T(IPH) {2IPH<=I+1, I<=2IPH}

            IPH = (I+1)/2                                               0714

C  T() {}

            GG = G(IPH)                                                 0715

C  T() {}

            UU = U(IPH)*UKSM1F                                          0716

C  T(J) {1<=J}

            DO 460 J = 1, N1E                                           0717

C  T() {}

               A(I,J) = A(I,J)*GG+UU                                    0718

C  T() {}

               A(I,K2QM+J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+   0719
     &         J)*GG                                                    0719

C  T() {}

460            CONTINUE                                                 0721

C  T() {}

450         CONTINUE                                                    0722

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL OUT(A, KPY, NWQ)                                          0723

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

         CALL OUT(A(1,K2Q), KZY, NWQ)                                   0724

C  T(KPN) {KPN#init+NWQ==KPN}

         KPN = KPN+NWQ                                                  0725

C  T(KPY) {KPY#init+NWQ==KPY}

         KPY = KPY+NWQ                                                  0726

C  T(KZX) {KZX#init+NWQ==KZX}

         KZX = KZX+NWQ                                                  0727

C  T(KZY) {KZY#init+NWQ==KZY}

         KZY = KZY+NWQ                                                  0728

C  T() {}

440      CONTINUE                                                       0729

C  T(ISIGN) {ISIGN==-1}

C
C [Z(OLD) + (MEAN -U) * (-DZ(OLD)/DX)] + (U,V).GRAD(Z)
C
      ISIGN = -1                                                        0733

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(A, LZY, NW)                                               0734

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXRCS==NXXRCS#init+1}

      CALL RCS(A, EX)                                                   0735

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(A, LZY, NW)                                              0736

C  T(KZO) {KZO==LZO}

      KZO = LZO                                                         0737

C  T(KZN) {KZN==LZN}

      KZN = LZN                                                         0738

C  T(KZY) {KZY==LZY}

      KZY = LZY                                                         0739

C  T() {}

      DTFAC = 0.125*DTT/REAL(N1)                                        0740

C  T() {}

      F1 = DTT*FX*0.25                                                  0741

C  T() {}

      F = F1                                                            0742

C  T(I,J,K,K2QJ,KZN,KZO,KZY,NXXOUT,NXXXIN) {2K+NXXOUT#init==NXXOUT+2,
C    3K+NXXXIN#init==NXXXIN+3, KZN+KZY#init==KZN#init+KZY,
C    KZO+KZY#init==KZO#init+KZY, K+KZY#init<=KZY+1,
C    NXXXIN#init<=NXXXIN}

      DO 470 K = 1, 2                                                   0743

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA, KZO, NWH)                                          0744

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0745

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZO, KZO+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL OUT(CA(1,K2Q), KZO, NWH)                                  0746

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA(1,K2Q), KZY, NWH)                                   0747

C  T(I,J,K2QJ) {1<=J}

         DO 480 J = 1, N1Q                                              0748

C  T(K2QJ) {J+K2QM==K2QJ}

            K2QJ = J+K2QM                                               0749

C  T() {}

            F = F-F1                                                    0750

C  T(I) {1<=I}

            DO 490 I = 1, N2P                                           0751

C  T() {}

               CA(I,J) = CA(I,J)*CMPLX(1., F*U(I))+DTFAC*CA(I,K2QJ)     0752

C  T() {}

490            CONTINUE                                                 0753

C  T() {}

480         CONTINUE                                                    0754

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL OUT(CA, KZN, NWH)                                         0755

C  T(KZN) {KZN#init+NWH==KZN}

         KZN = KZN+NWH                                                  0756

C  T(KZO) {KZO#init+NWH==KZO}

         KZO = KZO+NWH                                                  0757

C  T(KZY) {KZY#init+NWH==KZY}

         KZY = KZY+NWH                                                  0758

C  T() {}

470      CONTINUE                                                       0759

C  T(I,IEXSHF,IPH,ISIGN,J,K,K2QJ,KPN,KPY,KTN,KTO,KZN,KZX,KZY,LOG,
C    MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,NXLOG2,NXPRNT,NXSCSC,
C    NXXCSR,NXXOUT,NXXRCS,NXXXIN,TEMPHY:NCALL)
C    {NFTVMT+5NXXRCS#init+TEMPHY:NCALL#init==NFTVMT#init+5NXXRCS+
C    TEMPHY:NCALL, NUSHUF+TEMPHY:NCALL#init==NUSHUF#init+TEMPHY:NCALL,
C    NXACAC+NXXRCS#init==NXACAC#init+NXXRCS,
C    NXLOG2+2NXXRCS#init==NXLOG2#init+2NXXRCS,
C    NXPRNT+TEMPHY:NCALL#init==NXPRNT#init+TEMPHY:NCALL,
C    NXSCSC+NXXRCS#init==NXSCSC#init+NXXRCS,
C    NXXCSR+2NXXRCS#init+TEMPHY:NCALL#init==NXXCSR#init+2NXXRCS+
C    TEMPHY:NCALL, NXXOUT+17NXXRCS#init==NXXOUT#init+17NXXRCS,
C    31NXXRCS+NXXXIN#init+TEMPHY:NCALL==31NXXRCS#init+NXXXIN+
C    TEMPHY:NCALL#init, NXXRCS<=NXXRCS#init+1,
C    NXXRCS#init+TEMPHY:NCALL<=NXXRCS+TEMPHY:NCALL#init,
C    TEMPHY:NCALL#init<=TEMPHY:NCALL}

      IF (NOTEMP.NE.1) THEN                                             0760

C  T(NPTS) {2N2==NPTS}

C
C FIND DT/DY:
C
         NPTS = 2*N2                                                    0764

C  T(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0765

C  T(MTRN) {MTRN==N1H}

         MTRN = N1H                                                     0766

C  T(MSKIP) {MSKIP==N2P}

         MSKIP = N2P                                                    0767

C  T(ISIGN) {ISIGN==1}

         ISIGN = 1                                                      0768

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0769

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0770

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LTN, NW)                                           0771

C  T() {}

         F = 0.                                                         0772

C  T(I,J) {1<=I}

         DO 500 I = 1, N2                                               0773

C  T(J) {1<=J}

            DO 510 J = 1, N1H                                           0774

C  T() {}

               CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))      0775

C  T() {}

510            CONTINUE                                                 0776

C  T() {}

            F = F+1.                                                    0777

C  T() {}

500         CONTINUE                                                    0778

C  T(J) {1<=J}

         DO 520 J = 1, N1H                                              0779

C  T() {}

            CA(N2P,J) = 0.                                              0780

C  T() {}

520         CONTINUE                                                    0781

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXSCSC==NXSCSC#init+1}

         CALL SCSC(CA, EX, WORK)                                        0782

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(CA, LZY, NW)                                          0783

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(CA, LTN, NW)                                           0784

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

         CALL ACAC(CA, EX, WORK)                                        0785

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(CA, LTN, NW)                                          0786

C  T(NPTS) {N1==NPTS}

         NPTS = N1                                                      0787

C  T(NSKIP) {N2P==NSKIP}

         NSKIP = N2P                                                    0788

C  T(MTRN) {MTRN==N2P}

         MTRN = N2P                                                     0789

C  T(MSKIP) {MSKIP==1}

         MSKIP = 1                                                      0790

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

         CALL XLOG2(NPTS, LOG)                                          0791

C  T(IEXSHF) {}

         IEXSHF = NMAX2/NPTS                                            0792

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    NFTVMT+NXXXIN#init==NFTVMT#init+NXXXIN, NPTS==NPTS#init,
C    NUSHUF+NXXXIN#init==NUSHUF#init+NXXXIN,
C    NXPRNT+NXXXIN#init==NXPRNT#init+NXXXIN,
C    NXXCSR+NXXXIN#init==NXXCSR#init+NXXXIN,
C    NXXXIN+TEMPHY:NCALL#init==NXXXIN#init+TEMPHY:NCALL,
C    NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

         IF (NSTEPS.EQ.1) THEN                                          0793

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init, NFTVMT==NFTVMT#init+1,
C    NPTS==NPTS#init, NUSHUF==NUSHUF#init+1, NXPRNT==NXPRNT#init+1,
C    NXXCSR==NXXCSR#init+1, NXXXIN==NXXXIN#init+1,
C    TEMPHY:NCALL==TEMPHY:NCALL#init+1, 1<=LTN, LTN<=MEMSIZ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, 0)                      0794

         ELSEIF (MOD(NSTEPS, KTP).EQ.1.OR.MOD(NSTEPS, KPP).EQ.1) THEN   0793

C  T(IEXSHF,LOG,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init, NFTVMT==NFTVMT#init+1,
C    NPTS==NPTS#init, NUSHUF==NUSHUF#init+1, NXPRNT==NXPRNT#init+1,
C    NXXCSR==NXXCSR#init+1, NXXXIN==NXXXIN#init+1,
C    TEMPHY:NCALL==TEMPHY:NCALL#init+1, 1<=LTN, LTN<=MEMSIZ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, -1)                     0798
         ENDIF

C  T() {}

C
C TEMPERATURE INFLUENCE:
C
         F = -FX                                                        0803

C  T(KZN) {KZN==LZN}

         KZN = LZN                                                      0804

C  T(KZX) {KZX==LZX}

         KZX = LZX                                                      0805

C  T(KTN) {KTN==LTN}

         KTN = LTN                                                      0806

C  T() {}

         DTA = 0.5*ALPHA*DTT                                            0807

C  T(I,J,K,K2QJ,KTN,KZN,KZX,NXXOUT,NXXXIN) {2K+NXXOUT#init==NXXOUT+2,
C    2K+NXXXIN#init==NXXXIN+2, KTN+KZN#init==KTN#init+KZN,
C    KZN+KZX#init==KZN#init+KZX, K+KZN#init<=KZN+1,
C    NXXXIN#init<=NXXXIN}

         DO 530 K = 1, 2                                                0808

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA, KZN, NWH)                                       0809

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA(1,K2Q), KTN, NWH)                                0810

C  T(I,J,K2QJ) {1<=J}

            DO 540 J = 1, N1Q                                           0811

C  T(K2QJ) {J+K2QM==K2QJ}

               K2QJ = J+K2QM                                            0812

C  T() {}

               F = F+FX                                                 0813

C  T(I) {1<=I}

               DO 550 I = 1, N2P                                        0814

C  T() {}

                  CA(I,K2QJ) = CMPLX(-F*AIMAG(CA(I,K2QJ)), F*REAL(CA(   0815
     &            I,K2QJ)))                                             0815

C  T() {}

                  CA(I,J) = CA(I,J)+DTA*CA(I,K2QJ)                      0817

C  T() {}

550               CONTINUE                                              0818

C  T() {}

540            CONTINUE                                                 0819

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(CA, KZN, NWH)                                      0820

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZX, KZX+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(CA(1,K2Q), KZX, NWH)                               0821

C  T(KZX) {KZX#init+NWH==KZX}

            KZX = KZX+NWH                                               0822

C  T(KTN) {KTN#init+NWH==KTN}

            KTN = KTN+NWH                                               0823

C  T(KZN) {KZN#init+NWH==KZN}

            KZN = KZN+NWH                                               0824

C  T() {}

530         CONTINUE                                                    0825

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZX, LZX+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZX, NW)                                            0826

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

         CALL CSR(A, EX)                                                0827

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZX, LZX+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZX, NW)                                           0828

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZY, NW)                                            0829

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

         CALL CSR(A, EX)                                                0830

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZY, NW)                                           0831

C  T(KPN) {KPN==LPN}

         KPN = LPN                                                      0832

C  T(KPY) {KPY==LPY}

         KPY = LPY                                                      0833

C  T(KZX) {KZX==LZX}

         KZX = LZX                                                      0834

C  T(KZY) {KZY==LZY}

         KZY = LZY                                                      0835

C  T(I,IPH,J,K,KPN,KPY,KZX,KZY,NXXOUT,NXXXIN)
C    {K+NXXOUT#init==NXXOUT+1, KPN+KZY#init==KPN#init+KZY,
C    KPY+KZY#init==KPY#init+KZY, KZX+KZY#init==KZX#init+KZY,
C    4NXXOUT+NXXXIN#init==4NXXOUT#init+NXXXIN,
C    KZY#init+NXXOUT<=KZY+NXXOUT#init, NXXXIN#init<=NXXXIN}

C
C IN PHYSICAL SPACE - FIND  (U,V).GRAD(T):
C
         DO 560 K = 1, 4                                                0839

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A, KPY, NWQ)                                        0840

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A(1,K1Q), KPN, NWQ)                                 0841

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A(1,K2Q), KZY, NWQ)                                 0842

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZX, KZX+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL IN(A(1,K3Q), KZX, NWQ)                                 0843

C  T(I,IPH,J) {1<=I}

            DO 570 I = 1, N2PD                                          0844

C  T(IPH) {2IPH<=I+1, I<=2IPH}

               IPH = (I+1)/2                                            0845

C  T() {}

               GG = G(IPH)                                              0846

C  T(J) {1<=J}

               DO 580 J = 1, N1E                                        0847

C  T() {}

                  A(I,J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+J)   0848
     &            *GG                                                   0848

C  T() {}

580               CONTINUE                                              0850

C  T() {}

570            CONTINUE                                                 0851

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1,
C    1<=NWQ}

            CALL OUT(A, KZY, NWQ)                                       0852

C  T(KPN) {KPN#init+NWQ==KPN}

            KPN = KPN+NWQ                                               0853

C  T(KPY) {KPY#init+NWQ==KPY}

            KPY = KPY+NWQ                                               0854

C  T(KZX) {KZX#init+NWQ==KZX}

            KZX = KZX+NWQ                                               0855

C  T(KZY) {KZY#init+NWQ==KZY}

            KZY = KZY+NWQ                                               0856

C  T() {}

560         CONTINUE                                                    0857

C  T(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0858

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LZY, NW)                                            0859

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXRCS==NXXRCS#init+1}

         CALL RCS(A, EX)                                                0860

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LZY, NW)                                           0861

C  T(KTN) {KTN==LTN}

         KTN = LTN                                                      0862

C  T(KTO) {KTO==LTO}

         KTO = LTO                                                      0863

C  T(KZY) {KZY==LZY}

         KZY = LZY                                                      0864

C  T(I,J,K,K2QJ,KTN,KTO,KZY,NXXOUT,NXXXIN) {2K+NXXOUT#init==NXXOUT+2,
C    3K+NXXXIN#init==NXXXIN+3, KTN+KZY#init==KTN#init+KZY,
C    KTO+KZY#init==KTO#init+KZY, K+KZY#init<=KZY+1,
C    NXXXIN#init<=NXXXIN}

         DO 590 K = 1, 2                                                0865

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA, KTO, NWH)                                       0866

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(A(1,K2Q), KTN, NWH)                                 0867

C  T(I,J) {K2Q<=J}

            DO 600 J = K2Q, N1H                                         0868

C  T(I) {1<=I}

               DO 610 I = 1, N2PD                                       0869

C  T() {}

                  A(I,J) = 0.5*A(I,J)                                   0870

C  T() {}

610               CONTINUE                                              0871

C  T() {}

600            CONTINUE                                                 0872

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(A(1,K2Q), KTO, NWH)                                0873

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZY, KZY+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL IN(CA(1,K2Q), KZY, NWH)                                0874

C  T(I,J,K2QJ) {1<=J}

            DO 620 J = 1, N1Q                                           0875

C  T(K2QJ) {J+K2QM==K2QJ}

               K2QJ = J+K2QM                                            0876

C  T(I) {1<=I}

               DO 630 I = 1, N2P                                        0877

C  T() {}

                  CA(I,J) = CA(I,J)+DTFAC*CA(I,K2QJ)                    0878

C  T() {}

630               CONTINUE                                              0879

C  T() {}

620            CONTINUE                                                 0880

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTN, KTN+NWH<=MEMSIZ+1,
C    1<=NWH}

            CALL OUT(CA, KTN, NWH)                                      0881

C  T(KTN) {KTN#init+NWH==KTN}

            KTN = KTN+NWH                                               0882

C  T(KTO) {KTO#init+NWH==KTO}

            KTO = KTO+NWH                                               0883

C  T(KZY) {KZY#init+NWH==KZY}

            KZY = KZY+NWH                                               0884

C  T() {}

590         CONTINUE                                                    0885
      ENDIF

C  T() {}


      DTF = 0.25*DTT*FX                                                 0888

C  T() {}

      F = -DTF                                                          0889

C  T(KZN) {KZN==LZN}

      KZN = LZN                                                         0890

C  T(KTN) {KTN==LTN}

      KTN = LTN                                                         0891

C  T(I,J,K,K2QJ,KTN,KZN,NXXOUT,NXXXIN) {KTN+KZN#init==KTN#init+KZN,
C    K+KZN#init<=KZN+1, NXXOUT+2<=2K+NXXOUT#init,
C    K+NXXOUT#init<=NXXOUT+1, NXXXIN+2<=2K+NXXXIN#init,
C    K+NXXXIN#init<=NXXXIN+1}

      DO 640 K = 1, 2                                                   0892

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

         IF (NOTEMP.NE.1) CALL IN(CA, KTN, NWH)                         0893

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0894

C  T(I,J,K2QJ) {1<=J}

         DO 650 J = 1, N1Q                                              0895

C  T(K2QJ) {J+K2QM==K2QJ}

            K2QJ = J+K2QM                                               0896

C  T() {}

            F = F+DTF                                                   0897

C  T(I) {}

            IF (NOTEMP.NE.1) THEN                                       0898

C  T(I) {1<=I}

               DO 660 I = 1, N2P                                        0899

C  T() {}

                  WORK(I) = F*U(I)                                      0900

C  T() {}

                  CA(I,J) = CMPLX(1.0, -WORK(I))*CA(I,J)/(1.0+WORK(I)   0901
     &            *WORK(I))                                             0901

C  T() {}

660               CONTINUE                                              0903
            ENDIF

C  T(I) {1<=I}


            DO 670 I = 1, N2P                                           0906

C  T() {}

               WORK(I) = F*U(I)                                         0907

C  T() {}

               CA(I,K2QJ) = CMPLX(1.0, -WORK(I))*CA(I,K2QJ)/(1.0+WORK   0908
     &         (I)*WORK(I))                                             0908

C  T() {}

670            CONTINUE                                                 0910

C  T() {}

650         CONTINUE                                                    0911

C  T(NXXOUT) {NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

         IF (NOTEMP.NE.1) CALL OUT(CA, KTN, NWH)                        0912

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    1<=NWH}

         CALL OUT(CA(1,K2Q), KZN, NWH)                                  0913

C  T(KTN) {KTN#init+NWH==KTN}

         KTN = KTN+NWH                                                  0914

C  T(KZN) {KZN#init+NWH==KZN}

         KZN = KZN+NWH                                                  0915

C  T() {}

640      CONTINUE                                                       0916

C  T(NPTS) {2N2==NPTS}

      NPTS = 2*N2                                                       0917

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0918

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0919

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0920

C  T(ISIGN) {ISIGN==-1}

      ISIGN = -1                                                        0921

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0922

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0923

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL IN(A, LZN, NW)                                               0924

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

      CALL ACAC(A, EX, WORK)                                            0925

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LZN, LZN+NW<=MEMSIZ+1, 1<=NW}

      CALL OUT(A, LZN, NW)                                              0926

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC,NXXOUT,NXXXIN)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init,
C    NFTVMT+NXXOUT#init==NFTVMT#init+NXXOUT, NPTS==NPTS#init,
C    NXACAC+NXXOUT#init==NXACAC#init+NXXOUT,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN, NXXOUT#init<=NXXOUT,
C    NXXOUT<=NXXOUT#init+1}

      IF (NOTEMP.NE.1) THEN                                             0927

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL IN(A, LTN, NW)                                            0928

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

         CALL ACAC(A, EX, WORK)                                         0929

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=NW}

         CALL OUT(A, LTN, NW)                                           0930
      ENDIF

C  T(KZN) {KZN==LZN}


      KZN = LZN                                                         0933

C  T(KPN) {KPN==LPN}

      KPN = LPN                                                         0934

C  T() {}

      F2 = 1./(4.*REAL(N2))                                             0935

C  T() {}

      F1 = RNU*DTT                                                      0936

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LEIG, LEIG+NWEIG<=MEMSIZ+1,
C    1<=NWEIG}

C
C FIND PRESSURE NOW OR NEVER (IF REQUIRED...)
C
      CALL IN(EVAL, LEIG, NWEIG)                                        0940

C  T(LVECT) {LVECT==N2M}

      LVECT = N2M                                                       0941

C  T(LSKIP) {LSKIP==2}

      LSKIP = 2                                                         0942

C  T(NVECT) {NVECT==2}

      NVECT = 2                                                         0943

C  T(NVSKIP) {NVSKIP==1}

      NVSKIP = 1                                                        0944

C  T() {}

      FXSQ = FX*FX                                                      0945

C  T(I,J,KPN,KZN,NXXOUT,NXXXIN) {J+NXXXIN#init==NXXXIN+1,
C    KPN+KZN#init==KPN#init+KZN,
C    NXXOUT+2NXXXIN#init==NXXOUT#init+2NXXXIN,
C    KZN#init+NXXXIN<=KZN+NXXXIN#init, NXXXIN#init<=NXXXIN}

C
C UPDATE VORTICITY AND FIND THE NEW STREAMFUNCTION:
C
      DO 680 J = 1, N1H                                                 0949

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

         CALL IN(CWORK, KZN, N2PD)                                      0950

C  T() {}

         F = REAL((J-1)*(J-1))*FXSQ                                     0951

C  T(I) {2<=I}

         DO 690 I = 2, N2                                               0952

C  T() {}

            CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))               0953

C  T() {}

            CWORK2(I) = CWORK(I)/(EVAL(I-1)-F)                          0954

C  T() {}

690         CONTINUE                                                    0955

C  T() {}

         CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                              0956

C  T() {}

         CWORK2(1) = 0.0                                                0957

C  T() {}

         IF (F.NE.0.0) CWORK2(1) = -CWORK(1)/F                          0958

C  T() {}

         CWORK(N2P) = 0.0                                               0959

C  T() {}

         CWORK2(N2P) = 0.0                                              0960

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KZN, KZN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

         CALL OUT(CWORK, KZN, N2PD)                                     0961

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KPN, KPN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

         CALL OUT(CWORK2, KPN, N2PD)                                    0962

C  T(KPN) {KPN#init+N2PD==KPN}

         KPN = KPN+N2PD                                                 0963

C  T(KZN) {KZN#init+N2PD==KZN}

         KZN = KZN+N2PD                                                 0964

C  T() {}

680      CONTINUE                                                       0965

C  T(NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

C
C DE-ALIASE UPDATED FIELDS IF REQUESTED:
C
      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LZN)                    0969

C  T(NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LPN)                    0970

C  T(I,J,KTN,NXXOUT,NXXXIN) {NXXOUT#init<=NXXOUT,
C    NXXOUT#init+NXXXIN<=NXXOUT+NXXXIN#init+1,
C    NXXOUT+NXXXIN#init<=NXXOUT#init+NXXXIN}

      IF (NOTEMP.NE.1) THEN                                             0971

C  T(NXXXIN) {NXXXIN#init<=NXXXIN, NXXXIN<=NXXXIN#init+1}

C
C UPDATE TEMPERATURE:
C
         IF (NOALS.EQ.1) CALL IN(EVAL, LEIG, NWEIG)                     0975

C  T(KTN) {KTN==LTN}

         KTN = LTN                                                      0976

C  T() {}

         F1 = RKAPA*DTT                                                 0977

C  T(I,J,KTN,NXXOUT,NXXXIN) {J+NXXXIN#init==NXXXIN+1,
C    NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    KTN#init+NXXXIN<=KTN+NXXXIN#init, NXXXIN#init<=NXXXIN}

         DO 700 J = 1, N1H                                              0978

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=KTN, KTN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL IN(CWORK, KTN, N2PD)                                   0979

C  T() {}

            F = REAL((J-1)*(J-1))*FXSQ                                  0980

C  T(I) {2<=I}

            DO 710 I = 2, N2                                            0981

C  T() {}

               CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))            0982

C  T() {}

710            CONTINUE                                                 0983

C  T() {}

            CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                           0984

C  T() {}

            CWORK(N2P) = 0.0                                            0985

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=KTN, KTN+N2PD<=MEMSIZ+1,
C    1<=N2PD}

            CALL OUT(CWORK, KTN, N2PD)                                  0986

C  T(KTN) {KTN#init+N2PD==KTN}

            KTN = KTN+N2PD                                              0987

C  T() {}

700         CONTINUE                                                    0988

C  T(NXXOUT,NXXXIN) {NXXOUT+NXXXIN#init==NXXOUT#init+NXXXIN,
C    NXXOUT#init<=NXXOUT, NXXOUT<=NXXOUT#init+1}

C
C DE-ALIASE IF REQUESTED:
C
         IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LTN)                 0992
      ENDIF

C  T() {}

C
C AT LAST, THE END OF THE TIME STEP:
C
      DTT = DT+DT                                                       0997

C  T() {}

      T = T+DT                                                          0998

C  T(NSTEPS) {NSTEPS==NSTEPS#init+1}

      NSTEPS = NSTEPS+1                                                 0999

C  T() {}

      IF (NUMBER.GE.NSTEPS) GOTO 150                                    1000
C#
c      END IF
C

C  T() {}

      WRITE (6, 9010) TXXXIN, TXXOUT, TXXRCS, TXXCSR, TXSCSC, TXACAC    1004
     &, TFTVMT, TXSHUF, TUSHUF, TXPRNT, TXLOG2                          1004

C  T() {}

      WRITE (6, 9020) EXXRCS, EXXCSR, EXSCSC, EXACAC, EFTVMT            1006

C  T() {}

      WRITE (6, 9030) NXXXIN, NXXOUT, NXXRCS, NXXCSR, NXSCSC, NXACAC    1007
     &, NFTVMT, NXSHUF, NUSHUF, NXPRNT, NXLOG2                          1007

C  T(NUM1) {NUM1==NUM1#init+1}

C
      CALL BUG('AFTER  ALL')                                            1010

C  T() {}

C
      CALL CPUTIM(CPU2)                                                 1012

C  T() {}

      CALL ELAPSE(TCLCK2)                                               1013

C  T() {}

C
      TWALL = MOD(TCLCK2-TCLCK1+1000000.0, 1000000.0)                   1015

C  T() {}

      WRITE (6, 9040) TWALL                                             1016

C  T() {}

      WRITE (1, *)                                                      1017

C  T() {}

      WRITE (1, *) 'ELAPSED CPU TIME IN SECONDS: ', CPU2-CPU1           1018

C  T() {}

C MFLOPS RATE = MFLOP 1 CPU CRAY X-MP/CPU TIME
      WRITE (1, *) 'MFLOPS RATE: ', 1657.863/(CPU2-CPU1)                1020

C  T() {}

      WRITE (1, *) 'ELAPSED WALLCLOCK TIME IN SECONDS: ', TWALL         1021

C  T() {}

      WRITE (1, 9050)                                                   1022

C  T(I) {}

      WRITE (1, 9080) (CDAT(I), I = 1, 15)                              1023

C  T(VALID) {VALID==1}

      VALID = 1                                                         1024

C  T(I,VALID) {1<=I}

      DO 720 I = 1, 15                                                  1025

C  T(VALID) {}

         IF (I.EQ.3.OR.I.EQ.13) THEN                                    1026

C  T(VALID) {}

            IF (ABS(CDAT(I)).GT.ABS(VDAT(I))) VALID = 0                 1027

         ELSEIF (ABS(VDAT(I)-CDAT(I)).GT.ABS(.01*VDAT(I))) THEN         1026

C  T(VALID) {VALID==0}

            VALID = 0                                                   1030
         ENDIF

C  T() {}


720      CONTINUE                                                       1033

C  T() {}

C
      IF (VALID.EQ.1) THEN                                              1035

C  T() {}

         WRITE (1, 9060)                                                1036

      ELSE

C  T() {}

         WRITE (1, 9070)                                                1039
      ENDIF

C  T() {}


c      STOP

9000  FORMAT(1X,'OUTPUT FOR PERFECT CLUB BENCHMARK: OCEAN INSTRUMENTED V
     &ERSION',/,1X,'$Revision: 1.A.1 $ $Author: psharma $',/)           1044

C  T() {}

C
9010  FORMAT(/,2X,'SUBROUTINE    IN, EX-TIME FOR FIRST CALL =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   OUT, EX-TIME FOR FIRST CALL =',1P,E1
     &3.6,/,2X,'SUBROUTINE   RCS, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2
     &X,'SUBROUTINE   CSR, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBR
     &OUTINE  SCSC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE 
     & ACAC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE FTRVMT 
     &EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE  SHUF, EX-TIME
     & FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE UNSHUF EX-TIME FOR FI
     &RST CALL =',1P,E13.6,/,2X,'SUBROUTINE RPRINT EX-TIME FOR FIRST CAL
     &L =',1P,E13.6,/,2X,'SUBROUTINE XLOG2, EX-TIME FOR FIRST CALL =',1P
     &,E13.6)                                                           1048

C  T() {}

9020  FORMAT(/,2X,'SUBROUTINE   RCS, EX-TIME LAST TIMESTEP  =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   CSR, EX-TIME LAST TIMESTEP  =',1P,E1
     &3.6,/,2X,'SUBROUTINE  SCSC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2
     &X,'SUBROUTINE  ACAC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2X,'SUBR
     &OUTINE FTRVMT EX-TIME LAST TIMESTEP  =',1P,E13.6)                 1062

C  T() {}

9030  FORMAT(/,2X,'SUBROUTINE    IN, CUMULATIVE CALLS TO    =',I12,/,2X,
     &'SUBROUTINE   OUT, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE 
     &  RCS, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE   CSR, CUMUL
     &ATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE  SCSC, CUMULATIVE CALLS 
     &TO    =',I12,/,2X,'SUBROUTINE  ACAC, CUMULATIVE CALLS TO    =',I12
     &,/,2X,'SUBROUTINE FTRVMT CUMULATIVE CALLS TO    =',I12,/,2X,'SUBRO
     &UTINE  SHUF, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE UNSHUF
     & CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE RPRINT CUMULATIVE 
     &CALLS TO    =',I12,/,2X,'SUBROUTINE XLOG2, CUMULATIVE CALLS TO    
     &=',I12)                                                           1069

C  T() {}

9040  FORMAT(/,2X,'MEASURE OF WALL-CLOCK TIME (ENVIRONMENT SENSITIVE)',/
     &,2X,'FOR EXECUTION ONLY =',1P,E13.6,1X,'SECONDS')                 1080

C  T() {}

C
9050  FORMAT(/,1X,'VALIDATION PARAMETERS:',/)                           1083

C  T() {}

9060  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE:   VALID')                1084

C  T() {}

9070  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE: INVALID')                1085

C  T() {}

9080  FORMAT(5E15.5)                                                    1086

      END

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C***********************************************************************
C
      SUBROUTINE OUT(ARRAY,LOC,NW)
      COMMON /MEMORY/MEMSIZ,RM(165117)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION ARRAY(1)
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0014

C  T(I,LOCM,NXXOUT) {LOC==LOCM+1, NXXOUT==NXXOUT#init+1, 1<=I,
C    NW+1<=I, 1<=LOC, LOC+NW<=MEMSIZ+1, 1<=NW}

C
      IF (LOC.LT.1.OR.LOC+NW-1.GT.MEMSIZ.OR.NW.LT.1) THEN               0016

C  T() {}

C
         WRITE (6, 9000) LOC, NW, MEMSIZ                                0018

C  T() {0==-1}

         STOP                                                           0019

      ELSE

C  T(LOCM) {LOC==LOCM+1}

         LOCM = LOC-1                                                   0022

C  T(I) {1<=I}

         DO 10 I = 1, NW                                                0023

C  T() {}

            RM(LOCM+I) = ARRAY(I)                                       0024

C  T() {}

10          CONTINUE                                                    0025

C  T() {}

C
         IF (LFIRST) THEN                                               0027

C  T() {}

            LFIRST = .FALSE.                                            0028

C  T() {}

            CALL CPUTIM(T2)                                             0029

C  T() {}

            TXXOUT = T2-T1                                              0030
         ENDIF

C  T(NXXOUT) {NXXOUT==NXXOUT#init+1}

C
         NXXOUT = NXXOUT+1                                              0033
C
      ENDIF

C  T() {}


9000  FORMAT(/,/,/,' OUT: ILLEGAL REQUEST. LOCATION:',I22,' ;   NUMBER O
     &F WORDS:',I22,' ;  MEMSIZ:',I7)                                   0037

      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE PSIFOU(CA,N2P,N1H,CWORK)
      COMMON /LADDR/LDUMMY(2),LPN,LDUMY1(9)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0010

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LPN, NW)                                              0011

C  T() {}

      CALL CPRINT(CA, 'PSI FOU', N1H, N2P, -1)                          0012
      END

C  T(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUSHUF,NXACAC,
C    NXLOG2,NXXCSR) {ISIGN==1, MSKIP==1, MTRN==N2P, MTRN==NSKIP,
C    2N1H==NPTS, NFTVMT==NFTVMT#init+2, NUSHUF==NUSHUF#init+1,
C    NXACAC==NXACAC#init+1, NXLOG2==NXLOG2#init+2,
C    NXXCSR==NXXCSR#init+1}

C***********************************************************************
C
C     FGPS  2-APR-88 REWROTE SUBROUTINE SO AS TO RECEIVE THE COMPLEX ARR
C                    CA IN FOURIER SPACE, TRANSFORM THIS ONTO PHYSICAL S
C                    AND CALL CPRINT TO PRINT OUT THE RESULT
C
      SUBROUTINE PSIPHY(CA,N2P,N1H,EX,G,U,WORK,CWORK3,IMODE)
      COMMON /EXSIZE/NMAX2
      COMMON /DATA/ALPHA,BETA,FX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK3(1),EX(1)
      REAL U(1),G(1),WORK(1)

C  T(N2PD) {2N2P==N2PD}

C
      N2PD = N2P+N2P                                                    0018

C  T(NPTS) {N2PD==NPTS+2}

      NPTS = N2PD-2                                                     0019

C  T(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0020

C  T(MTRN) {MTRN==N1H}

      MTRN = N1H                                                        0021

C  T(MSKIP) {MSKIP==N2P}

      MSKIP = N2P                                                       0022

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0023

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0024

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0025

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXACAC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXACAC==NXACAC#init+1}

      CALL ACAC(CA, EX, WORK)                                           0026

C  T(N1) {N1==2N1H}

C
      N1 = N1H+N1H                                                      0028

C  T(NPTS) {N1==NPTS}

      NPTS = N1                                                         0029

C  T(NSKIP) {N2P==NSKIP}

      NSKIP = N2P                                                       0030

C  T(MTRN) {MTRN==N2P}

      MTRN = N2P                                                        0031

C  T(MSKIP) {MSKIP==1}

      MSKIP = 1                                                         0032

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0033

C  T(LOG,NXLOG2) {NXLOG2==NXLOG2#init+1}

      CALL XLOG2(NPTS, LOG)                                             0034

C  T(IEXSHF) {}

      IEXSHF = NMAX2/NPTS                                               0035

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

      CALL CSR(CA, EX)                                                  0036

C  T() {}

C
      CALL TELTIM                                                       0038

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(CA, N2P, N1, WORK)                                    0039

C  T() {}

      CALL CPRINT(CA, 'PSI PHYS', N1H, N2P, IMODE)                      0040
C      CALL PLOTME (CA,WORK,NCALL)
C
      END

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXRCS) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXRCS==NXXRCS#init+1}

C
      SUBROUTINE RCS(A,EX)
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMPLEX A(1),EX(1),BJ,BJSTAR
C
C   PERFORM A REAL TO CONJUGATE SYMMETRIC TRANFORM, SAVING ONLY HALF OF
C   THE RESULTING CONJUGATE SYMMETRIC ARRAY, AND PACKING A(0) AND A(N/2)
C   INTO A(0) SINCE THEY ARE BOTH REAL
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0022

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0023

C  T() {}

      IF (LXSTEP) THEN                                                  0024

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0025
      ENDIF

C  T(N) {N==NPTS}

C
      N = NPTS                                                          0028

C  T(NPTS) {NPTS#init<=2NPTS+1, 2NPTS<=NPTS#init}

      NPTS = NPTS/2                                                     0029

C  T(M) {M==NPTS}

      M = NPTS                                                          0030

C  T(ISHIFT) {ISHIFT==0}

      ISHIFT = 0                                                        0031

C  T(ISHIFT) {}

      IF (ISIGN.LT.0) ISHIFT = M*IEXSHF                                 0032

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0033

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0034

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0035

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = 2*IEXSHF                                                 0036

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(A(1), EX(1))                                          0037

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0038

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0039

C  T(NPTS) {N==NPTS}

      NPTS = N                                                          0040

C  T(I,IEXH,IEXL,IST,ISTP,J,JSTAR,LOOP) {1<=LOOP}

      DO 10 LOOP = 1, MTRN                                              0041

C  T(IST) {}

         IST = (LOOP-1)*MSKIP                                           0042

C  T(ISTP) {IST==ISTP-1}

         ISTP = IST+1                                                   0043

C  T() {}

         A(ISTP) = CMPLX(2.*(REAL(A(ISTP))+AIMAG(A(ISTP))), 2.*(REAL(   0044
     &   A(ISTP))-AIMAG(A(ISTP))))                                      0044

C  T(I,IEXH,IEXL,J,JSTAR) {2<=I}

         DO 20 I = 2, MH                                                0046

C  T(J) {}

            J = (I-1)*NSKIP+ISTP                                        0047

C  T(JSTAR) {}

            JSTAR = (M-I+1)*NSKIP+ISTP                                  0048

C  T() {}

            BJ = A(J)                                                   0049

C  T() {}

            BJSTAR = A(JSTAR)                                           0050

C  T(IEXL) {}

            IEXL = IEXSHF*(I-1)+1+ISHIFT                                0051

C  T(IEXH) {}

            IEXH = IEXSHF*(M-I+1)+1+ISHIFT                              0052

C  T() {}

            A(J) = BJ+CONJG(BJSTAR)+CMPLX(0., -1.)*EX(IEXL)*(BJ-CONJG   0053
     &      (BJSTAR))                                                   0053

C  T() {}

            A(JSTAR) = BJSTAR+CONJG(BJ)+CMPLX(0., -1.)*EX(IEXH)*(       0055
     &      BJSTAR-CONJG(BJ))                                           0055

C  T() {}

20          CONTINUE                                                    0057

C  T(J) {}

         J = MH*NSKIP+ISTP                                              0058

C  T() {}

         A(J) = 2.*A(J)                                                 0059

C  T() {}

         IF (ISIGN.LT.0) A(J) = CONJG(A(J))                             0060

C  T() {}

10       CONTINUE                                                       0061

C  T() {}

C
      IF (LFIRST) THEN                                                  0063

C  T() {}

         LFIRST = .FALSE.                                               0064

C  T() {}

         CALL CPUTIM(T2)                                                0065

C  T() {}

         TXXRCS = T2-T1                                                 0066
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0069

C  T() {}

         IF (LXTIME) THEN                                               0070

C  T() {}

            LXTIME = .FALSE.                                            0071

C  T() {}

            CALL CPUTIM(T2)                                             0072

C  T() {}

            EXXRCS = T2-T1                                              0073
         ENDIF

      ENDIF

C  T(NXXRCS) {NXXRCS==NXXRCS#init+1}

C
      NXXRCS = NXXRCS+1                                                 0078
C
      END

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
C***********************************************************************
C
C     FGPS 25-MAR-88 CHANGED THE DIMENSIONING OF R(1,1) TO R(N2PD,1)
C     FGPS 7-MAR-88 SUBROUTINE RPRINT REPROGRAMMED
C
C     N O T E :  THE INDEXING OF ARRAYS HANDLING VARIABLES REPRESENTED I
C     PHYSICAL SPACE IS USUALLY OF THE FORM
C
C                        A (1<=JY<=N2PD,1<=IX<=N1H)
C
C     WHERE "JY" IS THE COUNT ALONG THE Y-AXIS AND "IX" RUNS ALONG THE X
C     AXIS, AND WHERE
C
C                        N2PD = 2 * (N2+1)                 FOR THE Y-AXI
C     AND
C                         N1H = N1/2                       FOR THE X-AXI
C
C     AND WHERE THE BASIC GRID IS DIMENSIONED 2*(N2+1) BY N1.
C
C
      SUBROUTINE RPRINT(R,NAME,N1H,N2PD,IMODE)
C
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      REAL R(N2PD,1)
      CHARACTER*8 NAME

C  T() {}

C
C
      WRITE (6, 9000) NSTEPS                                            0036

C  T() {}

C
C     SELECT THE PRINT-OUT MODE
C
      IF (IMODE.LT.0) GOTO 10                                           0040

C  T() {}

      IF (IMODE.EQ.0) GOTO 20                                           0040

C  T() {}

C
30    CONTINUE                                                          0095

C  T(JY1) {3N2PD<=4JY1+3, 4JY1<=3N2PD}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF X (I.E., 1<=IX<=N1H WITH STRIDE = 2) AT CONS
C     Y (I.E., JY = N2PD/4)
C
      JY1 = 3*N2PD/4                                                    0101

C  T(IX) {}

      WRITE (6, 9050) (IX, NAME, JY1, R(JY1,IX), IX = 1, N1H, 2)        0102

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
      NXPRNT = NXPRNT+1                                                 0104

C  T() {}

C
C
C
9000  FORMAT(/,2X,'NSTEPS =',I7)                                        0108

C  T() {}

9010  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6)                  0109

C  T() {}

9020  FORMAT(2X,A8,'(JY=',I3,',IX=',I3,') =',1P,E13.6,/)                0110

C  T() {}

C
9030  FORMAT(34(2X,'JY =',I5,2X,A8,'(JY,IX=',I3,') =',1P,E13.6,/))      0112

C  T() {}

9040  FORMAT(/,/,/)                                                     0113

C  T() {}

C
9050  FORMAT(/,32(2X,'IX =',I5,2X,A8,'(JY=',I3,',IX) =',1P,E13.6,6X,'IX 
     &=',I5,2X,A8,'(JY=',I3,',IX) =',1P,E13.6,/))                       0115
      RETURN

C  T() {}

C
20    CONTINUE                                                          0079

C  T(IX1) {N1H+1<=2IX1, 2IX1<=N1H+2}

C
C     VALUES OF THE VARIABLE ASSOCIATED WITH NAME ARE PRINTED OUT AT INT
C     VALS AS A FUNCTION OF Y (I.E., 1<=JY<=N2P WITH STRIDE = 4) AT CONS
C     X (I.E., IX = 1+N1H/2)
C
      IX1 = 1+N1H/2                                                     0085

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0086

C  T(JY) {}

      WRITE (6, 9030) (JY, NAME, IX1, R(JY,IX1), JY = 1, N2P, 4)        0087

C  T() {}

      WRITE (6, 9040)                                                   0088

C  T() {}

      IF (NSTEPS.EQ.1.AND.NAME.EQ.'TEMP PHY') CDAT(5) = R(65,IX1)       0089

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
      NXPRNT = NXPRNT+1                                                 0091
C
      RETURN

C  T() {}

C
10    CONTINUE                                                          0042

C  T(IX1) {N1H+1<=4IX1, 4IX1<=N1H+4}

C
      IX1 = 1+N1H/4                                                     0044

C  T(IX2) {N1H+1<=2IX2, 2IX2<=N1H+2}

      IX2 = 1+N1H/2                                                     0045

C  T(JY1) {N2PD+1<=4JY1, 4JY1<=N2PD+4}

      JY1 = 1+N2PD/4                                                    0046

C  T() {}

      WRITE (6, 9010) NAME, JY1, IX1, R(JY1,IX1)                        0047

C  T() {}

C
      WRITE (6, 9020) NAME, JY1, IX2, R(JY1,IX2)                        0049

C  T() {}

      IF (NSTEPS.EQ.1) THEN                                             0050

C  T() {}

         IF (NAME.EQ.'ZETA PHY') THEN                                   0051

C  T() {}

            CDAT(2) = R(JY1,IX1)                                        0052

         ELSEIF (NAME.EQ.'UVEL PHY') THEN                               0051

C  T() {}

            CDAT(3) = R(JY1,IX2)                                        0055

         ELSEIF (NAME.EQ.'VVEL PHY') THEN                               0051

C  T() {}

            CDAT(4) = R(JY1,IX2)                                        0058
         ENDIF

      ELSEIF (NSTEPS.EQ.NUMBER) THEN                                    0050

C  T() {}

         IF (NAME.EQ.'ZETA PHY') THEN                                   0062

C  T() {}

            CDAT(12) = R(JY1,IX1)                                       0063

         ELSEIF (NAME.EQ.'UVEL PHY') THEN                               0062

C  T() {}

            CDAT(13) = R(JY1,IX2)                                       0066

         ELSEIF (NAME.EQ.'VVEL PHY') THEN                               0062

C  T() {}

            CDAT(14) = R(JY1,IX2)                                       0069
         ENDIF

      ENDIF

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
C
      NXPRNT = NXPRNT+1                                                 0075
C

      END

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C***********************************************************************
C
C     FGPS  8-APR-88 SET UP RPRNT2 AS A MODIFICATION OF RPRINT.  THE IN
C                    TENT IS TO PRINT THE VALUE OF A QUANTITY AT THE CEN
C                    OF THE FIRST VORTEX CELL IN ORDER TO MONITOR EXECUT
C
      SUBROUTINE RPRNT2(R,NAME,N1H,N2PD,IMODE)
C
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      REAL R(N2PD,1)
      CHARACTER*8 NAME
C
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0024

C  T() {}

C
      WRITE (6, 9000) NSTEPS                                            0026

C  T(IX1) {N1H+1<=4IX1, 4IX1<=N1H+4}

C
C
      IX1 = 1+N1H/4                                                     0029

C  T(IX2) {N1H+1<=2IX2, 2IX2<=N1H+2}

      IX2 = 1+N1H/2                                                     0030

C  T(JY1) {N2PD+1<=4JY1, 4JY1<=N2PD+4}

      JY1 = 1+N2PD/4                                                    0031

C  T() {}

      WRITE (6, 9010) NAME, JY1, IX1, R(JY1,IX1)                        0032

C  T() {}

      WRITE (6, 9020) NAME, JY1, IX2, R(JY1,IX2)                        0033

C  T() {}

      IF (NSTEPS.EQ.51) THEN                                            0034

C  T() {}

         CDAT(7) = R(JY1,IX2)                                           0035

      ELSEIF (NSTEPS.EQ.101) THEN                                       0034

C  T() {}

         CDAT(8) = R(JY1,IX2)                                           0038

      ELSEIF (NSTEPS.EQ.151) THEN                                       0034

C  T() {}

         CDAT(9) = R(JY1,IX2)                                           0041

      ELSEIF (NSTEPS.EQ.201) THEN                                       0034

C  T() {}

         CDAT(10) = R(JY1,IX2)                                          0044

      ELSEIF (NSTEPS.EQ.NUMBER) THEN                                    0034

C  T() {}

         CDAT(15) = R(JY1,IX2)                                          0047
      ENDIF

C  T() {}

C
      IF (LFIRST) THEN                                                  0050

C  T() {}

         LFIRST = .FALSE.                                               0051

C  T() {}

         CALL CPUTIM(T2)                                                0052

C  T() {}

         TXPRNT = T2-T1                                                 0053
      ENDIF

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

C
      NXPRNT = NXPRNT+1                                                 0056

C  T() {}

C
C
9000  FORMAT(/,2X,'NSTEPS =',I7)                                        0059

C  T() {}


9010  FORMAT(2X,'TEMPERATURE DROP:',/,2X,'AT THE CENTER OF FIRST CONVECT
     &ION CELL = ',A8,'(JY=',I3,',IX=',I2,') =',1P,E13.6)               0060

C  T() {}

9020  FORMAT(2X,'AT CENTER OF CONVECTION-CELL BOUNDARY  = ',A8,'(JY=',I3
     &,',IX=',I2,') =',1P,E13.6,/)                                      0064

      END

C  T() {}

C***********************************************************************
      SUBROUTINE RUNINF
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS

C  T() {}

C
C THIS SUBROUTINE TELLS US WHAT  OCEAN  WILL BE DOING:
C
C*****MACHINE-DEPENDENT CONSTANT (REPLACE FOR YOUR MACHINE)
C
C*********************
      ZERO = 1.0E-200                                                   0012

C  T() {}

C*********************
C
      WRITE (6, 9000)                                                   0015

C  T() {}

C
      CALL CPUTIM(CPUTM)                                                0017

C  T() {}

C      CALL DATE   (TODAY)
C      CALL TIME   (NOW)
      WRITE (6, 9010) CPUTM                                             0020

C  T(MOREST) {MOREST+NSTEPS==NUMBER+1}

C
      MOREST = NUMBER-NSTEPS+1                                          0022

C  T() {}

      WRITE (6, 9020) N1, N2, MOREST, KTA                               0023

C  T() {}

      IF (KSM.EQ.1) WRITE (6, 9030)                                     0024

C  T() {}

      IF (KSM.EQ.2) WRITE (6, 9040)                                     0025

C  T() {}

C
C#      GO TO (1,2,3), KDATA
C#      WRITE(6,400)
C#      GO TO 10
C#1     WRITE(6,401)
C#      GO TO 10
C#2     WRITE(6,402)
C#      GO TO 10
C#3     WRITE(6,403)
C
      IF (KDATA.EQ.1) THEN                                              0036

C  T() {}

         WRITE (6, 9060)                                                0037

      ELSEIF (KDATA.EQ.2) THEN                                          0036

C  T() {}

         WRITE (6, 9070)                                                0040

      ELSEIF (KDATA.EQ.3) THEN                                          0036

C  T() {}

         WRITE (6, 9080)                                                0043

      ELSE

C  T() {}

         WRITE (6, 9050)                                                0046
      ENDIF

C  T() {}

C
C#10    GO TO (11,123,123), LMAPP
C#      WRITE(6,500)
C#      GO TO 20
C#11    WRITE(6,501)
C#      GO TO 20
C#123   WRITE(6,523)
C
      IF (LMAPP.EQ.1) THEN                                              0056

C  T() {}

         WRITE (6, 9100)                                                0057

      ELSEIF (LMAPP.EQ.2) THEN                                          0056

C  T() {}

         WRITE (6, 9110)                                                0060

      ELSEIF (LMAPP.EQ.3) THEN                                          0056

C  T() {}

         WRITE (6, 9110)                                                0063

      ELSE

C  T() {}

         WRITE (6, 9090)                                                0066
      ENDIF

C  T() {}

C
C#20    GO TO (21), NOTEMP
C#      WRITE(6,600)
C#      GO TO 30
C#21    WRITE(6,601)
C
      IF (NOTEMP.EQ.1) THEN                                             0074

C  T() {}

         WRITE (6, 9130)                                                0075

      ELSE

C  T() {}

         WRITE (6, 9120)                                                0078
      ENDIF

C  T() {}

C
C#30    GO TO (31,32,33), KTAPE
C#      WRITE(6,700)
C#      GO TO 40
C#31    WRITE(6,701)
C#      GO TO 40
C#32    WRITE(6,702)
C#      GO TO 40
C#33    WRITE(6,703)
C
      IF (KTAPE.EQ.1) THEN                                              0090

C  T() {}

         WRITE (6, 9150)                                                0091

      ELSEIF (KTAPE.EQ.2) THEN                                          0090

C  T() {}

         WRITE (6, 9160)                                                0094

      ELSEIF (KTAPE.EQ.3) THEN                                          0090

C  T() {}

         WRITE (6, 9170)                                                0097

      ELSE

C  T() {}

         WRITE (6, 9140)                                                0100
      ENDIF

C  T() {}

C
      IF (KPP.NE.1) WRITE (6, 9180) KPP                                 0103

C  T() {}

      IF (KZP.NE.1) WRITE (6, 9190) KZP                                 0104

C  T() {}

      IF (KTP.NE.1) WRITE (6, 9200) KTP                                 0105

C  T() {}

      IF (KUP.NE.1) WRITE (6, 9210) KUP                                 0106

C  T() {}

      IF (KVP.NE.1) WRITE (6, 9220) KVP                                 0107

C  T() {}

      IF (KPF.NE.1) WRITE (6, 9230) KPF                                 0108

C  T() {}

      IF (KZF.NE.1) WRITE (6, 9240) KZF                                 0109

C  T() {}

      IF (KTF.NE.1) WRITE (6, 9250) KTF                                 0110

C  T() {}

      IF (KUF.NE.1) WRITE (6, 9260) KUF                                 0111

C  T() {}

      IF (KVF.NE.1) WRITE (6, 9270) KVF                                 0112

C  T() {}

      IF (KPRESS.NE.1) WRITE (6, 9280) KPRESS                           0113

C  T() {}

C
      IF (NOALS.EQ.1) WRITE (6, 9290)                                   0115

C  T() {}

C
      REY = 1.0/(RNU+ZERO)                                              0117

C  T() {}

      RH = H*H*H*H*ABS(ALPHA*BETA)/(RNU*RKAPA+ZERO)                     0118

C  T() {}

C
C CRITICAL RAYLEIGH NUMBER IS   (PI**4) * 27/4:
C
      RHCRIT = 657.5113648                                              0122

C  T() {}

      RRATIO = RH/RHCRIT                                                0123

C  T() {}

      PR = RNU/(RKAPA+ZERO)                                             0124

C  T() {}

      WRITE (6, 9300) BOXX, H, RNU, RKAPA, ALPHA, BETA, REY, RH,        0125
     &RRATIO, PR, DT, T                                                 0125

C  T() {}

C
C
C FORMAT STATEMENTS:
C
9000  FORMAT(/,12X,' OOOOOO     CCCCCC    EEEEEEE    AAAAAA    N     N',
     &/,12X,'O      O   C      C   E         A      A   NN    N',/,12X,'
     &O      O   C          E         A      A   N N   N',/,12X,'O      
     &O   C          EEEE      AAAAAAAA   N  N  N',/,12X,'O      O   C  
     &        E         A      A   N   N N',/,12X,'O      O   C      C  
     & E         A      A   N    NN',/,12X,' OOOOOO     CCCCCC    EEEEEE
     &E   A      A   N     N')                                          0131

C  T() {}

C
C200   FORMAT (////' THIS RUN BEGINS ON DATE ',A8,' AT TIME ',A8,/,
C     1            ' CPU TIME USED SO FAR IS',F9.6,' SECONDS.')
9010  FORMAT(/,/,/,/,' CPU TIME USED SO FAR IS',F9.6,' SECONDS.',/,/,'W 
     &A R N I N G ******** POSSIBLE UNDERFLOW ********',/,'THE STATEMENT
     & "ZERO = 1.0E-200" APPEARS IN RUNINF.')                           0142

C  T() {}

C
9020  FORMAT(/,/,' THIS RUN USES ',I3,' BY ',I3,' GRID, AND DOES',I5,' T
     &IME STEPS',/,' TIME AVERAGING IS DONE EVERY',I3,' STEPS')         0146

C  T() {}

9030  FORMAT(' MEAN FLOW IS INCLUDED IN CALCULATIONS')                  0149

C  T() {}

9040  FORMAT(' MEAN FLOW IS SPECIFIED BY USER')                         0150

C  T() {}

C
9050  FORMAT(' KDATA HAS ILLEGAL VALUE')                                0152

C  T() {}

9060  FORMAT(' INITIAL DATA IN PHYSICAL SPACE')                         0153

C  T() {}

9070  FORMAT(' INITIAL DATA IN FOURIER SPACE')                          0154

C  T() {}

9080  FORMAT(/,' THIS IS A RESTART RUN',/)                              0155

C  T() {}

C
9090  FORMAT(' LMAPP HAS AN ILLEGAL VALUE')                             0157

C  T() {}

9100  FORMAT(' LINEAR MAPPING IN BOTH DIRECTIONS')                      0158

C  T() {}

9110  FORMAT(' NON-LINEAR MAPPING IN Y DIRECTION')                      0159

C  T() {}

C
9120  FORMAT(' TEMPERATURE FIELD INCLUDED IN CALCULATIONS')             0161

C  T() {}

9130  FORMAT(' CALCULATIONS DONE WITHOUT TEMPERATURE FIELD')            0162

C  T() {}

C
9140  FORMAT(/,' NO HISTORY TAPE WILL BE WRITTEN',/)                    0164

C  T() {}

9150  FORMAT(/,' HISTORY TAPE WILL INCLUDE OPERATOR MATRICES ONLY',/)   0165

C  T() {}

9160  FORMAT(/,' HISTORY TAPE WILL NOT INCLUDE OPERATOR MATRICES',/)    0166

C  T() {}

9170  FORMAT(/,' HISTORY TAPE WILL INCLUDE ALL IMPORTANT ARRAYS',/)     0167

C  T() {}

C
9180  FORMAT                                                            0169
     &(' OUTPUT PHYSICAL STREAMFUNCTION EVERY',I4,' TIME STEPS')        0169

C  T() {}

9190  FORMAT                                                            0170
     &(' OUTPUT PHYSICAL VORTICITY      EVERY',I4,' TIME STEPS')        0170

C  T() {}

9200  FORMAT                                                            0171
     &(' OUTPUT PHYSICAL TEMPERATURE    EVERY',I4,' TIME STEPS')        0171

C  T() {}

9210  FORMAT                                                            0172
     &(' OUTPUT PHYSICAL X VELOCITY     EVERY',I4,' TIME STEPS')        0172

C  T() {}

9220  FORMAT                                                            0173
     &(' OUTPUT PHYSICAL Y VELOCITY     EVERY',I4,' TIME STEPS')        0173

C  T() {}

9230  FORMAT                                                            0174
     &(' OUTPUT FOURIER  STREAMFUNCTION EVERY',I4,' TIME STEPS')        0174

C  T() {}

9240  FORMAT                                                            0175
     &(' OUTPUT FOURIER  VORTICITY      EVERY',I4,' TIME STEPS')        0175

C  T() {}

9250  FORMAT                                                            0176
     &(' OUTPUT FOURIER  TEMPERATURE    EVERY',I4,' TIME STEPS')        0176

C  T() {}

9260  FORMAT                                                            0177
     &(' OUTPUT FOURIER  X VELOCITY     EVERY',I4,' TIME STEPS')        0177

C  T() {}

9270  FORMAT                                                            0178
     &(' OUTPUT FOURIER  V VELOCITY     EVERY',I4,' TIME STEPS')        0178

C  T() {}

9280  FORMAT                                                            0179
     &(' OUTPUT PHYSICAL PRESSURE       EVERY',I4,' TIME STEPS')        0179

C  T() {}

C
9290  FORMAT(' DE-ALIASING TURNED ON.')                                 0181

C  T() {}

C
9300  FORMAT(/,/,/,/,' PHYSICAL PARAMETERS FOR THIS RUN ARE:',/,' BOX DI
     &MENSIONS          : ',F10.6,' BY ',F10.6,/,' VISCOSITY (NU)       
     &   : ',E24.14,/,' HEAT CONDUCTIVITY (KAPA): ',E24.14,/,' ALPHA AND
     & BETA          : ',F10.6,' AND',F10.6,/,' REYNOLDS NUMBER         
     &: ',E24.14,/,' RAYLEIGH NUMBER         : ',E24.14,/,' RATIO RAY/RA
     &Y(CRITICAL) : ',E24.14,/,' PRANDTL  NUMBER         : ',E24.14,/,/,
     &' THE TIME STEP IS',F10.6,/,' WE BEGIN AT  T =',F10.6,/,/,/,' ',60
     &('+-'),/,/)                                                       0183

      END

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXSCSC==NXSCSC#init+1}

C
      SUBROUTINE SCSC(AC,EX,WORK)
C
C COMPLEX SYMMETRIC TO COMPLEX SYMMETRIC
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX AC(1),WORK(1),TEMP1,TEMP2,X,Y,BJ,BJSYM
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      DIMENSION EX(1)
C
      LOGICAL LFIRST,LXSTEP,LXTIME
      DATA LFIRST,LXSTEP,LXTIME/.TRUE.,.FALSE.,.TRUE./
      SAVE LFIRST,LXSTEP,LXTIME

C  T() {}

C
      IF (NSTEPS.EQ.NUMBER) LXSTEP = .TRUE.                             0022

C  T() {}

      IF (LFIRST) CALL CPUTIM(T1)                                       0023

C  T() {}

      IF (LXSTEP) THEN                                                  0024

C  T() {}

         IF (LXTIME) CALL CPUTIM(T1)                                    0025
      ENDIF

C  T(NPTSINIT) {NPTS==NPTSINIT}

C
      NPTSINIT = NPTS                                                   0028

C  T(M) {NPTS<=2M+1, 2M<=NPTS}

      M = NPTS/2                                                        0029

C  T(NPTS) {M==NPTS}

      NPTS = M                                                          0030

C  T(MH) {2MH<=M, M<=2MH+1}

      MH = M/2                                                          0031

C  T(MHP) {MH==MHP-1}

      MHP = MH+1                                                        0032

C  T(ISTOP) {}

      ISTOP = 1+(MTRN-1)*MSKIP                                          0033

C  T(MNSKIP) {}

      MNSKIP = M*NSKIP                                                  0034

C  T(LOG) {LOG==LOG#init-1}

      LOG = LOG-1                                                       0035

C  T(NSKIP2) {2NSKIP==NSKIP2}

      NSKIP2 = NSKIP*2                                                  0036

C  T(MP2) {M==MP2-2}

      MP2 = M+2                                                         0037

C  T(IEXSHF) {IEXSHF==2IEXSHF#init}

      IEXSHF = IEXSHF*2                                                 0038

C  T() {}

      FACT = REAL(ISIGN)/2.                                             0039

C  T(MNSH) {MNSKIP<=2MNSH+1, 2MNSH<=MNSKIP}

      MNSH = MNSKIP/2                                                   0040

C  T(IPROD) {IPROD+NSKIP==MNSH}

      IPROD = MNSH-NSKIP                                                0041

C  T(IEXSYM) {}

      IEXSYM = 4+M*IEXSHF                                               0042

C  T(I,IAC,ISUM,LOOP) {}

      DO 10 LOOP = 1, ISTOP, MSKIP                                      0043

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0044

C  T() {}

         WORK(1) = AC(LOOP)                                             0045

C  T() {}

         WORK(MHP) = AC(ISUM)                                           0046

C  T(IAC) {LOOP+NSKIP==IAC}

         IAC = LOOP+NSKIP                                               0047

C  T() {}

         Y = AC(IAC)                                                    0048

C  T(I,IAC) {2<=I}

         DO 20 I = 2, MH                                                0049

C  T(IAC) {IAC#init+NSKIP2==IAC}

            IAC = IAC+NSKIP2                                            0050

C  T() {}

            Y = Y+AC(IAC)                                               0051

C  T() {}

            TEMP1 = CMPLX(0., 1.)*(AC(IAC)-AC(IAC-NSKIP2))              0052

C  T() {}

            TEMP2 = AC(IAC-NSKIP)                                       0053

C  T() {}

            WORK(I) = TEMP2+TEMP1                                       0054

C  T() {}

            WORK(MP2-I) = TEMP2-TEMP1                                   0055

C  T() {}

20          CONTINUE                                                    0056

C  T(IAC) {IAC==LOOP}

         IAC = LOOP                                                     0057

C  T(I,IAC) {1<=I}

         DO 30 I = 1, M                                                 0058

C  T() {}

            AC(IAC) = WORK(I)                                           0059

C  T(IAC) {IAC#init+NSKIP==IAC}

            IAC = IAC+NSKIP                                             0060

C  T() {}

30          CONTINUE                                                    0061

C  T() {}

         AC(ISUM) = 4.*Y                                                0062

C  T() {}

10       CONTINUE                                                       0063

C  T(NFTVMT) {NFTVMT==NFTVMT#init+1}

      CALL FTRVMT(AC, EX)                                               0064

C  T(I,IFIN,ISTART,ISUM,J,JSUM,JSYM,LOOP) {}

      DO 40 LOOP = 1, ISTOP, MSKIP                                      0065

C  T(ISUM) {LOOP+MNSKIP==ISUM}

         ISUM = LOOP+MNSKIP                                             0066

C  T(JSUM) {ISUM+LOOP==JSUM}

         JSUM = ISUM+LOOP                                               0067

C  T() {}

         X = 2.*AC(LOOP)                                                0068

C  T() {}

         Y = AC(ISUM)                                                   0069

C  T() {}

         AC(LOOP) = X+Y                                                 0070

C  T() {}

         AC(ISUM) = X-Y                                                 0071

C  T() {}

         AC(LOOP+MNSH) = 2.*AC(LOOP+MNSH)                               0072

C  T(ISTART) {LOOP+NSKIP==ISTART}

         ISTART = LOOP+NSKIP                                            0073

C  T(IFIN) {IPROD+LOOP==IFIN}

         IFIN = LOOP+IPROD                                              0074

C  T(I) {I==2}

         I = 2                                                          0075

C  T(I,J,JSYM) {}

         DO 50 J = ISTART, IFIN, NSKIP                                  0076

C  T(I) {I#init+IEXSHF==I}

            I = I+IEXSHF                                                0077

C  T(JSYM) {J+JSYM==JSUM}

            JSYM = JSUM-J                                               0078

C  T() {}

            BJ = AC(J)                                                  0079

C  T() {}

            BJSYM = AC(JSYM)                                            0080

C  T() {}

            TEMP1 = BJ+BJSYM                                            0081

C  T() {}

            TEMP2 = CMPLX(FACT/EX(I), 0.)*(BJ-BJSYM)                    0082

C  T() {}

            AC(J) = TEMP1+TEMP2                                         0083

C  T() {}

            AC(JSYM) = TEMP1-TEMP2                                      0084

C  T() {}

50          CONTINUE                                                    0085

C  T() {}

40       CONTINUE                                                       0086

C  T(NPTS) {NPTS==NPTSINIT}

c      NPTS = M*2
      NPTS = NPTSINIT                                                   0088

C  T(LOG) {LOG==LOG#init+1}

      LOG = LOG+1                                                       0089

C  T(IEXSHF) {IEXSHF#init<=2IEXSHF+1, 2IEXSHF<=IEXSHF#init}

      IEXSHF = IEXSHF/2                                                 0090

C  T() {}

C
      IF (LFIRST) THEN                                                  0092

C  T() {}

         LFIRST = .FALSE.                                               0093

C  T() {}

         CALL CPUTIM(T2)                                                0094

C  T() {}

         TXSCSC = T2-T1                                                 0095
      ENDIF

C  T() {}

C
      IF (LXSTEP) THEN                                                  0098

C  T() {}

         IF (LXTIME) THEN                                               0099

C  T() {}

            LXTIME = .FALSE.                                            0100

C  T() {}

            CALL CPUTIM(T2)                                             0101

C  T() {}

            EXSCSC = T2-T1                                              0102
         ENDIF

      ENDIF

C  T(NXSCSC) {NXSCSC==NXSCSC#init+1}

C
      NXSCSC = NXSCSC+1                                                 0107
C
      END

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

C***********************************************************************
      SUBROUTINE SHUF(A,N2P,N1,WORK)
      DIMENSION A(N2P,1),WORK(1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0012

C  T(I,II,J) {1<=J}

C
      DO 10 J = 1, N1, 2                                                0014

C  T(I,II) {1<=I}

         DO 20 I = 1, N2P                                               0015

C  T(II) {2I==II}

            II = I+I                                                    0016

C  T() {}

            WORK(II-1) = A(I,J)                                         0017

C  T() {}

            WORK(II) = A(I,J+1)                                         0018

C  T() {}

20          CONTINUE                                                    0019

C  T(I) {1<=I}

         DO 30 I = 1, N2P                                               0020

C  T() {}

            A(I,J) = WORK(I)                                            0021

C  T() {}

            A(I,J+1) = WORK(I+N2P)                                      0022

C  T() {}

30          CONTINUE                                                    0023

C  T() {}

10       CONTINUE                                                       0024

C  T() {}

C
      IF (LFIRST) THEN                                                  0026

C  T() {}

         LFIRST = .FALSE.                                               0027

C  T() {}

         CALL CPUTIM(T2)                                                0028

C  T() {}

         TXSHUF = T2-T1                                                 0029
      ENDIF

C  T(NXSHUF) {NXSHUF==NXSHUF#init+1}

C
      NXSHUF = NXSHUF+1                                                 0032
C
      END

C  T(KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,KVF,KVP,KZF,
C    KZP,LMAPP,N1,N2,NOALS,NOTEMP,NUMBER) {KDATA==1, KPF==1, KPP==249,
C    KPRESS==1, KSM==1, KTA==50, KTAPE==0, KTF==1, KTP==50, KUF==1,
C    KUP==249, KVF==1, KVP==249, KZF==1, KZP==249, LMAPP==1, N1==NX,
C    N2==NY, NOALS==1, NOTEMP==0, NUMBER==250}

C***********************************************************************
C     FGPS  2-MAY-99 SET KPP = KZP = KUP = KVP = 249 AND NUMBER = 250
C     FGPS 18-APR-88 SET KPP = KZP = KUP = KVP = 499 AND NUMBER = 500
C
      SUBROUTINE START(NX,NY)
C
C THIS SUBROUTINE IS USED TO SPECIFY OPTIONS FOR PROGRAM OCEAN.
C
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS

C  T(N1) {N1==NX}

C
C N1 AND N2 ARE THE DIMENSIONS OF THE MATRIX. THEY HAVE TO BE POWERS
C OF  2  AND GREATER THAN OR EQUAL TO  8
C
      N1 = NX                                                           0015

C  T(N2) {N2==NY}

      N2 = NY                                                           0016

C  T(KDATA) {KDATA==1}

C
C KDATA SPECIFIES THE WAY DATA IS SUPPLIED TO THE PROGRAM.
C
C            KDATA = 1     MEANS THAT IT WILL BE IN PHYSICAL SPACE
C                  = 2     MEANS THAT IT WILL BE IN FOURIER SPACE
C                  = 3     MEANS THAT THIS IS A RESTART RUN (->READ TAPE
C
      KDATA = 1                                                         0024

C  T(LMAPP) {LMAPP==1}

C
C LMAPP SPECIFIES THE MAPPING IN THE Y DIRECTION.
C
C            LMAPP = 1     MEANS LINEAR MAPPING (-> EIGSET NOT CALLED)
C                  = 2     MEANS NON-LINEAR MAPPING
C                  = 3     MEANS RESTART RUN, NON-LINEAR MAPPING
C
      LMAPP = 1                                                         0032

C  T(NOTEMP) {NOTEMP==0}

C
C NOTEMP EXCLUDES TEMPERATURE FIELD FROM CALCULATIONS WHEN SET TO 1.
C
      NOTEMP = 0                                                        0036

C  T(NOALS) {NOALS==1}

C
C NOALS TURNS ON DEALIASING AT EACH TIME STEP WHEN SET TO 1:
C (TO BE USED ONLY WITH LINEAR MAPPING)
C
      NOALS = 1                                                         0041

C  T(KTA) {KTA==50}

C
C TIME AVERAGING IS PERFORMED EACH KTA TIME STEPS:
C
      KTA = 50                                                          0045

C  T(KPP) {KPP==249}

C
C THE FOLLOWING PARAMETERS SPECIFY WHEN TO CALL CORRESPONDING OUTPUT
C SUBROUTINES. IF YOU WANT, FOR EXAMPLE, PSIPHY TO BE CALLED EVERY
C 50 TIME STEPS, YOU SHOULD SET KPP TO 50.
C
C WARNING: SETTING A PARAMETER TO 1 TURNS OFF THE SUBROUTINE. IT DOES
C          NOT CAUSE IT TO BE CALLED EVERY TIME STEP.
C          YOU SHOULD NEVER SET ANY OF THEM TO 0, SINCE THEY ARE USED
C          WITH THE FUNCTION MOD(NSTEPS,KXYZ).
C
      KPP = 249                                                         0056

C  T(KZP) {KZP==249}

      KZP = 249                                                         0057

C  T(KTP) {KTP==50}

      KTP = 50                                                          0058

C  T(KUP) {KUP==249}

      KUP = 249                                                         0059

C  T(KVP) {KVP==249}

      KVP = 249                                                         0060

C  T(KPF) {KPF==1}

      KPF = 1                                                           0061

C  T(KZF) {KZF==1}

      KZF = 1                                                           0062

C  T(KTF) {KTF==1}

      KTF = 1                                                           0063

C  T(KUF) {KUF==1}

      KUF = 1                                                           0064

C  T(KVF) {KVF==1}

      KVF = 1                                                           0065

C  T(KPRESS) {KPRESS==1}

      KPRESS = 1                                                        0066

C  T(KTAPE) {KTAPE==0}

C
C KTAPE SPECIFIES HOW WILL HISTORY TAPE BE WRITTEN:
C
C          KTAPE = 1  WRITE ONLY EIG-STUFF ON TAPE
C                = 2  WRITE ONLY DATA ON TAPE
C                = 3  WRITE BOTH EIG-STUFF AND DATA ON TAPE
C
C ANY OTHER VALUE WILL PREVENT THE HISTORY TAPE FROM BEING WRITTEN.
C
      KTAPE = 0                                                         0076

C  T(NUMBER) {NUMBER==250}

C
C NUMBER SPECIFIES THE NUMBER OF TIME STEPS IN A SINGLE RUN:
C
      NUMBER = 250                                                      0080

C  T(KSM) {KSM==1}

C
C KSM GOVERNS THE USE OF THE MEAN FLOW OPTION.
C
C                   KSM = 0       MEANS THAT U(MEAN) IS ZERO
C                         1       MEANS THAT IT SHOULD BE COMPUTED
C                         2       MEANS THAT IT IS USER-SPECIFIED
C
      KSM = 1                                                           0088
C
C THAT WAS ALL. RETURN TO MOTHER OCEAN.
C
      END

C  T() {}

C***********************************************************************
      SUBROUTINE TELTIM
      COMMON /DATA/DUMMY(8),TIME,IDUMY1

C  T() {}


      WRITE (6, 9000) TIME                                              0005

C  T() {}


9000  FORMAT(' TIME = ',F20.6)                                          0007

      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE TEMPFO(CA,N2P,N1H,CWORK)
      COMMON /LADDR/LDUMMY,LTN,LDUMY1(10)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0010

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LTN, NW)                                              0011

C  T() {}

      CALL CPRINT(CA, 'TEMP FOU', N1H, N2P, -1)                         0012
      END

C  T(IEXSHF,LOG,NCALL,NFTVMT,NPTS,NUSHUF,NXPRNT,NXXCSR,NXXXIN)
C    {IEXSHF==IEXSHF#init, LOG==LOG#init, NCALL==NCALL#init+1,
C    NFTVMT==NFTVMT#init+1, NPTS==NPTS#init, NUSHUF==NUSHUF#init+1,
C    NXPRNT==NXPRNT#init+1, NXXCSR==NXXCSR#init+1,
C    NXXXIN==NXXXIN#init+1, 1<=LTN, LTN<=OUT:MEMSIZ}

C***********************************************************************
C
C
C     FGPS  9-APR-88 MADE TO CALL RPRNT2 (NOT RPRINT) WHENEVER IMODE =
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C     FGPS 10-FEB-88 ADDED "COMPLEX  EX(1)"
C
      SUBROUTINE TEMPHY(A,N2PD,N1H,EX,WORK,IMODE)
      COMMON /LADDR/LDUMMY,LTN,LDUMY1(10)
      DIMENSION A(N2PD,1),WORK(1)
      COMPLEX EX(1)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /MAPING/GMAPP(129),GDUMY1(129)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      SAVE NCALL
      DATA NCALL/0/

C  T(NW) {}


      NW = N2PD*N1H                                                     0022

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0023

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0024

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LTN, LTN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(A, LTN, NW)                                               0025

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXXCSR) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXXCSR==NXXCSR#init+1}

      CALL CSR(A, EX)                                                   0026

C  T(J) {1<=J}

      DO 10 J = 1, N1H                                                  0027

C  T() {}

         WORK(J) = 0.0                                                  0028

C  T() {}

10       CONTINUE                                                       0029

C  T(I,IPH,J) {1<=I}

      DO 20 I = 1, N2PD                                                 0030

C  T(IPH) {2IPH<=I+1, I<=2IPH}

         IPH = (I+1)/2                                                  0031

C  T() {}

         ADJUST = BETA*GMAPP(IPH)                                       0032

C  T(J) {1<=J}

C WHEN INTERESTED IN TEMPERATURE DISTURBANCE ONLY, USE THIS INSTEAD:
C        ADJUST = 0.0
         DO 30 J = 1, N1H                                               0035

C  T() {}

            WORK(J) = WORK(J)+A(I,J)*A(I,J)                             0036

C  T() {}

            A(I,J) = 0.5*A(I,J)-ADJUST                                  0037

C  T() {}

30          CONTINUE                                                    0038

C  T() {}

20       CONTINUE                                                       0039

C  T() {}

      SUMSQ = 0.0                                                       0040

C  T(J) {1<=J}

      DO 40 J = 1, N1H                                                  0041

C  T() {}

         SUMSQ = SUMSQ+WORK(J)                                          0042

C  T() {}

40       CONTINUE                                                       0043

C  T() {}

      ZRMS = 0.5*SQRT(SUMSQ/(REAL(N1)*REAL(N2P)))                       0044

C  T() {}

      WRITE (6, 9000) ZRMS                                              0045

C  T(NCALL) {NCALL==NCALL#init+1}

      NCALL = NCALL+1                                                   0046

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0047

C  T() {}

      CALL TELTIM                                                       0048

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      IF (IMODE.LT.0) THEN                                              0049

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

         CALL RPRNT2(A, 'TEMP PHY', N1H, N2PD, IMODE)                   0050

      ELSE

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

         CALL RPRINT(A, 'TEMP PHY', N1H, N2PD, IMODE)                   0053
      ENDIF

C  T() {}

C      CALL PLOTME (A,WORK,NCALL)
9000  FORMAT(/,' SQRT (AVERAGE TEMPERATURESQUARED) =',F30.15)           0056

      END

C  T() {}

C***********************************************************************
      SUBROUTINE TESTDT(A,N2P,N1,WORK,G)
      COMMON /PI/PI
      DIMENSION A(N2P,N1),WORK(N2P),G(N2P)

C  T(I) {1<=I}

C
C FIND MAXIMUM DT:
C
      DO 10 I = 1, N2P                                                  0008

C  T() {}

         WORK(I) = 0.0                                                  0009

C  T() {}

10       CONTINUE                                                       0010

C  T(I,J) {1<=J}

      DO 20 J = 1, N1                                                   0011

C  T(I) {1<=I}

         DO 30 I = 1, N2P                                               0012

C  T() {}

            WORK(I) = MAX(WORK(I), ABS(G(I)*A(I,J)))                    0013

C  T() {}

30          CONTINUE                                                    0014

C  T() {}

20       CONTINUE                                                       0015

C  T(I) {2<=I}

C
C G WAS 1.0/(DY/DX), AND X GOES FROM 0.0 TO PI, HENCE IF WE WANT
C ((DY/DI)/V)=((DY/DX)(DX/DI)/V)=PI/(N1*G(I)*V(I))
C REMEMBER, A CONTAINS 2.0*V:
      DO 40 I = 2, N2P                                                  0020

C  T() {}

         WORK(1) = MAX(WORK(1), WORK(I))                                0021

C  T() {}

40       CONTINUE                                                       0022

C  T() {}

C
C SO, WORK(1) = MAX (G(I)*2*V(I,J)):
C DT(MAX) = 0.2* MIN (DY/V) = 0.2*2.0*PI/(N1*WORK(1)):
CSRD  DTMAX = 0.4*PI/(REAL(N1)*WORK(1)+1.0E-1000)
      DTMAX = 0.4*PI/(REAL(N1)*WORK(1)+1.0E-300)                        0027

C  T() {}

      WRITE (6, 9000) DTMAX                                             0028

C  T() {}


9000  FORMAT(/,/,' DTMAX =',F16.10)                                     0030

      END

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

C***********************************************************************
      SUBROUTINE UNSHUF(A,N2P,N1,WORK)
      DIMENSION A(N2P,1),WORK(1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      LOGICAL LFIRST
      DATA LFIRST/.TRUE./
      SAVE LFIRST

C  T() {}

C
      IF (LFIRST) CALL CPUTIM(T1)                                       0012

C  T(I,II,J) {1<=J}

C
      DO 10 J = 1, N1, 2                                                0014

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0015

C  T() {}

            WORK(I) = A(I,J)                                            0016

C  T() {}

            WORK(I+N2P) = A(I,J+1)                                      0017

C  T() {}

20          CONTINUE                                                    0018

C  T(I,II) {1<=I}

         DO 30 I = 1, N2P                                               0019

C  T(II) {2I==II}

            II = I+I                                                    0020

C  T() {}

            A(I,J) = WORK(II-1)                                         0021

C  T() {}

            A(I,J+1) = WORK(II)                                         0022

C  T() {}

30          CONTINUE                                                    0023

C  T() {}

10       CONTINUE                                                       0024

C  T() {}

C
      IF (LFIRST) THEN                                                  0026

C  T() {}

         LFIRST = .FALSE.                                               0027

C  T() {}

         CALL CPUTIM(T2)                                                0028

C  T() {}

         TUSHUF = T2-T1                                                 0029
      ENDIF

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

C
      NUSHUF = NUSHUF+1                                                 0032
C
      END

C  T(IEXSHF,ISIGN,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    ISIGN==1, LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXSCSC==NXSCSC#init+1}

C***********************************************************************
      SUBROUTINE UVELFO(CA,N2P,N1H,G,EX,CWORK)
c      COMMON /FT/NDUMMY(4),ISIGN,NDUMY2(2)
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
      COMPLEX CA(N2P,1),CWORK(1),EX(1)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION G(1)

C  T(I,J) {1<=I}


      DO 10 I = 1, N2P                                                  0012

C  T(J) {1<=J}

         DO 20 J = 1, N1H                                               0013

C  T() {}

            CA(I,J) = G(I)*CA(I,J)                                      0014

C  T() {}

20          CONTINUE                                                    0015

C  T() {}

10       CONTINUE                                                       0016

C  T(ISIGN) {ISIGN==-1}

      ISIGN = -1                                                        0017

C  T(IEXSHF,LOG,NFTVMT,NPTS,NXSCSC) {IEXSHF==IEXSHF#init,
C    LOG==LOG#init, NFTVMT==NFTVMT#init+1, NPTS==NPTS#init,
C    NXSCSC==NXSCSC#init+1}

      CALL SCSC(CA, EX, CWORK)                                          0018

C  T(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0019

C  T() {}

      F = 0.125/REAL(N2P-1)                                             0020

C  T(I,J) {1<=J}

      DO 30 J = 1, N1H                                                  0021

C  T(I) {1<=I}

         DO 40 I = 1, N2P                                               0022

C  T() {}

            CA(I,J) = F*CA(I,J)                                         0023

C  T() {}

40          CONTINUE                                                    0024

C  T() {}

30       CONTINUE                                                       0025

C  T() {}

      CALL CPRINT(CA, 'UVEL FOU', N1H, N2P, -1)                         0026
      END

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF==NUSHUF#init+1,
C    NXPRNT==NXPRNT#init+1, NXXXIN==NXXXIN#init+1, 1<=LPY,
C    LPY<=OUT:MEMSIZ}

C***********************************************************************
C
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C
      SUBROUTINE UVELPH(A,N2PD,N1H,WORK,IMODE)
      COMMON /LADDR/LDUMMY(5),LPY,LDUMY1(6)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      DIMENSION A(N2PD,1),WORK(1)
      COMMON /DATA/DUMY1(2),BOXX,DUMY2(6),IDUMY1

C  T(I) {1<=I}


      DO 10 I = 1, N2PD                                                 0014

C  T() {}

         WORK(I) = 0.0                                                  0015

C  T() {}

10       CONTINUE                                                       0016

C  T(NW) {}

      NW = N2PD*N1H                                                     0017

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0018

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0019

C  T() {}

      CALL TELTIM                                                       0020

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPY, LPY+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(A, LPY, NW)                                               0021

C  T(I,J) {1<=J}

      DO 20 J = 1, N1H                                                  0022

C  T(I) {1<=I}

         DO 30 I = 1, N2PD                                              0023

C  T() {}

            WORK(I) = MAX(WORK(I), ABS(A(I,J)))                         0024

C  T() {}

30          CONTINUE                                                    0025

C  T() {}

20       CONTINUE                                                       0026

C  T() {}

      WRKMAX = 0.0                                                      0027

C  T(I) {1<=I}

      DO 40 I = 1, N2PD                                                 0028

C  T() {}

         WRKMAX = MAX(WRKMAX, WORK(I))                                  0029

C  T() {}

40       CONTINUE                                                       0030

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0031

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      CALL RPRINT(A, 'UVEL PHY', N1H, N2PD, IMODE)                      0032

C  T() {}

C
C AT THIS POINT A(N2P,N1) CONTAINS 2.0*U
C
      UMAX = 0.5*WRKMAX+1.0E-32                                         0036

C  T() {}

      DTMAX = 0.2*BOXX/REAL(N1)/UMAX                                    0037

C  T() {}

      WRITE (6, 9000) DTMAX                                             0038

C  T() {}


9000  FORMAT(/,/,' DTMAX =',F16.10)                                     0040

      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE VVELFO(CA,N2P,N1H,FX,CWORK)
      COMMON /LADDR/LDUMMY(2),LPN,LDUMY1(9)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0010

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LPN, NW)                                              0011

C  T() {}

      F = 0.                                                            0012

C  T(I,J) {1<=J}

      DO 10 J = 1, N1H                                                  0013

C  T(I) {1<=I}

         DO 20 I = 1, N2P                                               0014

C  T() {}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0015

C  T() {}

20          CONTINUE                                                    0016

C  T() {}

         F = F+FX                                                       0017

C  T() {}

10       CONTINUE                                                       0018

C  T() {}

      CALL CPRINT(CA, 'VVEL FOU', N1H, N2P, -1)                         0019
      END

C  T(NUSHUF,NXPRNT,NXXXIN) {NUSHUF==NUSHUF#init+1,
C    NXPRNT==NXPRNT#init+1, NXXXIN==NXXXIN#init+1, 1<=LPN,
C    LPN<=OUT:MEMSIZ}

C***********************************************************************
C
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C
      SUBROUTINE VVELPH(A,N2PD,N1H,WORK,IMODE)
      COMMON /LADDR/LDUMMY(2),LPN,LDUMY1(9)
      DIMENSION A(N2PD,1),WORK(1)
      COMMON /MAPING/GMAPP(129),G(129)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2

C  T(NW) {}


      NW = N2PD*N1H                                                     0014

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0015

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0016

C  T() {}

      CALL TELTIM                                                       0017

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LPN, LPN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(A, LPN, NW)                                               0018

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0019

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      CALL RPRINT(A, 'VVEL PHY', N1H, N2PD, IMODE)                      0020

C  T() {}

C
C AT THIS POINT A(N2P,N1) CONTAINS 2.0*V
C
      CALL TESTDT(A, N2P, N1, WORK, G)                                  0024
      END

C  T(NB,NXLOG2) {NXLOG2==NXLOG2#init+1}

C***********************************************************************
C
C     FGPS 29-APR-88 INTRODUCED "SUBROUTINE XLOG2 (NA,NB)" IN ORDER TO I
C                    PROVE EFFICIENCY.  THIS REPLACES "FUNCTION LOG2 (N)
C
C      FUNCTION LOG2 (N)
C      LOG2 = LOG(REAL(N))/LOG(2.)+0.01
C      RETURN
C      END
C
      SUBROUTINE XLOG2(NA,NB)
C
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
C
      LOGICAL INITL1,INITL2
      DATA INITL1,INITL2/.TRUE.,.TRUE./
      REAL T1,T2,F1,B
      SAVE INITL1,INITL2,F1

C  T() {}

C
      IF (INITL1) CALL CPUTIM(T1)                                       0023

C  T() {}

C
      IF (INITL2) THEN                                                  0025

C  T() {}

         INITL2 = .FALSE.                                               0026

C  T() {}

         F1 = 1.0/LOG(2.0)                                              0027
      ENDIF

C  T() {}

C
      B = F1*LOG(REAL(NA))+0.01                                         0030

C  T(NB) {}

      NB = INT(B)                                                       0031

C  T() {}

C
      IF (INITL1) THEN                                                  0033

C  T() {}

         INITL1 = .FALSE.                                               0034

C  T() {}

         CALL CPUTIM(T2)                                                0035

C  T() {}

         TXLOG2 = T2-T1                                                 0036
      ENDIF

C  T(NXLOG2) {NXLOG2==NXLOG2#init+1}

C
      NXLOG2 = NXLOG2+1                                                 0039
C
      END

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN<=OUT:MEMSIZ}

C***********************************************************************
      SUBROUTINE ZETAFO(CA,N2P,N1H,CWORK)
      COMMON /LADDR/LZN,LDUMY1(11)
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      COMPLEX CA(N2P,1),CWORK(1)

C  T(NW) {}


      NW = N2P*N1H*2                                                    0010

C  T(NXXXIN) {NXXXIN==NXXXIN#init+1, 1<=LZN, LZN+NW<=OUT:MEMSIZ+1,
C    1<=NW}

      CALL IN(CA, LZN, NW)                                              0011

C  T() {}

      CALL CPRINT(CA, 'ZETA FOU', N1H, N2P, -1)                         0012
      END

C  T(ACAC:IEXSHF,ACAC:LOG,ACAC:NPTS,NCALL,NFTVMT,NUSHUF,NXPRNT,NXXCSR)
C    {ACAC:IEXSHF==ACAC:IEXSHF#init, ACAC:LOG==ACAC:LOG#init,
C    ACAC:NPTS==ACAC:NPTS#init, NCALL==NCALL#init+1,
C    NFTVMT==NFTVMT#init+1, NUSHUF==NUSHUF#init+1,
C    NXPRNT==NXPRNT#init+1, NXXCSR==NXXCSR#init+1}

C***********************************************************************
C
C     FGPS 18-FEB-88 RELOCATED "CALL RPRINT ( , ,N1H,N2PD,IMODE)"
C
      SUBROUTINE ZETAPH(A,N2PD,N1H,EX,WORK,IMODE)
      DIMENSION A(N2PD,1),EX(1),WORK(1)
      SAVE NCALL
      DATA NCALL/0/
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2

C  T(ACAC:IEXSHF,ACAC:LOG,ACAC:NPTS,NFTVMT,NXXCSR)
C    {ACAC:IEXSHF==ACAC:IEXSHF#init, ACAC:LOG==ACAC:LOG#init,
C    ACAC:NPTS==ACAC:NPTS#init, NFTVMT==NFTVMT#init+1,
C    NXXCSR==NXXCSR#init+1}


      CALL CSR(A, EX)                                                   0014

C  T(N2P) {N2PD<=2N2P+1, 2N2P<=N2PD}

      N2P = N2PD/2                                                      0015

C  T(N1) {N1==2N1H}

      N1 = N1H+N1H                                                      0016

C  T(NUSHUF) {NUSHUF==NUSHUF#init+1}

      CALL UNSHUF(A, N2P, N1, WORK)                                     0017

C  T() {}

      CALL TELTIM                                                       0018

C  T(J) {1<=J}

      DO 10 J = 1, N1H                                                  0019

C  T() {}

         WORK(J) = 0.0                                                  0020

C  T() {}

10       CONTINUE                                                       0021

C  T(I,J) {1<=I}

      DO 20 I = 1, N2PD                                                 0022

C  T(J) {1<=J}

         DO 30 J = 1, N1H                                               0023

C  T() {}

            WORK(J) = WORK(J)+A(I,J)*A(I,J)                             0024

C  T() {}

30          CONTINUE                                                    0025

C  T() {}

20       CONTINUE                                                       0026

C  T() {}

      SUMSQ = 0.0                                                       0027

C  T(J) {1<=J}

      DO 40 J = 1, N1H                                                  0028

C  T() {}

         SUMSQ = SUMSQ+WORK(J)                                          0029

C  T() {}

40       CONTINUE                                                       0030

C  T() {}

      ZRMS = SQRT(SUMSQ/(REAL(N1)*REAL(N2P)))                           0031

C  T() {}

      WRITE (6, 9000) ZRMS                                              0032

C  T(NCALL) {NCALL==NCALL#init+1}

      NCALL = NCALL+1                                                   0033

C  T(NXPRNT) {NXPRNT==NXPRNT#init+1}

      CALL RPRINT(A, 'ZETA PHY', N1H, N2PD, IMODE)                      0034

C  T() {}

C      CALL PLOTME (A,WORK,NCALL)
9000  FORMAT(/,' SQRT (AVERAGE ZETASQUARED) =',F30.15)                  0036

      END

C  P() {NFTVMT==0, NUM1==1, NUSHUF==0, NXACAC==0, NXLOG2==0,
C    NXPRNT==0, NXSCSC==0, NXSHUF==0, NXXCSR==0, NXXOUT==0, NXXRCS==0,
C    NXXXIN==0}

C
C     1993 version - Modified by Beatrice Creusillet for PIPS -
C
C     MODIFICATIONS:
C
C     AUGUST 1995:
C     ~~~~~~~~~~~~
C     - CXxxxxx and CYyyyyy commentaries removed for clarity.
C     - CPUTIM and ELAPSE subroutines uncommented.
C     - BLOCK DATA moved in main procedure (Francois Irigoin) .
C     - Macro definition LSTMOD(MODEHI) in module DEALSE replaced where
C       it is used.
C     - (1.,0.) replaced by CMPLX(1.,0.) wherever needed.
C     - In RUNINF, computed GOTO's are replaced by block if's.
C     - Passed through stf; one empty if block removed afterwards.
C     - Add common /TIMING/ in DATAST, TEMPFO, TEMPHY, PSIFOU, PSIPHY,
C       ZETAFO, ZETAPH, VVELFO, VVELPH, UVELFO, UVELPH, DEALSE, in order
C       to help the interprocedural propagation.
C     - Common /NMBRS/ declared in RCS, CSR, ACAC, SCSC to
C       propagate major predicates (like N2P==129) downwards to FTRVMT 
C       (fi, June 1993).
C     - Add common /FT/ in TEMPHY
C     - Add common /MEMORY/ in OCEAN
C     - variable NUMBER in common /DEBUG/ renamed into NUM1 to avoid clashes
C       with variable NUMBER in common /OPTONS/
C     - use full declaration of /FT/ in UVELFO (Francois Irigoin)
C     - Syntactic construct IF(.TRUE.) THEN ... ENDIF added around the
C       time loop to compute accuracte preconditions and transformers.
C       This should be useless with unspaghettify...
C       (Francois Irigoin)
C     - useless STOP in OCEAN commented out to avoid problems with
C       Ronan's dead code elimination (Francois Irigoin)
C     - management of NPTS in SCSC modified to restore
C       exactly NPTS; preconditions fail to find this because they use
C       a transformer computed with no knowledge of NPTS parity;
C       Same transform in ACAC.
C       Note that NPTS is directly saved and restored in RCS.
C       (Francois Irigoin)
C     - artificial IF(.TRUE.)THEN removed; do not forget to unspaghettify
C       the code before processing (Francois Irigoin)
C     - combination of arithmetic IF and RETURNs restructured manually
C       in CPRINT
C     - forwarding of N1's assignment in subsequent WRITE in CPRINT;
C       I guess the programmer did not realize N1 was directly available
C       in COMMON /OPTONS/; he did not realize the potential impact
C       of N1 reassignement in the middle of the time loop; common
C       /OPTONS/ might be useless!
C
C******NOTE: USE OF MACHINE-DEPENDENT CONSTANT: ZERO IN SUBROUTINE RUNIN
C
C            ZERO = 1.0E-200 (MAY HAVE TO REPLACE WITH YOUR MACHINES
C                             RELATIVE PRECISION FOR REAL DATA TYPE)
C

C***********************************************************************
C                        OCEAN FORTRAN PROGRAMS
C                        CREATION DATE: 3/22/81
C***********************************************************************
      PROGRAM OCEAN
C
C  D(Z)/DT + (U,V).GRAD(Z) = RNU*DELSQ(Z) + ALPHA*D(TEMP)/DX
C
C  D(TEMP)/DT + (U,V).GRAD(TEMP) = RKAPA*DELSQ(TEMP) + BETA*V
C
C
C
C THIS PROGRAM SIMULATES TWO-DIMENSIONAL FLUID FLOW ON A   (N2+1) * N1
C GRID. IT IS POSSIBLE TO SPECIFY NON-LINEAR DISTRIBUTION OF DATA POINTS
C THE Y-DIRECTION (THE FIRST INDEX CORRESPONDS TO Y DIRECTION, SECOND TO
C X DIRECTION). N1 AND N2 HAVE TO BE POWERS OF TWO GREATER OR EQUAL TO 8
C
C THE PROGRAM USES LARGE CORE MEMORY. IT REQUIRES 8*(N2+1)*N1+(N2-1)*(N2
C WORDS OF IT. IF NOTEMP = 1 IT IS POSSIBLE TO SAVE 2*(N2+1)*N1 WORDS,
C IF LMAPP = 1 YOU SAVE ADDITIONAL (N2-1)*(N2+1) WORDS.
C
C IF  LMAPP = 2 , LCM REQUIREMENTS ARE AT LEAST  3 * (N2-1) * (N2-1)
C MORE MEMORY COULD BE NEEDED IN THIS CASE BECAUSE OF EIGSET AND LCMRQR.
C
C
C FOR CDC7600 RUNS: DELETE ROUTINES LCMREQ, IN AND OUT FROM THE END OF
C                   THIS PACKAGE. ON CDC7600 THE LCM IS USED THROUGH
C                   THE ASSEMBLY ROUTINES.
C
C                   LIBRARY.
C FOR CRAY-1 RUNS : DELETE ROUTINES SECOND, DATE, TIME, EXSET AND
C                   LOG2 FROM THE END OF THIS PACKAGE. THEY ARE
C                   OBTAINED AT LOAD TIME FROM CRAY LIBRARIES AND
C                   FFTLIB.
C                   ALSO, ADJUST THE SIZE OF PARAMETER LCMSIZ IN
C                   THE ROUTINE LCMREQ SO THAT THE COMMON IS LARGE
C                   ENOUGH TO EMULATE CDC7600 LCM REQUIRED FOR THE RUN.
C
C THE FOLLOWING PARAMETERS DEFINE THE SIZE OF THE RUN:
C
      PARAMETER (NX=128,NY=128)
      PARAMETER (NA1=2* (NY+1),NA2=NX/2,NE=NY-1,NW1=NY+1)
      PARAMETER (NW2=128,NEX=256)
      PARAMETER (NI=2*NY-1,NEQ=3*NY-2,NCW2=2*NW1+1,NCW3=4*NW1+1)
C
C PLEASE REFER TO THE DIMENSIONING AND EQUIVALENCING INSTRUCTIONS IN
C THE CASE YOUR COMPILER CANNOT HANDLE PARAMETER STATEMENTS...
C COMMON BLOCKS:
C
      COMMON /FT/NPTS,NSKIP,MTRN,MSKIP,ISIGN,LOG,IEXSHF
C
C THE DIMENSION OF  GSOLV  HAS TO BE AT LEAST (N2-1)
C
      COMMON /SOLV/LVECT,LSKIP,NVECT,NVSKIP,GSOLV(127)
C
C THE DIMENSIONS OF  GMAPP  AND  G  HAVE TO BE AT LEAST (N2+1)
C
      COMMON /MAPING/GMAPP(129),G(129)
      COMMON /MFLOW/U(129)
      COMMON /DATA/ALPHA,BETA,BOXX,H,RNU,RKAPA,DT,DTT,T,NSTEPS
      COMMON /OPTONS/N1,N2,NUMBER,KDATA,LMAPP,NOTEMP,KTA,KTAPE,KSM,KPP,
     +       KZP,KTP,KUP,KVP,KPF,KZF,KTF,KUF,KVF,KPRESS,NOALS
      COMMON /PI/PI
      COMMON /NMBRS/N1H,N1Q,N1E,N2M,N2P,N2DP,N2DM,N2PD
      COMMON /EXSIZE/NMAX2
      COMMON /LADDR/LZN,LTN,LPN,LZO,LTO,LPY,LZX,LZY,LEIG,LE,LH,LEV
      COMMON /TIMING/TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT,
     +       TXSHUF,TUSHUF,TXPRNT,TXLOG2,EXXRCS,EXXCSR,EXSCSC,EXACAC,
     +       EFTVMT,NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT,
     +       NXSHUF,NUSHUF,NXPRNT,NXLOG2
      PARAMETER (LCMSIZ=165117)
      COMMON /MEMORY/MEMSIZ,RM(LCMSIZ)
C
C
C COMPLEX ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            CA        (N2+1) X N1/2
C            CWORK     N2+1
C            CWORK2    N2+1
C            CWORK3    N2+1
C            EX        MAX(2*N2, N1)
C
C EX ARRAY MUST NOT BE THE FIRST ARRAY IN THE MEMORY.
C
      COMPLEX CA(NW1,NA2),CWORK(NW1),CWORK2(NW1)
      COMPLEX CWORK3(NW1),EX(NEX),CF
C
C REAL ARRAYS HAVE TO BE DIMENSIONED EXACTLY AS THE FORMULAS SAY:
C            A      2*(N2+1) X N1/2
C            E      (N2-1)   X (N2-1)
C            WORK   N2+1     X MAX(6, 2*MIN(64, N1/2))   (AT LEAST)
C            EVAL   N2-1
C            IR     N2-1
C            IC     N2-1
C
      REAL A(NA1,NA2),E(NE,NE)
      REAL WORK(NW1*NW2)
      REAL EVAL(NE),IR(NE),IC(NE)
      INTEGER VALID
C
C EQUIVALENCE STATEMENTS ARE SAVING MEMORY SPACE. THE FOLLOWING PATTERN
C HAS TO BE FOLLOWED EXACTLY:
C
C     A-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CA+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     EVAL+-+IR-+-+-IC+-+-+E+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C
C
C     WORK+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
C     CWORK-+-+-+CWORK2-+-+-CWORK3+-+-+
C
C      EQUIVALENCE (A,CA,EVAL), (A(NY),IR), (A(NI),IC), A(NEQ),E) - ORGI
C      EQUIVALENCE (A,CA,EVAL), (EVAL(NY),IR), (EVAL(NI),IC),
C     *             (EVAL(NEQ),E) - MACFARLANE'S FIX. BAD.
C POINTER'S FIX. ANSI REQUIRES THAT THE NUMBER OF SUBSCRIPTS MATCH
C THE NUMBER OF DIMENSIONS OF THE ARRAY. THAT WAS THE PROBLEM WITH
C THE ORGINAL STATEMENT. THE PROBLEM WITH MACFARLANE'S FIX IS THAT
C NY,NI,NEQ>NE (THE DIMENSION OF EVAL). HERE 3*NE+1-NA1 IS THE 3*NE+1TH
C ELEMENT OF A AND 3*NE+1 = NEQ.
      EQUIVALENCE (A,CA,EVAL), (A(NY,1),IR), (A(NI,1),IC),
     +            (A(3*NE+1-NA1,2),E)
      EQUIVALENCE (WORK,CWORK), (WORK(NCW2),CWORK2), (WORK(NCW3),CWORK3)
      COMMON /VERIFY/VDAT(15),CDAT(15)
      COMMON /DEBUG/NUM1,TLAST
C
C     former BLOCK DATA
C
C
      DATA TXXXIN,TXXOUT,TXXRCS,TXXCSR,TXSCSC,TXACAC,TFTVMT/0.,0.,0.,0.,
     +     0.,0.,0./
      DATA TXSHUF,TUSHUF,TXPRNT,TXLOG2/0.,0.,0.,0./
      DATA EXXRCS,EXXCSR,EXSCSC,EXACAC,EFTVMT/0.,0.,0.,0.,0./
      DATA NXXXIN,NXXOUT,NXXRCS,NXXCSR,NXSCSC,NXACAC,NFTVMT/0,0,0,0,0,0,
     +     0/
      DATA NXSHUF,NUSHUF,NXPRNT,NXLOG2/0,0,0,0/
      DATA VDAT/0.10000E+03,-0.10000E+03,0.10000E-04,-0.10000E+03,
     +     -0.15708E+01,0.99983E+02,-0.18147E+01,-0.20427E+01,
     +     -0.22452E+01,-0.24181E+01,0.95976E+02,-0.95977E+02,
     +     0.10000E-04,-0.95978E+02,-0.25589E+01/
C
C PI IS A USEFULL CONSTANT
C
      DATA PI/3.141592653589793/
      DATA NUM1/1/,TLAST/0.0/

C  P() {}

C
C
C
C NOW WE CAN START WITH THE PROGRAM...
C SUBROUTINE START TELLS OCEAN WHAT TO DO:
C
      CALL CPUTIM(CPU1)                                                 0204

C  P() {}

      CALL ELAPSE(TCLCK1)                                               0205

C  P() {}

      OPEN (UNIT=1,FILE='OCV')                                          0206

C  P() {}

      OPEN (UNIT=6,FILE='OCO6')                                         0207

C  P() {}

      WRITE (1, 9000)                                                   0208

C  P() {}


      CALL START(NX, NY)                                                0210

C  P() {}

C
C IF  LMAPP = 1 , H  (THE SIZE OF THE BOX IN Y DIRECTION)  SHOULD BE
C SPECIFIED IN THE MAIN PROGRAM.
C
      H = PI                                                            0215

C  P(N1) {N1==128}

C
C DEFINING CONSTANTS THAT WILL BE NEEDED:
C
      N1H = N1/2                                                        0219

C  P(N1) {N1==128}

      N1Q = N1/4                                                        0220

C  P(N1) {N1==128}

      N1E = N1/8                                                        0221

C  P(N2) {N2==128}

      N2M = N2-1                                                        0222

C  P(N2) {N2==128}

      N2P = N2+1                                                        0223

C  P(N2) {N2==128}

      N2DP = 2*N2+1                                                     0224

C  P(N2) {N2==128}

      N2DM = 2*N2-1                                                     0225

C  P(N2P) {N2P==129}

      N2PD = 2*N2P                                                      0226

C  P(N1H,N2PD) {N1H==64, N2PD==258}

      NW = N2PD*N1H                                                     0227

C  P(NW) {}

      NWH = NW/2                                                        0228

C  P(NW) {2NWH<=NW, NW<=2NWH+1}

      NWQ = NW/4                                                        0229

C  P(N2M) {N2M==127}

      NWEIG = N2M                                                       0230

C  P(LMAPP,N2M,NWEIG) {LMAPP==1, N2M==127, NWEIG==127}

      IF (LMAPP.NE.1) NWEIG = (N2M+3)*N2M                               0231

C  P(N1,N2) {N1==128, N2==128}

      NMAX2 = MAX(2*N2, N1)                                             0232

C  P(N1E) {N1E==16}

      K1Q = N1E+1                                                       0233

C  P(K1Q,N1E) {K1Q==17, N1E==16}

      K2Q = K1Q+N1E                                                     0234

C  P(K2Q,N1E) {K2Q==33, N1E==16}

      K3Q = K2Q+N1E                                                     0235

C  P(K1Q) {K1Q==17}

      K1QM = K1Q-1                                                      0236

C  P(K2Q) {K2Q==33}

      K2QM = K2Q-1                                                      0237

C  P(K3Q) {K3Q==49}

      K3QM = K3Q-1                                                      0238

C  P(NW) {2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

C
C LCM ALLOCATION AND COMPUTATION OF ADDRESSES:
C
      LARGE = 8*NW                                                      0242

C  P(LARGE,NOTEMP,NW) {LARGE==8NW, NOTEMP==0, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3}

      IF (NOTEMP.EQ.1) LARGE = 6*NW                                     0243

C  P(KPRESS,LARGE,LMAPP,N2M,NWEIG) {KPRESS==1, LARGE==8NW, LMAPP==1,
C    N2M==127, NWEIG==127, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

      IF (LMAPP.NE.2) THEN                                              0244

C  P(LARGE,NWEIG) {LARGE==8NW, NWEIG==127, 2NWH<=NW, NW<=2NWH+1,
C    4NWQ<=NW, NW<=4NWQ+3}

C
         LARGE = LARGE+NWEIG                                            0246

      ELSE

C  P() {0==-1}

C
         IF (KPRESS.GT.1) LARGE = MAX(LARGE, 3*N2M*N2M)+NWEIG+NWEIG     0250

C  P() {0==-1}

         IF (KPRESS.LE.1) LARGE = MAX(LARGE+NWEIG, 3*N2M*N2M)           0251
      ENDIF

C  P(LARGE) {LARGE==8NW+127, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3}

C
      LZN = LCMREQ(LARGE)                                               0254

C  P(LZN,NW) {LARGE==8NW+127, LZN==1, MEMSIZ==8NW+127, NW<=20623,
C    2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

      LTN = LZN+NW                                                      0255

C  P(LTN,LZN,NOTEMP) {LARGE==8LTN+119, 8LTN==MEMSIZ-119, LTN==NW+1,
C    LZN==1, NOTEMP==0, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (NOTEMP.EQ.1) LTN = LZN                                        0256

C  P(LTN,NW) {LARGE==8LTN+119, 8LTN==MEMSIZ-119, LTN==NW+1,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LPN = LTN+NW                                                      0257

C  P(LPN,NW) {LARGE==8LTN+119, LPN==2LTN-1, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      LZO = LPN+NW                                                      0258

C  P(LZO,NW) {LARGE==8LTN+119, LPN==2LTN-1, 3LTN==LZO+2,
C    8LTN==MEMSIZ-119, LTN==NW+1, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LTO = LZO+NW                                                      0259

C  P(LTO,LZO,NOTEMP) {LARGE==8LTN+119, LPN==2LTN-1, LTN+LZO==LTO+1,
C    3LTN==LZO+2, 8LTN==MEMSIZ-119, LTN==NW+1, NOTEMP==0, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (NOTEMP.EQ.1) LTO = LZO                                        0260

C  P(LTO,NW) {LARGE==8LTN+119, LPN==2LTN-1, 4LTN==LTO+3, 3LTN==LZO+2,
C    8LTN==MEMSIZ-119, LTN==NW+1, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LPY = LTO+NW                                                      0261

C  P(LPY,NW) {LARGE==8LTN+119, LPN==2LTN-1, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 8LTN==MEMSIZ-119, LTN==NW+1, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LZX = LPY+NW                                                      0262

C  P(LZX,NW) {LARGE==8LTN+119, LPN==2LTN-1, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 8LTN==MEMSIZ-119, LTN==NW+1,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LZY = LZX+NW                                                      0263

C  P(LARGE,LZN,NWEIG) {LARGE==8LTN+119, LPN==2LTN-1, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, LTN+LZX==LZY+1,
C    8LTN==MEMSIZ-119, LTN==NW+1, LZN==1, NWEIG==127, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LPRESS = LZN+LARGE-NWEIG                                          0264

C  P(LPRESS) {LARGE==8LTN+119, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5,
C    LTN+LZX==LZY+1, 8LTN==MEMSIZ-119, LTN==NW+1, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      LEIG = LPRESS                                                     0265

C  P(KPRESS,LEIG,LMAPP,LPRESS,NWEIG) {KPRESS==1, LARGE==8LTN+119,
C    LEIG==8LTN-7, LMAPP==1, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, LTN+LZX==LZY+1,
C    8LTN==MEMSIZ-119, LTN==NW+1, NWEIG==127, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (KPRESS.GT.1.AND.LMAPP.NE.1) LEIG = LPRESS-NWEIG               0266

C  P(LZN) {LZN==1}

C
C THESE LCM ADDRESSES ARE USED BY EIGSET AND LCMRQR
C
      LE = LZN                                                          0270

C  P(LE,N2M) {LE==1, N2M==127}

      LH = LE+N2M*N2M                                                   0271

C  P(LH,N2M) {N2M==127, 1<=LH}

      LEV = LH+N2M*N2M                                                  0272

C  P(NMAX2) {256<=NMAX2}

C
      CALL EXSET(EX, NMAX2)                                             0274

C  P(N2P) {N2P==129}

C
C SET ALL  U(I) TO 0. TO AVOID TROUBLE IF NO MEAN FLOW IS DESIRED
C
      DO 10 I = 1, N2P                                                  0278

C  P(I,N2P) {N2P==129, 1<=I, I<=129}

         U(I) = 0.                                                      0279

C  P(N2P) {N2P==129}

10       CONTINUE                                                       0280

C  P(I,LEIG,LMAPP,MEMSIZ,N2,N2M,N2P,NWEIG) {I==130, LARGE==8LTN+119,
C    LEIG==LPRESS, LEIG==8LTN-7, LMAPP==1, LPN==2LTN-1, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N2==128, N2M==127, N2P==129,
C    NWEIG==127, NXXOUT==0, LEIG<=164985, 16NWH+1<=LEIG,
C    LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

C
C SET UP ARRAYS ASSOCIATED WITH THE MAPPING FUNCTION:
C
      IF (LMAPP.EQ.1) THEN                                              0284

C  P(N2) {N2==128}

C
C LINEAR MAPPING - EIGENVALUES KNOWN, EIGENFUNCTIONS ARE SIMPLY SINES
C AND COSINES, SO THAT NO MATRICES ARE NEEDED:
C
         F = H/REAL(N2)                                                 0289

C  P() {}

         FZ = PI/H                                                      0290

C  P() {}

         FZSQ = FZ*FZ                                                   0291

C  P() {}

         GMAPP(1) = 0.                                                  0292

C  P() {}

         G(1) = FZ                                                      0293

C  P(I,N2M) {I==130, N2M==127}

         DO 20 I = 1, N2M                                               0294

C  P(I,N2M) {N2M==127, 1<=I, I<=127}

            GMAPP(I+1) = F*REAL(I)                                      0295

C  P(I,N2M) {N2M==127, 1<=I, I<=127}

            G(I+1) = FZ                                                 0296

C  P(I,N2M) {N2M==127, 1<=I, I<=127}

            EVAL(I) = -REAL(I)**2*FZSQ                                  0297

C  P(N2M) {N2M==127}

20          CONTINUE                                                    0298

C  P(N2P) {N2P==129}

         GMAPP(N2P) = H                                                 0299

C  P(N2P) {N2P==129}

         G(N2P) = FZ                                                    0300

C  P(LEIG,MEMSIZ,NWEIG) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1,
C    NWEIG==127, NXXOUT==0, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL OUT(EVAL, LEIG, NWEIG)                                    0301
C
      ENDIF

C  P(KDATA,LPN,LTN,MEMSIZ,N1,N2P,NXXOUT) {KDATA==1, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1==128, N2P==129, NXXOUT==1,
C    1<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

C
C READ THE DATA:
C
      IF (KDATA.EQ.1.OR.KDATA.EQ.2) CALL DATAST(A, N2P, N1, GMAPP)      0307

C  P() {}

      FX = 2.0*PI/BOXX                                                  0308

C  P() {}

      FX2 = 2.*FX                                                       0309

C  P(I,KDATA,LPN,LZN,MEMSIZ,N1,N1H,N2,N2P,N2PD,NMAX2,NUMBER,NW,NXXOUT)
C    {I==128, KDATA==1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, LZN==1,
C    N1==128, N1H==64, N2==128, N2P==129, N2PD==258, NFTVMT==0,
C    NUMBER==250, NXACAC==0, NXLOG2==0, NXSHUF==0, NXXOUT==3,
C    NXXRCS==0, NXXXIN==0, 1<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 256<=NMAX2}

C
C PREPARE THE INPUT FOR PROCESSING:
C
      IF (KDATA.EQ.1) THEN                                              0313

C  P(LPN,MEMSIZ,NW) {LARGE==8NW+127, LEIG==8LTN-7, LPN==2NW+1,
C    LPRESS==8LTN-7, LPY==5NW+1, 3LTN==LZO+2, 6LTN==LZX+5,
C    7LTN==LZY+6, LTN==NW+1, LTO==4NW+1, MEMSIZ==8NW+127, NXXXIN==0,
C    0<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

C
C THE INPUT WAS STREAMFUNCTION IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER SPACE:
C
         CALL IN(A, LPN, NW)                                            0318

C  P(N1,N2P) {N1==128, N2P==129, NXSHUF==0}

         CALL SHUF(A, N2P, N1, WORK)                                    0319

C  P(N1) {N1==128}

         NPTS = N1                                                      0320

C  P(N2P) {N2P==129}

         NSKIP = N2P                                                    0321

C  P(N2P) {N2P==129}

         MTRN = N2P                                                     0322

C  P() {}

         MSKIP = 1                                                      0323

C  P() {}

         ISIGN = -1                                                     0324

C  P(NPTS) {NPTS==128, NXLOG2==0}

         CALL XLOG2(NPTS, LOG)                                          0325

C  P(NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0326

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NPTS,NSKIP,NUMBER) {ISIGN==-1,
C    MSKIP==1, MTRN==129, NFTVMT==0, NPTS==128, NSKIP==129,
C    NUMBER==250, NXXRCS==0}

         CALL RCS(A, EX)                                                0327

C  P(N2,NPTS) {N2==128, NPTS==128}

         NPTS = 2*N2                                                    0328

C  P(NSKIP) {NSKIP==129}

         NSKIP = 1                                                      0329

C  P(MTRN,N1H) {MTRN==129, N1H==64}

         MTRN = N1H                                                     0330

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

         MSKIP = N2P                                                    0331

C  P(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0332

C  P(LOG,NPTS,NXLOG2) {NPTS==256, NXLOG2==1}

         CALL XLOG2(NPTS, LOG)                                          0333

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0334

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER) {ISIGN==-1,
C    MSKIP==129, MTRN==64, NFTVMT==1, NPTS==256, NSKIP==1,
C    NUMBER==250, NXACAC==0}

         CALL ACAC(A, EX, WORK)                                         0335

C  P(N1,N2) {N1==128, N2==128}

C           F = 0.125/REAL(N1*N2)
         F = 0.0625/REAL(N1*N2)                                         0337

C  P(I,N1H,N2PD) {I==128, N1H==64, N2PD==258}

         DO 30 J = 1, N1H                                               0338

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

            DO 40 I = 1, N2PD                                           0339

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

               A(I,J) = A(I,J)*F                                        0340

C  P(N1H,N2PD) {N1H==64, N2PD==258}

40             CONTINUE                                                 0341

C  P(N1H) {N1H==64}

30          CONTINUE                                                    0342

C  P(LPN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, NXXOUT==3, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL OUT(A, LPN, NW)                                           0343

C  P(LZN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, NXXOUT==4, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL OUT(A, LZN, NW)                                           0344
      ENDIF

C  P(I,IEXSHF,ISIGN,J,KDATA,LEIG,LOG,LTN,LTO,LZN,LZO,MEMSIZ,MSKIP,
C    MTRN,N1,N1H,N2,N2M,N2P,N2PD,NFTVMT,NMAX2,NOTEMP,NPTS,NSKIP,
C    NUMBER,NW,NWEIG,NXACAC,NXLOG2,NXSHUF,NXXOUT,NXXRCS,NXXXIN)
C    {I==259, ISIGN==-1, J==65, KDATA==1, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, LZN==1, MSKIP==129, MTRN==64,
C    N1==128, N1H==64, N2==128, N2M==127, N2P==129, N2PD==258,
C    NFTVMT==2, NOTEMP==0, NPTS==256, NSKIP==1, NUMBER==250,
C    NWEIG==127, NXACAC==1, NXLOG2==2, NXSHUF==1, NXXOUT==5,
C    NXXRCS==1, NXXXIN==1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 256<=NMAX2}

C
CC*****C H E C K   F O U R I E R   C O E F F I C I E N T S**************
C
C         WRITE (6,7010) A(1,1),A(1,2),A(1,3)
C         WRITE (6,7020) A(2,1),A(2,2),A(2,3)
C         WRITE (6,7030) A(3,1),A(3,2),A(3,3)
C 7010    FORMAT(/2X,26HCHECK FOURIER COEFFICIENTS/4X,8HA(1,1) =,1PE13.6
C     1   2X,8HA(1,2) =,1PE13.6,2X,8HA(1,3) =,1PE13.6)
C 7020    FORMAT(4X,8HA(2,1) =,1PE13.6,2X,8HA(2,2) =,1PE13.6,2X,
C     1   8HA(2,3) =,1PE13.6)
C 7030    FORMAT(4X,8HA(3,1) =,1PE13.6,2X,8HA(3,2) =,1PE13.6,2X,
C     1   8HA(3,3) =,1PE13.6/)
C
C
      IF (KDATA.NE.3) THEN                                              0360

C  P(LEIG,MEMSIZ,NWEIG,NXXXIN) {LARGE==8LTN+119, LEIG==LPRESS,
C    7LEIG==8LZY-1, LPN==2LTN-1, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, NWEIG==127, NXXXIN==1, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

C                                                     2
C STREAMFUNCTION KNOWN - FIND THE VORTICITY:  Z =  DEL  (PSI):
C
         CALL IN(EVAL, LEIG, NWEIG)                                     0364

C  P(LZN) {LZN==1}

         KZN = LZN                                                      0365

C  P(N2M) {N2M==127}

         LVECT = N2M                                                    0366

C  P() {}

         LSKIP = 2                                                      0367

C  P() {}

         NVECT = 2                                                      0368

C  P() {}

         NVSKIP = 1                                                     0369

C  P(I,J,KZN,MEMSIZ,N1H,N2,N2P,N2PD,NXXOUT,NXXXIN) {I==259, J==65,
C    KZN==1, LARGE==8LTN+119, LEIG==LPRESS, LEIG==8LTN-7, LPN==2LTN-1,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2==128, N2P==129,
C    N2PD==258, NXXOUT==5, NXXXIN==2, 9<=LEIG, LEIG<=164985,
C    16NWH+1<=LEIG, LEIG<=16NWH+9, 32NWQ+1<=LEIG, LEIG<=32NWQ+25}

         DO 50 J = 1, N1H                                               0370

C  P(KZN,MEMSIZ,N1H,N2PD,NXXXIN) {J==NXXOUT-4, J==NXXXIN-1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2PD==258, 1<=J, J<=64,
C    J<=KZN, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

            CALL IN(CWORK, KZN, N2PD)                                   0371

C  P(J,N1H) {J==NXXOUT-4, J==NXXXIN-2, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, N1H==64, 1<=J, J<=64, J<=KZN, 1<=KZN, KZN+138<=8LTN,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

            F = REAL((J-1)*(J-1))*FX*FX                                 0372

C  P(I,N1H,N2) {N1H==64, N2==128}

            DO 60 I = 2, N2                                             0373

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

               CWORK(I) = (EVAL(I-1)-F)*CWORK(I)                        0374

C  P(N1H,N2) {N1H==64, N2==128}

60             CONTINUE                                                 0375

C  P(N1H) {N1H==64}

            CWORK(1) = -F*CWORK(1)                                      0376

C  P(N1H,N2P) {N1H==64, N2P==129}

            CWORK(N2P) = 0.0                                            0377

C  P(KZN,MEMSIZ,N1H,N2PD,NXXOUT) {J==NXXOUT-4, J==NXXXIN-2,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2PD==258, 1<=J, J<=64,
C    J<=KZN, 1<=KZN, KZN+138<=8LTN, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

            CALL OUT(CWORK, KZN, N2PD)                                  0378

C  P(KZN,N1H,N2PD) {J==NXXOUT-5, J==NXXXIN-2, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2PD==258, 1<=J, J<=64,
C    J<=KZN, 1<=KZN, KZN+138<=8LTN, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

            KZN = KZN+N2PD                                              0379

C  P(N1H) {N1H==64}

50          CONTINUE                                                    0380

C  P(N2,NPTS) {N2==128, NPTS==256}

         NPTS = 2*N2                                                    0381

C  P(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0382

C  P(MTRN,N1H) {MTRN==64, N1H==64}

         MTRN = N1H                                                     0383

C  P(MSKIP,N2P) {MSKIP==129, N2P==129}

         MSKIP = N2P                                                    0384

C  P(ISIGN) {ISIGN==-1}

         ISIGN = 1                                                      0385

C  P(LOG,NPTS,NXLOG2) {NPTS==256, NXLOG2==2}

         CALL XLOG2(NPTS, LOG)                                          0386

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0387

C  P(LZN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, NXXXIN==66, 322<=KZN, KZN<=8LTN+120, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL IN(A, LZN, NW)                                            0388

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXACAC)
C    {ISIGN==1, MSKIP==129, MTRN==64, NFTVMT==2, NPTS==256, NSKIP==1,
C    NUMBER==250, NXACAC==1}

         CALL ACAC(A, EX, WORK)                                         0389

C  P(I,J,N1H,N2PD) {I==129, J==65, N1H==64, N2PD==258}

         DO 70 J = 1, N1H                                               0390

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

            DO 80 I = 1, N2PD                                           0391

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

               A(I,J) = 0.5*A(I,J)                                      0392

C  P(N1H,N2PD) {N1H==64, N2PD==258}

80             CONTINUE                                                 0393

C  P(N1H) {N1H==64}

70          CONTINUE                                                    0394

C  P(LZO,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, NXXOUT==69, 322<=KZN, KZN<=8LTN+120, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL OUT(A, LZO, NW)                                           0395

C  P(I,IEXSHF,ISIGN,J,KDATA,LOG,LTN,LTO,MEMSIZ,MSKIP,MTRN,N1,N1H,N2,
C    N2P,N2PD,NFTVMT,NMAX2,NOTEMP,NPTS,NSKIP,NUMBER,NW,NXACAC,NXLOG2,
C    NXSHUF,NXXOUT,NXXRCS,NXXXIN) {I==259, ISIGN==1, J==65, KDATA==1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, MSKIP==129, MTRN==64, N1==128,
C    N1H==64, N2==128, N2P==129, N2PD==258, NFTVMT==3, NOTEMP==0,
C    NPTS==256, NSKIP==1, NUMBER==250, NXACAC==2, NXLOG2==3,
C    NXSHUF==1, NXXOUT==70, NXXRCS==1, NXXXIN==67, 322<=KZN,
C    KZN<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 256<=NMAX2}

         IF (NOTEMP.NE.1) THEN                                          0396

C  P(I,IEXSHF,ISIGN,J,KDATA,LOG,LTN,LTO,MEMSIZ,MSKIP,MTRN,N1,N1H,N2,
C    N2P,N2PD,NFTVMT,NMAX2,NPTS,NSKIP,NUMBER,NW,NXACAC,NXLOG2,NXSHUF,
C    NXXOUT,NXXRCS,NXXXIN) {I==259, ISIGN==1, J==65, KDATA==1,
C    LARGE==8NW+127, LEIG==8LTN-7, LPN==2NW+1, LPRESS==8LTN-7,
C    LPY==5NW+1, 7LTN==LZY+6, LTN==NW+1, LTO==4NW+1, LZO==3NW+1,
C    LZX==6NW+1, MEMSIZ==8NW+127, MSKIP==129, MTRN==64, N1==128,
C    N1H==64, N2==128, N2P==129, N2PD==258, NFTVMT==3, NPTS==256,
C    NSKIP==1, NUMBER==250, NXACAC==2, NXLOG2==3, NXSHUF==1,
C    NXXOUT==70, NXXRCS==1, NXXXIN==67, 322<=KZN, KZN<=8NW+128,
C    256<=NMAX2, 1<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3}

            IF (KDATA.NE.1) THEN                                        0397

C  P() {0==-1}

               CALL IN(A, LTN, NW)                                      0398

C  P() {0==-1}

C
C NEW TEMPERATURE KNOWN - SET UP T(OLD):
C
               NPTS = 2*N2                                              0402

C  P() {0==-1}

               NSKIP = 1                                                0403

C  P() {0==-1}

               MTRN = N1H                                               0404

C  P() {0==-1}

               MSKIP = N2P                                              0405

C  P() {0==-1}

               ISIGN = 1                                                0406

C  P() {0==-1}

               CALL XLOG2(NPTS, LOG)                                    0407

C  P() {0==-1}

               IEXSHF = NMAX2/NPTS                                      0408

C  P() {0==-1}

               CALL ACAC(A, EX, WORK)                                   0409

C  P() {0==-1}

               DO 90 J = 1, N1H                                         0410

C  P() {0==-1}

                  DO 100 I = 1, N2PD                                    0411

C  P() {0==-1}

                     A(I,J) = A(I,J)*0.5                                0412

C  P() {0==-1}

100                  CONTINUE                                           0413

C  P() {0==-1}

90                CONTINUE                                              0414

C  P() {0==-1}

               CALL OUT(A, LTO, NW)                                     0415

            ELSE

C  P(LTN,MEMSIZ,NW,NXXXIN) {LARGE==8NW+127, LEIG==8LTN-7, LPN==2NW+1,
C    LPRESS==8LTN-7, LPY==5NW+1, 6LTN==LZX+5, 7LTN==LZY+6, LTN==NW+1,
C    LTO==4NW+1, LZO==3NW+1, MEMSIZ==8NW+127, NXXXIN==67, 322<=KZN,
C    KZN<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

C
C TEMPERATURE IS SUPPLIED IN PHYSICAL SPACE - SHUFFLE THE DATA AND
C GO TO FOURIER REPRESENTATION:
C
               CALL IN(A, LTN, NW)                                      0422

C  P(N1,N2P,NXSHUF) {N1==128, N2P==129, NXSHUF==1}

               CALL SHUF(A, N2P, N1, WORK)                              0423

C  P(N1,NPTS) {N1==128, NPTS==256}

               NPTS = N1                                                0424

C  P(N2P,NSKIP) {N2P==129, NSKIP==1}

               NSKIP = N2P                                              0425

C  P(MTRN,N2P) {MTRN==64, N2P==129}

               MTRN = N2P                                               0426

C  P(MSKIP) {MSKIP==129}

               MSKIP = 1                                                0427

C  P(ISIGN) {ISIGN==1}

               ISIGN = -1                                               0428

C  P(LOG,NPTS,NXLOG2) {NPTS==128, NXLOG2==3}

               CALL XLOG2(NPTS, LOG)                                    0429

C  P(IEXSHF,NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

               IEXSHF = NMAX2/NPTS                                      0430

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXXRCS)
C    {ISIGN==-1, MSKIP==1, MTRN==129, NFTVMT==3, NPTS==128,
C    NSKIP==129, NUMBER==250, NXXRCS==1}

               CALL RCS(A, EX)                                          0431

C  P(N1) {N1==128}

               F = 0.5/REAL(N1)                                         0432

C  P(I,J,N1H,N2PD) {I==259, J==65, N1H==64, N2PD==258}

               DO 110 J = 1, N1H                                        0433

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

                  DO 120 I = 1, N2PD                                    0434

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

                     A(I,J) = F*A(I,J)                                  0435

C  P(N1H,N2PD) {N1H==64, N2PD==258}

120                  CONTINUE                                           0436

C  P(N1H) {N1H==64}

110               CONTINUE                                              0437

C  P(LTO,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, NXXOUT==70, 322<=KZN, KZN<=8LTN+120, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

               CALL OUT(A, LTO, NW)                                     0438

C  P(N2,NPTS) {N2==128, NPTS==128}

               NPTS = 2*N2                                              0439

C  P(NSKIP) {NSKIP==129}

               NSKIP = 1                                                0440

C  P(MTRN,N1H) {MTRN==129, N1H==64}

               MTRN = N1H                                               0441

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

               MSKIP = N2P                                              0442

C  P(ISIGN) {ISIGN==-1}

               ISIGN = -1                                               0443

C  P(LOG,NPTS,NXLOG2) {NPTS==256, NXLOG2==4}

               CALL XLOG2(NPTS, LOG)                                    0444

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

               IEXSHF = NMAX2/NPTS                                      0445

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NUMBER,NXACAC)
C    {ISIGN==-1, MSKIP==129, MTRN==64, NFTVMT==4, NPTS==256, NSKIP==1,
C    NUMBER==250, NXACAC==2}

               CALL ACAC(A, EX, WORK)                                   0446

C  P(N2) {N2==128}

C           F = 0.25/REAL(N2)
               F = 0.125/REAL(N2)                                       0448

C  P(I,J,N1H,N2PD) {I==259, J==65, N1H==64, N2PD==258}

               DO 130 J = 1, N1H                                        0449

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

                  DO 140 I = 1, N2PD                                    0450

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

                     A(I,J) = F*A(I,J)                                  0451

C  P(N1H,N2PD) {N1H==64, N2PD==258}

140                  CONTINUE                                           0452

C  P(N1H) {N1H==64}

130               CONTINUE                                              0453

C  P(LTN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, NXXOUT==71, 322<=KZN, KZN<=8LTN+120, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

               CALL OUT(A, LTN, NW)                                     0454
            ENDIF

         ENDIF

C  P() {}


         T = 0.                                                         0459

C  P() {}

         DTT = DT                                                       0460

C  P() {}

         NSTEPS = 1                                                     0461
      ENDIF

C  P(KDATA,KPF,KPP,KPRESS,KSM,KTA,KTAPE,KTF,KTP,KUF,KUP,KVF,KVP,KZF,
C    KZP,LMAPP,N1,N2,NOALS,NOTEMP,NSTEPS,NUMBER) {KDATA==1, KPF==1,
C    KPP==249, KPRESS==1, KSM==1, KTA==50, KTAPE==0, KTF==1, KTP==50,
C    KUF==1, KUP==249, KVF==1, KVP==249, KZF==1, KZP==249, LMAPP==1,
C    N1==128, N2==128, NOALS==1, NOTEMP==0, NSTEPS==1, NUMBER==250}


      CALL RUNINF                                                       0464

C  P() {NUM1==1}

      CALL BUG('AFT INITAL')                                            0465

C  P() {}


C#
c      IF (.TRUE.) THEN    
150   CONTINUE                                                          0469

C  P(KTF,LTN,MEMSIZ,N1H,N2P,NOTEMP,NSTEPS,NUMBER,NXXXIN) {KTF==1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2P==129, NOTEMP==0,
C    NUMBER==250, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

C
C THIS IS THE BEGINNING OF THE TIME STEP.
C
      IF (MOD(NSTEPS, KTF).EQ.1.AND.NOTEMP.NE.1) CALL TEMPFO(CA, N2P    0473
     &, N1H, CWORK)                                                     0473

C  P(KPF,LPN,MEMSIZ,N1H,N2P,NSTEPS,NUMBER,NXXXIN) {KPF==1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2P==129, NUMBER==250,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (MOD(NSTEPS, KPF).EQ.1) CALL PSIFOU(CA, N2P, N1H, CWORK)       0475

C  P(KZF,LZN,MEMSIZ,N1H,N2P,NSTEPS,NUMBER,NXXXIN) {KZF==1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, LZN==1, N1H==64, N2P==129,
C    NUMBER==250, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      IF (MOD(NSTEPS, KZF).EQ.1) CALL ZETAFO(CA, N2P, N1H, CWORK)       0476

C  P(KVF,LPN,MEMSIZ,N1H,N2P,NSTEPS,NUMBER,NXXXIN) {KVF==1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1H==64, N2P==129, NUMBER==250,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (MOD(NSTEPS, KVF).EQ.1) CALL VVELFO(CA, N2P, N1H, FX, CWORK)   0477

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KTA,KTN,KTO,KZN,KZO,LOG,LTN,LTO,LZN,
C    LZO,MEMSIZ,MSKIP,MTRN,N1H,N1Q,N2,N2P,N2PD,NFTVMT,NMAX2,NOTEMP,
C    NPTS,NSKIP,NSTEPS,NUMBER,NW,NWH,NXACAC,NXLOG2,NXXOUT,NXXXIN)
C    {ISIGN==-1, K2QM==32, KTA==50, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, MSKIP==129, MTRN==64, N1H==64, N1Q==32,
C    N2==128, N2P==129, N2PD==258, NOTEMP==0, NPTS==256, NSKIP==1,
C    NUMBER==250, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4, 256<=NMAX2}

      IF (MOD(NSTEPS+1, KTA).EQ.1) THEN                                 0478

C  P() {}

C
C TIME AVERAGE VORTICITY:
C
         DTT = DT                                                       0482

C  P() {}

         T = T-0.5*DT                                                   0483

C  P(LZO,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

         CALL IN(A, LZO, NW)                                            0484

C  P(N2,NPTS) {N2==128, NPTS==256}

         NPTS = 2*N2                                                    0485

C  P(NSKIP) {NSKIP==1}

         NSKIP = 1                                                      0486

C  P(MTRN,N1H) {MTRN==64, N1H==64}

         MTRN = N1H                                                     0487

C  P(MSKIP,N2P) {MSKIP==129, N2P==129}

         MSKIP = N2P                                                    0488

C  P(ISIGN) {ISIGN==-1}

         ISIGN = -1                                                     0489

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0490

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

         CALL XLOG2(NPTS, LOG)                                          0491

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL ACAC(A, EX, WORK)                                         0492

C  P(N2) {N2==128}

         F = 0.125/REAL(N2)                                             0493

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258}

         DO 160 J = 1, N1H                                              0494

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

            DO 170 I = 1, N2PD                                          0495

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

               A(I,J) = A(I,J)*F                                        0496

C  P(N1H,N2PD) {N1H==64, N2PD==258}

170            CONTINUE                                                 0497

C  P(N1H) {N1H==64}

160         CONTINUE                                                    0498

C  P(LZO,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL OUT(A, LZO, NW)                                           0499

C  P(ISIGN) {ISIGN==-1}

         ISIGN = 1                                                      0500

C  P(MTRN,N1Q) {MTRN==64, N1Q==32}

         MTRN = N1Q                                                     0501

C  P(KZN,LZN) {LZN==1}

         KZN = LZN                                                      0502

C  P(KZO,LZO) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         KZO = LZO                                                      0503

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KZN,KZO,LOG,MEMSIZ,MSKIP,MTRN,N1Q,
C    N2PD,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,NWH,NXACAC,NXXOUT,NXXXIN)
C    {I==259, ISIGN==1, J==65, K2QM==32, KZN==1, KZO==3LTN-2,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, MSKIP==129, MTRN==32, N1Q==32,
C    N2PD==258, NPTS==256, NSKIP==1, NUMBER==250, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         DO 180 K = 1, 2                                                0504

C  P(KZO,MEMSIZ,NWH,NXXXIN) {KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K<=KZN, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

            CALL IN(A, KZO, NWH)                                        0505

C  P(KZN,MEMSIZ,NWH,NXXXIN) {KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K<=KZN, 1<=KZO,
C    KZO+NWH<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            CALL IN(A(1,K2Q), KZN, NWH)                                 0506

C  P(I,J,K2QJ,K2QM,N1Q,N2PD) {K2QM==32, N1Q==32, N2PD==258}

            DO 190 J = 1, N1Q                                           0507

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

               K2QJ = J+K2QM                                            0508

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 1<=J, J<=32}

               DO 200 I = 1, N2PD                                       0509

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 1<=I, I<=258,
C    1<=J, J<=32}

                  A(I,J) = A(I,J)+0.5*A(I,K2QJ)                         0510

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

200               CONTINUE                                              0511

C  P(N1Q) {N1Q==32}

190            CONTINUE                                                 0512

C  P(KZN,MEMSIZ,NWH,NXXOUT) {KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K<=KZN, 1<=KZN,
C    KZN+NWH<=8LTN+120, 1<=KZO, KZO+NWH<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            CALL OUT(A, KZN, NWH)                                       0513

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==32, NPTS==256, NSKIP==1,
C    NUMBER==250}

            CALL ACAC(A, EX, WORK)                                      0514

C  P(I,J,N1Q,N2PD) {I==259, J==33, N1Q==32, N2PD==258}

            DO 210 J = 1, N1Q                                           0515

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=J, J<=32}

               DO 220 I = 1, N2PD                                       0516

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=I, I<=258, 1<=J, J<=32}

                  A(I,J) = 0.5*A(I,J)                                   0517

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

220               CONTINUE                                              0518

C  P(N1Q) {N1Q==32}

210            CONTINUE                                                 0519

C  P(KZO,MEMSIZ,NWH,NXXOUT) {KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K<=KZN, 1<=KZN,
C    KZN+NWH<=8LTN+120, 1<=KZO, KZO+NWH<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            CALL OUT(A, KZO, NWH)                                       0520

C  P(KZO,NWH) {KZN+3LTN==KZO+3, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K<=KZN, 1<=KZN, KZN+NWH<=8LTN+120, 1<=KZO,
C    KZO+NWH<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            KZO = KZO+NWH                                               0521

C  P(KZN,NWH) {KZN+3LTN+NWH==KZO+3, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K<=KZN, 1<=KZN, KZN+NWH<=8LTN+120,
C    KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            KZN = KZN+NWH                                               0522

C  P() {}

180         CONTINUE                                                    0523

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KTN,KTO,LOG,LTN,LTO,MEMSIZ,MSKIP,
C    MTRN,N1H,N1Q,N2,N2PD,NFTVMT,NOTEMP,NPTS,NSKIP,NSTEPS,NUMBER,NW,
C    NWH,NXACAC,NXXOUT,NXXXIN) {I==259, ISIGN==1, J==33, K==3,
C    K2QJ==64, K2QM==32, KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, MSKIP==129, MTRN==32, N1H==64,
C    N1Q==32, N2==128, N2PD==258, NOTEMP==0, NPTS==256, NSKIP==1,
C    NUMBER==250, KZN<=8LTN+120, NWH+2<=KZN, KZO<=8LTN+120,
C    NWH+1<=KZO, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

         IF (NOTEMP.NE.1) THEN                                          0524

C  P(ISIGN) {ISIGN==1}

C
C TIME AVERAGE TEMPERATURE:
C
            ISIGN = -1                                                  0528

C  P(MTRN,N1H) {MTRN==32, N1H==64}

            MTRN = N1H                                                  0529

C  P(LTO,MEMSIZ,NW,NXXXIN) {KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, KZN<=8LTN+120, NWH+2<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            CALL IN(A, LTO, NW)                                         0530

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

            CALL ACAC(A, EX, WORK)                                      0531

C  P(N2) {N2==128}

            F = 0.125/REAL(N2)                                          0532

C  P(I,J,N1H,N2PD) {I==259, J==33, N1H==64, N2PD==258}

            DO 230 J = 1, N1H                                           0533

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=J, J<=64}

               DO 240 I = 1, N2PD                                       0534

C  P(I,J,N1H,N2PD) {N1H==64, N2PD==258, 1<=I, I<=258, 1<=J, J<=64}

                  A(I,J) = F*A(I,J)                                     0535

C  P(N1H,N2PD) {N1H==64, N2PD==258}

240               CONTINUE                                              0536

C  P(N1H) {N1H==64}

230            CONTINUE                                                 0537

C  P(LTO,MEMSIZ,NW,NXXOUT) {KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, KZN<=8LTN+120, NWH+2<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            CALL OUT(A, LTO, NW)                                        0538

C  P(ISIGN) {ISIGN==-1}

            ISIGN = 1                                                   0539

C  P(MTRN,N1Q) {MTRN==64, N1Q==32}

            MTRN = N1Q                                                  0540

C  P(KTO,LTO) {KZN+3LTN==KZO+3, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, KZN<=8LTN+120, NWH+2<=KZN, KZO<=8LTN+120, NWH+1<=KZO,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4, 1<=NWH}

            KTO = LTO                                                   0541

C  P(KTN,LTN) {KTO==4LTN-3, KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, KZN<=8LTN+120, NWH+2<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

            KTN = LTN                                                   0542

C  P(I,IEXSHF,ISIGN,J,K,K2QJ,K2QM,KTN,KTO,LOG,MEMSIZ,MSKIP,MTRN,N1Q,
C    N2PD,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,NWH,NXACAC,NXXOUT,NXXXIN)
C    {I==259, ISIGN==1, J==65, K==3, K2QJ==64, K2QM==32, 4KTN==KTO+3,
C    3KTN+KZN==KZO+3, 8KTN==LARGE-119, 8KTN==LEIG+7, 2KTN==LPN+1,
C    8KTN==LPRESS+7, 5KTN==LPY+4, KTN==LTN, 4KTN==LTO+3, 3KTN==LZO+2,
C    6KTN==LZX+5, 7KTN==LZY+6, 8KTN==MEMSIZ-119, KTN==NW+1,
C    MSKIP==129, MTRN==32, N1Q==32, N2PD==258, NPTS==256, NSKIP==1,
C    NUMBER==250, 2<=KTN, KTN<=20624, KZN<=8KTN+120, KZO<=8KTN+120,
C    2NWH+1<=KTN, KTN<=2NWH+2, 4NWQ+1<=KTN, KTN<=4NWQ+4, NWH+2<=KZN,
C    NWH+1<=KZO, 1<=NWH}

            DO 250 K = 1, 2                                             0543

C  P(KTO,MEMSIZ,NWH,NXXXIN) {KTN+3LTN==KTO+3, KZN+3LTN==KZO+3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K+LTN<=KTN+1,
C    KZN<=8LTN+120, NWH+2<=KZN, KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4,
C    1<=NWH}

               CALL IN(A, KTO, NWH)                                     0544

C  P(KTN,MEMSIZ,NWH,NXXXIN) {KTN+3LTN==KTO+3, KZN+3LTN==KZO+3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K+LTN<=KTN+1, 1<=KTO,
C    KTO+NWH<=8LTN+120, KZN<=8LTN+120, NWH+2<=KZN, KZO<=8LTN+120,
C    NWH+1<=KZO, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

               CALL IN(A(1,K2Q), KTN, NWH)                              0545

C  P(I,J,K2QJ,K2QM,N1Q,N2PD) {K2QM==32, N1Q==32, N2PD==258}

               DO 260 J = 1, N1Q                                        0546

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

                  K2QJ = J+K2QM                                         0547

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 1<=J, J<=32}

                  DO 270 I = 1, N2PD                                    0548

C  P(I,J,K2QJ,N1Q,N2PD) {J==K2QJ-32, N1Q==32, N2PD==258, 1<=I, I<=258,
C    1<=J, J<=32}

                     A(I,J) = A(I,J)+0.5*A(I,K2QJ)                      0549

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

270                  CONTINUE                                           0550

C  P(N1Q) {N1Q==32}

260               CONTINUE                                              0551

C  P(KTN,MEMSIZ,NWH,NXXOUT) {KTN+3LTN==KTO+3, KZN+3LTN==KZO+3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K+LTN<=KTN+1, 1<=KTN,
C    KTN+NWH<=8LTN+120, 1<=KTO, KTO+NWH<=8LTN+120, KZN<=8LTN+120,
C    NWH+2<=KZN, KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

               CALL OUT(A, KTN, NWH)                                    0552

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==32, NPTS==256, NSKIP==1,
C    NUMBER==250}

               CALL ACAC(A, EX, WORK)                                   0553

C  P(I,J,N1Q,N2PD) {I==259, J==33, N1Q==32, N2PD==258}

               DO 280 J = 1, N1Q                                        0554

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=J, J<=32}

                  DO 290 I = 1, N2PD                                    0555

C  P(I,J,N1Q,N2PD) {N1Q==32, N2PD==258, 1<=I, I<=258, 1<=J, J<=32}

                     A(I,J) = 0.5*A(I,J)                                0556

C  P(N1Q,N2PD) {N1Q==32, N2PD==258}

290                  CONTINUE                                           0557

C  P(N1Q) {N1Q==32}

280               CONTINUE                                              0558

C  P(KTO,MEMSIZ,NWH,NXXOUT) {KTN+3LTN==KTO+3, KZN+3LTN==KZO+3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K+LTN<=KTN+1, 1<=KTN,
C    KTN+NWH<=8LTN+120, 1<=KTO, KTO+NWH<=8LTN+120, KZN<=8LTN+120,
C    NWH+2<=KZN, KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

               CALL OUT(A, KTO, NWH)                                    0559

C  P(KTO,NWH) {KTN+3LTN==KTO+3, KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K+LTN<=KTN+1, 1<=KTN,
C    KTN+NWH<=8LTN+120, 1<=KTO, KTO+NWH<=8LTN+120, KZN<=8LTN+120,
C    NWH+2<=KZN, KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

               KTO = KTO+NWH                                            0560

C  P(KTN,NWH) {KTN+3LTN+NWH==KTO+3, KZN+3LTN==KZO+3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=2, K+LTN<=KTN+1, 1<=KTN,
C    KTN+NWH<=8LTN+120, KTO<=8LTN+120, NWH+1<=KTO, KZN<=8LTN+120,
C    NWH+2<=KZN, KZO<=8LTN+120, NWH+1<=KZO, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH}

               KTN = KTN+NWH                                            0561

C  P() {}

250            CONTINUE                                                 0562
         ENDIF

      ENDIF

C  P(IEXSHF,ISIGN,KPP,LOG,LPN,MEMSIZ,MSKIP,MTRN,N1H,N2P,NFTVMT,NMAX2,
C    NPTS,NSKIP,NSTEPS,NUMBER,NUSHUF,NW,NXACAC,NXLOG2,NXXCSR,NXXXIN)
C    {16ISIGN+MTRN==48, KPP==249, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, MSKIP==129, N1H==64, N2P==129, NPTS==256, NSKIP==1,
C    NUMBER==250, 0<=ISIGN+1, ISIGN<=1, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 256<=NMAX2}

C
C THE BEGINING OF A NORMAL TIME STEP
C (U IS X VELOCITY AND V IS Y VELOCITY)
C FIND (-U) = D(PSI)/DY
C
C
      IF (NSTEPS.LT.3) THEN                                             0572

C  P(LPN,MEMSIZ,NW,NXXXIN) {5LARGE==8LPY+627, 3LARGE==4LZX+377,
C    LARGE==MEMSIZ, LEIG==2LTO-1, 4LPN==LPRESS+3, 5LPN==2LPY+3,
C    4LTN==LTO+3, 3LTN==LZO+2, 7LTN==LZY+6, LTN==NW+1, 3LTO==2LZX+1,
C    LPN<=41247, 4NWH+1<=LPN, LPN<=4NWH+3, 8NWQ+1<=LPN, LPN<=8NWQ+7}

         CALL IN(CA, LPN, NW)                                           0573

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,N1H,N2P,NFTVMT,NMAX2,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NXACAC,NXLOG2,NXXCSR) {16ISIGN+MTRN==48,
C    MSKIP==129, N1H==64, N2P==129, NPTS==256, NSKIP==1, NUMBER==250,
C    0<=ISIGN+1, ISIGN<=1, 256<=NMAX2, NSTEPS<=2}

         CALL PSIPHY(CA, N2P, N1H, EX, G, U, WORK, CWORK3, 1)           0574

      ELSE

C  P(LPN,MEMSIZ,NW,NXXXIN) {5LARGE==8LPY+627, 3LARGE==4LZX+377,
C    LARGE==MEMSIZ, LEIG==2LTO-1, 4LPN==LPRESS+3, 5LPN==2LPY+3,
C    4LTN==LTO+3, 3LTN==LZO+2, 7LTN==LZY+6, LTN==NW+1, 3LTO==2LZX+1,
C    LPN<=41247, 4NWH+1<=LPN, LPN<=4NWH+3, 8NWQ+1<=LPN, LPN<=8NWQ+7}

         CALL IN(CA, LPN, NW)                                           0577

C  P(IEXSHF,ISIGN,KPP,LOG,MSKIP,MTRN,N1H,N2P,NFTVMT,NMAX2,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NXACAC,NXLOG2,NXXCSR) {16ISIGN+MTRN==48,
C    KPP==249, MSKIP==129, N1H==64, N2P==129, NPTS==256, NSKIP==1,
C    NUMBER==250, 0<=ISIGN+1, ISIGN<=1, 256<=NMAX2, 3<=NSTEPS}

         IF (MOD(NSTEPS, KPP).EQ.1) CALL PSIPHY(CA, N2P, N1H, EX, G,    0578
     &   U, WORK, CWORK3, -1)                                           0578
      ENDIF

C  P(N2,NPTS) {2048ISIGN+97MSKIP+128MTRN==18657, MSKIP==NPTS-127,
C    MSKIP+NSKIP==130, N2==128, ISIGN<=1, 65<=64ISIGN+MSKIP,
C    MSKIP<=129}

C
      NPTS = 2*N2                                                       0582

C  P(NSKIP) {2048ISIGN+97MSKIP+128MTRN==18657, MSKIP+NSKIP==130,
C    ISIGN<=1, 65<=64ISIGN+MSKIP, MSKIP<=129}

      NSKIP = 1                                                         0583

C  P(MTRN,N1H) {2048ISIGN+97MSKIP+128MTRN==18657, N1H==64, ISIGN<=1,
C    65<=64ISIGN+MSKIP, MSKIP<=129}

      MTRN = N1H                                                        0584

C  P(MSKIP,N2P) {N2P==129, ISIGN<=1, 65<=64ISIGN+MSKIP, MSKIP<=129}

      MSKIP = N2P                                                       0585

C  P(ISIGN) {0<=ISIGN+1, ISIGN<=1}

      ISIGN = 1                                                         0586

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

      CALL XLOG2(NPTS, LOG)                                             0587

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0588

C  P(LPN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL IN(CA, LPN, NW)                                              0589

C  P() {}

      F = 0.                                                            0590

C  P(I,J,N1H,N2) {N1H==64, N2==128}

      DO 300 I = 1, N2                                                  0591

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128}

         DO 310 J = 1, N1H                                              0592

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0593

C  P(N1H,N2) {N1H==64, N2==128}

310         CONTINUE                                                    0594

C  P(N2) {N2==128}

         F = F+1.                                                       0595

C  P(N2) {N2==128}

300      CONTINUE                                                       0596

C  P(J,N1H,N2P) {J==65, N1H==64, N2P==129}

      DO 320 J = 1, N1H                                                 0597

C  P(J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         CA(N2P,J) = 0.                                                 0598

C  P(N1H) {N1H==64}

320      CONTINUE                                                       0599

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXSCSC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL SCSC(CA, EX, WORK)                                           0600

C  P(LPY,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LPY, NW)                                             0601

C  P(KSM,N2P) {KSM==1, N2P==129}

      IF (KSM.EQ.1) CALL MEAN(CA, U, G)                                 0602

C  P(IEXSHF,ISIGN,KUF,LOG,MSKIP,MTRN,N1H,N2P,NFTVMT,NPTS,NSKIP,NSTEPS,
C    NUMBER,NXSCSC) {ISIGN==1, KUF==1, MSKIP==129, MTRN==64, N1H==64,
C    N2P==129, NPTS==256, NSKIP==1, NUMBER==250}

      IF (MOD(NSTEPS, KUF).EQ.1) CALL UVELFO(CA, N2P, N1H, G, EX,       0603
     &CWORK)                                                            0603

C  P(LPN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL IN(CA, LPN, NW)                                              0604

C  P() {}

C
C FIND  V = D(PSI)/DX
C
      F = 0.                                                            0608

C  P(I,J,N1H,N2P) {I==129, J==65, N1H==64, N2P==129}

      DO 330 J = 1, N1H                                                 0609

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         DO 340 I = 1, N2P                                              0610

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=I, I<=129, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0611

C  P(N1H,N2P) {N1H==64, N2P==129}

340         CONTINUE                                                    0612

C  P(N1H) {N1H==64}

         F = F+FX                                                       0613

C  P(N1H) {N1H==64}

330      CONTINUE                                                       0614

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL ACAC(CA, EX, WORK)                                           0615

C  P(LPN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LPN, NW)                                             0616

C  P(KPP,LPN,MEMSIZ,NOTEMP,NSTEPS,NW,NXXXIN) {KPP==249,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, NOTEMP==0, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (MOD(NSTEPS, KPP).EQ.1.AND.NOTEMP.NE.1) CALL IN(CA, LPN, NW)   0617

C  P(N2,NPTS) {N2==128, NPTS==256}

      NPTS = 2*N2                                                       0618

C  P(NSKIP) {NSKIP==1}

      NSKIP = 1                                                         0619

C  P(MTRN,N1H) {MTRN==64, N1H==64}

      MTRN = N1H                                                        0620

C  P(MSKIP,N2P) {MSKIP==129, N2P==129}

      MSKIP = N2P                                                       0621

C  P(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0622

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

      CALL XLOG2(NPTS, LOG)                                             0623

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0624

C  P(I,J,KTO,LTO,MEMSIZ,N1H,N2P,N2PD,NOTEMP,NXXOUT,NXXXIN) {I==130,
C    J==65, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    N2P==129, N2PD==258, NOTEMP==0, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (NOTEMP.NE.1) THEN                                             0625

C  P(KTO,LTO) {LARGE==8LTN+119, LEIG==8NW+1, LPN==2LTN-1,
C    LPRESS==8NW+1, LPY==5LTN-4, 3LPY==5LZO-2, 8LTN==MEMSIZ-119,
C    3LTO==4LZO-1, 3LTO==2LZX+1, LZX==6NW+1, LZY==7NW+1, 1<=NW,
C    NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW, NW<=4NWQ+3}

C
C T(TOTAL) = T-BETA*Y
C WHERE BETA < 0 MEANS   STABLE STRATIFICATION AND
C       BETA > 0 MEANS UNSTABLE STRATIFICATION
C
         KTO = LTO                                                      0631

C  P() {}

         DTB = 0.5*BETA*DTT                                             0632

C  P(I,J,KTO,MEMSIZ,N1H,N2P,N2PD,NXXOUT,NXXXIN) {I==130, J==65,
C    KTO==LTO, 3KTO==4LZO-1, KTO==4NW+1, LARGE==8LTN+119, LEIG==8NW+1,
C    LPN==2LTN-1, LPRESS==8NW+1, LPY==5LTN-4, 3LTN==LZO+2,
C    8LTN==MEMSIZ-119, LZX==6NW+1, LZY==7NW+1, N1H==64, N2P==129,
C    N2PD==258, 1<=NW, NW<=20623, 2NWH<=NW, NW<=2NWH+1, 4NWQ<=NW,
C    NW<=4NWQ+3}

         DO 350 J = 1, N1H                                              0633

C  P(KTO,MEMSIZ,N1H,N2PD,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, N1H==64, N2PD==258, 1<=J, J<=64, J+4LTN<=KTO+4,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

            CALL IN(CWORK, KTO, N2PD)                                   0634

C  P(J,N1H) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    1<=J, J<=64, J+4LTN<=KTO+4, 1<=KTO, KTO+138<=8LTN, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

            F = -REAL(J-1)*FX*DTT*0.25                                  0635

C  P(I,J,N1H,N2P) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    N2P==129, 1<=J, J<=64, J+4LTN<=KTO+4, 1<=KTO, KTO+138<=8LTN,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

            DO 360 I = 1, N2P                                           0636

C  P(I,J,N1H,N2P) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    N2P==129, 1<=I, I<=129, 1<=J, J<=64, J+4LTN<=KTO+4, 1<=KTO,
C    KTO+138<=8LTN, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4}

               CWORK(I) = CWORK(I)*CMPLX(1., U(I)*F)+DTB*CA(I,J)        0637

C  P(N1H,N2P) {N1H==64, N2P==129}

360            CONTINUE                                                 0638

C  P(KTO,MEMSIZ,N1H,N2PD,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, N1H==64, N2PD==258, 1<=J, J<=64, J+4LTN<=KTO+4,
C    1<=KTO, KTO+138<=8LTN, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

            CALL OUT(CWORK, KTO, N2PD)                                  0639

C  P(KTO,N1H,N2PD) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    N2PD==258, 1<=J, J<=64, J+4LTN<=KTO+4, 1<=KTO, KTO+138<=8LTN,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

            KTO = KTO+N2PD                                              0640

C  P(N1H) {N1H==64}

350         CONTINUE                                                    0641
      ENDIF

C  P(LZN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, 259<=KTO, 4LTN+318<=KTO, KTO<=8LTN+120,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}


      CALL IN(CA, LZN, NW)                                              0644

C  P() {}

C
C FIND DZ/DY:
C
      F = 0.                                                            0648

C  P(I,J,N1H,N2) {I==130, J==65, N1H==64, N2==128}

      DO 370 I = 1, N2                                                  0649

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128}

         DO 380 J = 1, N1H                                              0650

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0651

C  P(N1H,N2) {N1H==64, N2==128}

380         CONTINUE                                                    0652

C  P(N2) {N2==128}

         F = F+1.                                                       0653

C  P(N2) {N2==128}

370      CONTINUE                                                       0654

C  P(J,N1H,N2P) {J==65, N1H==64, N2P==129}

      DO 390 J = 1, N1H                                                 0655

C  P(J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         CA(N2P,J) = 0.                                                 0656

C  P(N1H) {N1H==64}

390      CONTINUE                                                       0657

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXSCSC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL SCSC(CA, EX, WORK)                                           0658

C  P(LZY,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 259<=KTO, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LZY, NW)                                             0659

C  P(LZN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, 259<=KTO, 4LTN+318<=KTO, KTO<=8LTN+120,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      CALL IN(CA, LZN, NW)                                              0660

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL ACAC(CA, EX, WORK)                                           0661

C  P(I,J,N1H,N2P) {I==129, J==65, N1H==64, N2P==129}

      DO 400 J = 1, N1H                                                 0662

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         DO 410 I = 1, N2P                                              0663

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=I, I<=129, 1<=J, J<=64}

            CA(I,J) = CA(I,J)*0.5                                       0664

C  P(N1H,N2P) {N1H==64, N2P==129}

410         CONTINUE                                                    0665

C  P(N1H) {N1H==64}

400      CONTINUE                                                       0666

C  P(LZN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, 259<=KTO, 4LTN+318<=KTO, KTO<=8LTN+120,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      CALL OUT(CA, LZN, NW)                                             0667

C  P(N1,NPTS) {N1==128, NPTS==256}

      NPTS = N1                                                         0668

C  P(N2P,NSKIP) {N2P==129, NSKIP==1}

      NSKIP = N2P                                                       0669

C  P(MTRN,N2P) {MTRN==64, N2P==129}

      MTRN = N2P                                                        0670

C  P(MSKIP) {MSKIP==129}

      MSKIP = 1                                                         0671

C  P(ISIGN) {ISIGN==1}

      ISIGN = 1                                                         0672

C  P(LOG,NPTS,NXLOG2) {NPTS==128}

      CALL XLOG2(NPTS, LOG)                                             0673

C  P(IEXSHF,NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0674

C  P(IEXSHF,ISIGN,KZP,LOG,MSKIP,MTRN,N1H,N2PD,NFTVMT,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,ZETAPH:NCALL) {ISIGN==1,
C    KZP==249, MSKIP==1, MTRN==129, N1H==64, N2PD==258, NPTS==128,
C    NSKIP==129, NUMBER==250}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL ZETAPH(CA, N2PD, N1H, EX, WORK    0675
     &, -1)                                                             0675

C  P(KZP,LZN,MEMSIZ,NSTEPS,NW,NXXXIN) {KZP==249, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, LZN==1, 4LTN+318<=KTO,
C    KTO<=8LTN+120, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      IF (MOD(NSTEPS, KZP).EQ.1) CALL IN(CA, LZN, NW)                   0676

C  P() {}

C
C FIND DZ/DX:
C
      F = 0.                                                            0680

C  P(I,J,N1H,N2P) {I==130, J==65, N1H==64, N2P==129}

      DO 420 J = 1, N1H                                                 0681

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

         DO 430 I = 1, N2P                                              0682

C  P(I,J,N1H,N2P) {N1H==64, N2P==129, 1<=I, I<=129, 1<=J, J<=64}

            CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))         0683

C  P(N1H,N2P) {N1H==64, N2P==129}

430         CONTINUE                                                    0684

C  P(N1H) {N1H==64}

         F = F+FX2                                                      0685

C  P(N1H) {N1H==64}

420      CONTINUE                                                       0686

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0687

C  P(LZX,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LZX, NW)                                             0688

C  P(LZY,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL IN(CA, LZY, NW)                                              0689

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0690

C  P(LZY,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LZY, NW)                                             0691

C  P(LPN,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL IN(CA, LPN, NW)                                              0692

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0693

C  P(LPN,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LPN, NW)                                             0694

C  P(LPY,MEMSIZ,NW,NXXXIN) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL IN(CA, LPY, NW)                                              0695

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL CSR(CA, EX)                                                  0696

C  P(LPY,MEMSIZ,NW,NXXOUT) {LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      CALL OUT(CA, LPY, NW)                                             0697

C  P(KUP,LPY,MEMSIZ,N1H,N2PD,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXXIN)
C    {KUP==249, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    N2PD==258, NUMBER==250, 4LTN+318<=KTO, KTO<=8LTN+120, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

C
C WE ARE IN PHYSICAL SPACE NOW - FIND  (U,V).GRAD (Z):
C
      IF (MOD(NSTEPS, KUP).EQ.1) CALL UVELPH(A, N2PD, N1H, WORK, -1)    0701

C  P(KVP,LPN,MEMSIZ,N1H,N2PD,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXXIN)
C    {KVP==249, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, N1H==64,
C    N2PD==258, NUMBER==250, 4LTN+318<=KTO, KTO<=8LTN+120, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      IF (MOD(NSTEPS, KVP).EQ.1) CALL VVELPH(A, N2PD, N1H, WORK, -1)    0702

C  P(KPY,LPY) {LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1,
C    4LTN+318<=KTO, KTO<=8LTN+120, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      KPY = LPY                                                         0703

C  P(KPN,LPN) {KPY==5LTN-4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      KPN = LPN                                                         0704

C  P(KZY,LZY) {KPN==2LTN-1, KPY==5LTN-4, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      KZY = LZY                                                         0705

C  P(KZX,LZX) {KPN==2LTN-1, KPY==5LTN-4, KZY==7LTN-6, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4,
C    4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 4LTN+318<=KTO, KTO<=8LTN+120,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

      KZX = LZX                                                         0706

C  P(KSM) {KSM==1}

      UKSM1F = REAL(2-KSM)                                              0707

C  P(I,IPH,J,K,K1QM,K2QM,K3QM,KPN,KPY,KZX,KZY,MEMSIZ,N1E,N2PD,NWQ,
C    NXXOUT,NXXXIN) {I==130, J==65, K1QM==16, K2QM==32, K3QM==48,
C    KPN==2LTN-1, KPY==5LTN-4, KZX==6LTN-5, KZY==7LTN-6,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, N1E==16, N2PD==258, 4LTN+318<=KTO,
C    KTO<=8LTN+120, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4}

      DO 440 K = 1, 4                                                   0708

C  P(KPY,MEMSIZ,NWQ,NXXXIN) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, 4LTN+318<=KTO, KTO<=8LTN+120, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4}

         CALL IN(A, KPY, NWQ)                                           0709

C  P(KPN,MEMSIZ,NWQ,NXXXIN) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, 1<=KPY, KPY+NWQ<=8LTN+120, 4LTN+318<=KTO,
C    KTO<=8LTN+120, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4, 1<=NWQ}

         CALL IN(A(1,K1Q), KPN, NWQ)                                    0710

C  P(KZY,MEMSIZ,NWQ,NXXXIN) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, 1<=KPN, KPN+NWQ<=8LTN+120, 1<=KPY,
C    KPY+NWQ<=8LTN+120, 4LTN+318<=KTO, KTO<=8LTN+120, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         CALL IN(A(1,K2Q), KZY, NWQ)                                    0711

C  P(KZX,MEMSIZ,NWQ,NXXXIN) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, 1<=KPN, KPN+NWQ<=8LTN+120, 1<=KPY,
C    KPY+NWQ<=8LTN+120, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZY,
C    KZY+NWQ<=8LTN+120, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         CALL IN(A(1,K3Q), KZX, NWQ)                                    0712

C  P(I,IPH,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258}

         DO 450 I = 1, N2PD                                             0713

C  P(I,IPH,N2PD) {N2PD==258, 1<=I, I<=258}

            IPH = (I+1)/2                                               0714

C  P(IPH,N2PD) {N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

            GG = G(IPH)                                                 0715

C  P(IPH,N2PD) {N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

            UU = U(IPH)*UKSM1F                                          0716

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

            DO 460 J = 1, N1E                                           0717

C  P(I,J,N1E,N2PD) {N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1,
C    I<=2IPH, 1<=J, J<=16}

               A(I,J) = A(I,J)*GG+UU                                    0718

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH, 1<=J,
C    J<=16}

               A(I,K2QM+J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+   0719
     &         J)*GG                                                    0719

C  P(N1E,N2PD) {N1E==16, N2PD==258}

460            CONTINUE                                                 0721

C  P(N2PD) {N2PD==258}

450         CONTINUE                                                    0722

C  P(KPY,MEMSIZ,NWQ,NXXOUT) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, 1<=KPN, KPN+NWQ<=8LTN+120, 1<=KPY,
C    KPY+NWQ<=8LTN+120, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZX,
C    KZX+NWQ<=8LTN+120, 1<=KZY, KZY+NWQ<=8LTN+120, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         CALL OUT(A, KPY, NWQ)                                          0723

C  P(KZY,MEMSIZ,NWQ,NXXOUT) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, 1<=KPN, KPN+NWQ<=8LTN+120, 1<=KPY,
C    KPY+NWQ<=8LTN+120, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZX,
C    KZX+NWQ<=8LTN+120, 1<=KZY, KZY+NWQ<=8LTN+120, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         CALL OUT(A(1,K2Q), KZY, NWQ)                                   0724

C  P(KPN,NWQ) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2, KZX+LTN==KZY+1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=4, K+7LTN<=KZY+7, 1<=KPN,
C    KPN+NWQ<=8LTN+120, 1<=KPY, KPY+NWQ<=8LTN+120, 4LTN+318<=KTO,
C    KTO<=8LTN+120, 1<=KZX, KZX+NWQ<=8LTN+120, 1<=KZY,
C    KZY+NWQ<=8LTN+120, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         KPN = KPN+NWQ                                                  0725

C  P(KPY,NWQ) {KPN+5LTN==KZY+NWQ+5, KPY+2LTN==KZY+2, KZX+LTN==KZY+1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, 1<=K, K<=4, K+7LTN<=KZY+7,
C    KPN<=8LTN+120, NWQ+1<=KPN, 1<=KPY, KPY+NWQ<=8LTN+120,
C    4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZX, KZX+NWQ<=8LTN+120, 1<=KZY,
C    KZY+NWQ<=8LTN+120, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         KPY = KPY+NWQ                                                  0726

C  P(KZX,NWQ) {KPN+5LTN==KZY+NWQ+5, KPY+2LTN==KZY+NWQ+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZX,
C    KZX+NWQ<=8LTN+120, 1<=KZY, KZY+NWQ<=8LTN+120, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         KZX = KZX+NWQ                                                  0727

C  P(KZY,NWQ) {KPN+5LTN==KZY+NWQ+5, KPY+2LTN==KZY+NWQ+2,
C    KZX+LTN==KZY+NWQ+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=4, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, KZX<=8LTN+120,
C    NWQ+1<=KZX, 1<=KZY, KZY+NWQ<=8LTN+120, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         KZY = KZY+NWQ                                                  0728

C  P() {}

440      CONTINUE                                                       0729

C  P(ISIGN) {ISIGN==1}

C
C [Z(OLD) + (MEAN -U) * (-DZ(OLD)/DX)] + (U,V).GRAD(Z)
C
      ISIGN = -1                                                        0733

C  P(LZY,MEMSIZ,NW,NXXXIN) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1,
C    KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZX<=8LTN+120, NWQ+1<=KZX,
C    KZY<=8LTN+120, 7LTN+NWQ<=KZY+3, NWQ+1<=KZY, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      CALL IN(A, LZY, NW)                                               0734

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXRCS) {ISIGN==-1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

      CALL RCS(A, EX)                                                   0735

C  P(LZY,MEMSIZ,NW,NXXOUT) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1,
C    KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZX<=8LTN+120, NWQ+1<=KZX,
C    KZY<=8LTN+120, 7LTN+NWQ<=KZY+3, NWQ+1<=KZY, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      CALL OUT(A, LZY, NW)                                              0736

C  P(KZO,LZO) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2, KZX+LTN==KZY+1,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120,
C    KZX<=8LTN+120, NWQ+1<=KZX, KZY<=8LTN+120, 7LTN+NWQ<=KZY+3,
C    NWQ+1<=KZY, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      KZO = LZO                                                         0737

C  P(KZN,LZN) {LZN==1}

      KZN = LZN                                                         0738

C  P(KZY,LZY) {KPN+5LTN==KZY+5, KPY+2LTN==KZY+2, KZO==3LTN-2,
C    KZX+LTN==KZY+1, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1,
C    KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZX<=8LTN+120, NWQ+1<=KZX,
C    KZY<=8LTN+120, 7LTN+NWQ<=KZY+3, NWQ+1<=KZY, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      KZY = LZY                                                         0739

C  P(N1) {N1==128}

      DTFAC = 0.125*DTT/REAL(N1)                                        0740

C  P() {}

      F1 = DTT*FX*0.25                                                  0741

C  P() {}

      F = F1                                                            0742

C  P(I,J,K,K2QJ,K2QM,KZN,KZO,KZY,MEMSIZ,N1Q,N2P,NWH,NXXOUT,NXXXIN)
C    {I==259, J==17, K==5, K2QM==32, KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN==1, KZO==3LTN-2, KZY==7LTN-6, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, N1Q==32, N2P==129, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120,
C    KZX<=8LTN+120, KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2,
C    NWQ+1<=KZX, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

      DO 470 K = 1, 2                                                   0743

C  P(KZO,MEMSIZ,NWH,NXXXIN) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120,
C    KZX<=8LTN+120, KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2,
C    NWQ+1<=KZX, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWQ}

         CALL IN(CA, KZO, NWH)                                          0744

C  P(KZN,MEMSIZ,NWH,NXXXIN) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZO,
C    KZO+NWH<=8LTN+120, KZX<=8LTN+120, KZX<=7LTN+121, NWQ+2<=KZX+LTN,
C    6LTN+NWQ<=KZX+2, NWQ+1<=KZX, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0745

C  P(KZO,MEMSIZ,NWH,NXXOUT) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZN,
C    KZN+NWH<=8LTN+120, 1<=KZO, KZO+NWH<=8LTN+120, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL OUT(CA(1,K2Q), KZO, NWH)                                  0746

C  P(KZY,MEMSIZ,NWH,NXXXIN) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZN,
C    KZN+NWH<=8LTN+120, 1<=KZO, KZO+NWH<=8LTN+120, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN,
C    LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL IN(CA(1,K2Q), KZY, NWH)                                   0747

C  P(I,J,K2QJ,K2QM,N1Q,N2P) {K2QM==32, N1Q==32, N2P==129}

         DO 480 J = 1, N1Q                                              0748

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

            K2QJ = J+K2QM                                               0749

C  P(N1Q) {N1Q==32}

            F = F-F1                                                    0750

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=J, J<=32}

            DO 490 I = 1, N2P                                           0751

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    1<=J, J<=32}

               CA(I,J) = CA(I,J)*CMPLX(1., F*U(I))+DTFAC*CA(I,K2QJ)     0752

C  P(N1Q,N2P) {N1Q==32, N2P==129}

490            CONTINUE                                                 0753

C  P(N1Q) {N1Q==32}

480         CONTINUE                                                    0754

C  P(KZN,MEMSIZ,NWH,NXXOUT) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, 1<=K, K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZN,
C    KZN+NWH<=8LTN+120, 1<=KZO, KZO+NWH<=8LTN+120, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    1<=KZY, KZY+NWH<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL OUT(CA, KZN, NWH)                                         0755

C  P(KZN,NWH) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1, KZN+7LTN==KZY+7,
C    KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, 1<=KZN,
C    KZN+NWH<=8LTN+120, 1<=KZO, KZO+NWH<=8LTN+120, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    1<=KZY, KZY+NWH<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         KZN = KZN+NWH                                                  0756

C  P(KZO,NWH) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1, KZN+7LTN==KZY+NWH+7,
C    KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120,
C    NWH+1<=KZN, 1<=KZO, KZO+NWH<=8LTN+120, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    1<=KZY, KZY+NWH<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         KZO = KZO+NWH                                                  0757

C  P(KZY,NWH) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1, KZN+7LTN==KZY+NWH+7,
C    KZO+4LTN==KZY+NWH+4, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, 1<=K,
C    K<=2, K+7LTN<=KZY+7, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120,
C    NWH+1<=KZN, KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    1<=KZY, KZY+NWH<=8LTN+120, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         KZY = KZY+NWH                                                  0758

C  P() {}

470      CONTINUE                                                       0759

C  P(I,IEXSHF,IPH,ISIGN,J,K,K1QM,K2Q,K2QJ,K2QM,K3QM,KPN,KPP,KPY,KTN,
C    KTO,KTP,KZN,KZX,KZY,LOG,LPN,LPY,LTN,LTO,LZN,LZX,LZY,MEMSIZ,MSKIP,
C    MTRN,N1,N1E,N1H,N1Q,N2,N2P,N2PD,NFTVMT,NMAX2,NOTEMP,NPTS,NSKIP,
C    NSTEPS,NUMBER,NUSHUF,NW,NWH,NWQ,NXACAC,NXLOG2,NXPRNT,NXSCSC,
C    NXXCSR,NXXOUT,NXXRCS,NXXXIN,TEMPHY:NCALL) {I==130, IPH==129,
C    ISIGN==-1, J==33, K==3, K1QM==16, K2Q==33, K2QJ==64, K2QM==32,
C    K3QM==48, KPN+4LTN==KZX+4, KPP==249, KPY+LTN==KZX+1, KTP==50,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, LZN==1, MSKIP==1, MTRN==129, N1==128, N1E==16,
C    N1H==64, N1Q==32, N2==128, N2P==129, N2PD==258, NOTEMP==0,
C    NPTS==128, NSKIP==129, NUMBER==250, KPN<=8LTN+120, NWQ+1<=KPN,
C    KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120,
C    KZN<=8LTN+120, NWH+1<=KZN, KZO<=8LTN+120, NWH+1<=KZO,
C    KZX<=8LTN+120, KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2,
C    NWQ+1<=KZX, KZY<=8LTN+120, 7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN,
C    LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4,
C    256<=NMAX2, 1<=NWH, 1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0760

C  P(N2,NPTS) {N2==128, NPTS==128}

C
C FIND DT/DY:
C
         NPTS = 2*N2                                                    0764

C  P(NSKIP) {NSKIP==129}

         NSKIP = 1                                                      0765

C  P(MTRN,N1H) {MTRN==129, N1H==64}

         MTRN = N1H                                                     0766

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

         MSKIP = N2P                                                    0767

C  P(ISIGN) {ISIGN==-1}

         ISIGN = 1                                                      0768

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

         CALL XLOG2(NPTS, LOG)                                          0769

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0770

C  P(LTN,MEMSIZ,NW,NXXXIN) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120, NWH+1<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX<=7LTN+121,
C    NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX, KZY<=8LTN+120,
C    7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL IN(CA, LTN, NW)                                           0771

C  P() {}

         F = 0.                                                         0772

C  P(I,J,N1H,N2) {I==130, J==33, N1H==64, N2==128}

         DO 500 I = 1, N2                                               0773

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128}

            DO 510 J = 1, N1H                                           0774

C  P(I,J,N1H,N2) {N1H==64, N2==128, 1<=I, I<=128, 1<=J, J<=64}

               CA(I,J) = CMPLX(-F*AIMAG(CA(I,J)), F*REAL(CA(I,J)))      0775

C  P(N1H,N2) {N1H==64, N2==128}

510            CONTINUE                                                 0776

C  P(N2) {N2==128}

            F = F+1.                                                    0777

C  P(N2) {N2==128}

500         CONTINUE                                                    0778

C  P(J,N1H,N2P) {J==65, N1H==64, N2P==129}

         DO 520 J = 1, N1H                                              0779

C  P(J,N1H,N2P) {N1H==64, N2P==129, 1<=J, J<=64}

            CA(N2P,J) = 0.                                              0780

C  P(N1H) {N1H==64}

520         CONTINUE                                                    0781

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXSCSC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL SCSC(CA, EX, WORK)                                        0782

C  P(LZY,MEMSIZ,NW,NXXOUT) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120, NWH+1<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX<=7LTN+121,
C    NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX, KZY<=8LTN+120,
C    7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL OUT(CA, LZY, NW)                                          0783

C  P(LTN,MEMSIZ,NW,NXXXIN) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120, NWH+1<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX<=7LTN+121,
C    NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX, KZY<=8LTN+120,
C    7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL IN(CA, LTN, NW)                                           0784

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL ACAC(CA, EX, WORK)                                        0785

C  P(LTN,MEMSIZ,NW,NXXOUT) {KPN+4LTN==KZX+4, KPY+LTN==KZX+1,
C    KZN+7LTN==KZY+7, KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPN==2LTN-1, LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3,
C    3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119,
C    LTN==NW+1, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120, NWH+1<=KZN,
C    KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX<=7LTN+121,
C    NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX, KZY<=8LTN+120,
C    7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN, LTN<=20624, 2NWH+1<=LTN,
C    LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         CALL OUT(CA, LTN, NW)                                          0786

C  P(N1,NPTS) {N1==128, NPTS==256}

         NPTS = N1                                                      0787

C  P(N2P,NSKIP) {N2P==129, NSKIP==1}

         NSKIP = N2P                                                    0788

C  P(MTRN,N2P) {MTRN==64, N2P==129}

         MTRN = N2P                                                     0789

C  P(MSKIP) {MSKIP==129}

         MSKIP = 1                                                      0790

C  P(LOG,NPTS,NXLOG2) {NPTS==128}

         CALL XLOG2(NPTS, LOG)                                          0791

C  P(IEXSHF,NMAX2,NPTS) {NPTS==128, 256<=NMAX2}

         IEXSHF = NMAX2/NPTS                                            0792

C  P(IEXSHF,ISIGN,KPP,KTP,LOG,LTN,MEMSIZ,MSKIP,MTRN,N1H,N2PD,NFTVMT,
C    NPTS,NSKIP,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,NXXXIN,
C    TEMPHY:NCALL) {ISIGN==1, KPN+4LTN==KZX+4, KPP==249,
C    KPY+LTN==KZX+1, KTP==50, KZN+7LTN==KZY+7, KZO+4LTN==KZY+4,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2, 6LTN==LZX+5, 7LTN==LZY+6,
C    8LTN==MEMSIZ-119, LTN==NW+1, MSKIP==1, MTRN==129, N1H==64,
C    N2PD==258, NPTS==128, NSKIP==129, NUMBER==250, KPN<=8LTN+120,
C    NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY, 4LTN+318<=KTO,
C    KTO<=8LTN+120, KZN<=8LTN+120, NWH+1<=KZN, KZO<=8LTN+120,
C    NWH+1<=KZO, KZX<=8LTN+120, KZX<=7LTN+121, NWQ+2<=KZX+LTN,
C    6LTN+NWQ<=KZX+2, NWQ+1<=KZX, KZY<=8LTN+120, 7LTN+NWH<=KZY+5,
C    NWH+1<=KZY, 2<=LTN, LTN<=20624, 2NWH+1<=LTN, LTN<=2NWH+2,
C    4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH, 1<=NWQ}

         IF (NSTEPS.EQ.1) THEN                                          0793

C  P(IEXSHF,ISIGN,LOG,LTN,MEMSIZ,MSKIP,MTRN,N1H,N2PD,NFTVMT,NPTS,
C    NSKIP,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {ISIGN==1, KPN+4LTN==KZX+4, KPY+LTN==KZX+1, KZN+7LTN==KZY+7,
C    KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, MSKIP==1,
C    MTRN==129, N1H==64, N2PD==258, NPTS==128, NSKIP==129, NSTEPS==1,
C    NUMBER==250, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120,
C    NWH+1<=KZN, KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    KZY<=8LTN+120, 7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH,
C    1<=NWQ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, 0)                      0794

         ELSEIF (MOD(NSTEPS, KTP).EQ.1.OR.MOD(NSTEPS, KPP).EQ.1) THEN   0793

C  P(IEXSHF,ISIGN,LOG,LTN,MEMSIZ,MSKIP,MTRN,N1H,N2PD,NFTVMT,NPTS,
C    NSKIP,NSTEPS,NUMBER,NUSHUF,NXPRNT,NXXCSR,NXXXIN,TEMPHY:NCALL)
C    {ISIGN==1, KPN+4LTN==KZX+4, KPY+LTN==KZX+1, KZN+7LTN==KZY+7,
C    KZO+4LTN==KZY+4, LARGE==8LTN+119, LEIG==8LTN-7, LPN==2LTN-1,
C    LPRESS==8LTN-7, LPY==5LTN-4, 4LTN==LTO+3, 3LTN==LZO+2,
C    6LTN==LZX+5, 7LTN==LZY+6, 8LTN==MEMSIZ-119, LTN==NW+1, MSKIP==1,
C    MTRN==129, N1H==64, N2PD==258, NPTS==128, NSKIP==129,
C    NUMBER==250, KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120,
C    NWQ+1<=KPY, 4LTN+318<=KTO, KTO<=8LTN+120, KZN<=8LTN+120,
C    NWH+1<=KZN, KZO<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX<=7LTN+121, NWQ+2<=KZX+LTN, 6LTN+NWQ<=KZX+2, NWQ+1<=KZX,
C    KZY<=8LTN+120, 7LTN+NWH<=KZY+5, NWH+1<=KZY, 2<=LTN, LTN<=20624,
C    2NWH+1<=LTN, LTN<=2NWH+2, 4NWQ+1<=LTN, LTN<=4NWQ+4, 1<=NWH,
C    1<=NWQ}

            CALL TEMPHY(A, N2PD, N1H, EX, WORK, -1)                     0798
         ENDIF

C  P() {}

C
C TEMPERATURE INFLUENCE:
C
         F = -FX                                                        0803

C  P(KZN,LZN) {LZN==1, NWH+1<=KZN, NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

         KZN = LZN                                                      0804

C  P(KZX,LZX) {NWQ+1<=KPN, NWQ+1<=KPY, NWQ+1<=KZX, 1<=NWQ}

         KZX = LZX                                                      0805

C  P(KTN,LTN) {LARGE==8LTN+119, LEIG==8LTN-7, LPRESS==8LTN-7,
C    LPY==5LTN-4, 4LTN==LTO+3, 8LTN==MEMSIZ-119}

         KTN = LTN                                                      0806

C  P() {}

         DTA = 0.5*ALPHA*DTT                                            0807

C  P(I,J,K,K2QJ,K2QM,KTN,KZN,KZX,MEMSIZ,N1Q,N2P,NWH,NXXOUT,NXXXIN)
C    {I==129, J==65, K==3, K2QJ==64, K2QM==32, 8KTN==LARGE-119,
C    8KTN==LEIG+7, 8KTN==LPRESS+7, 5KTN==LPY+4, KTN==LTN, 4KTN==LTO+3,
C    8KTN==MEMSIZ-119, KZN==1, KZX==LZX, N1Q==32, N2P==129,
C    NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

         DO 530 K = 1, 2                                                0808

C  P(KZN,MEMSIZ,NWH,NXXXIN) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1, 1<=K,
C    K<=2, K<=KZN, NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

            CALL IN(CA, KZN, NWH)                                       0809

C  P(KTN,MEMSIZ,NWH,NXXXIN) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1, 1<=K,
C    K<=2, K<=KZN, 1<=KZN, KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, NWH+1<=KZY,
C    1<=NWH}

            CALL IN(CA(1,K2Q), KTN, NWH)                                0810

C  P(I,J,K2QJ,K2QM,N1Q,N2P) {K2QM==32, N1Q==32, N2P==129}

            DO 540 J = 1, N1Q                                           0811

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

               K2QJ = J+K2QM                                            0812

C  P(N1Q) {N1Q==32}

               F = F+FX                                                 0813

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=J, J<=32}

               DO 550 I = 1, N2P                                        0814

C  P(I,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    1<=J, J<=32}

                  CA(I,K2QJ) = CMPLX(-F*AIMAG(CA(I,K2QJ)), F*REAL(CA(   0815
     &            I,K2QJ)))                                             0815

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    1<=J, J<=32}

                  CA(I,J) = CA(I,J)+DTA*CA(I,K2QJ)                      0817

C  P(N1Q,N2P) {N1Q==32, N2P==129}

550               CONTINUE                                              0818

C  P(N1Q) {N1Q==32}

540            CONTINUE                                                 0819

C  P(KZN,MEMSIZ,NWH,NXXOUT) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1, 1<=K,
C    K<=2, K<=KZN, 1<=KTN, KTN+NWH<=MEMSIZ+1, 1<=KZN,
C    KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

            CALL OUT(CA, KZN, NWH)                                      0820

C  P(KZX,MEMSIZ,NWH,NXXOUT) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1, 1<=K,
C    K<=2, K<=KZN, 1<=KTN, KTN+NWH<=MEMSIZ+1, 1<=KZN,
C    KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, NWH+1<=KZY, 1<=NWH}

            CALL OUT(CA(1,K2Q), KZX, NWH)                               0821

C  P(KZX,NWH) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1, 1<=K,
C    K<=2, K<=KZN, 1<=KTN, KTN+NWH<=MEMSIZ+1, 1<=KZN,
C    KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, 1<=KZX, KZX+NWH<=MEMSIZ+1,
C    NWH+1<=KZY, 1<=NWH}

            KZX = KZX+NWH                                               0822

C  P(KTN,NWH) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX+NWH==KZX+1,
C    1<=K, K<=2, K<=KZN, 1<=KTN, KTN+NWH<=MEMSIZ+1, 1<=KZN,
C    KZN+NWH<=MEMSIZ+1, NWH+1<=KZO, KZX<=MEMSIZ+1, NWH+1<=KZX,
C    NWH+1<=KZY, 1<=NWH}

            KTN = KTN+NWH                                               0823

C  P(KZN,NWH) {8KZN+LARGE+8NWH==8KTN+127, 8KZN+LEIG+8NWH==8KTN+1,
C    8KZN+LPRESS+8NWH==8KTN+1, 5KZN+LPY+5NWH==5KTN+1,
C    KZN+LTN+NWH==KTN+1, 4KZN+LTO+4NWH==4KTN+1,
C    8KZN+MEMSIZ+8NWH==8KTN+127, KZN+LZX+NWH==KZX+1, 1<=K, K<=2,
C    K<=KZN, KTN<=MEMSIZ+1, NWH+1<=KTN, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    NWH+1<=KZO, KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=NWH}

            KZN = KZN+NWH                                               0824

C  P() {}

530         CONTINUE                                                    0825

C  P(LZX,MEMSIZ,NW,NXXXIN) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=NWH}

         CALL IN(A, LZX, NW)                                            0826

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

         CALL CSR(A, EX)                                                0827

C  P(LZX,MEMSIZ,NW,NXXOUT) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX, LZX+NW<=MEMSIZ+1,
C    1<=NW, 1<=NWH}

         CALL OUT(A, LZX, NW)                                           0828

C  P(LZY,MEMSIZ,NW,NXXXIN) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX, LZX+NW<=MEMSIZ+1,
C    1<=NW, 1<=NWH}

         CALL IN(A, LZY, NW)                                            0829

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXCSR) {ISIGN==1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

         CALL CSR(A, EX)                                                0830

C  P(LZY,MEMSIZ,NW,NXXOUT) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX, LZX+NW<=MEMSIZ+1,
C    1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH}

         CALL OUT(A, LZY, NW)                                           0831

C  P(KPN,LPN) {NWQ+1<=KPN, NWQ+1<=KPY, 1<=NWQ}

         KPN = LPN                                                      0832

C  P(KPY,LPY) {8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, 5KZN+LPY==5KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1,
C    NWQ+1<=KPY, KTN<=MEMSIZ+1, NWH+1<=KTN, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX,
C    LZX+NW<=MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH,
C    1<=NWQ}

         KPY = LPY                                                      0833

C  P(KZX,LZX) {KPY+5KZN==5KTN+1, KPY==LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZN+LZX==KZX+1,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZX<=MEMSIZ+1, NWH+1<=KZX, NWH+1<=KZY, 1<=LZX, LZX+NW<=MEMSIZ+1,
C    1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH}

         KZX = LZX                                                      0834

C  P(KZY,LZY) {KPY+5KZN==5KTN+1, KPY==LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX==LZX, KTN<=MEMSIZ+1,
C    NWH+1<=KTN, KZN+KZX<=MEMSIZ+2, NWH+2<=KZN+KZX, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, 1<=KZX, KZX+NW<=MEMSIZ+1, NWH+1<=KZY,
C    1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH}

         KZY = LZY                                                      0835

C  P(I,IPH,J,K,K1QM,K2QM,K3QM,KPN,KPY,KZX,KZY,MEMSIZ,N1E,N2PD,NWQ,
C    NXXOUT,NXXXIN) {I==130, IPH==129, J==33, K==3, K1QM==16,
C    K2QM==32, K3QM==48, KPN==LPN, KPY+5KZN==5KTN+1, KPY==LPY,
C    8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1,
C    KZN+LTN==KTN+1, 4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127,
C    KZX==LZX, KZY==LZY, N1E==16, N2PD==258, KTN<=MEMSIZ+1,
C    NWH+1<=KTN, KZN+KZX<=MEMSIZ+2, NWH+2<=KZN+KZX, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, 1<=KZX, KZX+NW<=MEMSIZ+1, 1<=KZY,
C    KZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

C
C IN PHYSICAL SPACE - FIND  (U,V).GRAD(T):
C
         DO 560 K = 1, 4                                                0839

C  P(KPY,MEMSIZ,NWQ,NXXXIN) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K,
C    K<=4, K+LZY<=KZY+1, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1,
C    1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(A, KPY, NWQ)                                        0840

C  P(KPN,MEMSIZ,NWQ,NXXXIN) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K,
C    K<=4, K+LZY<=KZY+1, 1<=KPY, KPY+NWQ<=MEMSIZ+1, KTN<=MEMSIZ+1,
C    NWH+1<=KTN, KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY,
C    KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY,
C    KZX+LZY+NW<=KZY+MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW,
C    1<=NWH, 1<=NWQ}

            CALL IN(A(1,K1Q), KPN, NWQ)                                 0841

C  P(KZY,MEMSIZ,NWQ,NXXXIN) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K,
C    K<=4, K+LZY<=KZY+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1, 1<=KPY,
C    KPY+NWQ<=MEMSIZ+1, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1,
C    1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(A(1,K2Q), KZY, NWQ)                                 0842

C  P(KZX,MEMSIZ,NWQ,NXXXIN) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K,
C    K<=4, K+LZY<=KZY+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1, 1<=KPY,
C    KPY+NWQ<=MEMSIZ+1, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1,
C    1<=KZY, KZY+NWQ<=MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW,
C    1<=NWH, 1<=NWQ}

            CALL IN(A(1,K3Q), KZX, NWQ)                                 0843

C  P(I,IPH,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258}

            DO 570 I = 1, N2PD                                          0844

C  P(I,IPH,N2PD) {N2PD==258, 1<=I, I<=258}

               IPH = (I+1)/2                                            0845

C  P(IPH,N2PD) {N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

               GG = G(IPH)                                              0846

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH}

               DO 580 J = 1, N1E                                        0847

C  P(I,J,K1QM,K2QM,K3QM,N1E,N2PD) {K1QM==16, K2QM==32, K3QM==48,
C    N1E==16, N2PD==258, 1<=I, I<=258, 2IPH<=I+1, I<=2IPH, 1<=J,
C    J<=16}

                  A(I,J) = A(I,J)*A(I,K3QM+J)-A(I,K1QM+J)*A(I,K2QM+J)   0848
     &            *GG                                                   0848

C  P(N1E,N2PD) {N1E==16, N2PD==258}

580               CONTINUE                                              0850

C  P(N2PD) {N2PD==258}

570            CONTINUE                                                 0851

C  P(KZY,MEMSIZ,NWQ,NXXOUT) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K,
C    K<=4, K+LZY<=KZY+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1, 1<=KPY,
C    KPY+NWQ<=MEMSIZ+1, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, 1<=KZX, KZY+1<=KZX+LZY,
C    KZX+LZY+NW<=KZY+MEMSIZ+1, KZX+NWQ<=MEMSIZ+1, 1<=KZY,
C    KZY+NWQ<=MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH,
C    1<=NWQ}

            CALL OUT(A, KZY, NWQ)                                       0852

C  P(KPN,NWQ) {KPN+LZY==KZY+LPN, KPY+5KZN+LZY==5KTN+KZY+1,
C    KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1, 4KZN+LTO==4KTN+1,
C    8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K, K<=4,
C    K+LZY<=KZY+1, 1<=KPN, KPN+NWQ<=MEMSIZ+1, 1<=KPY,
C    KPY+NWQ<=MEMSIZ+1, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, 1<=KZX, KZY+1<=KZX+LZY,
C    KZX+LZY+NW<=KZY+MEMSIZ+1, KZX+NWQ<=MEMSIZ+1, 1<=KZY,
C    KZY+NWQ<=MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH,
C    1<=NWQ}

            KPN = KPN+NWQ                                               0853

C  P(KPY,NWQ) {KZY+LPN+NWQ==KPN+LZY, KPY+5KZN+LZY==5KTN+KZY+1,
C    KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1, 4KZN+LTO==4KTN+1,
C    8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K, K<=4,
C    K+LZY<=KZY+1, KPN<=MEMSIZ+1, NWQ+1<=KPN, 1<=KPY,
C    KPY+NWQ<=MEMSIZ+1, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, 1<=KZX, KZY+1<=KZX+LZY,
C    KZX+LZY+NW<=KZY+MEMSIZ+1, KZX+NWQ<=MEMSIZ+1, 1<=KZY,
C    KZY+NWQ<=MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH,
C    1<=NWQ}

            KPY = KPY+NWQ                                               0854

C  P(KZX,NWQ) {KZY+LPN+NWQ==KPN+LZY, KPY+5KZN+LZY==5KTN+KZY+NWQ+1,
C    KZY+LPY+NWQ==KPY+LZY, 8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1, 4KZN+LTO==4KTN+1,
C    8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, 1<=K, K<=4,
C    K+LZY<=KZY+1, KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1,
C    NWQ+1<=KPY, KTN<=MEMSIZ+1, NWH+1<=KTN, KZN+KZX+LZY<=KZY+MEMSIZ+2,
C    KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    1<=KZX, KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1,
C    KZX+NWQ<=MEMSIZ+1, 1<=KZY, KZY+NWQ<=MEMSIZ+1, 1<=LZY,
C    LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

            KZX = KZX+NWQ                                               0855

C  P(KZY,NWQ) {KZY+LPN+NWQ==KPN+LZY, KPY+5KZN+LZY==5KTN+KZY+NWQ+1,
C    KZY+LPY+NWQ==KPY+LZY, 8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1, 4KZN+LTO==4KTN+1,
C    8KZN+MEMSIZ==8KTN+127, KZY+LZX+NWQ==KZX+LZY, 1<=K, K<=4,
C    K+LZY<=KZY+1, KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1,
C    NWQ+1<=KPY, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+NWQ+2, KZY+NWH+NWQ+2<=KZN+KZX+LZY,
C    KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZX+LZY+NW<=KZY+MEMSIZ+NWQ+1, KZY+NWQ+1<=KZX+LZY, KZX<=MEMSIZ+1,
C    NWQ+1<=KZX, 1<=KZY, KZY+NWQ<=MEMSIZ+1, 1<=LZY, LZY+NW<=MEMSIZ+1,
C    1<=NW, 1<=NWH, 1<=NWQ}

            KZY = KZY+NWQ                                               0856

C  P() {}

560         CONTINUE                                                    0857

C  P(ISIGN) {ISIGN==1}

         ISIGN = -1                                                     0858

C  P(LZY,MEMSIZ,NW,NXXXIN) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX,
C    KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN+KZX+LZY<=KZY+MEMSIZ+2,
C    KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1, KZX<=MEMSIZ+1,
C    NWQ+1<=KZX, LZY+NWQ+3<=KZY, KZY<=MEMSIZ+1, NWQ+1<=KZY, 1<=LZY,
C    LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL IN(A, LZY, NW)                                            0859

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXXRCS) {ISIGN==-1, MSKIP==1, MTRN==129, NPTS==128, NSKIP==129,
C    NUMBER==250}

         CALL RCS(A, EX)                                                0860

C  P(LZY,MEMSIZ,NW,NXXOUT) {KPN+LZY==KZY+LPN,
C    KPY+5KZN+LZY==5KTN+KZY+1, KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX,
C    KPN<=MEMSIZ+1, NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KZN+KZX+LZY<=KZY+MEMSIZ+2,
C    KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1, NWH+2<=KZN, NWH+1<=KZO,
C    KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1, KZX<=MEMSIZ+1,
C    NWQ+1<=KZX, LZY+NWQ+3<=KZY, KZY<=MEMSIZ+1, NWQ+1<=KZY, 1<=LZY,
C    LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL OUT(A, LZY, NW)                                           0861

C  P(KTN,LTN) {KPN+LZY==KZY+LPN, KPY+5KZN+LZY==5KTN+KZY+1,
C    KPY+LZY==KZY+LPY, 8KZN+LARGE==8KTN+127, 8KZN+LEIG==8KTN+1,
C    8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1, 4KZN+LTO==4KTN+1,
C    8KZN+MEMSIZ==8KTN+127, KZX+LZY==KZY+LZX, KPN<=MEMSIZ+1,
C    NWQ+1<=KPN, KPY<=MEMSIZ+1, NWQ+1<=KPY, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KZN+KZX+LZY<=KZY+MEMSIZ+2, KZY+NWH+2<=KZN+KZX+LZY, KZN<=MEMSIZ+1,
C    NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY, KZX+LZY+NW<=KZY+MEMSIZ+1,
C    KZX<=MEMSIZ+1, NWQ+1<=KZX, LZY+NWQ+3<=KZY, KZY<=MEMSIZ+1,
C    NWQ+1<=KZY, 1<=LZY, LZY+NW<=MEMSIZ+1, 1<=NW, 1<=NWH, 1<=NWQ}

         KTN = LTN                                                      0862

C  P(KTO,LTO) {KPN+LZY==KZY+LPN, KPY+LZY==5KTN+KZY-4,
C    KPY+LZY==KZY+LPY, 8KTN==LARGE-119, 8KTN==LEIG+7, 8KTN==LPRESS+7,
C    KTN==LTN, 4KTN==LTO+3, 8KTN==MEMSIZ-119, KZX+LZY==KZY+LZX,
C    KPN<=8KTN+120, NWQ+1<=KPN, KPY<=8KTN+120, NWQ+1<=KPY,
C    KZN<=8KTN+120, KZN<=7KTN+121, KZN+KZX+LZY<=8KTN+KZY+121,
C    NWH+2<=KTN+KZN, KZX<=8KTN+120, KZX+LZY+NW<=8KTN+KZY+120,
C    KZY<=8KTN+120, LZY+NW<=8KTN+120, KZY+NWH+2<=KZN+KZX+LZY,
C    NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY, NWQ+1<=KZX,
C    LZY+NWQ+3<=KZY, NWQ+1<=KZY, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         KTO = LTO                                                      0863

C  P(KZY,LZY) {KPN+LZY==KZY+LPN, KPY+LZY==5KTN+KZY-4,
C    KPY+LZY==KZY+LPY, 4KTN==KTO+3, 8KTN==LARGE-119, 8KTN==LEIG+7,
C    8KTN==LPRESS+7, KTN==LTN, 4KTN==LTO+3, 8KTN==MEMSIZ-119,
C    KZX+LZY==KZY+LZX, KPN<=8KTN+120, NWQ+1<=KPN, KPY<=8KTN+120,
C    NWQ+1<=KPY, KZN<=8KTN+120, KZN<=7KTN+121,
C    KZN+KZX+LZY<=8KTN+KZY+121, NWH+2<=KTN+KZN, KZX<=8KTN+120,
C    KZX+LZY+NW<=8KTN+KZY+120, KZY<=8KTN+120, LZY+NW<=8KTN+120,
C    KZY+NWH+2<=KZN+KZX+LZY, NWH+2<=KZN, NWH+1<=KZO, KZY+1<=KZX+LZY,
C    NWQ+1<=KZX, LZY+NWQ+3<=KZY, NWQ+1<=KZY, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         KZY = LZY                                                      0864

C  P(I,J,K,K2Q,K2QJ,K2QM,KTN,KTO,KZY,MEMSIZ,N1H,N1Q,N2P,N2PD,NWH,
C    NXXOUT,NXXXIN) {I==259, J==17, K==5, K2Q==33, K2QJ==64, K2QM==32,
C    KPN+LZX==KZX+LPN, KPY+LZX==5KTN+KZX-4, KPY+LZX==KZX+LPY,
C    4KTN==KTO+3, 8KTN==LARGE-119, 8KTN==LEIG+7, 8KTN==LPRESS+7,
C    KTN==LTN, 4KTN==LTO+3, 8KTN==MEMSIZ-119, KZY==LZY, N1H==64,
C    N1Q==32, N2P==129, N2PD==258, KPN<=8KTN+120, NWQ+1<=KPN,
C    KPY<=8KTN+120, NWQ+1<=KPY, KZN<=8KTN+120, KZN<=7KTN+121,
C    KZN+LZX<=8KTN+121, NWH+2<=KTN+KZN, KZX<=8KTN+120,
C    KZX+KZY<=8KTN+LZX+120, KZY+NW<=8KTN+120, LZX+NW<=8KTN+120,
C    NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+KZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY, 1<=LZX, 1<=NW, 1<=NWH,
C    1<=NWQ}

         DO 590 K = 1, 2                                                0865

C  P(KTO,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZY+LZX==5KTN+KZX+5LZY-4, KPY+LZX==KZX+LPY,
C    4KTN+3LZY==KTO+3KZY+3, 8KTN+8LZY==8KZY+LARGE-119,
C    8KTN+8LZY==8KZY+LEIG+7, 8KTN+8LZY==8KZY+LPRESS+7,
C    KTN+LZY==KZY+LTN, 4KTN+4LZY==4KZY+LTO+3,
C    8KTN+8LZY==8KZY+MEMSIZ-119, 1<=K, K<=2, K+LZY<=KZY+1,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, KZN+8KZY+LZX<=8KTN+8LZY+121, KZN+8KZY<=8KTN+8LZY+120,
C    KZN+7KZY<=7KTN+7LZY+121, KZY+NWH+2<=KTN+KZN+LZY,
C    KZX+8KZY<=8KTN+LZX+7LZY+120, KZX+8KZY<=8KTN+8LZY+120,
C    8KZY+LZX+NW<=8KTN+8LZY+120, 8KZY+NW<=8KTN+7LZY+120,
C    NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

            CALL IN(CA, KTO, NWH)                                       0866

C  P(KTN,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZY+LZX==5KTN+KZX+5LZY-4, KPY+LZX==KZX+LPY,
C    4KTN+3LZY==KTO+3KZY+3, 8KTN+8LZY==8KZY+LARGE-119,
C    8KTN+8LZY==8KZY+LEIG+7, 8KTN+8LZY==8KZY+LPRESS+7,
C    KTN+LZY==KZY+LTN, 4KTN+4LZY==4KZY+LTO+3,
C    8KTN+8LZY==8KZY+MEMSIZ-119, 1<=K, K<=2, K+LZY<=KZY+1,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, KZN+8KZY+LZX<=8KTN+8LZY+121, KZN+8KZY<=8KTN+8LZY+120,
C    KZN+7KZY<=7KTN+7LZY+121, KZY+NWH+2<=KTN+KZN+LZY,
C    KZX+8KZY<=8KTN+LZX+7LZY+120, KZX+8KZY<=8KTN+8LZY+120,
C    8KZY+LZX+NW<=8KTN+8LZY+120, 8KZY+NW<=8KTN+7LZY+120, 1<=KTO,
C    KTO+NWH<=MEMSIZ+1, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(A(1,K2Q), KTN, NWH)                                 0867

C  P(I,J,K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258}

            DO 600 J = K2Q, N1H                                         0868

C  P(I,J,K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258, 33<=J, J<=64}

               DO 610 I = 1, N2PD                                       0869

C  P(I,J,K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258, 1<=I, I<=258,
C    33<=J, J<=64}

                  A(I,J) = 0.5*A(I,J)                                   0870

C  P(K2Q,N1H,N2PD) {K2Q==33, N1H==64, N2PD==258}

610               CONTINUE                                              0871

C  P(K2Q,N1H) {K2Q==33, N1H==64}

600            CONTINUE                                                 0872

C  P(KTO,MEMSIZ,NWH,NXXOUT) {KPN+LZX==KZX+LPN,
C    KPY+5KZY+LZX==5KTN+KZX+5LZY-4, KPY+LZX==KZX+LPY,
C    4KTN+3LZY==KTO+3KZY+3, 8KTN+8LZY==8KZY+LARGE-119,
C    8KTN+8LZY==8KZY+LEIG+7, 8KTN+8LZY==8KZY+LPRESS+7,
C    KTN+LZY==KZY+LTN, 4KTN+4LZY==4KZY+LTO+3,
C    8KTN+8LZY==8KZY+MEMSIZ-119, 1<=K, K<=2, K+LZY<=KZY+1,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, 1<=KTN, KZN+8KZY+LZX<=8KTN+8LZY+121,
C    KZN+8KZY<=8KTN+8LZY+120, KZN+7KZY<=7KTN+7LZY+121,
C    KZY+NWH+2<=KTN+KZN+LZY, KZX+8KZY<=8KTN+LZX+7LZY+120,
C    KZX+8KZY<=8KTN+8LZY+120, 8KZY+LZX+NW<=8KTN+8LZY+120,
C    8KZY+NW<=8KTN+7LZY+120, KTN+NWH<=MEMSIZ+1, 1<=KTO,
C    KTO+NWH<=MEMSIZ+1, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

            CALL OUT(A(1,K2Q), KTO, NWH)                                0873

C  P(KZY,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZY+LZX==5KTN+KZX+5LZY-4, KPY+LZX==KZX+LPY,
C    4KTN+3LZY==KTO+3KZY+3, 8KTN+8LZY==8KZY+LARGE-119,
C    8KTN+8LZY==8KZY+LEIG+7, 8KTN+8LZY==8KZY+LPRESS+7,
C    KTN+LZY==KZY+LTN, 4KTN+4LZY==4KZY+LTO+3,
C    8KTN+8LZY==8KZY+MEMSIZ-119, 1<=K, K<=2, K+LZY<=KZY+1,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, 1<=KTN, KZN+8KZY+LZX<=8KTN+8LZY+121,
C    KZN+8KZY<=8KTN+8LZY+120, KZN+7KZY<=7KTN+7LZY+121,
C    KZY+NWH+2<=KTN+KZN+LZY, KZX+8KZY<=8KTN+LZX+7LZY+120,
C    KZX+8KZY<=8KTN+8LZY+120, 8KZY+LZX+NW<=8KTN+8LZY+120,
C    8KZY+NW<=8KTN+7LZY+120, KTN+NWH<=MEMSIZ+1, 1<=KTO,
C    KTO+NWH<=MEMSIZ+1, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(CA(1,K2Q), KZY, NWH)                                0874

C  P(I,J,K2QJ,K2QM,N1Q,N2P) {I==259, J==65, K2QM==32, N1Q==32,
C    N2P==129}

            DO 620 J = 1, N1Q                                           0875

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

               K2QJ = J+K2QM                                            0876

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=J, J<=32}

               DO 630 I = 1, N2P                                        0877

C  P(I,J,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    1<=J, J<=32}

                  CA(I,J) = CA(I,J)+DTFAC*CA(I,K2QJ)                    0878

C  P(N1Q,N2P) {N1Q==32, N2P==129}

630               CONTINUE                                              0879

C  P(N1Q) {N1Q==32}

620            CONTINUE                                                 0880

C  P(KTN,MEMSIZ,NWH,NXXOUT) {KPN+LZX==KZX+LPN,
C    KPY+5KZY+LZX==5KTN+KZX+5LZY-4, KPY+LZX==KZX+LPY,
C    4KTN+3LZY==KTO+3KZY+3, 8KTN+8LZY==8KZY+LARGE-119,
C    8KTN+8LZY==8KZY+LEIG+7, 8KTN+8LZY==8KZY+LPRESS+7,
C    KTN+LZY==KZY+LTN, 4KTN+4LZY==4KZY+LTO+3,
C    8KTN+8LZY==8KZY+MEMSIZ-119, 1<=K, K<=2, K+LZY<=KZY+1,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, 1<=KTN, KZN+8KZY+LZX<=8KTN+8LZY+121,
C    KZN+8KZY<=8KTN+8LZY+120, KZN+7KZY<=7KTN+7LZY+121,
C    KZY+NWH+2<=KTN+KZN+LZY, KZX+8KZY<=8KTN+LZX+7LZY+120,
C    KZX+8KZY<=8KTN+8LZY+120, 8KZY+LZX+NW<=8KTN+8LZY+120,
C    8KZY+NW<=8KTN+7LZY+120, KTN+NWH<=MEMSIZ+1, 1<=KTO,
C    KTO+NWH<=MEMSIZ+1, NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY,
C    KZY+NWH<=MEMSIZ+1, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL OUT(CA, KTN, NWH)                                      0881

C  P(KTN,NWH) {KPN+LZX==KZX+LPN, KPY+5KZY+LZX==5KTN+KZX+5LZY-4,
C    KPY+LZX==KZX+LPY, 4KTN+3LZY==KTO+3KZY+3,
C    8KTN+8LZY==8KZY+LARGE-119, 8KTN+8LZY==8KZY+LEIG+7,
C    8KTN+8LZY==8KZY+LPRESS+7, KTN+LZY==KZY+LTN,
C    4KTN+4LZY==4KZY+LTO+3, 8KTN+8LZY==8KZY+MEMSIZ-119, 1<=K, K<=2,
C    K+LZY<=KZY+1, KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN,
C    KPY+8KZY<=8KTN+8LZY+120, NWQ+1<=KPY, 1<=KTN,
C    KZN+8KZY+LZX<=8KTN+8LZY+121, KZN+8KZY<=8KTN+8LZY+120,
C    KZN+7KZY<=7KTN+7LZY+121, KZY+NWH+2<=KTN+KZN+LZY,
C    KZX+8KZY<=8KTN+LZX+7LZY+120, KZX+8KZY<=8KTN+8LZY+120,
C    8KZY+LZX+NW<=8KTN+8LZY+120, 8KZY+NW<=8KTN+7LZY+120,
C    KTN+NWH<=MEMSIZ+1, 1<=KTO, KTO+NWH<=MEMSIZ+1, NWH+2<=KZN+LZX,
C    NWH+2<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, 1<=KZY, KZY+NWH<=MEMSIZ+1, 1<=LZX, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

            KTN = KTN+NWH                                               0882

C  P(KTO,NWH) {KPN+LZX==KZX+LPN, KPY+5KZY+LZX+5NWH==5KTN+KZX+5LZY-4,
C    KPY+LZX==KZX+LPY, KTO+3KZY+4NWH==4KTN+3LZY-3,
C    8KZY+LARGE+8NWH==8KTN+8LZY+119, 8KZY+LEIG+8NWH==8KTN+8LZY-7,
C    8KZY+LPRESS+8NWH==8KTN+8LZY-7, KZY+LTN+NWH==KTN+LZY,
C    4KZY+LTO+4NWH==4KTN+4LZY-3, 8KZY+MEMSIZ+8NWH==8KTN+8LZY+119,
C    1<=K, K<=2, K+LZY<=KZY+1, KPN+8KZY+8NWH<=8KTN+8LZY+120,
C    NWQ+1<=KPN, KPY+8KZY+8NWH<=8KTN+8LZY+120, NWQ+1<=KPY,
C    KZN+8KZY+LZX+8NWH<=8KTN+8LZY+121, KZN+8KZY+8NWH<=8KTN+8LZY+120,
C    KZN+7KZY+7NWH<=7KTN+7LZY+121, KZY+2NWH+2<=KTN+KZN+LZY,
C    KZX+8KZY+8NWH<=8KTN+LZX+7LZY+120, KZX+8KZY+8NWH<=8KTN+8LZY+120,
C    8KZY+LZX+NW+8NWH<=8KTN+8LZY+120, 8KZY+NW+8NWH<=8KTN+7LZY+120,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, 1<=KTO, KTO+NWH<=MEMSIZ+1,
C    NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY, KZY+NWH<=MEMSIZ+1, 1<=LZX,
C    1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KTO = KTO+NWH                                               0883

C  P(KZY,NWH) {KPN+LZX==KZX+LPN, KPY+5KZY+LZX+5NWH==5KTN+KZX+5LZY-4,
C    KPY+LZX==KZX+LPY, KTO+3KZY+3NWH==4KTN+3LZY-3,
C    8KZY+LARGE+8NWH==8KTN+8LZY+119, 8KZY+LEIG+8NWH==8KTN+8LZY-7,
C    8KZY+LPRESS+8NWH==8KTN+8LZY-7, KZY+LTN+NWH==KTN+LZY,
C    4KZY+LTO+4NWH==4KTN+4LZY-3, 8KZY+MEMSIZ+8NWH==8KTN+8LZY+119,
C    1<=K, K<=2, K+LZY<=KZY+1, KPN+8KZY+8NWH<=8KTN+8LZY+120,
C    NWQ+1<=KPN, KPY+8KZY+8NWH<=8KTN+8LZY+120, NWQ+1<=KPY,
C    KZN+8KZY+LZX+8NWH<=8KTN+8LZY+121, KZN+8KZY+8NWH<=8KTN+8LZY+120,
C    KZN+7KZY+7NWH<=7KTN+7LZY+121, KZY+2NWH+2<=KTN+KZN+LZY,
C    KZX+8KZY+8NWH<=8KTN+LZX+7LZY+120, KZX+8KZY+8NWH<=8KTN+8LZY+120,
C    8KZY+LZX+NW+8NWH<=8KTN+8LZY+120, 8KZY+NW+8NWH<=8KTN+7LZY+120,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, 1<=KZY, KZY+NWH<=MEMSIZ+1, 1<=LZX,
C    1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KZY = KZY+NWH                                               0884

C  P() {}

590         CONTINUE                                                    0885
      ENDIF

C  P() {}


      DTF = 0.25*DTT*FX                                                 0888

C  P() {}

      F = -DTF                                                          0889

C  P(KZN,LZN) {KPN+LZX==KZX+LPN, KPY+5KZY+LZX==5KTN+KZX+5LZY-4,
C    KPY+LZX==KZX+LPY, 4KTN+3LZY==KTO+3KZY+3,
C    8KTN+8LZY==8KZY+LARGE-119, 8KTN+8LZY==8KZY+LEIG+7,
C    8KTN+8LZY==8KZY+LPRESS+7, KTN+LZY==KZY+LTN,
C    4KTN+4LZY==4KZY+LTO+3, 8KTN+8LZY==8KZY+MEMSIZ-119, LZN==1,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, KZN+8KZY+LZX<=8KTN+8LZY+121, KZN+8KZY<=8KTN+8LZY+120,
C    KZN+7KZY<=7KTN+7LZY+121, KZY+NWH+2<=KTN+KZN+LZY,
C    KZX+8KZY<=8KTN+LZX+7LZY+120, KZX+8KZY<=8KTN+8LZY+120,
C    8KZY+LZX+NW<=8KTN+8LZY+120, 8KZY+NW<=8KTN+7LZY+120,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, KTO<=MEMSIZ+1, NWH+1<=KTO,
C    NWH+2<=KZN+LZX, NWH+2<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, LZY+NWH+1<=KZY, KZY<=MEMSIZ+1,
C    NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

      KZN = LZN                                                         0890

C  P(KTN,LTN) {KPN+LZX==KZX+LPN, KPY+5KZY+LZX==5KTN+KZX+5LZY-4,
C    KPY+LZX==KZX+LPY, 4KTN+3LZY==KTO+3KZY+3,
C    8KTN+8LZY==8KZY+LARGE-119, 8KTN+8LZY==8KZY+LEIG+7,
C    8KTN+8LZY==8KZY+LPRESS+7, KTN+LZY==KZY+LTN,
C    4KTN+4LZY==4KZY+LTO+3, 8KTN+8LZY==8KZY+MEMSIZ-119,
C    KPN+8KZY<=8KTN+8LZY+120, NWQ+1<=KPN, KPY+8KZY<=8KTN+8LZY+120,
C    NWQ+1<=KPY, KZX+8KZY<=8KTN+LZX+7LZY+120, KZX+8KZY<=8KTN+8LZY+120,
C    8KZY+LZX+NW<=8KTN+8LZY+120, 9KZY+LZX+NWH<=9KTN+9LZY+119,
C    8KZY+NWH<=8KTN+LZX+8LZY+118, 8KZY+LZX+NWH<=8KTN+8LZY+119,
C    7KZY+NWH<=7KTN+LZX+7LZY+119, 8KZY+NW<=8KTN+7LZY+120,
C    9KZY+NWH<=9KTN+9LZY+118, 8KZY+NWH<=8KTN+8LZY+118,
C    7KZY+NWH<=7KTN+7LZY+119, KTN<=MEMSIZ+1, NWH+1<=KTN,
C    KTO<=MEMSIZ+1, NWH+1<=KTO, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, LZY+NWH+1<=KZY, KZY<=MEMSIZ+1,
C    NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

      KTN = LTN                                                         0891

C  P(I,J,K,K2QJ,K2QM,KTN,KZN,MEMSIZ,N1Q,N2P,NOTEMP,NWH,NXXOUT,NXXXIN)
C    {I==130, J==33, K==3, K2QJ==64, K2QM==32, KPN+LZX==KZX+LPN,
C    KPY+LZX==5KTN+KZX-4, KPY+LZX==KZX+LPY, 4KTN+KZY==KTO+LZY+3,
C    8KTN==LARGE-119, 8KTN==LEIG+7, 8KTN==LPRESS+7, KTN==LTN,
C    4KTN==LTO+3, 8KTN==MEMSIZ-119, KZN==1, N1Q==32, N2P==129,
C    NOTEMP==0, KPN<=8KTN+120, NWQ+1<=KPN, KPY<=8KTN+120, NWQ+1<=KPY,
C    KTO<=8KTN+120, KZX<=8KTN+120, KZX+LZY<=8KTN+LZX+120,
C    KZY<=8KTN+120, KZY<=7KTN+LZY+120, LZY+NWH+1<=KTN+KZY,
C    LZX+NW<=8KTN+120, LZX+NWH<=9KTN+119, NWH<=8KTN+LZX+118,
C    LZX+NWH<=8KTN+119, NWH<=7KTN+LZX+119, LZY+NW<=8KTN+120,
C    NWH<=9KTN+118, NWH<=8KTN+118, NWH<=7KTN+119, NWH+1<=KTO,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

      DO 640 K = 1, 2                                                   0892

C  P(KTN,MEMSIZ,NOTEMP,NWH,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, NOTEMP==0, 1<=K, K<=2,
C    K<=KZN, KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128,
C    NWQ+1<=KPY, KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    NWH+1<=KTO, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW,
C    1<=NWH, 1<=NWQ}

         IF (NOTEMP.NE.1) CALL IN(CA, KTN, NWH)                         0893

C  P(KZN,MEMSIZ,NWH,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, 1<=K, K<=2, K<=KZN,
C    KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY,
C    1<=KTN, KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN+NWH<=MEMSIZ+1, NWH+1<=KTO, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX,
C    1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL IN(CA(1,K2Q), KZN, NWH)                                   0894

C  P(I,J,K2QJ,K2QM,N1Q,N2P,NOTEMP) {K2QM==32, N1Q==32, N2P==129,
C    NOTEMP==0}

         DO 650 J = 1, N1Q                                              0895

C  P(J,K2QJ,K2QM,N1Q) {K2QM==32, N1Q==32, 1<=J, J<=32}

            K2QJ = J+K2QM                                               0896

C  P(N1Q) {N1Q==32}

            F = F+DTF                                                   0897

C  P(I,J,N1Q,N2P,NOTEMP) {J==K2QJ-32, N1Q==32, N2P==129, NOTEMP==0,
C    1<=J, J<=32}

            IF (NOTEMP.NE.1) THEN                                       0898

C  P(I,J,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=J, J<=32}

               DO 660 I = 1, N2P                                        0899

C  P(I,N1Q,N2P) {N1Q==32, N2P==129, 1<=I, I<=129}

                  WORK(I) = F*U(I)                                      0900

C  P(I,J,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129, 1<=J,
C    J<=32}

                  CA(I,J) = CMPLX(1.0, -WORK(I))*CA(I,J)/(1.0+WORK(I)   0901
     &            *WORK(I))                                             0901

C  P(N1Q,N2P) {N1Q==32, N2P==129}

660               CONTINUE                                              0903
            ENDIF

C  P(I,K2QJ,N1Q,N2P) {I==130, J==K2QJ-32, N1Q==32, N2P==129, 1<=J,
C    J<=32}


            DO 670 I = 1, N2P                                           0906

C  P(I,N1Q,N2P) {N1Q==32, N2P==129, 1<=I, I<=129}

               WORK(I) = F*U(I)                                         0907

C  P(I,K2QJ,N1Q,N2P) {J==K2QJ-32, N1Q==32, N2P==129, 1<=I, I<=129,
C    1<=J, J<=32}

               CA(I,K2QJ) = CMPLX(1.0, -WORK(I))*CA(I,K2QJ)/(1.0+WORK   0908
     &         (I)*WORK(I))                                             0908

C  P(N1Q,N2P) {N1Q==32, N2P==129}

670            CONTINUE                                                 0910

C  P(N1Q) {N1Q==32}

650         CONTINUE                                                    0911

C  P(KTN,MEMSIZ,NOTEMP,NWH,NXXOUT) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, NOTEMP==0, 1<=K, K<=2,
C    K<=KZN, KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128,
C    NWQ+1<=KPY, 1<=KTN, KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN+NWH<=MEMSIZ+1, NWH+1<=KTO, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         IF (NOTEMP.NE.1) CALL OUT(CA, KTN, NWH)                        0912

C  P(KZN,MEMSIZ,NWH,NXXOUT) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, 1<=K, K<=2, K<=KZN,
C    KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY,
C    1<=KTN, KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN+NWH<=MEMSIZ+1, NWH+1<=KTO, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         CALL OUT(CA(1,K2Q), KZN, NWH)                                  0913

C  P(KTN,NWH) {KPN+LZX==KZX+LPN, KPY+5KZN+LZX==5KTN+KZX+1,
C    KPY+LZX==KZX+LPY, KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, 1<=K, K<=2, K<=KZN,
C    KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY,
C    1<=KTN, KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN+NWH<=MEMSIZ+1, NWH+1<=KTO, 1<=KZN, KZN+NWH<=MEMSIZ+1,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         KTN = KTN+NWH                                                  0914

C  P(KZN,NWH) {KPN+LZX==KZX+LPN, KPY+5KZN+LZX+5NWH==5KTN+KZX+1,
C    KPY+LZX==KZX+LPY, KTO+4KZN+LZY+4NWH==4KTN+KZY+1,
C    8KZN+LARGE+8NWH==8KTN+127, 8KZN+LEIG+8NWH==8KTN+1,
C    8KZN+LPRESS+8NWH==8KTN+1, KZN+LTN+NWH==KTN+1,
C    4KZN+LTO+4NWH==4KTN+1, 8KZN+MEMSIZ+8NWH==8KTN+127, 1<=K, K<=2,
C    K<=KZN, KPN+8KZN+8NWH<=8KTN+128, NWQ+1<=KPN,
C    KPY+8KZN+8NWH<=8KTN+128, NWQ+1<=KPY, KTO+8KZN+8NWH<=8KTN+128,
C    8KZN+KZX+LZY+8NWH<=8KTN+LZX+128, 8KZN+KZX+8NWH<=8KTN+128,
C    7KZN+KZY+7NWH<=7KTN+LZY+127, KZN+LZY+2NWH<=KTN+KZY,
C    8KZN+KZY+8NWH<=8KTN+128, 8KZN+LZX+NW+8NWH<=8KTN+128,
C    9KZN+LZX+10NWH<=9KTN+128, 8KZN+9NWH<=8KTN+LZX+126,
C    8KZN+LZX+9NWH<=8KTN+127, 7KZN+8NWH<=7KTN+LZX+126,
C    8KZN+LZY+NW+8NWH<=8KTN+128, 9KZN+10NWH<=9KTN+127,
C    8KZN+9NWH<=8KTN+126, 7KZN+8NWH<=7KTN+126, KTN<=MEMSIZ+1,
C    NWH+1<=KTN, NWH+1<=KTO, 1<=KZN, KZN+NWH<=MEMSIZ+1, NWH+1<=KZO,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

         KZN = KZN+NWH                                                  0915

C  P() {}

640      CONTINUE                                                       0916

C  P(N2,NPTS) {N2==128, NPTS==128}

      NPTS = 2*N2                                                       0917

C  P(NSKIP) {NSKIP==129}

      NSKIP = 1                                                         0918

C  P(MTRN,N1H) {MTRN==129, N1H==64}

      MTRN = N1H                                                        0919

C  P(MSKIP,N2P) {MSKIP==1, N2P==129}

      MSKIP = N2P                                                       0920

C  P(ISIGN) {ISIGN==-1}

      ISIGN = -1                                                        0921

C  P(IEXSHF,NMAX2,NPTS) {NPTS==256, 256<=NMAX2}

      IEXSHF = NMAX2/NPTS                                               0922

C  P(LOG,NPTS,NXLOG2) {NPTS==256}

      CALL XLOG2(NPTS, LOG)                                             0923

C  P(LZN,MEMSIZ,NW,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, LZN==1,
C    KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY,
C    KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, NWH+1<=KTO, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

      CALL IN(A, LZN, NW)                                               0924

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

      CALL ACAC(A, EX, WORK)                                            0925

C  P(LZN,MEMSIZ,NW,NXXOUT) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, LZN==1,
C    KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY,
C    KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, NWH+1<=KTO, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, NW<=MEMSIZ, 1<=NW,
C    1<=NWH, 1<=NWQ}

      CALL OUT(A, LZN, NW)                                              0926

C  P(IEXSHF,ISIGN,LOG,LTN,MEMSIZ,MSKIP,MTRN,NFTVMT,NOTEMP,NPTS,NSKIP,
C    NSTEPS,NUMBER,NW,NXACAC,NXXOUT,NXXXIN) {ISIGN==-1,
C    KPN+LZX==KZX+LPN, KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, MSKIP==129, MTRN==64,
C    NOTEMP==0, NPTS==256, NSKIP==1, NUMBER==250, KPN+8KZN<=8KTN+128,
C    NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY, KTO+8KZN<=8KTN+128,
C    8KZN+KZX<=8KTN+128, 8KZN+KZX+LZY<=8KTN+LZX+128,
C    8KZN+KZY<=8KTN+128, 7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, NWH+1<=KTO, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, NW<=MEMSIZ, 1<=NW,
C    1<=NWH, 1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0927

C  P(LTN,MEMSIZ,NW,NXXXIN) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KPN+8KZN<=8KTN+128,
C    NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY, KTO+8KZN<=8KTN+128,
C    8KZN+KZX<=8KTN+128, 8KZN+KZX+LZY<=8KTN+LZX+128,
C    8KZN+KZY<=8KTN+128, 7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, NWH+1<=KTO, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LZX, 1<=LZY, NW<=MEMSIZ, 1<=NW,
C    1<=NWH, 1<=NWQ}

         CALL IN(A, LTN, NW)                                            0928

C  P(IEXSHF,ISIGN,LOG,MSKIP,MTRN,NFTVMT,NPTS,NSKIP,NSTEPS,NUMBER,
C    NXACAC) {ISIGN==-1, MSKIP==129, MTRN==64, NPTS==256, NSKIP==1,
C    NUMBER==250}

         CALL ACAC(A, EX, WORK)                                         0929

C  P(LTN,MEMSIZ,NW,NXXOUT) {KPN+LZX==KZX+LPN,
C    KPY+5KZN+LZX==5KTN+KZX+1, KPY+LZX==KZX+LPY,
C    KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, KPN+8KZN<=8KTN+128,
C    NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY, KTO+8KZN<=8KTN+128,
C    8KZN+KZX<=8KTN+128, 8KZN+KZX+LZY<=8KTN+LZX+128,
C    8KZN+KZY<=8KTN+128, 7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, NWH+1<=KTO, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=LZX,
C    1<=LZY, NW<=MEMSIZ, 1<=NW, 1<=NWH, 1<=NWQ}

         CALL OUT(A, LTN, NW)                                           0930
      ENDIF

C  P(KZN,LZN) {KPN+LZX==KZX+LPN, KPY+5KZN+LZX==5KTN+KZX+1,
C    KPY+LZX==KZX+LPY, KTO+4KZN+LZY==4KTN+KZY+1, 8KZN+LARGE==8KTN+127,
C    8KZN+LEIG==8KTN+1, 8KZN+LPRESS==8KTN+1, KZN+LTN==KTN+1,
C    4KZN+LTO==4KTN+1, 8KZN+MEMSIZ==8KTN+127, LZN==1,
C    KPN+8KZN<=8KTN+128, NWQ+1<=KPN, KPY+8KZN<=8KTN+128, NWQ+1<=KPY,
C    KTO+8KZN<=8KTN+128, 8KZN+KZX<=8KTN+128,
C    8KZN+KZX+LZY<=8KTN+LZX+128, 8KZN+KZY<=8KTN+128,
C    7KZN+KZY<=7KTN+LZY+127, KZN+LZY+NWH<=KTN+KZY,
C    8KZN+LZX+NW<=8KTN+128, 9KZN+LZX+NWH<=9KTN+128,
C    8KZN+NWH<=8KTN+LZX+126, 8KZN+LZX+NWH<=8KTN+127,
C    7KZN+NWH<=7KTN+LZX+126, 8KZN+LZY+NW<=8KTN+128,
C    9KZN+NWH<=9KTN+127, 8KZN+NWH<=8KTN+126, 7KZN+NWH<=7KTN+126,
C    KTN<=MEMSIZ+1, NWH+1<=KTN, NWH+1<=KTO, KZN<=MEMSIZ+1, NWH+2<=KZN,
C    NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LTN, LTN+NW<=MEMSIZ+1, 1<=LZX,
C    1<=LZY, NW<=MEMSIZ, 1<=NW, 1<=NWH, 1<=NWQ}


      KZN = LZN                                                         0933

C  P(KPN,LPN) {KPN+LZX==KZX+LPN, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    KPN<=8LTN+120, NWQ+1<=KPN, KPY<=8LTN+120, NWQ+1<=KPY,
C    KTN<=9LTN+119, KTN<=8LTN+120, LTN+NWH+1<=KTN, NWH+1<=KTN,
C    KTO<=8LTN+120, NWH+1<=KTO, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

      KPN = LPN                                                         0934

C  P(N2) {N2==128}

      F2 = 1./(4.*REAL(N2))                                             0935

C  P() {}

      F1 = RNU*DTT                                                      0936

C  P(LEIG,MEMSIZ,NWEIG,NXXXIN) {KPN==LPN, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    NWEIG==127, KPN+KZX<=8LTN+LZX+120, LZX+NWQ+1<=KPN+KZX,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO,
C    NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

C
C FIND PRESSURE NOW OR NEVER (IF REQUIRED...)
C
      CALL IN(EVAL, LEIG, NWEIG)                                        0940

C  P(LVECT,N2M) {LVECT==127, N2M==127}

      LVECT = N2M                                                       0941

C  P(LSKIP) {LSKIP==2}

      LSKIP = 2                                                         0942

C  P(NVECT) {NVECT==2}

      NVECT = 2                                                         0943

C  P(NVSKIP) {NVSKIP==1}

      NVSKIP = 1                                                        0944

C  P() {}

      FXSQ = FX*FX                                                      0945

C  P(I,J,KPN,KZN,MEMSIZ,N1H,N2,N2P,N2PD,NXXOUT,NXXXIN) {I==130, J==33,
C    KPN==LPN, KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4,
C    KTO+LZY==KZY+4LTN-3, KZN==1, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119, N1H==64, N2==128,
C    N2P==129, N2PD==258, KPN+KZX<=8LTN+LZX+120, LZX+NWQ+1<=KPN+KZX,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO,
C    NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

C
C UPDATE VORTICITY AND FIND THE NEW STREAMFUNCTION:
C
      DO 680 J = 1, N1H                                                 0949

C  P(KZN,MEMSIZ,N1H,N2PD,NXXXIN) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPY<=8LTN+120,
C    NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120, LTN+NWH+1<=KTN,
C    NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

         CALL IN(CWORK, KZN, N2PD)                                      0950

C  P(J,N1H) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4,
C    KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119, N1H==64, 1<=J,
C    J<=64, J<=KZN, KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 1<=KZN,
C    KZN+138<=8LTN, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         F = REAL((J-1)*(J-1))*FXSQ                                     0951

C  P(I,N1H,N2) {N1H==64, N2==128}

         DO 690 I = 2, N2                                               0952

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

            CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))               0953

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

            CWORK2(I) = CWORK(I)/(EVAL(I-1)-F)                          0954

C  P(N1H,N2) {N1H==64, N2==128}

690         CONTINUE                                                    0955

C  P(N1H) {N1H==64}

         CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                              0956

C  P(N1H) {N1H==64}

         CWORK2(1) = 0.0                                                0957

C  P(N1H) {N1H==64}

         IF (F.NE.0.0) CWORK2(1) = -CWORK(1)/F                          0958

C  P(N1H,N2P) {N1H==64, N2P==129}

         CWORK(N2P) = 0.0                                               0959

C  P(N1H,N2P) {N1H==64, N2P==129}

         CWORK2(N2P) = 0.0                                              0960

C  P(KZN,MEMSIZ,N1H,N2PD,NXXOUT) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPY<=8LTN+120,
C    NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120, LTN+NWH+1<=KTN,
C    NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 1<=KZN, KZN+138<=8LTN,
C    NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         CALL OUT(CWORK, KZN, N2PD)                                     0961

C  P(KPN,MEMSIZ,N1H,N2PD,NXXOUT) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPY<=8LTN+120,
C    NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120, LTN+NWH+1<=KTN,
C    NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 1<=KZN, KZN+138<=8LTN,
C    NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         CALL OUT(CWORK2, KPN, N2PD)                                    0962

C  P(KPN,N1H,N2PD) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN, 1<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN+138<=8LTN,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 1<=KZN,
C    KZN+138<=8LTN, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

         KPN = KPN+N2PD                                                 0963

C  P(KZN,N1H,N2PD) {KZN+LPN==KPN-257, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J<=KZN, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+377, KZN+LZX+NWQ+258<=KPN+KZX,
C    KPN<=8LTN+120, KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119,
C    KTN<=8LTN+120, LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120,
C    NWH+1<=KTO, 1<=KZN, KZN+138<=8LTN, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

         KZN = KZN+N2PD                                                 0964

C  P(N1H) {N1H==64}

680      CONTINUE                                                       0965

C  P(LZN,MEMSIZ,N1H,N2P,NOALS,NXXOUT,NXXXIN) {KZN+LPN==KPN+1,
C    KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3,
C    8LTN==MEMSIZ-119, LZN==1, N1H==64, N2P==129, NOALS==1, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN,
C    KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

C
C DE-ALIASE UPDATED FIELDS IF REQUESTED:
C
      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LZN)                    0969

C  P(LPN,MEMSIZ,N1H,N2P,NOALS,NXXOUT,NXXXIN) {KZN+LPN==KPN+1,
C    KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3,
C    8LTN==MEMSIZ-119, N1H==64, N2P==129, NOALS==1, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN,
C    KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

      IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LPN)                    0970

C  P(I,J,KTN,LEIG,LTN,MEMSIZ,N1H,N2,N2P,N2PD,NOALS,NOTEMP,NWEIG,
C    NXXOUT,NXXXIN) {I==129, J==65, KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2==128, N2P==129, N2PD==258, NOALS==1, NOTEMP==0,
C    NWEIG==127, 259<=KPN, KPN+KZX<=KZN+8LTN+LZX+119,
C    KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120, KPY<=8LTN+120, NWQ+1<=KPY,
C    KTN<=9LTN+119, KTN<=8LTN+120, LTN+NWH+1<=KTN, NWH+1<=KTN,
C    KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN, KZN<=8LTN+120, NWH+1<=KZO,
C    KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120,
C    LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LPN,
C    LPN<=8LTN+119, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

      IF (NOTEMP.NE.1) THEN                                             0971

C  P(LEIG,MEMSIZ,NOALS,NWEIG,NXXXIN) {KZN+LPN==KPN+1,
C    KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3,
C    8LTN==MEMSIZ-119, NOALS==1, NWEIG==127, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN,
C    KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LPN, LPN<=8LTN+119, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

C
C UPDATE TEMPERATURE:
C
         IF (NOALS.EQ.1) CALL IN(EVAL, LEIG, NWEIG)                     0975

C  P(KTN,LTN) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4,
C    KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTN<=9LTN+119, KTN<=8LTN+120,
C    LTN+NWH+1<=KTN, NWH+1<=KTN, KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN,
C    KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LPN, LPN<=8LTN+119, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

         KTN = LTN                                                      0976

C  P() {}

         F1 = RKAPA*DTT                                                 0977

C  P(I,J,KTN,MEMSIZ,N1H,N2,N2P,N2PD,NXXOUT,NXXXIN) {I==129, J==65,
C    KZN+LPN==KPN+1, KPY+LZX==5KTN+KZX-4, KPY+LZX==KZX+LPY,
C    4KTN+KZY==KTO+LZY+3, 8KTN==LARGE-119, 8KTN==LEIG+7,
C    8KTN==LPRESS+7, KTN==LTN, 4KTN==LTO+3, 8KTN==MEMSIZ-119, N1H==64,
C    N2==128, N2P==129, N2PD==258, 259<=KPN, KPN<=8KTN+120,
C    KPN+KZX<=8KTN+KZN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPY<=8KTN+120,
C    NWQ+1<=KPY, 1<=KTN, KTO<=8KTN+120, KZN<=8KTN+120, KZX<=8KTN+120,
C    KZX+LZY<=8KTN+LZX+120, KZY<=8KTN+120, KZY<=7KTN+LZY+120,
C    LZY+NWH+1<=KTN+KZY, LPN<=8KTN+119, LZX+NW<=8KTN+120,
C    LZX+NWH<=9KTN+119, NWH<=8KTN+LZX+118, LZX+NWH<=8KTN+119,
C    NWH<=7KTN+LZX+119, LZY+NW<=8KTN+120, NW<=8KTN+119, NW<=7KTN+120,
C    NWH<=9KTN+118, NWH<=8KTN+118, NWH<=7KTN+119, NWH+1<=KTO,
C    322<=KZN, NWH+1<=KZO, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LPN, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

         DO 700 J = 1, N1H                                              0978

C  P(KTN,MEMSIZ,N1H,N2PD,NXXXIN) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J+LTN<=KTN+1, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN,
C    KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LPN, LPN<=8LTN+119, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

            CALL IN(CWORK, KTN, N2PD)                                   0979

C  P(J,N1H) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4,
C    KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119, LEIG==8LTN-7,
C    LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119, N1H==64, 1<=J,
C    J<=64, J+LTN<=KTN+1, 259<=KPN, KPN+KZX<=KZN+8LTN+LZX+119,
C    KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120, KPY<=8LTN+120, NWQ+1<=KPY,
C    1<=KTN, KTN+138<=8LTN, KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN,
C    KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120,
C    LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120,
C    KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY,
C    NWH+1<=KZY, 1<=LPN, LPN<=8LTN+119, 1<=LTN, LZX+NW<=8LTN+120,
C    LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119,
C    NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120,
C    NWH<=9LTN+118, NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY,
C    1<=NW, 1<=NWH, 1<=NWQ}

            F = REAL((J-1)*(J-1))*FXSQ                                  0980

C  P(I,N1H,N2) {N1H==64, N2==128}

            DO 710 I = 2, N2                                            0981

C  P(I,N1H,N2) {N1H==64, N2==128, 2<=I, I<=128}

               CWORK(I) = CWORK(I)*F2/(1.0-F1*(EVAL(I-1)-F))            0982

C  P(N1H,N2) {N1H==64, N2==128}

710            CONTINUE                                                 0983

C  P(N1H) {N1H==64}

            CWORK(1) = CWORK(1)*F2/(1.0+F1*F)                           0984

C  P(N1H,N2P) {N1H==64, N2P==129}

            CWORK(N2P) = 0.0                                            0985

C  P(KTN,MEMSIZ,N1H,N2PD,NXXOUT) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J+LTN<=KTN+1, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, 1<=KTN, KTN+138<=8LTN, KTO<=8LTN+120,
C    NWH+1<=KTO, 322<=KZN, KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LPN, LPN<=8LTN+119, 1<=LTN,
C    LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118,
C    LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120,
C    NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118, NWH<=8LTN+118,
C    NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            CALL OUT(CWORK, KTN, N2PD)                                  0986

C  P(KTN,N1H,N2PD) {KZN+LPN==KPN+1, KPY+LZX==KZX+LPY,
C    KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3, LARGE==8LTN+119,
C    LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3, 8LTN==MEMSIZ-119,
C    N1H==64, N2PD==258, 1<=J, J<=64, J+LTN<=KTN+1, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, 1<=KTN, KTN+138<=8LTN, KTO<=8LTN+120,
C    NWH+1<=KTO, 322<=KZN, KZN<=8LTN+120, NWH+1<=KZO, KZX<=8LTN+120,
C    KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY, LZX+NWQ+3<=KZX,
C    NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120, LZY+NWH+1<=KZY+LTN,
C    LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LPN, LPN<=8LTN+119, 1<=LTN,
C    LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119, NWH<=8LTN+LZX+118,
C    LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119, LZY+NW<=8LTN+120,
C    NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118, NWH<=8LTN+118,
C    NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH, 1<=NWQ}

            KTN = KTN+N2PD                                              0987

C  P(N1H) {N1H==64}

700         CONTINUE                                                    0988

C  P(LTN,MEMSIZ,N1H,N2P,NOALS,NXXOUT,NXXXIN) {KZN+LPN==KPN+1,
C    KPY+LZX==KZX+LPY, KPY+LZX==KZX+5LTN-4, KTO+LZY==KZY+4LTN-3,
C    LARGE==8LTN+119, LEIG==8LTN-7, LPRESS==8LTN-7, 4LTN==LTO+3,
C    8LTN==MEMSIZ-119, N1H==64, N2P==129, NOALS==1, 259<=KPN,
C    KPN+KZX<=KZN+8LTN+LZX+119, KZN+LZX+NWQ<=KPN+KZX, KPN<=8LTN+120,
C    KPY<=8LTN+120, NWQ+1<=KPY, 259<=KTN, LTN+321<=KTN, KTN<=8LTN+120,
C    KTO<=8LTN+120, NWH+1<=KTO, 322<=KZN, KZN<=8LTN+120, NWH+1<=KZO,
C    KZX<=8LTN+120, KZX+LZY<=8LTN+LZX+120, LZX+NWQ+1<=KZX+LZY,
C    LZX+NWQ+3<=KZX, NWQ+1<=KZX, KZY<=8LTN+120, KZY<=7LTN+LZY+120,
C    LZY+NWH+1<=KZY+LTN, LZY+NWH+1<=KZY, NWH+1<=KZY, 1<=LPN,
C    LPN<=8LTN+119, 1<=LTN, LZX+NW<=8LTN+120, LZX+NWH<=9LTN+119,
C    NWH<=8LTN+LZX+118, LZX+NWH<=8LTN+119, NWH<=7LTN+LZX+119,
C    LZY+NW<=8LTN+120, NW<=8LTN+119, NW<=7LTN+120, NWH<=9LTN+118,
C    NWH<=8LTN+118, NWH<=7LTN+119, 1<=LZX, 1<=LZY, 1<=NW, 1<=NWH,
C    1<=NWQ}

C
C DE-ALIASE IF REQUESTED:
C
         IF (NOALS.EQ.1) CALL DEALSE(CA, N2P, N1H, LTN)                 0992
      ENDIF

C  P() {}

C
C AT LAST, THE END OF THE TIME STEP:
C
      DTT = DT+DT                                                       0997

C  P() {}

      T = T+DT                                                          0998

C  P(NSTEPS) {}

      NSTEPS = NSTEPS+1                                                 0999

C  P(NSTEPS,NUMBER) {NUMBER==250}

      IF (NUMBER.GE.NSTEPS) GOTO 150                                    1000
C#
c      END IF
C

C  P() {}

      WRITE (6, 9010) TXXXIN, TXXOUT, TXXRCS, TXXCSR, TXSCSC, TXACAC    1004
     &, TFTVMT, TXSHUF, TUSHUF, TXPRNT, TXLOG2                          1004

C  P() {}

      WRITE (6, 9020) EXXRCS, EXXCSR, EXSCSC, EXACAC, EFTVMT            1006

C  P(NFTVMT,NUSHUF,NXACAC,NXLOG2,NXPRNT,NXSCSC,NXSHUF,NXXCSR,NXXOUT,
C    NXXRCS,NXXXIN) {NXSHUF==2}

      WRITE (6, 9030) NXXXIN, NXXOUT, NXXRCS, NXXCSR, NXSCSC, NXACAC    1007
     &, NFTVMT, NXSHUF, NUSHUF, NXPRNT, NXLOG2                          1007

C  P(NUM1) {NUM1==2}

C
      CALL BUG('AFTER  ALL')                                            1010

C  P() {}

C
      CALL CPUTIM(CPU2)                                                 1012

C  P() {}

      CALL ELAPSE(TCLCK2)                                               1013

C  P() {}

C
      TWALL = MOD(TCLCK2-TCLCK1+1000000.0, 1000000.0)                   1015

C  P() {}

      WRITE (6, 9040) TWALL                                             1016

C  P() {}

      WRITE (1, *)                                                      1017

C  P() {}

      WRITE (1, *) 'ELAPSED CPU TIME IN SECONDS: ', CPU2-CPU1           1018

C  P() {}

C MFLOPS RATE = MFLOP 1 CPU CRAY X-MP/CPU TIME
      WRITE (1, *) 'MFLOPS RATE: ', 1657.863/(CPU2-CPU1)                1020

C  P() {}

      WRITE (1, *) 'ELAPSED WALLCLOCK TIME IN SECONDS: ', TWALL         1021

C  P() {}

      WRITE (1, 9050)                                                   1022

C  P(I) {}

      WRITE (1, 9080) (CDAT(I), I = 1, 15)                              1023

C  P() {}

      VALID = 1                                                         1024

C  P(I,VALID) {VALID==1}

      DO 720 I = 1, 15                                                  1025

C  P(I,VALID) {1<=I, I<=15}

         IF (I.EQ.3.OR.I.EQ.13) THEN                                    1026

C  P(I,VALID) {3<=I, I<=13}

            IF (ABS(CDAT(I)).GT.ABS(VDAT(I))) VALID = 0                 1027

         ELSEIF (ABS(VDAT(I)-CDAT(I)).GT.ABS(.01*VDAT(I))) THEN         1026

C  P(VALID) {}

            VALID = 0                                                   1030
         ENDIF

C  P() {}


720      CONTINUE                                                       1033

C  P(VALID) {}

C
      IF (VALID.EQ.1) THEN                                              1035

C  P() {}

         WRITE (1, 9060)                                                1036

      ELSE

C  P() {}

         WRITE (1, 9070)                                                1039
      ENDIF

C  P() {}


c      STOP

9000  FORMAT(1X,'OUTPUT FOR PERFECT CLUB BENCHMARK: OCEAN INSTRUMENTED V
     &ERSION',/,1X,'$Revision: 1.A.1 $ $Author: psharma $',/)           1044

C  P() {}

C
9010  FORMAT(/,2X,'SUBROUTINE    IN, EX-TIME FOR FIRST CALL =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   OUT, EX-TIME FOR FIRST CALL =',1P,E1
     &3.6,/,2X,'SUBROUTINE   RCS, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2
     &X,'SUBROUTINE   CSR, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBR
     &OUTINE  SCSC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE 
     & ACAC, EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE FTRVMT 
     &EX-TIME FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE  SHUF, EX-TIME
     & FOR FIRST CALL =',1P,E13.6,/,2X,'SUBROUTINE UNSHUF EX-TIME FOR FI
     &RST CALL =',1P,E13.6,/,2X,'SUBROUTINE RPRINT EX-TIME FOR FIRST CAL
     &L =',1P,E13.6,/,2X,'SUBROUTINE XLOG2, EX-TIME FOR FIRST CALL =',1P
     &,E13.6)                                                           1048

C  P() {}

9020  FORMAT(/,2X,'SUBROUTINE   RCS, EX-TIME LAST TIMESTEP  =',1P,E13.6,
     &' SECONDS',/,2X,'SUBROUTINE   CSR, EX-TIME LAST TIMESTEP  =',1P,E1
     &3.6,/,2X,'SUBROUTINE  SCSC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2
     &X,'SUBROUTINE  ACAC, EX-TIME LAST TIMESTEP  =',1P,E13.6,/,2X,'SUBR
     &OUTINE FTRVMT EX-TIME LAST TIMESTEP  =',1P,E13.6)                 1062

C  P() {}

9030  FORMAT(/,2X,'SUBROUTINE    IN, CUMULATIVE CALLS TO    =',I12,/,2X,
     &'SUBROUTINE   OUT, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE 
     &  RCS, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE   CSR, CUMUL
     &ATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE  SCSC, CUMULATIVE CALLS 
     &TO    =',I12,/,2X,'SUBROUTINE  ACAC, CUMULATIVE CALLS TO    =',I12
     &,/,2X,'SUBROUTINE FTRVMT CUMULATIVE CALLS TO    =',I12,/,2X,'SUBRO
     &UTINE  SHUF, CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE UNSHUF
     & CUMULATIVE CALLS TO    =',I12,/,2X,'SUBROUTINE RPRINT CUMULATIVE 
     &CALLS TO    =',I12,/,2X,'SUBROUTINE XLOG2, CUMULATIVE CALLS TO    
     &=',I12)                                                           1069

C  P() {}

9040  FORMAT(/,2X,'MEASURE OF WALL-CLOCK TIME (ENVIRONMENT SENSITIVE)',/
     &,2X,'FOR EXECUTION ONLY =',1P,E13.6,1X,'SECONDS')                 1080

C  P() {}

C
9050  FORMAT(/,1X,'VALIDATION PARAMETERS:',/)                           1083

C  P() {}

9060  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE:   VALID')                1084

C  P() {}

9070  FORMAT(/,/,1X,'RESULTS FOR THIS RUN ARE: INVALID')                1085

C  P() {}

9080  FORMAT(5E15.5)                                                    1086

      END
